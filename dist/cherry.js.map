{"version":3,"sources":["config.js","globals.js","matrix.js","recycler.js","rect.js","vec2.js","node_modules/@rsthn/rin/alpha.js","node_modules/@rsthn/rin/class.js","node_modules/@rsthn/rin/event.js","node_modules/@rsthn/rin/event-dispatcher.js","node_modules/@rsthn/rin/model-regex.js","node_modules/@rsthn/rin/model-constraints.js","node_modules/@rsthn/rin/model.js","node_modules/@rsthn/rin/model-list.js","node_modules/@rsthn/rin/schema.js","node_modules/@rsthn/rin/flattenable.js","node_modules/@rsthn/rin/collection.js","node_modules/@rsthn/rin/template.js","node_modules/@rsthn/rin/main.js","tfunction.js","perf.js","keycodes.js","linkable.js","list.js","timer.js","canvas.js","system.js","log.js","wrappers/drawable.js","wrappers/drawable-rect.js","wrappers/spritesheet.js","wrappers/spritesheet-animation.js","wrappers/spritefont.js","wrappers/sound.js","wrappers/sound-array.js","wrappers.js","resources.js","quadtree-item.js","quadtree-node.js","quadtree.js","fragment.js","display-element.js","viewport.js","world.js","easing.js","anim.js","controls/button.js","controls/stick.js","controls.js","main.js"],"names":["module","exports","FPS","ANTIALIAS","BACKGROUND","ORIENTATION","WIDTH","HEIGHT","ORIGINAL_TILE_SIZE","TILE_SIZE","BOARD_WIDTH","BOARD_HEIGHT","SCALE","init","C","require","area","viewport","debugHitbox","debugBounds","debugImage","global","px","value","dispose","obj","reason","__dtor","audioContext","AudioContext","fetchd","url","options","Promise","resolve","reject","responseType","request","XMLHttpRequest","i","open","onload","response","onerror","send","fetchAudioBuffer","then","arrayBuffer","decodeAudioData","audioBuffer","catch","err","int","bool","float","parseFloat","float2","float3","float4","rad","Math","PI","rand","random","randf","randrf","a","b","t","randr","randtf","n","list","push","hrnow","performance","now","randvar","randitem","arr","length","getLineSegmentIntersection","ls1_x1","ls1_y1","ls1_x2","ls1_y2","ls2_x1","ls2_y1","ls2_x2","ls2_y2","dyA","dxA","dyB","dxB","x1","max","min","y1","tA","tB","lineSegmentIntersects","rotatePoint","angle","x","y","Rin","typeOf","cos","sin","stepValue","minValue","maxValue","numSteps","round","alignValue","step","Matrix","data","prototype","toString","zero","set","Array","identity","scalef","f","clone","matr","append","j","k","m","temp","translate","rotate","scale","sx","sy","applyTo","transpose","det","adj","d","inverse","recyclingFacilities","attachTo","_class","_maxPoolSize","className","Error","recyclerPool","objectId","nextObjectId","createdItems","restoredItems","recycledItems","alloc","item","pop","__reinit","apply","arguments","disposeReason","console","error","showStats","group","c","debug","groupEnd","Recycler","Rect","cx","cy","x2","y2","Rect0","Rect2","Rect4","w","h","resize","reset","extendWithPoint2","extendWithPoint1","p","dx","dy","centerAt","relative","set1","set4","r","equals","equals1","equals4","contains","contains1","contains4","setAsUnion","setAsUnion1","setAsUnion4","intersects","intersects1","intersects4","_x1","_y1","_x2","_y2","setAsIntersection","setAsIntersection1","setAsIntersection4","topLeftRelative","resizeBy","dw","dh","width","height","ncx","ncy","isRight","containsPoint","tol","strict","floor","ceil","toFixed","flatten","unflatten","o","Vec2","Vec2_0","Vec2_1","Vec2_2","isZero","neg","inv","abs","add","sub","fx","fy","fract","dot","magnitude","sqrt","normalize","majorAxis","minorAxis","sign","Class","TFunction","extend","__ctor","copyFrom","src","t0","t1","i0","find","i1","getAt","dt","log","endTime","delta","startTime","time","splice","get","x0","y0","integral","c0","tmp","accum","second_integral","a0","Temp1","integrate","a1","Temp2","accumulate","chopLeft","chopRight","map","fn","s","pad","char","Perf","accumSize","expectedValue","stdSum","stdCount","begin","end","feed","report","returnString","avg","std","e","undefined","pow","out","BACKSPACE","TAB","ENTER","ESC","SPACE","PGUP","PGDN","END","HOME","INS","DEL","LEFT","UP","RIGHT","DOWN","NUM_PLUS","NUM_MINUS","NUM_ASTERISK","NUM_SLASH","NUM_DOT","NUM_0","NUM_1","NUM_2","NUM_3","NUM_4","NUM_5","NUM_6","NUM_7","NUM_8","NUM_9","D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","A","B","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","Linkable","prev","next","clear","linkAfter","linkBefore","unlink","List","top","bottom","count","nextItem","index","getNodeAt","sgetNode","remove","isInstanceOf","insertBefore","ref","insertAfter","unshift","shift","Timer","interval","callback","highPerformance","onTimeout","isRunning","targetTime","lastTime","curTime","runAfter","rTime","tError","sTime","tDelta","lTime","onStart","start","timeout","setTimeout","stop","Canvas","elem","opts","document","createElement","passThruCanvas","hidden","body","appendChild","absolute","style","position","left","getContext","gl","context","initGl","antialias","setBackground","background","matrixStack","alphaStack","_alpha","_globalScale","transform","strokeStyle","fillStyle","parentNode","imageSmoothingEnabled","renderingContext","save","restore","setTransform","toDataURL","mime","params","beginPath","moveTo","closePath","lineTo","rect","fill","stroke","fillRect","strokeRect","clip","quadraticCurveTo","cpx","cpy","bezierCurveTo","cx1","cy1","cx2","cy2","arc","sA","eA","cw","arcTo","fillText","text","maxWidth","strokeText","measureText","createImageData","getImageData","putImageData","drawImage","args","getBoundingClientRect","buildShader","program","type","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","gl_array_buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","gl_program","createProgram","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","clearColor","disable","DEPTH_TEST","clearDepth","depthFunc","GEQUAL","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","gl_attrib_location","getAttribLocation","gl_uniform_screen_size","getUniformLocation","gl_uniform_texture_size","gl_uniform_texture","gl_uniform_matrix","gl_uniform_current_matrix","gl_uniform_texture_matrix","enableVertexAttribArray","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","location_matrix","texture_matrix","current_matrix","img","gl_active_texture","gl_texture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","uniform2fv","sw","sh","uniformMatrix3fv","drawArrays","TRIANGLE_STRIP","prepareImage","image","texture","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","gl_ready","applyConfig","imageRendering","removeChild","color","canvasColor","backgroundColor","_width","_height","globalScale","loadIdentity","flipped","toDataUrl","toPng64","substr","_contextAttribute","name","lineCap","lineJoin","lineWidth","miterLimit","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","font","textAlign","textBaseline","globalAlpha","alpha","globalCompositeOperation","clearRect","a3","a4","a7","a8","DEPTH_BUFFER_BIT","COLOR_BUFFER_BIT","clearPath","pushMatrix","popMatrix","pushAlpha","popAlpha","loadMatrix","getMatrix","appendMatrix","useNative","ellipse","ox","oy","xe","ye","xm","ym","circle","line","enablePointerEvents","pointerHandler","pointerScale","pointerOffset","_","_evt","action","buttons","lbuttons","containedBy","pointerHandlers","code","evt","rx","clientX","ry","clientY","dragging","ldx","ldy","ddx","ddy","call","onmousedown","onmouseup","onmousemove","setPointerScale","setPointerOffset","addPointerHandler","removePointerHandler","id","drawImageResource","KeyCodes","System","flags","renderingEnabled","renderingPaused","EVT_KEY_DOWN","EVT_KEY_UP","EVT_POINTER_DOWN","EVT_POINTER_UP","EVT_POINTER_MOVE","EVT_POINTER_DRAG_START","EVT_POINTER_DRAG_MOVE","EVT_POINTER_DRAG_STOP","DEFAULT","LANDSCAPE","PORTRAIT","AUTOMATIC","defaultOptions","canvas","canvas2","fps","minFps","targetScreenWidth","targetScreenHeight","orientation","extraScaleFactor","fullscreen","screenWidth","screenHeight","offsX","offsY","devicePixelRatio","backingStoreRatio","canvasPixelRatio","canvasScaleFactor","scaleFactor","initialMatrix","displayBuffer","displayBuffer2","tempDisplayBuffer","keyState","ctrl","alt","keyCode","pointerState","updateQueue","drawQueue","timeScale","frameInterval","fixedFrameInterval","maxFrameInterval","frameDelta","frameDeltaMillis","frameTime","frameTimeMillis","frameNumber","frameUpdateInProgress","frameDrawInProgress","perf","numFrames","updateTime","drawTime","Object","assign","onresize","onWindowResized","bind","frameTimer","onFrame","pointerEvents","display0","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","_this","onkeydown","target","onKeyboardEvent","onkeyup","ontouchstart","preventDefault","touches","changedTouches","identifier","isActive","isDragging","button","reverseRender","onPointerEvent","ontouchend","deltaTime","ontouchcancel","ontouchmove","which","asSeconds","pause","resume","resetPerf","timer","update","stack","draw","notRendering","_screenWidth","screen","_screenHeight","innerWidth","innerHeight","marginLeft","marginTop","integerScaleFactor","onCanvasResized","updateQueueAdd","updateQueueRemove","drawQueueAdd","drawQueueRemove","queueAdd","queueRemove","dts","dtm","interpolate","dst","duration","easing","interpolator","pointer","pointers","Log","enabled","maxsize","debugEcho","write","msg","fontSize","showFps","showIndex","g","_time","_frames","wrapper","getDrawable","numCols","drawableCache","r_scale","v_scale","config","sheetWidth","frameWidth","frameHeight","r_frameWidth","r_frameHeight","numRows","drawFrame","frame","frameIndex","SpriteSheet","Animation","seq","seq_i","trans","trans_i","trans_t","queue","frameMillis","finished","paused","onFinishedCallback","onFinishedArg","onFrameCallback","onFrameArg","anim","setFps","setPaused","setInitialDelay","onFinished","arg","setFrame","getFrame","normalized","getLength","loop","use","advance","seqName","force","setQueue","enqueue","SpriteSheetAnimation","_super","initialized","def","indexOf","split","initialseq","getSequence","r_charWidth","charWidth","r_charHeight","charHeight","cols","charset","charTable","widths","w1","w2","measureWidth","measureHeight","drawText","drawTextAligned","ax","ay","drawTextAligned2","bounds","Sound","track","toUpperCase","play","volume","playLoop","ENGINE_HTML5","ENGINE_WEBAUDIO","ENGINE_NATIVEAUDIO","override","MASTER","SFX","MUSIC","VOICE","MAX_POOL_SIZE","pool","active","register","node","registered","unregister","updateNode","cmd","snd","engine","updateNode_webaudio","updateNode_nativeaudio","updateNode_audio","alloc_webaudio","gainNode","createGain","gain","connect","destination","res","createBufferSource","buffer","free_webaudio","disconnect","alloc_nativeaudio","free_nativeaudio","alloc_audio","cloneNode","_src","free_audio","playing","playTime","onended","onended_webaudio","currentTarget","plugins","NativeAudio","onended_nativeaudio","onended_audio","currentTime","enableTrack","disableTrack","setVolume","createNode","startVolume","completeCallback","fadeOut","millis","setInterval","clearInterval","fadeIn","mode","sounds","lastIndex","getRandomSound","playAt","playLoopAt","Drawable","DrawableRect","SpriteFont","SoundArray","Wrappers","Resources","integerScaling","load","keyList","keys","__original","resName","Image","ratio","owidth","oheight","original","resizeImage","pixelated","rscale","onLoaded","d0","dN","d1","lastIndexOf","_i","cb","preloadSimple","Audio","oncanplaythrough","json","unload","discardOriginal","rep_x","rep_y","output","sp","tw","th","flipImageHorz","showDownload","filename","dataUrl","link","href","display","download","click","showFilePicker","allowMultiple","accept","input","multiple","onchange","files","onfocus","loadAsDataURL","file","reader","FileReader","result","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataURL","fileList","loadNext","size","QuadTreeItem","insertionBounds","lastBounds","lbounds","zindex","visible","numRefNodes","tag","FLAG_INITIAL","setFlags","clearFlags","getFlags","setTag","getTag","setZIndex","getZIndex","notifyInserted","tree","FLAG_ATTACHED","getBounds","notifyRemoved","notifyPosition","getInsertionBounds","getLastBounds","getLBounds","setType","getType","setVisible","getVisible","FLAG_QUEUED","FLAG_SELECTED","FLAG_ALWAYS_SELECT","FLAG_CHILD","FLAG_USERDEF","QuadTreeNode","extents","numItems","insertionPoint","subNode","isDirty","items","getExtents","addItem","capacity","cur","removeItem","selectItems","detectCollisions","handler","i_next","onFilterRequest","j_next","iId","jId","onCollision","QuadTree","root","orderedItems","nodeCapacity","isReverse","xd","yd","zd","fnComparator","COMPARATOR_DEFAULT_YX","setXd","setYd","setZd","getXd","getYd","getZd","setComparator","q","COMPARATOR_DEFAULT_XY","COMPARATOR_MANHATTAN","COMPARATOR_Y2","COMPARATOR_Y1","COMPARATOR_X2","COMPARATOR_X1","isBefore","addItemOrdered","reorderItems","updateItem","getItems","setReverse","getNextSelectedItem","ret","attempts","DisplayElement","Fragment","parent","FLAG_FRAGMENT","layer","fragments","scrX","scrY","related","setPosition","setLayer","setRelated","addFragment","fragment","getNumFragments","getFragments","onPositionChanged","zi","dzi","setBounds","centerRelative","getScrX","getScrY","setX","setY","getX","getY","FLAG_HOLLOW","Viewport","worldWidth","worldHeight","focusFactorX","focusFactorY","focusTarget","worldX1","worldY1","worldX2","worldY2","focusBounds","screenBounds","updateScreenBounds","updateBounds","centerRatioX","centerRatioY","isEnabled","setEnabled","setScale","setCenter","setScreenPosition","getPositionX","getPositionY","getWidth","getHeight","getScreenBounds","getFocusBounds","focusOn","kx","ky","nx","ny","setFocusTarget","setFocusFactor","valueX","valueY","applyTransform","toWorldSpace","toScreenSpace","World","numViewports","viewports","numLayers","layers","debugLBounds","onLayerDrawn","fullClear","drawHollow","focusFactor","halfX","halfY","minX","maxX","minY","maxY","getViewport","getLayer","viewportIndex","clipArea","layerIndex","selectedCount","updateElems","onUpdated","updateLayers","updateViewports","_used","truncatePosition","elemBounds","moveToContact","ra","rb","p_ra","getVelocity","t_bottom","t_top","t_left","t_right","dir","T_TOP","T_BOTTOM","T_LEFT","T_RIGHT","Easing","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","Quad","Quartic","Quintic","Sine","Step","Anim","initialData","block","blockTime","initial","setOutput","op","started","blocks","indices","blockTimes","_block","_index","_blockTime","_count","field","startValue","_startValue","_endValue","endValue","last","table","parallel","serial","repeat","restart","wait","range","randt","exec","Controls","hbounds","focusLock","refX","refY","status","pstatus","unpressedImg","pressedImg","getXByRef","getYByRef","getFByRef","preDraw","postDraw","activate","_ref","onChange","deactivate","pointerX","pointerY","onTap","dispX","dispY","radius","angleSteps","radiusSteps","rdirX","rdirY","dirX","dirY","outerImg","innerImg","maxRadius","maxRadiusRatio","atan2","fs","TOP","BOTTOM","CENTER","Button","Stick"],"mappings":"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","file":"cherry.js","sourceRoot":"..","sourcesContent":["/*\n**\t@rsthn/cherry/config\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tContains configuration constants. Can be extended as needed from other modules.\n*/\n\nmodule.exports =\n{\n\tFPS:\t\t\t\t\t60,\n\tANTIALIAS:\t\t\t\tfalse,\n\tBACKGROUND:\t\t\t\t'#000',\n\n\tORIENTATION:\t\t\t0,\n\tWIDTH: \t\t\t\t\t360,\n\tHEIGHT: \t\t\t\t640,\n\n\tORIGINAL_TILE_SIZE:\t\t32,\n\tTILE_SIZE: \t\t\t\t64,\n\n\tBOARD_WIDTH:\t\t\t10,\n\tBOARD_HEIGHT:\t\t\t5,\n\n\tSCALE:\t\t\t\t\t1,\n\n\tinit: function ()\n\t{\n\t\tthis.SCALE = this.TILE_SIZE / this.ORIGINAL_TILE_SIZE;\n\t}\n};\n","/*\n**\t@rsthn/cherry/globals\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst C = require('./config');\n\n/**\n**\tGlobal functions and definitions.\n*/\n\n/**\n**\tVariables and behavior flags, can be extended as needed from other modules.\n*/\n\nmodule.exports =\n{\n\tarea: null,\n\tviewport: null,\n\n\tdebugHitbox: false,\n\tdebugBounds: false,\n\tdebugImage: false\n};\n\n\n/**\n**\tConverts the given pixel-value to actual screen pixels taking into account the current scale.\n**\n**\t>> float px (float value);\n*/\n\nglobal.px = function(value)\n{\n\treturn value*C.SCALE;\n};\n\n\n/**\n**\tDisposes an object, first by checking if it has a 'dispose' method, and if not, tried to check\n**\twith a '__dtor' method.\n**\n**\t>> dispose (object obj, string reason);\n**\t>> dispose (object obj);\n*/\n\nglobal.dispose = function (obj, reason)\n{\n\tif (!obj) return;\n\n\tif ('dispose' in obj)\n\t{\n\t\tobj.dispose(reason);\n\t\treturn;\n\t}\n\n\tif ('__dtor' in obj) obj.__dtor();\n};\n\n\n/**\n**\tCreates a global AudioContext if supported.\n*/\n\nif ('AudioContext' in global)\n\tglobal.audioContext = new AudioContext();\nelse\n\tglobal.audioContext = null;\n\n\n/**\n**\tSimilar to fetch() but uses XMLHttpRequest, as in some mobile browsers normal mode does not work well for ArrayBuffers.\n**\n**\t>> Promise fetchd (string url, object options);\n**\t>> Promise fetchd (string url);\n*/\n\nglobal.fetchd = function (url, options)\n{\n\treturn new Promise ((resolve, reject) =>\n\t{\n\t\tif (!options) options = { };\n\t\tif (!('responseType' in options)) options.responseType = 'arraybuffer';\n\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open('GET', url, true);\n\n\t\tfor (var i in options) request[i] = options[i];\n\n\t\trequest.onload = function() {\n\t\t\tresolve (request.response);\n\t\t};\n\n\t\trequest.onerror = function() {\n\t\t\treject ('Unable to fetch specified resource.');\n\t\t};\n\n\t\trequest.send();\n\t});\n};\n\n\n/**\n**\tLoads an arraybuffer from the specified URL and converts it to a AudioBuffer using the global audioContext.\n**\n**\t>> Promise fetchAudioBuffer (string url);\n*/\n\nglobal.fetchAudioBuffer = function (url)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (!global.audioContext)\n\t\t{\n\t\t\treject ('AudioContext is not available.');\n\t\t\treturn;\n\t\t}\n\n\t\tfetchd(url)\n\t\t.then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))\n\t\t.then(audioBuffer => resolve(audioBuffer))\n\t\t.catch(err => reject(err));\n\t});\n};\n\n\n/**\n**\tReturns the value as an integer.\n**\n**\tint int (T value);\n*/\n\nglobal.int = function (value)\n{\n\treturn ~~value;\n};\n\n\n/**\n**\tReturns the value as a boolean.\n**\n**\tbool bool (T value);\n*/\n\nglobal.bool = function (value)\n{\n\tif (value === true || value === false)\n\t\treturn value;\n\n\tif (value == 'true')\n\t\treturn true;\n\n\tif (value == 'false')\n\t\treturn false;\n\n\treturn !(!value);\n};\n\n\n/**\n**\tReturns the value as a floating point number.\n**\n**\tfloat float (T value);\n*/\n\nglobal.float = function (value)\n{\n\treturn parseFloat(value);\n};\n\n\n/**\n**\tReturns the value with 2 digits of precision.\n**\n**\tfloat float2 (float value);\n*/\n\nglobal.float2 = function (value)\n{\n\treturn (~~(value*100))/100;\n};\n\n\n/**\n**\tReturns the value with 3 digits of precision.\n**\n**\tfloat float3 (float value);\n*/\n\nglobal.float3 = function (value)\n{\n\treturn (~~(value*1000))/1000;\n};\n\n\n/**\n**\tReturns the value with 4 digits of precision.\n**\n**\tfloat float4 (float value);\n*/\n\nglobal.float4 = function (value)\n{\n\treturn (~~(value*10000))/10000;\n};\n\n\n/**\n**\tConverts the given value to radians.\n**\n**\tfloat rad (float value);\n*/\n\nglobal.rad = function (value)\n{\n\treturn value*Math.PI / 180;\n};\n\n\n/**\n**\tReturns a random integer value from 0 to 0xFFFF (inclusive).\n**\n**\tint rand ();\n*/\n\nglobal.rand = function ()\n{\n\treturn int(Math.random()*0x10000);\n};\n\n\n/**\n**\tReturns a random float from 0 to 1 (non-inclusive).\n**\n**\tfloat randf ();\n*/\n\nglobal.randf = function ()\n{\n\treturn Math.random();\n};\n\n\n/**\n**\tReturns a random float within the given (non-inclusive) range.\n**\n**\tfloat randrf (float a, float b);\n*/\n\nglobal.randrf = function (a, b)\n{\n\tlet t = Math.random();\n\treturn t*b + (1-t)*a;\n};\n\n\n/**\n**\tReturns a random integer within the given range (inclusive).\n**\n**\tint randr (int a, int b);\n*/\n\nglobal.randr = function (a, b)\n{\n\tlet t = Math.random();\n\treturn ~~(t*b + (1-t)*a);\n};\n\n\n/**\n**\tReturns a table of random float numbers within the given range (non-inclusive).\n**\n**\tarray randtf (float a, float b, int n);\n*/\n\nglobal.randtf = function (a, b, n)\n{\n\tvar list = [ ];\n\n\tfor (var i = 0; i < n; i++)\n\t\tlist.push(randrf(a, b));\n\n\treturn list;\n};\n\n\n/**\n**\tReturns the high-resolution 'now' counter in milliseconds.\n**\n**\tint hrnow();\n*/\n\nglobal.hrnow = function ()\n{\n\treturn ~~performance.now();\n};\n\n\n/**\n**\tReturns a function that produces a random integer value within the given (inclusive) range.\n**\n**\tfunction randvar (int a, int b);\n*/\n\nglobal.randvar = function (a, b)\n{\n\treturn function() { return randr(a, b); };\n};\n\n\n/**\n**\tReturns a function that returns an item from the specified array at some random index within the\n**\tgiven inclusive range.\n**\n**\tfunction randitem (array arr, int a, int b);\n**\tfunction randitem (array arr, int a);\n**\tfunction randitem (array arr);\n*/\n\nglobal.randitem = function (arr, a, b)\n{\n\tif (!a) a = 0;\n\tif (!b) b = arr.length - 1;\n\n\treturn function() { return arr[randr(a, b)]; };\n};\n\n\n/**\n**\tReturns the parameter 't' where two line segments intersect.\n**\n**\tfloat getLineSegmentIntersection (float ls1_x1, float ls1_y1, float ls1_x2, float ls1_y2, float ls2_x1, float ls2_y1, float ls2_x2, float ls2_y2);\n*/\n\nglobal.getLineSegmentIntersection = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\t// Case #1: Identical segments.\n\tif (ls1_x1 == ls2_x1 && ls1_y1 == ls2_y1 && ls1_x2 == ls2_x2 && ls1_y2 == ls2_y2)\n\t\treturn 0;\n\n\tlet inf = 2.0;\n\n\tvar dyA = ls1_y2 - ls1_y1;\n\tvar dxA = ls1_x2 - ls1_x1;\n\tvar dyB = ls2_y2 - ls2_y1;\n\tvar dxB = ls2_x2 - ls2_x1;\n\n\t// Case #2: Horizontal vs. Horizontal\n\tif (dyA == 0 && dyB == 0)\n\t{\n\t\tif (ls1_y1 != ls2_y1) return inf;\n\n\t\tvar x1 = Math.max(ls1_x1, ls2_x1);\n\t\tvar x2 = Math.min(ls1_x2, ls2_x2);\n\n\t\tif (x1 > x2) return inf;\n\n\t\treturn (x1 - ls1_x1) / dxA;\n\t}\n\n\t// Case #3: Vertical vs. Vertical\n\tif (dxA == 0 && dxB == 0)\n\t{\n\t\tif (ls1_x1 != ls2_x1) return inf;\n\n\t\tvar y1 = Math.max(ls1_y1, ls2_y1);\n\t\tvar y2 = Math.min(ls1_y2, ls2_y2);\n\n\t\tif (y1 > y2) return inf;\n\n\t\treturn (y1 - ls1_y1) / dyA;\n\t}\n\n\t// Case #4: Vertical vs. Horizontal or Sloped\n\tif (dxA == 0)\n\t{\n\t\tvar tA = (dyB*(ls1_x1 - ls2_x1) + dxB*(ls2_y1 - ls1_y1)) / (dxB * dyA);\n\t\tif (0 > tA || tA > 1) return inf;\n\n\t\tvar tB = (ls1_x1 - ls2_x1) / dxB; \n\t\tif (0 > tB || tB > 1) return inf;\n\n\t\treturn tA;\n\t}\n\n\t// Case #5: Regular line segments.\n\tvar a = dyA*(ls2_x1 - ls1_x1) + dxA*(ls1_y1 - ls2_y1);\n\tvar b = dyB*dxA - dxB*dyA;\n\n\tif (b == 0) return inf;\n\n\tvar tB = a / b;\n\tif (0 > tB || tB > 1) return inf;\n\n\tvar tA = (dxB*tB + ls2_x1 - ls1_x1) / dxA;\n\tif (0 > tA || tA > 1) return inf;\n\n\treturn tA;\n};\n\n\n/**\n**\tReturns boolean if the line segments intersect.\n**\n**\tbool lineSegmentIntersects (float ls1_x1, float ls1_y1, float ls1_x2, float ls1_y2, float ls2_x1, float ls2_y1, float ls2_x2, float ls2_y2);\n*/\n\nglobal.lineSegmentIntersects = function (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2)\n{\n\tlet t = getLineSegmentIntersection (ls1_x1, ls1_y1, ls1_x2, ls1_y2, ls2_x1, ls2_y1, ls2_x2, ls2_y2);\n\treturn t >= 0 && t <= 1.0;\n};\n\n/**\n**\tRotates a point (2d) by the given angle and returns an object.\n**\n**\t>> Object{x,y} rotatePoint (Object{x,y} angle, x, y);\n**\t>> Object{x,y} rotatePoint (float angle, x, y);\n*/\n\nglobal.rotatePoint = function (angle, x, y)\n{\n\tif (Rin.typeOf(angle) == \"object\")\n\t\treturn { x: x*angle.x + y*angle.y, y: y*angle.x - x*angle.y };\n\telse\n\t\treturn { x: x*Math.cos(angle) + y*Math.sin(angle), y: y*Math.cos(angle) - x*Math.sin(angle) };\n};\n\n\n/**\n**\tReturns a value snapped to a step within the given range.\n**\n**\tfloat stepValue (float value, float minValue, float maxValue, int numSteps);\n*/\n\nglobal.stepValue = function (value, minValue, maxValue, numSteps)\n{\n\treturn ((Math.round(numSteps * (value - minValue) / (maxValue - minValue))) / numSteps) * (maxValue - minValue) + minValue;\n};\n\n\n/**\n**\tReturns a value that is a factor of the specified step.\n**\n**\tfloat alignValue (float value, float step);\n*/\n\nglobal.alignValue = function (value, step)\n{\n\treturn Math.round(value/step)*step;\n};\n\n\nrequire('./shims');\n","/*\n**\t@rsthn/cherry/matrix\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tRepresents a 3x3 matrix. Provides an interface to manipulate 3x3 matrices.\n*/\n\n/**\n**\tConstructs a Matrix object. The components are set to the identity matrix.\n*/\n\nconst Matrix = module.exports = function ()\n{\n\tthis.data = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n};\n\n\n/**\n**\tReturns a string representation of the matrix.\n**\n**\t>> string toString()\n*/\n\nMatrix.prototype.toString = function ()\n{\n\treturn `[${this.data[0]}, ${this.data[1]}, ${this.data[2]}]\\n[${this.data[3]}, ${this.data[4]}, ${this.data[5]}]\\n[${this.data[6]}, ${this.data[7]}, ${this.data[8]}]\\n`;\n};\n\n\n/**\n**\tSets the matrix to the zero matrix.\n**\n**\t>> Matrix zero();\n*/\n\nMatrix.prototype.zero = function ()\n{\n\tfor (var i = 0; i < 9; i++) this.data[i] = 0;\n\treturn this;\n};\n\n\n/**\n**\tSets all matrix elements to a given value.\n**\n**\t>> Matrix set (float value);\n*/\n\nMatrix.prototype.set = function (value)\n{\n\tif (value instanceof Matrix)\n\t{\n\t\tfor (let i = 0; i < 9; i++)\n\t\t\tthis.data[i] = value.data[i];\n\t}\n\telse if (value instanceof Array)\n\t{\n\t\tfor (let i = 0; i < 9; i++)\n\t\t\tthis.data[i] = value[i];\n\t}\n\telse\n\t{\n\t\tfor (let i = 0; i < 9; i++)\n\t\t\tthis.data[i] = value;\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tSets the matrix to the identity matrix.\n**\n**\t>> Matrix identity();\n*/\n\nMatrix.prototype.identity = function ()\n{\n\tfor (var i = 0; i < 9; i++) this.data[i] = i&3?0:1;\n\treturn this;\n};\n\n\n/**\n**\tMultiplies all elements in the matrix by a given scalar.\n**\n**\t>> Matrix scalef (float f);\n*/\n\nMatrix.prototype.scalef = function (f)\n{\n\tfor (var i = 0; i < 9; i++) this.data[i] *= f;\n\treturn this;\n};\n\n\n/**\n**\tReturns a new matrix with the same values as this one.\n**\n**\t>> Matrix clone();\n*/\n\nMatrix.prototype.clone = function ()\n{\n\tvar matr = new Matrix ();\n\n\tfor (var i = 0; i < 9; i++) matr.data[i] = this.data[i];\n\treturn matr;\n};\n\n\n/**\n**\tAppends two matrices (the current one and the given one) by using matrix multiplication.\n**\n**\tMatrix append (Matrix matr);\n*/\n\nMatrix.prototype.append = function (matr)\n{\n\tvar i, j, k, m, temp = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n\tif (matr[\"data\"]) matr = matr.data;\n\n\tfor (j = 0; j < 3; j++)\n\t{\n\t\tfor (i = 0; i < 3; i++)\n\t\t{\n\t\t\tm = 0;\n\n\t\t\tfor (k = 0; k < 3; k++)\n\t\t\t{\n\t\t\t\tm += this.data[j*3+k] * matr[k*3+i];\n\t\t\t}\n\n\t\t\ttemp[j*3+i] = m;\n\t\t}\n\t}\n\n\tfor (i = 0; i < 9; i++) this.data[i] = temp[i];\n\treturn this;\n};\n\n\n/**\n**\tCreates a translation matrix and appends it to the current matrix.\n**\n**\t>> Matrix translate (float x, float y);\n*/\n\nMatrix.prototype.translate = function (x, y)\n{\n\tif (x == 0 && y == 0)\n\t\treturn this;\n\n\treturn this.append ([1, 0, x, 0, 1, y, 0, 0, 1]);\n};\n\n\n/**\n**\tCreates a rotation matrix for the given angle (in radians) and appends it to the current matrix.\n**\n**\t>> Matrix rotate (float angle);\n*/\n\nMatrix.prototype.rotate = function (angle)\n{\n\tif (angle == 0)\n\t\treturn this;\n\n\treturn this.append ([Math.cos(angle), Math.sin(angle), 0, -Math.sin(angle), Math.cos(angle), 0, 0, 0, 1]);\n};\n\n\n/**\n**\tCreates a scale transformation matrix and appends it to the current matrix.\n**\n**\t>> Matrix scale (float sx, float sy);\n*/\n\nMatrix.prototype.scale = function (sx, sy)\n{\n\tif (sx == 1 && sy == 1)\n\t\treturn this;\n\n\treturn this.append ([sx, 0, 0, 0, sy, 0, 0, 0, 1]);\n};\n\n\n/**\n**\tApplies the matrix to a vector to transform it and returns a new vector.\n**\n**\t>> Object{x,y} applyTo (float x, float y);\n*/\n\nMatrix.prototype.applyTo = function (x, y)\n{\n\tvar nx = this.data[0]*x + this.data[1]*y + this.data[2];\n\tvar ny = this.data[3]*x + this.data[4]*y + this.data[5];\n\n\treturn { x:nx, y:ny };\n};\n\n\n/**\n**\tReturns the transpose of the matrix.\n**\n**\t>> Matrix transpose();\n*/\n\nMatrix.prototype.transpose = function ()\n{\n\tvar temp = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n\tfor (var j = 0; j < 3; j++)\n\tfor (var i = 0; i < 3; i++)\n\t\ttemp[j*3+i] = this.data[i*3+j];\n\n\tfor (let i = 0; i < 9; i++)\n\t\tthis.data[i] = temp[i];\n\n\treturn this;\n};\n\n/**\n**\tReturns the determinant of the matrix.\n**\n**\t>> float det();\n*/\n\nMatrix.prototype.det = function ()\n{\n\treturn\tthis.data[0] * (this.data[4]*this.data[8] - this.data[5]*this.data[7]) -\n\t\t\tthis.data[1] * (this.data[3]*this.data[8] - this.data[5]*this.data[6]) +\n\t\t\tthis.data[2] * (this.data[3]*this.data[7] - this.data[4]*this.data[6])\n\t\t\t;\n};\n\n\n/**\n**\tReturns the adjoint of the matrix as a new matrix.\n**\n**\t>> Matrix adj();\n*/\n\nMatrix.prototype.adj = function ()\n{\n\tvar t = this.transpose();\n\tvar d = [];\n\n\td[0] = (t.data[4]*t.data[8] - t.data[5]*t.data[7]);\n\td[1] = -(t.data[3]*t.data[8] - t.data[5]*t.data[6]);\n\td[2] = (t.data[3]*t.data[7] - t.data[4]*t.data[6]);\n\n\td[3] = -(t.data[1]*t.data[8] - t.data[2]*t.data[7]);\n\td[4] = (t.data[0]*t.data[8] - t.data[2]*t.data[6]);\n\td[5] = -(t.data[0]*t.data[7] - t.data[1]*t.data[6]);\n\n\td[6] = (t.data[1]*t.data[5] - t.data[2]*t.data[4]);\n\td[7] = -(t.data[0]*t.data[5] - t.data[2]*t.data[3]);\n\td[8] = (t.data[0]*t.data[4] - t.data[1]*t.data[3]);\n\n\tt.data = d;\n\treturn t;\n};\n\n\n/**\n**\tReturns the inverse of the matrix as a new matrix.\n**\n**\tMatrix inverse();\n*/\n\nMatrix.prototype.inverse = function ()\n{\n\tvar det = this.det();\n\tif (!det) return null;\n\n\treturn this.adj().scalef(1/det);\n};\n","/*\n**\t@rsthn/cherry/recycler\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst recyclingFacilities = { };\n\n/**\n**\tAttaches recycling methods (alloc, dispose) to the specified class. Class should have methods __reinit to reinitialize the\n**\tobject and __dtor to destroy it.\n**\n**\t>> void attachTo (function classConstructor, int maxPoolSize=1024);\n*/\n\nmodule.exports.attachTo = function (_class, _maxPoolSize)\n{\n\tif (!_maxPoolSize) _maxPoolSize = 1024;\n\n\tif (!_class.prototype.className)\n\t\tthrow new Error ('Unable to attach recycler functions to unnamed class.');\n\n\trecyclingFacilities[_class.prototype.className] = _class;\n\n\t_class.recyclerPool = [ ];\n\n\t_class.prototype.objectId = 0;\n\t_class.nextObjectId = 0;\n\n\t_class.createdItems = 0;\n\t_class.restoredItems = 0;\n\t_class.recycledItems = 0;\n\n\t_class.alloc = function()\n\t{\n\t\tvar item;\n\n\t\tif (!this.recyclerPool.length)\n\t\t{\n\t\t\titem = new _class ();\n\t\t\t_class.createdItems++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\titem = this.recyclerPool.pop();\n\t\t\t_class.restoredItems++;\n\t\t}\n\n\t\tif (\"__reinit\" in item)\n\t\t\titem.__reinit.apply(item, arguments);\n\n\t\titem.objectId = ++this.nextObjectId;\n\t\tthis.nextObjectId = this.nextObjectId & 0x3FFFFFFF;\n\n\t\treturn item;\n\t};\n\n\t_class.prototype.dispose = function (reason)\n\t{\n\t\tif (this.objectId == 0)\n\t\t{\n\t\t\tconsole.error ('Already disposed (' + _class.prototype.className + '): ' + reason + ' / ' + this.disposeReason);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\"__dtor\" in this) this.__dtor();\n\n\t\t_class.recycledItems++;\n\n\t\tthis.objectId = 0;\n\t\tthis.disposeReason = reason;\n\n\t\tif (_class.recyclerPool.length < _maxPoolSize)\n\t\t\t_class.recyclerPool.push (this);\n\t};\n};\n\n\n/**\n**\tShows stats about all recycling facilities using console.debug.\n**\n**\tvoid showStats();\n*/\n\nmodule.exports.showStats = function ()\n{\n\tconsole.group(\"Recycling Facilities\");\n\n\tfor (var i in recyclingFacilities)\n\t{\n\t\tvar c = recyclingFacilities[i];\n\t\tconsole.debug (i + \": created=\" + c.createdItems + \", restored=\" + c.restoredItems + \", recycled=\" + c.recycledItems + \", available=\" + c.recyclerPool.length);\n\t}\n\n\tconsole.groupEnd();\n};\n","/*\n**\t@rsthn/cherry/rect\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst Recycler = require('./recycler');\n\n/**\n**\tRepresents a 2D rectangle.\n*/\n\nconst Rect = module.exports = function ()\n{\n};\n\nRect.prototype.className = 'Rect';\n\n/**\n**\tCoordinates of the rectangle (cx and cy are for the center). Note that this fields are readonly they should be modified\n**\tthrough methods only.\n*/\nRect.prototype.cx = 0;\nRect.prototype.cy = 0;\nRect.prototype.x1 = 0;\nRect.prototype.y1 = 0;\nRect.prototype.x2 = 0;\nRect.prototype.y2 = 0;\n\n/**\n**\tInitializes the rect (takes 0, 2 or 4 parameters).\n*/\nRect.prototype.__reinit = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 0: this.Rect0.apply(this, arguments); break;\n\t\tcase 2: this.Rect2.apply(this, arguments); break;\n\t\tcase 4: this.Rect4.apply(this, arguments); break;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tConstructs a rectangle object. All values are set to zero.\t \n*/\nRect.prototype.Rect0 = function ()\n{\n\tthis.x1 = this.y1 = this.x2 = this.y2 = this.cx = this.cy = 0;\n};\n\n/**\n**\tConstructs a rectangle object with the given coordinates.\t \n*/\nRect.prototype.Rect4 = function (x1, y1, x2, y2)\n{\n\tthis.set (x1, y1, x2, y2);\n};\n\n/**\n**\tConstructs a rectangle object with the given size (centers at zero).\t \n*/\nRect.prototype.Rect2 = function (w, h)\n{\n\tthis.set (0, 0, 0, 0);\n\tthis.resize (w, h);\n};\n\n/**\n**\tClones the rect and returns a new object.\t \n*/\nRect.prototype.clone = function ()\n{\n\treturn Rect.alloc (this.x1, this.y1, this.x2, this.y2);\n};\n\nRect.prototype.zero = function ()\n{\n\tthis.cx = 0; this.cy = 0;\n\tthis.x1 = 0; this.y1 = 0;\n\tthis.x2 = 0; this.y2 = 0;\n\n\treturn this;\n};\n\nRect.prototype.reset = function ()\n{\n\tthis.cx = null; this.cy = null;\n\tthis.x1 = null; this.y1 = null;\n\tthis.x2 = null; this.y2 = null;\n\n\treturn this;\n};\n\nRect.prototype.extendWithPoint2 = function (x, y)\n{\n\tif (this.x1 === null || x < this.x1) this.x1 = x;\n\tif (this.y1 === null || y < this.y1) this.y1 = y;\n\tif (this.x2 === null || x > this.x2) this.x2 = x;\n\tif (this.y2 === null || y > this.y2) this.y2 = y;\n\n\tthis.cx = (this.x1 + this.x2) / 2;\n\tthis.cy = (this.y1 + this.y2) / 2;\n\n\treturn this;\n};\n\nRect.prototype.extendWithPoint1 = function (p)\n{\n\treturn this.extendWithPoint2(p.x, p.y);\n};\n\n/**\n**\tTranslates the rectangle by the given deltas.\t \n*/\nRect.prototype.translate = function (dx, dy)\n{\n\tthis.x1 += dx; this.y1 += dy;\n\tthis.x2 += dx; this.y2 += dy;\n\tthis.cx += dx; this.cy += dy;\n\n\treturn this;\n};\n\n/**\n**\tMoves the center of the rectangle to the specified position.\t \n*/\nRect.prototype.centerAt = function (x, y, relative=false)\n{\n\tif (relative == true)\n\t{\n\t\tx = this.x1 + x*(this.x2 - this.x1);\n\t\ty = this.y1 + y*(this.y2 - this.y1);\n\t}\n\n\treturn this.translate (x - this.cx, y - this.cy);\n};\n\n/**\n**\tSets the coordinates of the rectangle.\t \n*/\nRect.prototype.set = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.set1.apply(this, arguments);\n\t\tcase 4: return this.set4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tSets the coordinates of the rectangle.\t \n*/\nRect.prototype.set4 = function (x1, y1, x2, y2)\n{\n\tthis.cx = (x1 + x2) / 2;\n\tthis.cy = (y1 + y2) / 2;\n\n\tthis.x1 = x1;\n\tthis.y1 = y1;\n\tthis.x2 = x2;\n\tthis.y2 = y2;\n\n\treturn this;\n};\n\n/**\n**\tCopies the coordinates of a given rectangle.\t \n*/\nRect.prototype.set1 = function (r)\n{\n\treturn this.set4 (r.x1, r.y1, r.x2, r.y2);\n};\n\n/**\n**\tReturns true if the specified rect is equal to the current rect.\n*/\nRect.prototype.equals = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.equals1.apply(this, arguments);\n\t\tcase 4: return this.equals4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tReturns true if the specified rect is equal to the current rect.\n*/\nRect.prototype.equals1 = function (r)\n{\n\treturn this.x1 == r.x1 && this.x2 == r.x2 && this.y1 == r.y1 && this.y2 == r.y2;\n};\n\n/**\n**\tReturns true if the specified rectangle is equal to the current rect.\n*/\nRect.prototype.equals4 = function (x1, y1, x2, y2)\n{\n\treturn x1 == this.x1 && x2 == this.x2 && y1 == this.y1 && y2 == this.y2;\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.contains = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.contains1.apply(this, arguments);\n\t\tcase 4: return this.contains4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.contains1 = function (b)\n{\n\treturn b.equals(Math.max(this.x1, b.x1), Math.max(this.y1, b.y1), Math.min(this.x2, b.x2), Math.min(this.y2, b.y2));\n};\n\n/**\n**\tReturns a bool indicating if the rectangle defined by the specified coordinates is contained by the current rectangle.\n*/\nRect.prototype.contains4 = function (x1, y1, x2, y2)\n{\n\treturn (x1 == Math.max(this.x1, x1)) && (y1 == Math.max(this.y1, y1)) && (x2 == Math.min(this.x2, x2)) && (y2 == Math.min(this.y2, y2));\n};\n\n/**\n**\tReturns a bool indicating if the specified rectangle object is contained by the current rectangle.\n*/\nRect.prototype.setAsUnion = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.setAsUnion1.apply(this, arguments);\n\t\tcase 4: return this.setAsUnion4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tSets the rect to the union box formed by the current rect and the given one. The resulting bounding box will contain any\n**\tpoint from either rect.\n*/\nRect.prototype.setAsUnion1 = function (b)\n{\n\treturn this.setAsUnion4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tSets the rect to the union box formed by the current rect and the given one. The resulting bounding box will contain any\n**\tpoint from either rect.\n*/\nRect.prototype.setAsUnion4 = function (x1, y1, x2, y2)\n{\n\tthis.x1 = Math.min(this.x1, x1);\n\tthis.y1 = Math.min(this.y1, y1);\n\tthis.x2 = Math.max(this.x2, x2);\n\tthis.y2 = Math.max(this.y2, y2);\n\n\treturn this;\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.intersects1.apply(this, arguments);\n\t\tcase 4: return this.intersects4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects1 = function (b)\n{\n\treturn this.intersects4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tReturns a bool indicating if the rectangles intersect or not.\n*/\nRect.prototype.intersects4 = function (x1, y1, x2, y2)\n{\n\tvar _x1 = Math.max(this.x1, x1);\n\tvar _y1 = Math.max(this.y1, y1);\n\tvar _x2 = Math.min(this.x2, x2);\n\tvar _y2 = Math.min(this.y2, y2);\n\n\treturn Math.max(0, _y2-_y1) * Math.max(0, _x2-_x1) > 0;\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any point\n**\tthat's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 1: return this.setAsIntersection1.apply(this, arguments);\n\t\tcase 4: return this.setAsIntersection4.apply(this, arguments);\n\t}\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any\n**\tpoint that's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection1 = function (b)\n{\n\treturn this.setAsIntersection4 (b.x1, b.y1, b.x2, b.y2);\n};\n\n/**\n**\tSets the rect to the intersection box formed by the current rect and the given one. The resulting bounding box contains any point\n**\tthat's contained simultaneously in both rects.\n*/\nRect.prototype.setAsIntersection4 = function (x1, y1, x2, y2)\n{\n\tthis.x1 = Math.max(this.x1, x1);\n\tthis.y1 = Math.max(this.y1, y1);\n\tthis.x2 = Math.min(this.x2, x2);\n\tthis.y2 = Math.min(this.y2, y2);\n\n\treturn Math.max(0, this.y2-this.y1) * Math.max(0, this.x2-this.x1) > 0;\n};\n\n/**\n**\tResizes the rect to the given size using center or top-left as reference.\t \n*/\nRect.prototype.resize = function (w, h, relative=false, topLeftRelative=false)\n{\n\tif (relative == true)\n\t{\n\t\tw *= (this.x2 - this.x1);\n\t\th *= (this.y2 - this.y1);\n\t}\n\n\tif (topLeftRelative == true)\n\t{\n\t\tthis.x2 = this.x1 + w;\n\t\tthis.y2 = this.y1 + h;\n\t}\n\telse\n\t{\n\t\tw /= 2; h /= 2;\n\n\t\tthis.x1 = this.cx - w; this.y1 = this.cy - h;\n\t\tthis.x2 = this.cx + w; this.y2 = this.cy + h;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tResizes the rect using the specified deltas (relative to center or top-left).\n*/\nRect.prototype.resizeBy = function (dw, dh, topLeftRelative=false)\n{\n\tif (topLeftRelative == true)\n\t{\n\t\tthis.x2 += dw;\n\t\tthis.y2 += dh;\n\t}\n\telse\n\t{\n\t\tdw /= 2; dh /= 2;\n\n\t\tthis.x1 -= dw; this.y1 -= dh;\n\t\tthis.x2 += dw; this.y2 += dh;\n\t}\n\n\treturn this;\n};\n\n/**\n**\tReturns the width of the rectangle.\t \n*/\nRect.prototype.width = function ()\n{\n\treturn this.x2 - this.x1;\n};\n\n/**\n**\tReturns the height of the rectangle.\t \n*/\nRect.prototype.height = function ()\n{\n\treturn this.y2 - this.y1;\n};\n\n/**\n**\tReturns the normalized center-X of the rect.\n*/\nRect.prototype.ncx = function ()\n{\n\treturn (this.cx - this.x1) / (this.x2 - this.x1);\n};\n\n/**\n**\tReturns the normalized center-Y of the rect.\n*/\nRect.prototype.ncy = function ()\n{\n\treturn (this.cy - this.y1) / (this.y2 - this.y1);\n};\n\n/**\n**\tReturns true if the rect is a right rectangle (x1 < x2 and y1 < y2).\n*/\nRect.prototype.isRight = function ()\n{\n\treturn this.x1 <= this.x2 && this.y1 <= this.y2;\n};\n\n/**\n**\tReturns true if the specified point is within the rectangle. The tol parameter is used to specify a tolerance value in pixels.\n*/\nRect.prototype.containsPoint = function (x, y, tol)\n{\n\tif (!tol) tol = 0;\n\treturn (this.x1-tol <= x && x <= this.x2+tol) && (this.y1-tol <= y && y <= this.y2+tol);\n};\n\n/**\n**\tReturns the area of the rectangle. Strict mode specifies if area is returned only if the rectangle is a right rectangle. \t \n*/\nRect.prototype.area = function (strict)\n{\n\treturn strict ? (this.isRight() ? (this.y2-this.y1)*(this.x2-this.x1) : 0) : ((this.y2-this.y1)*(this.x2-this.x1));\n};\n\n/**\n**\tSets the components to their lower-integer parts.\n*/\nRect.prototype.floor = function()\n{\n\tthis.x1 = Math.floor(this.x1);\n\tthis.y1 = Math.floor(this.y1);\n\tthis.x2 = Math.floor(this.x2);\n\tthis.y2 = Math.floor(this.y2);\n\tthis.cx = Math.floor(this.cx);\n\tthis.cy = Math.floor(this.cy);\n\treturn this;\n};\n\n/**\n**\tSets the components to their upper-integer parts.\n*/\nRect.prototype.ceil = function()\n{\n\tthis.x1 = Math.ceil(this.x1);\n\tthis.y1 = Math.ceil(this.y1);\n\tthis.x2 = Math.ceil(this.x2);\n\tthis.y2 = Math.ceil(this.y2);\n\tthis.cx = Math.ceil(this.cx);\n\tthis.cy = Math.ceil(this.cy);\n\treturn this;\n};\n\n/**\n**\tReturns the string representation of the rect coordinates.\n*/\nRect.prototype.toString = function ()\n{\n\treturn \"(Rect: \" + this.x1.toFixed(2) + \", \" + this.y1.toFixed(2) + \", \" + this.x2.toFixed(2) + \", \" + this.y2.toFixed(2) + \")\";\n};\n\nRect.prototype.flatten = function ()\n{\n\treturn [this.x1, this.y1, this.x2, this.y2];\n};\n\nRect.prototype.unflatten = function (o)\n{\n\tthis.set (o[0], o[1], o[2], o[3]);\n\treturn this;\n};\n\n/* ********************************************************** */\nRecycler.attachTo (Rect);\n","/*\n**\t@rsthn/cherry/vec2\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tRepresentation of a vector in 2D space, that is a tuple with two components x and y.\n*/\n\nconst Vec2 = module.exports = function ()\n{\n\tswitch (arguments.length)\n\t{\n\t\tcase 0: return this.Vec2_0.apply(this, arguments);\n\t\tcase 1: return this.Vec2_1.apply(this, arguments);\n\t\tcase 2: return this.Vec2_2.apply(this, arguments);\n\t}\n};\n\n/**\n**\tCoordinate value of the X-axis. \t \n*/\nVec2.prototype.x = 0;\n\n/**\n**\tCoordinate value of the Y-axis.\n*/\nVec2.prototype.y = 0;\n\n/**\n**\tConstructs a vector object. Components are set to zero.\n*/\nVec2.prototype.Vec2_0 = function ()\n{\n\tthis.x = this.y = 0;\n};\n\n/**\n**\tConstructs a vector object with the given components.\n*/\nVec2.prototype.Vec2_2 = function (x, y)\n{\n\tthis.x = x; this.y = y;\n};\n\n/**\n**\tConstructs a vector object with the components from the specified vector.\n*/\nVec2.prototype.Vec2_1 = function (b)\n{\n\tthis.x = b.x; this.y = b.y;\n};\n\n/**\n**\tClones the vector and returns a new object.\n*/\nVec2.prototype.clone = function () /* Vec2 */\n{\n\treturn new Vec2 (this.x, this.y);\n};\n\n/**\n**\tSets the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.set = function (x, y) /* Vec2 */\n{\n\tif (arguments.length == 1)\n\t\tthis.x = x.x, this.y = x.y;\n\telse\n\t\tthis.x = x, this.y = y;\n\n\treturn this;\n};\n\n/**\n**\tSets the components of the vector to zero.\n*/\nVec2.prototype.zero = function ()\n{\n\treturn this.set (0, 0);\n};\n\n/**\n**\tReturns true if the vector is zero.\n*/\nVec2.prototype.isZero = function ()\n{\n\treturn this.x == 0 && this.y == 0;\n};\n\n/**\n**\tReturns true if the coordinates have the same components as the vector. (vec2 or x,y)\n*/\nVec2.prototype.equals = function (x, y)\n{\n\tif (arguments.length == 1)\n\t\treturn this.x == x.x && this.y == x.y;\n\telse\n\t\treturn this.x == x && this.y == y;\n};\n\n/**\n**\tNegates the vector, that is changing the sign of each component in the vector.\n*/\nVec2.prototype.neg = function ()\n{\n\tthis.x = -this.x; this.y = -this.y;\n\treturn this;\n};\n\n/**\n**\tInverts the vector by changing each component to its reciprocal.\n*/\nVec2.prototype.inv = function ()\n{\n\tthis.x = 1 / this.x; this.y = 1 / this.y;\n\treturn this;\n};\n\n/**\n**\tChanges the components of the vector to their absolute value.\n*/\nVec2.prototype.abs = function ()\n{\n\tthis.x = this.x < 0 ? -this.x : this.x;\n\tthis.y = this.y < 0 ? -this.y : this.y;\n\treturn this;\n};\n\n/**\n**\tAdds the given value to all components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.translate = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x += dx.x, this.y += dx.y;\n\telse\n\t\tthis.x += dx, this.y += dy;\n\n\treturn this;\n};\n\n/**\n**\tAdds given values to the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.add = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x += dx.x, this.y += dx.y;\n\telse\n\t\tthis.x += dx, this.y += dy;\n\n\treturn this;\n};\n\n/**\n**\tSubtracts given values from the components of the vector. (vec2 or x,y)\n*/\nVec2.prototype.sub = function (dx, dy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x -= dx.x, this.y -= dx.y;\n\telse\n\t\tthis.x -= dx, this.y -= dy;\n\n\treturn this;\n};\n\n/**\n**\tScales both components of the vector by the given factor (fx or fx, fy).\n*/\nVec2.prototype.scale = function (fx, fy)\n{\n\tif (arguments.length == 1)\n\t\tthis.x *= fx, this.y *= fx;\n\telse\n\t\tthis.x *= fx, this.y *= fy;\n\n\treturn this;\n};\n\n/**\n**\tSets the components to their integer parts.\n*/\nVec2.prototype.floor = function ()\n{\n\tthis.x = ~~this.x;\n\tthis.y = ~~this.y;\n\n\treturn this;\n};\n\n/**\n**\tSets the components to their fractional parts.\n*/\nVec2.prototype.fract = function ()\n{\n\tthis.x = this.x - ~~this.x;\n\tthis.y = this.y - ~~this.y;\n\n\treturn this;\n};\n\n/**\n**\tReturns the dot product of the vector and the provided values (x, y).\n*/\nVec2.prototype.dot = function (x, y)\n{\n\tif (arguments.length == 2)\n\t\treturn this.x*x + this.y*y;\n\telse\n\t\treturn this.x*x.x + this.y*x.y;\n};\n\n/**\n**\tReturns the magnitude of the vector.\n*/\nVec2.prototype.magnitude = function ()\n{\n\treturn Math.sqrt(this.x*this.x + this.y*this.y);\n};\n\n/**\n**\tNormalizes the vector. That is achieved by dividing each component of the Vector by its\n**\tmagnitude in order to obtain a unit vector.\n*/\nVec2.prototype.normalize = function ()\n{\n\treturn this.isZero() ? this : this.scale (1 / this.magnitude());\n};\n\n/**\n**\tSets the vector to its major-axis.\n*/\nVec2.prototype.majorAxis = function ()\n{\n\tif (Math.abs(this.x) > Math.abs(this.y)) this.y = 0; else this.x = 0;\n\treturn this;\n};\n\n/**\n**\tSets the vector to its minor-axis.\n*/\nVec2.prototype.minorAxis = function ()\n{\n\tif (Math.abs(this.x) < Math.abs(this.y)) this.y = 0; else this.x = 0;\n\treturn this;\n};\n\n/**\n**\tSets the vector to its sign-vector representation.\n*/\nVec2.prototype.sign = function ()\n{\n\tthis.x = !this.x ? 0 : (this.x < 0 ? -1 : 1);\n\tthis.y = !this.y ? 0 : (this.y < 0 ? -1 : 1);\n\treturn this;\n};\n\n/**\n**\tReturns the string representation of the vector.\n*/\nVec2.prototype.toString = function ()\n{\n\treturn `(${this.x}, ${this.y})`;\n};\n","/*\r\n**\trin/alpha\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = module.exports = { };\r\n\r\n/**\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRin.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/**\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRin.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/**\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRin.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/**\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRin.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rin.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRin.clone = function (elem)\r\n{\r\n\tvar o;\r\n\r\n\tif (Rin.typeOf(elem) == \"array\")\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rin.clone(elem[i]));\r\n\t}\r\n\telse if (Rin.typeOf(elem) == \"object\")\r\n\t{\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rin.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/**\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRin.merge = function (output, ...objs)\r\n{\r\n\tif (Rin.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rin.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rin.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rin.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rin.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rin.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRin.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rin.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/**\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRin.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRin.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRin.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRin.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/**\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRin.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/**\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRin.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/**\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRin.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/**\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRin.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n","/*\r\n**\trin/class\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tBase class used to easily create classes and sub-classes with complex multiple inheritance and\r\n**\tsupport for calls to parent class methods.\r\n*/\r\n\r\nlet Class = module.exports = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tReference to the class itself.\r\n*/\r\nClass._class = Class;\r\n\r\n\r\n/**\r\n**\tContains the methods of each of the super classes.\r\n*/\r\nClass._super = { };\r\n\r\n\r\n/**\r\n**\tName of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n*/\r\nClass.prototype.className = \"Class\";\r\n\r\n\r\n/**\r\n**\tClass constructor, should initialize the state of the instance. Invoked when the `new` keyword is used with the class.\r\n*/\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tClass destructor, should clear the instance state and release any used resources, invoked when the global `dispose`\r\n**\tfunction is called with the instance as parameter.\r\n*/\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n\r\n/**\r\n**\tReturns true if the object is an instance of the specified class (verifies inheritance), the parameter can be a class\r\n**\tname, a class constructor or a class instance, in any case the appropriate checks will be done.\r\n**\r\n**\t>> bool isInstanceOf (string className);\r\n**\t>> bool isInstanceOf (constructor classConstructor);\r\n**\t>> bool isInstanceOf (object classInstance);\r\n*/\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tclassName = Rin.typeOf(className) == \"string\" ? className : (className.prototype ? className.prototype.className : className.constructor.prototype.className);\r\n\treturn className in this._super ? true : this.className == className;\r\n};\r\n\r\n\r\n/**\r\n**\tInternal method to ensure the _super field of an instance is ready to be used.\r\n**\r\n**\t>> void _initSuperRefs ();\r\n*/\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tvar _super = this.constructor._super;\r\n\tvar _newSuper = { };\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rin.typeOf(_prot[j]) == \"function\")\r\n\t\t\t\to[j] = _prot[j].bind(this);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/**\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tvar self = this._class;\r\n\r\n\tvar _super = self._super;\r\n\tvar _class = self._class;\r\n\r\n\tif (Rin.typeOf(proto) == \"function\")\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRin.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super methods.\r\n\t\tRin.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRin.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/**\r\n**\tInternal method used to extend a class with one or more prototypes.\r\n**\r\n**\t>> class _extend (object base, object[] protos);\r\n*/\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tvar _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif (\"classInit\" in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a new class with the specified prototypes each of which can be a class constructor or an object.\r\n**\r\n**\t>> constructor extend (object... protos);\r\n*/\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/**\r\n**\tCreates a new instance of a class resulting from extending the self class with the specified prototype.\r\n**\r\n**\t>> object create (object proto);\r\n*/\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n","/*\r\n**\trin/event\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\nlet Class = require('./class');\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rin.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","/*\r\n**\trin/event-dispatcher\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Class = require('./class');\r\nlet Event = require('./event');\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName: eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","/*\n**\trin/model-regex\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nmodule.exports =\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","/*\n**\trin/model-constraints\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet Regex = require('./model-regex');\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nmodule.exports =\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rin.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rin.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rin.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rin.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rin.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rin.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rin.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rin.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","/*\n**\trin/model\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet EventDispatcher = require('./event-dispatcher');\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = module.exports = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\tvar o = { };\n\n\t\t\t\tfor (var i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tvar j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) == \"function\")\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (arguments[0], true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rin.typeOf(defaults) != \"object\" && Rin.typeOf(defaults) != \"function\"))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rin.typeOf(this.defaults) == \"function\")\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rin.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rin.typeOf(arguments[0]) == \"object\")) && Rin.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] != arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] != arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rin.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rin.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRin.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRin.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rin.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rin.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rin.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rin.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rin.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rin.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rin.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\n_Model.Constraints = require('./model-constraints');\n","/*\n**\trin/model-list\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\nlet Model = require('./model');\n\n/**\n**\tGeneric list for models.\n*/\n\nmodule.exports = Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"List\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of properties.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int index, Model item);\n\t*/\n\t_bind: function (index, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, index);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, object data);\n\t*/\n\t_onItemEvent: function (evt, args, data)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { index: data, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int count ();\n\t*/\n\tcount: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> void setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear ();\n\t\tif (!data) return;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rin.ensureTypeOf(this.itemt, data[i]);\n\t\t\tthis._bind (i, item);\n\n\t\t\tthis.data.contents.push (item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn Rin.ensureTypeOf(this.itemt, this.data.contents[index]);\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tvar item = Rin.ensureTypeOf(this.itemt, this.data.contents.splice(index, 1)[0]);\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { index: index, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind (index, item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { index: index, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { index: index, item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rin.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis.data.contents.push (item);\n\t\tthis._bind (this.data.contents.length-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { index: this.data.contents.length-1, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind (Rin.ensureTypeOf(this.itemt, this.data.contents.pop()));\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rin.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rin.ensureTypeOf(this.itemt, item);\n\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind (0, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { index: 0, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind (Rin.ensureTypeOf(this.itemt, this.data.contents.shift()));\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rin.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","/*\r\n**\trin/schema\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tThe utility functions in this module allow to create a very strict serialization/deserialization schema\r\n**\tto ensure that all values are of the specific type when stored in string format.\r\n*/\r\n\r\nlet Schema = module.exports =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rin.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.strings_map = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.strings_map))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.strings_map[value] = context.strings.length;\r\n                }\r\n\r\n                return context.strings_map[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n                \r\n                for (let i = 0; i < value.length; i++)\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type)\r\n            {\r\n                this.properties.push({ name: name, type: type });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].name], context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].name], context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n            \r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(value[this.properties[i].name], context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(value[i], context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t}\r\n};\r\n","/*\r\n**\trin/flattenable\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Class = require('./class');\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nmodule.exports = Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","/*\r\n**\trin/collection\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Flattenable = require('./flattenable');\r\nlet Schema = require('./schema');\r\nlet Rin = require('./alpha');\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nmodule.exports = Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection.\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rin.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rin.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tcount: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded(item))\r\n\t\t\treturn this;\r\n\r\n\t\tthis.items.push (item);\r\n\t\tthis.onItemAdded (item);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tTraverses the given array and adds all items to the collection.\r\n\t*/\r\n\taddItems: function (list)\r\n\t{\r\n\t\tif (!list) return this;\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tthis.add (list[i]);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found.\r\n\t*/\r\n\tgetAt: function (index, rel)\r\n\t{\r\n\t\tif (index < 0 && rel == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index.\r\n\t*/\r\n\tremoveAt: function (index)\r\n\t{\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn this;\r\n\r\n\t\tvar item = this.items[index];\r\n\r\n\t\tthis.items.splice (index, 1);\r\n\r\n\t\tthis.onItemRemoved (item, index);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\tthis.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","/*\n**\trin/template\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nlet Rin = require('./alpha');\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRin.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template = module.exports =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rin.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!str) str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!str) str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rin.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rin.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rin.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'typeof': function(args) { return Rin.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'**': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tjson <expr>\n\t*/\n\t'json': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets a variable in the data context.\n\t**\n\t**\tset <var-name> <expr>\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tlet value = Template.value(parts[2], data);\n\n\t\tif (parts[1].length > 1)\n\t\t{\n\t\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\treturn '';\n\t\t}\n\t\n\t\tdata[Template.value(parts[1], data)] = value;\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rin.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rin.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs an array obtained by expanding the given template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = [];\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts.push(Template.expand(parts[3], data, 'text'));\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rin.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rin.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rin.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n","/*\r\n**\trin/main\r\n**\r\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rin = require('./alpha');\r\n\r\nRin.Rin = Rin;\r\nRin.Class = require('./class');\r\n\r\nRin.Event = require('./event');\r\nRin.EventDispatcher = require('./event-dispatcher');\r\n\r\nRin.Model = require('./model');\r\nRin.ModelList = require('./model-list');\r\n\r\nRin.Schema = require('./schema');\r\nRin.Flattenable = require('./flattenable');\r\nRin.Collection = require('./collection');\r\n\r\nRin.Template = require('./template');\r\n\r\n/* ---- */\r\nObject.assign (module.exports, Rin);\r\n","/*\n**\t@rsthn/cherry/tfunction\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\n\n/**\n**\tDescribes a function dependent of time (t-function), multiple sampling points (t,y) can be added, this class\n**\tprovides methods to access any value for a given time, or the integral of a time range.\n*/\n\nconst TFunction = module.exports = Class.extend\n({\n\tclassName: 'TFunction',\n\n\t/**\n\t**\tContains the time values (t) in the t-function, for each time value there is a corresponding y and f.\n\t*/\n\tt: null,\n\n\t/**\n\t**\tContains the values (y) for each of the time values (t) in the t-function.\n\t*/\n\ty: null,\n\n\t/**\n\t**\tContains the easing function (f) for each of the time values (t).\n\t*/\n\tf: null,\n\n\t/**\n\t**\tConstructs the time function with an initial value.\n\t**\n\t**\t@param value:float Initial value of the t-function for t=0, defaults to 0.\n\t*/\n\t__ctor: function (value)\n\t{\n\t\tthis.reset (value);\n\t},\n\n\t/**\n\t**\tResets the t-function to its initial state.\n\t**\n\t**\t@param value:float Initial value of the t-function for time=0, if none provided zero will be assumed.\n\t**\n\t**\t@returns TFunction\n\t*/\n\treset: function (value=0)\n\t{\n\t\tthis.t = [0];\n\t\tthis.y = [value];\n\t\tthis.f = [null];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tResets the t-function and copies data from the specified source.\n\t**\n\t**\t@param src:TFunction Source TFunction.\n\t**\t@param t0:float Initial time, if none specified will be assumed to be the min time of the source.\n\t**\t@param t1:float Final time, if none specified will be assumed to the the max time of the source.\n\t**\n\t**\t@returns TFunction or null if the specified time range could not be resolved.\n\t*/\n\tcopyFrom: function (src, t0, t1)\n\t{\n\t\tthis.t = [];\n\t\tthis.y = [];\n\t\tthis.f = [];\n\n\t\tif (t0 == null && t1 == null)\n\t\t{\n\t\t\tfor (let i = 0; i < src.t.length; i++)\n\t\t\t{\n\t\t\t\tthis.t.push(src.t[i]);\n\t\t\t\tthis.y.push(src.y[i]);\n\t\t\t\tthis.f.push(src.f[i]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tif (t0 == null) t0 = src.t[0];\n\t\tif (t1 == null) t1 = src.t[src.t.length-1];\n\n\t\tif (t0 < src.t[0]) t0 = src.t[0];\n\n\t\tlet i0 = src.find(t0);\n\t\tlet i1 = src.find(t1);\n\n\t\tif (i0 == null) return null;\n\t\tif (i1 == null) return null;\n\n\t\tif (src.t[i0] != t0) {\n\t\t\tthis.set(t0, src.getAt(t0), src.f[i0]);\n\t\t\ti0++;\n\t\t}\n\n\t\tfor (let i = i0; i <= i1; i++)\n\t\t\tthis.set(src.t[i], src.y[i], src.f[i]);\n\n\t\tif (src.t[i1] != t1)\n\t\t{\n\t\t\tlet dt = (t1 - src.t[i1]) / Math.ceil(Math.log(t1 - src.t[i1]));\n\t\t\tlet t = this.t[this.t.length-1];\n\n\t\t\tif (dt <= 0) dt = 1;\ndt = t1-t; // Force just one step.\n\t\t\twhile (t != t1)\n\t\t\t{\n\t\t\t\tif (t+dt > t1)\n\t\t\t\t\tdt = t1 - t;\n\n\t\t\t\tt += dt;\n\t\t\t\tthis.set(float4(t), src.getAt(t), src.f[i1]);\n\t\t\t}\n\t\t}\n\t\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tCreates a new t-function with the same values as this.\n\t**\n\t**\t@param t0:float Initial time, if none specified will be assumed to be the min time of the source.\n\t**\t@param t1:float Final time, if none specified will be assumed to the the max time of the source.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tclone: function (t0, t1)\n\t{\n\t\treturn (new TFunction()).copyFrom(this, t0, t1);\n\t},\n\n\t\t/**\n\t**\tReturns the maximum time value in the t-function plus the given delta.\n\t**\n\t**\t@param delta:float Delta value to add to the result.\n\t**\t@returns float\n\t*/\n\tendTime: function (delta=0)\n\t{\n\t\treturn this.t[this.t.length-1] + delta;\n\t},\n\n\t/**\n\t**\tReturns the start time of the t-function plus the given delta.\n\t**\n\t**\t@param delta:float Delta value to add to the result.\n\t**\t@returns float\n\t*/\n\tstartTime: function (delta=0)\n\t{\n\t\treturn this.t[0] + delta;\n\t},\n\n\t/**\n\t**\tFinds the index of a sampling point whose sampling range contains the given time.\n\t** \n\t**\t@param time:float Time value to search.\n\t**\n\t**\t@returns int Index of the sampling point or `null` if not within range.\n\t*/\n\tfind: function (time)\n\t{\n\t\tif (time < this.t[0])\n\t\t\treturn null;\n\n\t\tconst n = this.t.length;\n\n\t\tfor (let i = 1; i < n; i++)\n\t\t{\n\t\t\tif (time < this.t[i])\n\t\t\t\treturn i-1;\n\t\t}\n\n\t\treturn n-1;\n\t},\n\n\t/**\n\t**\tSets a sampling point (t,y).\n\t**\n\t**\t@param t:float Time value of the sampling point.\n\t**\t@param y:float Y-value for the given t.\n\t**\n\t**\t@returns bool Indicates if operation was successful.\n\t*/\n\tset: function (t, y, f=null)\n\t{\n\t\tlet i = this.find(t);\n\t\tif (i == null) return false;\n\n\t\tif (this.t[i] == t)\n\t\t{\n\t\t\tthis.y[i] = y;\n\t\t\tif (f != null) this.f[i] = f;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ti++;\n\t\t\tthis.t.splice(i, 0, t);\n\t\t\tthis.y.splice(i, 0, y);\n\t\t\tthis.f.splice(i, 0, f);\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns the last Y-value in the t-function.\n\t**\n\t**\t@returns float Y-value.\n\t*/\n\tget: function ()\n\t{\n\t\treturn this.y[this.y.length-1];\n\t},\n\n\t/**\n\t**\tReturns the Y-value in the t-function corresponding to some point in time (t).\n\t**\n\t**\t@param t:float Time (t) value.\n\t**\n\t**\t@returns float Y-value.\n\t*/\n\tgetAt: function (t)\n\t{\n\t\tlet i0 = this.find(t);\n\t\tif (i0 == null) return 0;\n\n\t\tlet i1 = i0 + 1;\n\n\t\tif (this.t[i0] == t || i1 >= this.t.length || this.y[i0] == this.y[i1] || this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tif (this.f[i0] == null)\n\t\t\treturn this.y[i0];\n\n\t\tlet x = t;\n\t\tlet x0 = this.t[i0];\n\t\tlet x1 = this.t[i1];\n\t\tlet y0 = this.y[i0];\n\t\tlet y1 = this.y[i1];\n\n\t\tt = (x - x0) / (x1 - x0);\n\t\tt = this.f[i0](t);\n\n\t\treturn t*y1 + (1-t)*y0;\n\t},\n\n\t/**\n\t**\tReturns the approximate definite integral of the t-function for the given time range.\n\t**\n\t**\t@param t0:float Initial time value.\n\t**\t@param t1:float Final time value.\n\t**\t@param c0:float Constant of integration, default is 0.\n\t**\n\t**\t@returns float Definite integral of t-function from t0 to t1.\n\t*/\n\tintegral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tif (t0 < this.t[0]) t0 = this.t[0];\n\n\t\tlet sign = 1;\n\n\t\tif (t0 > t1) {\n\t\t\tlet tmp; tmp = t0; t0 = t1; t1 = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tlet accum = c0;\n\n\t\tfor (let time = t0; time < t1; )\n\t\t{\n\t\t\tlet i0 = this.find(time);\n\t\t\tif (i0 == null) return 0;\n\n\t\t\tlet i1 = i0 + 1;\n\n\t\t\tlet x0 = Math.max(this.t[i0], time);\n\t\t\tlet x1 = Math.min(i1 < this.t.length ? this.t[i1] : t1, t1);\n\n\t\t\tlet y0 = this.getAt(x0);\n\t\t\tlet y1 = this.getAt(x1);\n\n\t\t\tlet dx = x1 - x0;\n\t\t\tlet dy = y1 - y0;\n\n\t\t\tif (this.f[i0] == null)\n\t\t\t\taccum += y0*dx;\n\t\t\telse\n\t\t\t\taccum += 0.5*dy*(x1+x0) - x0*dy + y0*dx;\n\n\t\t\ttime += dx;\n\t\t}\n\n\t\treturn sign*accum;\n\t},\n\n\t/**\n\t**\tReturns the approximate definite second integral of the t-function for the given time range.\n\t**\n\t**\t@param t0:float Initial time value.\n\t**\t@param t1:float Final time value.\n\t**\t@param c0:float Constant of integration, default is 0.\n\t**\n\t**\t@returns float Definite second integral of t-function from t0 to t1.\n\t*/\n\tsecond_integral: function (t0=null, t1=null, c0=0)\n\t{\n\t\tif (t0 == null) t0 = this.t[0];\n\t\tif (t1 == null) t1 = this.t[this.t.length-1];\n\n\t\tlet a0 = TFunction.Temp1.copyFrom(this, this.t[0], t0).integrate(c0).integral();\n\t\tlet a1 = TFunction.Temp2.copyFrom(this, this.t[0], t1).integrate(c0).integral();\n\n\t\treturn a1 - a0;\n\t},\n\n\t/**\n\t**\tTransforms the t-function to its integral. For every sampling range in the t-function their Y-value will be set to the integral\n\t**\tof the sampling range plus any previous integrals.\n\t**\n\t**\t@param c0:float Constant of integration, if none specified 0 will be assumed.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tintegrate: function (c0=0)\n\t{\n\t\tlet y = [];\n\n\t\ty.push(c0);\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\ty.push(y[i-1] + this.integral(this.t[i-1], this.t[i]));\n\n\t\tthis.y = y;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tTransforms the t-function Y-values to the accumulated sum of each Y-value plus the given c0.\n\t**\n\t**\t@returns TFunction\n\t*/\n\taccumulate: function (c0=0)\n\t{\n\t\tthis.y[0] += c0;\n\n\t\tfor (let i = 1; i < this.t.length; i++)\n\t\t\tthis.y[i] += this.y[i-1];\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves all sampling-points located before the given index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tchopLeft: function (i)\n\t{\n\t\tthis.t.splice(0, i);\n\t\tthis.f.splice(0, i);\n\t\tthis.y.splice(0, i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves all sampling-points located after the given index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tchopRight: function (i)\n\t{\n\t\tthis.t.splice(i+1, this.t.length-i-1);\n\t\tthis.f.splice(i+1, this.f.length-i-1);\n\t\tthis.y.splice(i+1, this.y.length-i-1);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tMaps the Y-value to other Y-values using the specified mapping function. The mapping function will receive four\n\t**\tparameters: y, t, and i where 'y' is the y-value, 't' the t-value, 'i' the index.\n\t**\n\t**\t@returns TFunction\n\t*/\n\tmap: function (fn)\n\t{\n\t\tfor (let i = 0; i < this.y.length; i++)\n\t\t\tthis.y[i] = fn (this.y[i], this.t[i], i);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns a string representation of the variable state.\n\t**\n\t**\t@returns string\n\t*/\n\ttoString: function(c0=0)\n\t{\n\t\tlet s = '';\n\t\tlet n = 10;\n\n\t\tconst pad = function (value, n, char)\n\t\t{\n\t\t\tvalue = value.toString();\n\n\t\t\tif (char == null) char = ' ';\n\t\t\tchar = char[0];\n\n\t\t\twhile (value.length < n)\n\t\t\t\tvalue += char;\n\n\t\t\treturn value;\n\t\t};\n\n\t\ts += '\\n';\n\t\ts += pad(' Time', n) + ' ' + pad(' Value', n) + ' ' + pad(' Integral', n) + '\\n';\n\t\ts += pad('', n, '-') + ' ' + pad('', n, '-') + ' ' + pad('', n, '-') + '\\n';\n\n\t\tfor (let i = 0; i < this.t.length; i++)\n\t\t{\n\t\t\ts += pad(' '+float4(this.t[i]), n) + ' ' + pad(' '+float4(this.y[i]), n) + ' ' + pad(' '+float4(this.integral(this.t[0], this.t[i], c0)), n) + '\\n';\n\t\t}\n\n\t\treturn s;\n\t}\n});\n\nTFunction.Temp1 = new TFunction();\nTFunction.Temp2 = new TFunction();\n","/*\n**\t@rsthn/cherry/perf\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tSmall utility class for performance tracking.\n**\n**\t>> Perf __constructor (float accumSize, float expectedValue);\n**\t>> Perf __constructor (float accumSize);\n*/\n\nlet Perf = module.exports = function (accumSize, expectedValue)\n{\n\tthis.data = [ ];\n\tthis.accumSize = accumSize;\n\n\tthis.expectedValue = expectedValue;\n\n\tthis.stdSum = 0;\n\tthis.stdCount = 0;\n};\n\n/**\n**\tMarks the start time of the performance test.\n**\n**\t>> void begin();\n*/\n\nPerf.prototype.begin = function ()\n{\n\tthis.startTime = performance.now();\n};\n\n\n/**\n**\tMarks the end time of the performance test, the elapsed time is fed into the tracker.\n**\n**\t>> void end();\n*/\n\nPerf.prototype.end = function ()\n{\n\tthis.feed (performance.now() - this.startTime);\n};\n\n\n/**\n**\tFeeds a value into the tracker, auto-generates a report using console.log when the number of samples\n**\treaches the accumSize specified in the constructor.\n**\n**\t>> void feed (float value);\n*/\n\nPerf.prototype.feed = function (value)\n{\n\tthis.data.push(value);\n\n\tif (this.data.length != this.accumSize)\n\t\treturn;\n\n\tthis.report();\n\tthis.data = [ ];\n};\n\n\n/**\n**\tShows a report using console.log, if the returnString parameter is set to true, the report string will be returned\n**\tinstead of printed. After a call to this method instance variables 'min', 'max', 'avg' and 'std' will be populated.\n**\n**\t>> void report (bool returnString=false);\n*/\n\nPerf.prototype.report = function (returnString)\n{\n\tvar min = null;\n\tvar max = null;\n\tvar avg = 0;\n\tvar std = 0;\n\n\tfor (var i = 0; i < this.data.length; i++)\n\t{\n\t\tmin = min === null ? this.data[i] : Math.min(min, this.data[i]);\n\t\tmax = max === null ? this.data[i] : Math.max(max, this.data[i]);\n\t\tavg += this.data[i];\n\t}\n\n\tavg /= this.data.length;\n\n\tvar e = this.expectedValue !== undefined ? this.expectedValue : avg;\n\n\tfor (var i = 0; i < this.data.length; i++) std += Math.pow(this.data[i] - e, 2);\n\n\tstd = Math.sqrt(std / this.data.length);\n\n\tthis.stdSum += std;\n\tthis.stdCount++;\n\n\tvar out = \"N: \" + this.stdCount + \", MIN: \" + min + \", MAX: \" + max + \", AVG: \" + avg.toFixed(2) + (this.expectedValue !== undefined ? \", E: \" + this.expectedValue : \"\") + \", STDDEV: \" + std.toFixed(2) + \", AVG_STDDEV: \" + (this.stdSum / this.stdCount).toFixed(2);\n\n\tthis.min = min;\n\tthis.max = max;\n\tthis.avg = avg;\n\tthis.std = std;\n\n\tif (returnString === true)\n\t\treturn out;\n\n\tconsole.log(out);\n};\n","/*\n**\t@rsthn/cherry/keycodes\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nmodule.exports =\n{\n\tBACKSPACE: 8,\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tSPACE: 32,\n\n\tPGUP: 33,\n\tPGDN: 34,\n\n\tEND: 35,\n\tHOME: 36,\n\n\tINS: 45,\n\tDEL: 46,\n\n\tLEFT: 37,\n\tUP: 38,\n\tRIGHT: 39,\n\tDOWN: 40,\n\n\tNUM_PLUS: 107,\n\tNUM_MINUS: 109,\n\tNUM_ASTERISK: 106,\n\tNUM_SLASH: 111,\n\tNUM_DOT: 110,\n\n\tNUM_0: 96,\n\tNUM_1: 97,\n\tNUM_2: 98,\n\tNUM_3: 99,\n\tNUM_4: 100,\n\tNUM_5: 101,\n\tNUM_6: 102,\n\tNUM_7: 103,\n\tNUM_8: 104,\n\tNUM_9: 105,\n\n\tD0: 48,\n\tD1: 49,\n\tD2: 50,\n\tD3: 51,\n\tD4: 52,\n\tD5: 53,\n\tD6: 54,\n\tD7: 55,\n\tD8: 56,\n\tD9: 57,\n\n\tA: 65,\tB: 66,\tC: 67,\tD: 68,\tE: 69,\tF: 70,\tG: 71,\tH: 72,\tI: 73,\tJ: 74,\tK: 75,\tL: 76,\tM: 77,\tN: 78,\n\tO: 79,\tP: 80,\tQ: 81,\tR: 82,\tS: 83,\tT: 84,\tU: 85,\tV: 86,\tW: 87,\tX: 88,\tY: 89,\tZ: 90\n};\n","/*\n**\t@rsthn/cherry/linkable\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Recycler = require('./recycler');\n\n/**\n**\tGeneric class for linkable items such as required by linked lists. The responsibility of this class is\n**\tto wrap a value into a linkable object.\n*/\n\nconst Linkable = module.exports = Class.extend\n({\n\tclassName: \"Linkable\",\n\n\t/**\n\t**\tPointer to the previous item in the chain.\n\t*/\n\tprev: null, /* Linkable */\n\n\t/**\n\t**\tPointer to the next item in the chain.\n\t*/\n\tnext: null, /* Linkable */\n\n\t/**\n\t**\tWrapped value.\n\t*/\n\tvalue: null,\n\n\t/**\n\t**\tConstructs the linkable to wrap the specified value.\n\t*/\n\t__ctor: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\t},\n\n\t/**\n\t**\tInitializes the linkable item. Makes sure the previous and next pointers are clear.\n\t*/\n\t__reinit: function (value)\n\t{\n\t\tthis.value = value;\n\t\tthis.clear();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tDestructor.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t**\tSets the previous/next connection pointers to null. Returns `this`.\n\t*/\n\tclear: function () /*Linkable*/\n\t{\n\t\tthis.next = this.prev = null;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tLinks the item to come after the given one.\n\t*/\n\tlinkAfter: function (/*Linkable*/item)\n\t{\n\t\tthis.prev = item;\n\t\tthis.next = item ? item.next : null;\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.next) item.next.prev = this;\n\t\t\titem.next = this;\n\t\t}\n\t},\n\n\t/**\n\t**\tLinks the item to come before the given one.\n\t*/\n\tlinkBefore: function (/*Linkable*/item)\n\t{\n\t\tthis.prev = item ? item.prev : null;\n\t\tthis.next = item;\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.prev) item.prev.next = this;\n\t\t\titem.prev = this;\n\t\t}\n\t},\n\n\t/**\n\t**\tUnlinks the item by linking the `prev` and `next` together (when available) and returns `this`.\n\t*/\n\tunlink: function () /*Linkable*/\n\t{\n\t\tif (this.prev) this.prev.next = this.next;\n\t\tif (this.next) this.next.prev = this.prev;\n\n\t\treturn this.clear ();\n\t}\n});\n\nRecycler.attachTo (Linkable);\n","/*\n**\t@rsthn/cherry/list\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Linkable = require('./linkable');\n\n/**\n**\tImplementation of a linked list.\n*/\n\nconst List = module.exports = Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"List\",\n\n\t/**\n\t**\tPointer to the first item in the list.\n\t*/\n\ttop: null, /* Linkable */\n\n\t/**\n\t**\tPointer to the last item in the list.\n\t*/\n\tbottom: null, /* Linkable */\n\n\t/**\n\t**\tCount of items in the list.\n\t*/\n\tcount: 0,\n\n\t/**\n\t**\tConstructor of the list.\n\t*/\n\t__ctor: function ()\n\t{\n\t\tthis.top = null;\n\t\tthis.bottom = null;\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes. The actual values are maintained. To destroy the\n\t**\tlist contents call clear() instead.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tthis.reset();\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes and values.\n\t*/\n\tclear: function () /*List*/\n\t{\n\t\tvar item, nextItem;\n\n\t\tfor (item = this.top; item != null; item = nextItem)\n\t\t{\n\t\t\tnextItem = item.next;\n\n\t\t\tdispose(item.value);\n\t\t\tdispose(item);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.count = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tTraverses the list and destroys all nodes. Values are preserved.\n\t*/\n\treset: function ()\n\t{\n\t\tvar item, nextItem;\n\n\t\tfor (item = this.top; item != null; item = nextItem)\n\t\t{\n\t\t\tnextItem = item.next;\n\t\t\tdispose(item);\n\t\t}\n\n\t\tthis.top = this.bottom = null;\n\t\tthis.count = 0;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns an item given its index.\n\t*/\n\tgetAt: function (index) /*(value)*/\n\t{\n\t\tvar item = null;\n\n\t\tfor (item = this.top; item && index--; item = item.next);\n\n\t\treturn item != null ? item.value : null;\n\t},\n\n\t/**\n\t**\tReturns the node at the given index.\n\t*/\n\tgetNodeAt: function (index) /*Linkable*/\n\t{\n\t\tvar item = null;\n\n\t\tfor (item = this.top; item && index--; item = item.next);\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tReturns the node of an item given another element to compare, uses identical comparison to match the item.\n\t*/\n\tsgetNode: function (value) /*Linkable*/\n\t{\n\t\tfor (var item = this.top; item; item = item.next)\n\t\t\tif (item.value == value) return item;\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRemoves the given item from the list and returns the item.\n\t*/\n\tremove: function (/*Linkable*/item) /*any*/\n\t{\n\t\tif (item != null && !('isInstanceOf' in item && item.isInstanceOf(Linkable)))\n\t\t\titem = this.sgetNode(item);\n\n\t\tif (!item) return null;\n\n\t\tif (!item.prev) this.top = item.next;\n\t\tif (!item.next) this.bottom = item.prev;\n\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item before the given reference.\n\t*/\n\tinsertBefore: function (/*Linkable*/ref, /*any*/value) /*List*/\n\t{\n\t\tif (!ref) return this;\n\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkBefore (ref);\n\n\t\tif (ref == this.top) this.top = item;\n\t\tthis.count++;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tAdds an item after the given reference.\n\t*/\n\tinsertAfter: function (/*Linkable*/ref, /*any*/value) /*List*/\n\t{\n\t\tif (!ref) return this;\n\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkAfter (ref);\n\n\t\tif (ref == this.bottom) this.bottom = item;\n\t\tthis.count++;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list.\n\t*/\n\tunshift: function (value) /* List */\n\t{\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkBefore (this.top);\n\t\tif (!this.bottom) this.bottom = item;\n\n\t\tthis.top = item;\n\t\tthis.count++;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves an item from the top of the list.\n\t*/\n\tshift: function () /*any*/\n\t{\n\t\tvar item = this.top;\n\t\tif (!item) return null;\n\n\t\tif (!(this.top = item.next)) this.bottom = null;\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list.\n\t*/\n\tpush: function (value) /* List */\n\t{\n\t\tvar item = Linkable.alloc(value);\n\n\t\titem.linkAfter (this.bottom);\n\t\tif (!this.top) this.top = item;\n\n\t\tthis.bottom = item;\n\t\tthis.count++;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tRemoves an item from the bottom of the list.\n\t*/\n\tpop: function () /*any*/\n\t{\n\t\tvar item = this.bottom;\n\t\tif (!item) return null;\n\n\t\tif (!(this.bottom = item.prev)) this.top = null;\n\t\tthis.count--;\n\n\t\tvar value = item.unlink().value;\n\t\tdispose(item);\n\n\t\treturn value;\n\t},\n\n\t/**\n\t**\tAppends all contents of a given list to the list.\n\t*/\n\tappend: function (/*List*/list) /*List*/\n\t{\n\t\tfor (var i = list.top; i; i = i.next)\n\t\t\tthis.push (i.value);\n\n\t\treturn this;\n\t}\n});\n","/*\n**\t@rsthn/cherry/timer\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\n/**\n**\tTimer class.\n**\n**\t>> Timer __constructor (float interval, function callback, bool highPerformance=false);\n**\t>> Timer __constructor (float interval, function callback);\n*/\n\nconst Timer = module.exports = function (interval, callback, highPerformance=false)\n{\n\tthis.callback = callback;\n\tthis.interval = interval;\n\tthis.highPerformance = highPerformance;\n};\n\n\n/**\n**\tTimeout handler.\n**\n**\t>> void onTimeout();\n*/\n\nTimer.prototype.onTimeout = function ()\n{\n\tif (!this.isRunning) return;\n\n\tif (this.highPerformance)\n\t{\n\t\tvar targetTime = this.lastTime + this.interval;\n\n\t\twhile (hrnow() < targetTime) {\n\t\t}\n\n\t\tvar curTime = hrnow();\n\t\tvar delta = curTime - this.lastTime;\n\t\tthis.lastTime = curTime;\n\n\t\tthis.callback (delta, this);\n\t\tthis.runAfter(0);\n\t}\n\telse\n\t{\n\t\tthis.rTime = hrnow() - this.startTime;\n\n\t\tvar tError = this.rTime - (this.sTime + this.interval);\n\t\tif (tError < 0)\n\t\t{\n\t\t\tthis.runAfter(-tError);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.sTime += this.interval * (1 + int(tError / this.interval));\n\n\t\tthis.tDelta = tError < 0 ? this.interval : (this.rTime - this.lTime);\n\t\tthis.lTime = this.rTime;\n\n\t\tthis.callback (this.tDelta, this);\n\t\tthis.runAfter((this.sTime + this.interval) - (hrnow() - this.startTime));\n\t}\n};\n\n\n/**\n**\tTimer start handler (overridable).\n**\n**\t>> void onStart();\n*/\n\nTimer.prototype.onStart = function ()\n{\n};\n\n\n/**\n**\tStarts the timer.\n**\n**\t>> void start();\n*/\n\nTimer.prototype.start = function ()\n{\n\tthis.startTime = hrnow();\n\n\tthis.sTime = 0;\n\tthis.lTime = 0;\n\n\tthis.lastTime = hrnow();\n\tthis.isRunning = true;\n\n\tthis.onStart();\n\tthis.runAfter(this.interval);\n};\n\n\n/**\n**\tExecutes the timer onTimeout() after the specified amount of milliseconds.\n**\n**\t>> void runAfter (int timeout);\n*/\n\nTimer.prototype.runAfter = function (timeout)\n{\n\tsetTimeout (() => this.onTimeout(), timeout);\n};\n\n\n/**\n**\tStops the timer.\n**\n**\t>> void stop();\n*/\n\nTimer.prototype.stop = function ()\n{\n\tthis.isRunning = false;\n};\n","/*\n**\t@rsthn/cherry/canvas\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Rin } = require('@rsthn/rin');\nconst Matrix = require('./matrix');\n\n/**\n**\tConstructs a canvas object. If the Canvas DOM element is not provided a new element will be created and attached to the page.\n**\n**\t>> Canvas __constructor (CanvasElement elem = null[, Object opts = null]);\n*/\nconst Canvas = module.exports = function (elem, opts)\n{\n\t// Create canvas element if required.\n\tif (elem == null)\n\t{\n\t\tthis.elem = global.document ? global.document.createElement (\"canvas\") : Rin.clone(Canvas.passThruCanvas);\n\n\t\tif (global.document && opts && opts.hidden != true)\n\t\t{\n\t\t\tglobal.document.body.appendChild (this.elem);\n\n\t\t\tif (opts.absolute === true) {\n\t\t\t\tthis.elem.style.position = 'absolute';\n\t\t\t\tthis.elem.style.left = '0px';\n\t\t\t\tthis.elem.style.top = '0px';\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tthis.elem = elem;\n\t}\n\n\tif (!this.elem.getContext) return;\n\n\tif (opts.gl === true)\n\t{\n\t\tthis.gl = this.elem.getContext(\"webgl\") || this.elem.getContext(\"experimental-webgl\");\n\t\tthis.context = null;\n\n\t\tthis.initGl();\n\t}\n\telse\n\t{\n\t\tthis.context = this.elem.getContext (\"2d\");\n\t\tthis.gl = null;\n\t}\n\n\tthis.antialias = opts && opts.antialias === false ? false : true;\n\tthis.setBackground (opts && opts.background != null ? opts.background : \"#000\");\n\n\t// State stack support.\n\tthis.matrixStack = [];\n\tthis.alphaStack = [];\n\tthis.matr = new Matrix ();\n\n\t// Default alpha value.\n\tthis._alpha = 1.0;\n\tthis._globalScale = 1.0;\n\n\t// Set initial transformation matrix.\n\tthis.matr.identity();\n\n\tif (this.context != null) {\n\t\tthis.transform();\n\t\tthis.strokeStyle(\"#fff\");\n\t\tthis.fillStyle(\"#fff\");\n\t}\n\n\tthis.resize();\n};\n\nCanvas.passThruCanvas = \n{\n\tparentNode: null,\n\n\timageSmoothingEnabled: true,\n\n\tstyle: {\n\t},\n\n\twidth: 950,\n\theight: 540,\n\n\tgetContext: function (renderingContext) {\n\t\treturn this;\n\t},\n\n\tsave: function() {\n\t},\n\n\trestore: function() {\n\t},\n\n\tscale: function (sx, sy) {\n\t},\n\n\trotate: function (angle) {\n\t},\n\n\ttranslate: function (x, y) {\n\t},\n\n\tsetTransform: function (a, b, c, d, e, f) {\n\t},\n\n\ttransform: function (a, b, c, d, e, f) {\n\t},\n\n\ttoDataURL: function (mime, params) {\n\t\treturn '';\n\t},\n\n\tbeginPath: function () {\n\t},\n\n\tmoveTo: function (x, y) {\n\t},\n\n\tclosePath: function() {\n\t},\n\n\tlineTo: function() {\n\t},\n\n\trect: function(x, y, w, h) {\n\t},\n\n\tfill: function() {\n\t},\n\n\tstroke: function() {\n\t},\n\n\tfillRect: function(x, y, w, h) {\n\t},\n\n\tstrokeRect: function(x, y, w, h) {\n\t},\n\n\tclip: function() {\n\t},\n\n\tquadraticCurveTo: function (cpx, cpy, x, y) {\n\t},\n\n\tbezierCurveTo: function (cx1, cy1, cx2, cy2, x, y) {\n\t},\n\n\tarc: function (x, y, r, sA, eA, cw) {\n\t},\n\n\tarcTo: function (x1, y1, x2, y2, r) {\n\t},\n\n\tfillText: function (text, x, y, maxWidth) {\n\t},\n\n\tstrokeText: function (text, x, y, maxWidth) {\n\t},\n\n\tmeasureText: function (text) {\n\t\treturn { width: 0 };\n\t},\n\n\tcreateImageData: function (w, h) {\n\t\treturn { width: w, height: h };\n\t},\n\n\tgetImageData: function (x, y, w, h) {\n\t\treturn { width: w, height: h, data: [] };\n\t},\n\n\tputImageData: function (data, x, y) {\n\t},\n\n\tdrawImage: function (...args) {\n\t},\n\n\tgetBoundingClientRect: function () {\n\t\treturn { left: 0, top: 0 };\n\t}\n};\n\n\n/**\n**\tCompiles a shader and attaches it to the program.\n*/\n\nCanvas.prototype.buildShader = function (program, type, source)\n{\n\tconst gl = this.gl;\n\n\tconst shader = gl.createShader(type);\n\tgl.shaderSource(shader, source);\n\tgl.compileShader(shader);\n\n\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n\t\tthrow new Error ('compilerShader: ' + gl.getShaderInfoLog(shader));\n\n\tgl.attachShader(program, shader);\n};\n\n\n/**\n**\tInitializes the OpenGL ES context.\n*/\nCanvas.prototype.initGl = function ()\n{\n\tlet gl = this.gl;\n\n\tthis.gl_array_buffer = gl.createBuffer();\n\tgl.bindBuffer (gl.ARRAY_BUFFER, this.gl_array_buffer);\n\tgl.bufferData (gl.ARRAY_BUFFER, new Float32Array ([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n\n\tthis.gl_program = gl.createProgram();\n\n\tthis.buildShader (this.gl_program, gl.VERTEX_SHADER,\n\t`\n\t\t#version 100\n\t\tattribute vec2 location;\n\t\tuniform vec2 screen_size;\n\t\tuniform vec2 texture_size;\n\t\tuniform mat3 location_matrix;\n\t\tuniform mat3 texture_matrix;\n\t\tuniform mat3 current_matrix;\n\t\tuniform sampler2D texture;\n\t\tvarying highp vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(((vec2(current_matrix*location_matrix*vec3(location, 1.0))/screen_size)*2.0-vec2(1.0, 1.0))*vec2(1.0, -1.0), 0.0, 1.0);\n\t\t\tf_texcoords = vec2(texture_matrix*vec3(location, 1.0))/texture_size;\n\t\t}\n\t`);\n\n\tthis.buildShader (this.gl_program, gl.FRAGMENT_SHADER,\n\t`\n\t\tuniform sampler2D texture;\n\t\tvarying highp vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(texture, f_texcoords);\n\t\t}\n\t`);\n\n\tgl.linkProgram (this.gl_program);\n\n\tif (!gl.getProgramParameter(this.gl_program, gl.LINK_STATUS))\n\t\tthrow new Error ('linkProgram: ' + gl.getProgramInfoLog(program));\n\n\tgl.useProgram (this.gl_program);\n\n\t/* **** */\n\tgl.clearColor (0, 0, 0, 0);\n\n\tgl.disable (gl.DEPTH_TEST);\n\tgl.clearDepth (0.0);\n\tgl.depthFunc (gl.GEQUAL);\n\n\tgl.enable (gl.BLEND);\n\tgl.blendFunc (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\t/* **** */\n\tthis.gl_attrib_location = gl.getAttribLocation(this.gl_program, 'location');\n\tthis.gl_uniform_screen_size = gl.getUniformLocation(this.gl_program, 'screen_size');\n\tthis.gl_uniform_texture_size = gl.getUniformLocation(this.gl_program, 'texture_size');\n\tthis.gl_uniform_texture = gl.getUniformLocation(this.gl_program, 'texture');\n\tthis.gl_uniform_matrix = gl.getUniformLocation(this.gl_program, 'location_matrix');\n\tthis.gl_uniform_current_matrix = gl.getUniformLocation(this.gl_program, 'current_matrix');\n\tthis.gl_uniform_texture_matrix = gl.getUniformLocation(this.gl_program, 'texture_matrix');\n\n\tgl.enableVertexAttribArray (this.gl_attrib_location);\n\tgl.vertexAttribPointer (this.gl_attrib_location, 2, gl.FLOAT, gl.FALSE, 2*Float32Array.BYTES_PER_ELEMENT, 0*Float32Array.BYTES_PER_ELEMENT);\n\n\t/* *** */\n\tthis.location_matrix = new Matrix();\n\tthis.texture_matrix = new Matrix();\n\tthis.current_matrix = new Matrix();\n\n\t// drawImage (Image img, float x, float y);\n\t// drawImage (Image img, float x, float y, float w, float h);\n\t// drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n\tthis.drawImage = function (...args)\n\t{\n\t\tconst img = args[0];\n\t\tconst sx = args[1];\n\t\tconst sy = args[2];\n\n\t\tif (this.gl_active_texture != img.gl_texture)\n\t\t{\n\t\t\tthis.gl.activeTexture(gl.TEXTURE0);\n\t\t\tthis.gl.bindTexture(gl.TEXTURE_2D, img.gl_texture);\n\t\t\tthis.gl.uniform1i(this.gl_uniform_texture, 0);\n\t\t\tthis.gl.uniform2fv(this.gl_uniform_texture_size, [img.width, img.height]);\n\n\t\t\tthis.gl_active_texture = img.gl_texture;\n\t\t}\n\n\t\tif (args.length == 3)\n\t\t\treturn;\n\n\t\tconst sw = args[3];\n\t\tconst sh = args[4];\n\n\t\tif (args.length == 5)\n\t\t\treturn;\n\n\t\tconst dx = args[5];\n\t\tconst dy = args[6];\n\t\tconst dw = args[7];\n\t\tconst dh = args[8];\n\n\t\tthis.current_matrix.set(this.matr);\n\t\tthis.current_matrix.transpose();\n\n\t\tthis.location_matrix.identity();\n\t\tthis.location_matrix.translate(dx, dy);\n\t\tthis.location_matrix.scale(dw, dh);\n\t\tthis.location_matrix.transpose();\n\n\t\tthis.texture_matrix.identity();\n\t\tthis.texture_matrix.translate(sx, sy);\n\t\tthis.texture_matrix.scale(sw, sh);\n\t\tthis.texture_matrix.transpose();\n\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_current_matrix, false, this.current_matrix.data);\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_matrix, false, this.location_matrix.data);\n\t\tthis.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix, false, this.texture_matrix.data);\n\t\tthis.gl.drawArrays (gl.TRIANGLE_STRIP, 0, 4);\n\t};\n};\n\n/**\n**\tPrepares an image to use it on the canvas. Used only if gl is not null.\n*/\nCanvas.prototype.prepareImage = function (image)\n{\n\tlet gl = this.gl;\n\tif (gl == null) return;\n\n\tlet texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\timage.gl_texture = texture;\n\timage.gl_ready = true;\n};\n\n/**\n**\tApplies the current config to the canvas (usually called after a reset on the canvas).\n**\n**\t>> void applyConfig();\n*/\n\nCanvas.prototype.applyConfig = function ()\n{\n\tif (this.antialias == false)\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = false;\n\n\t\tthis.elem.style.imageRendering = \"crisp-edges\";\n\t}\n\telse\n\t{\n\t\tif (this.context != null)\n\t\t\tthis.context.imageSmoothingEnabled = true;\n\n\t\tthis.elem.style.imageRendering = \"auto\";\n\t}\n};\n\n\n/**\n**\tDisposes the resources used by the canvas. The DOMElement will also be removed.\n**\n**\t>> void dispose();\n*/\n\nCanvas.prototype.dispose = function ()\n{\n\tif (this.elem.parentNode)\n\t\tthis.elem.parentNode.removeChild (this.elem);\n\n\tthis.matrixStack = null;\n\tthis.alphaStack = null;\n\tthis.matr = null;\n\tthis.context = null;\n\tthis.elem = null;\n};\n\n\n/**\n**\tSets the default background color of the canvas. Does not cause a canvas clear.\n**\n**\t>> void setBackground (string color);\n*/\n\nCanvas.prototype.setBackground = function (color, canvasColor)\n{\n\tthis.elem.style.background = color;\n\tthis.backgroundColor = canvasColor ? canvasColor : color;\n};\n\n\n/**\n**\tSets the canvas size.\n**\n**\t>> Canvas resize (float width, float height);\n*/\n\nCanvas.prototype.resize = function (width, height)\n{\n\tlet rect = this.elem.getBoundingClientRect();\n\n\tif (!width) width = rect.width;\n\tif (!height) height = rect.height;\n\n\tthis.elem.width = width;\n\tthis.elem.height = height;\n\n\tthis.width = this.elem.width;\n\tthis.height = this.elem.height;\n\n\tthis._width = ~~(this.width / this._globalScale);\n\tthis._height = ~~(this.height / this._globalScale);\n\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.viewport (0, 0, width, height);\n\n\t\tif (this.gl_uniform_screen_size)\n\t\t\tthis.gl.uniform2fv (this.gl_uniform_screen_size, [width, height]);\n\t}\n\n\tthis.applyConfig();\n\treturn this;\n};\n\n\n/**\n**\tSets the global canvas scale. Loads identity matrix.\n**\n**\t>> Canvas globalScale (float value);\n*/\n\nCanvas.prototype.globalScale = function (value)\n{\n\tthis._globalScale = value;\n\n\tthis._width = ~~(this.width / this._globalScale);\n\tthis._height = ~~(this.height / this._globalScale);\n\n\tthis.loadIdentity();\n\tthis.scale(value, value);\n\n\treturn this;\n};\n\n\n/**\n**\tIndicates if the canvas was flipped (i.e. xy is now yx).\n**\n**\t>> Canvas flipped (bool value);\n*/\n\nCanvas.prototype.flipped = function (value)\n{\n\tif (value)\n\t{\n\t\tthis._width = ~~(this.height / this._globalScale);\n\t\tthis._height = ~~(this.width / this._globalScale);\n\t}\n\telse\n\t{\n\t\tthis._width = ~~(this.width / this._globalScale);\n\t\tthis._height = ~~(this.height / this._globalScale);\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tSaves the state of the canvas context.\n**\n**\t>> Canvas save();\n*/\n\nCanvas.prototype.save = function ()\n{\n\tthis.context.save();\n\treturn this;\n};\n\n\n/**\n**\tRestores the state of the canvas context.\n**\n**\t>> Canvas restore();\n*/\n\nCanvas.prototype.restore = function ()\n{\n\tthis.context.restore();\n\treturn this;\n};\n\n\n/**\n**\tReturns the image on the canvas as a string in DATA-URI format.\n**\n**\t>> string toDataUrl (string name);\n*/\n\nCanvas.prototype.toDataUrl = function (mime, params)\n{\n\treturn this.elem.toDataURL (mime, params);\n};\n\n\n/**\n**\tReturns the image as a Base-64 encoded PNG string.\n**\n**\t>> string toPng64();\n*/\n\nCanvas.prototype.toPng64 = function ()\n{\n\treturn this.elem.toDataURL (\"image/png\").substr(22);\n};\n\n\n/**\n**\tSets or returns an attribute of the canvas context.\n**\n**\t>> Canvas _contextAttribute (string name);\n**\t>> Canvas _contextAttribute (string name, string value);\n*/\n\nCanvas.prototype._contextAttribute = function (name, value)\n{\n\tif (value !== undefined)\n\t{\n\t\tthis.context[name] = value;\n\t\treturn this;\n\t}\n\n\treturn this.context[name];\n};\n\n\n/**\n**\tSets or returns the current fill style (default black).\n**\n**\t>> Canvas fillStyle (string value);\n*/\n\nCanvas.prototype.fillStyle = function (value)\n{\n\treturn this._contextAttribute (\"fillStyle\", value);\n};\n\n\n/**\n**\tSets or returns the current stroke style (default black).\n**\n**\t>> Canvas strokeStyle (string value);\n*/\n\nCanvas.prototype.strokeStyle = function (value)\n{\n\treturn this._contextAttribute (\"strokeStyle\", value);\n};\n\n\n/**\n**\tSets or returns the current line cap style (butt, round, square. butt is default).\n**\n**\t>> Canvas lineCap (string value);\n**\t>> string lineCap ();\n*/\n\nCanvas.prototype.lineCap = function (value)\n{\n\treturn this._contextAttribute (\"lineCap\", value);\n};\n\n\n/**\n**\tSets or returns the current line join style (bevel, round, miter. miter is default).\n**\n**\t>> Canvas lineJoin (string value);\n**\t>> string lineJoin ();\n*/\n\nCanvas.prototype.lineJoin = function (value)\n{\n\treturn this._contextAttribute (\"lineJoin\", value);\n};\n\n\n/**\n**\tSets or returns the current line width value (default 1).\n**\n**\t>> Canvas lineWidth (float value);\n**\t>> float lineWidth ();\n*/\n\nCanvas.prototype.lineWidth = function (value)\n{\n\treturn this._contextAttribute (\"lineWidth\", value);\n};\n\n\n/**\n**\tSets or returns the current miter limit value (default 10).\n**\n**\t>> Canvas miterLimit (float value);\n**\t>> float miterLimit ();\n*/\n\nCanvas.prototype.miterLimit = function (value)\n{\n\treturn this._contextAttribute (\"miterLimit\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow color value (default black).\n**\n**\t>> Canvas shadowColor (string value);\n**\t>> string shadowColor ();\n*/\n\nCanvas.prototype.shadowColor = function (value)\n{\n\treturn this._contextAttribute (\"shadowColor\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow X offset (default 0).\n**\n**\t>> Canvas shadowOffsetX (float value);\n**\t>> float shadowOffsetX ();\n*/\n\nCanvas.prototype.shadowOffsetX = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetX\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow Y offset (default 0).\n**\n**\t>> Canvas shadowOffsetY (float value);\n**\t>> float shadowOffsetY ();\n*/\n\nCanvas.prototype.shadowOffsetY = function (value)\n{\n\treturn this._contextAttribute (\"shadowOffsetY\", value);\n};\n\n\n/**\n**\tSets or returns the current shadow blue value (default 0).\n**\n**\t>> Canvas shadowBlur (string value);\n**\t>> string shadowBlur ();\n*/\n\nCanvas.prototype.shadowBlur = function (value)\n{\n\treturn this._contextAttribute (\"shadowBlur\", value);\n};\n\n\n/**\n**\tSets or returns the current font settings.\n**\n**\t>> Canvas font (string value);\n**\t>> string font ();\n*/\n\nCanvas.prototype.font = function (value)\n{\n\treturn this._contextAttribute (\"font\", value);\n};\n\n\n/**\n**\tSets or returns the current text align settings (start, end, left, right, center).\n**\n**\t>> Canvas textAlign (string value);\n**\t>> string textAlign ();\n*/\n\nCanvas.prototype.textAlign = function (value)\n{\n\treturn this._contextAttribute (\"textAlign\", value);\n};\n\n\n/**\n**\tSets or returns the current text base line settings (alphabetic, bottom, hanging, ideographic, middle, top. Alphabetic is default).\n**\n**\t>> Canvas textBaseline (string value);\n**\t>> string textBaseline ();\n*/\n\nCanvas.prototype.textBaseline = function (value)\n{\n\treturn this._contextAttribute (\"textBaseline\", value);\n};\n\n\n/**\n**\tSets or returns the current global alpha value.\n**\n**\t>> Canvas globalAlpha (float value);\n**\t>> float globalAlpha ();\n*/\n\nCanvas.prototype.globalAlpha = function (value)\n{\n\tif (value !== undefined)\n\t\tthis._alpha = value;\n\telse\n\t\treturn this._alpha;\n\n\treturn this.alpha(1.0);\n};\n\n\n/**\n**\tSets the relative alpha value for subsequent drawing operations.\n**\n**\t>> Canvas alpha (float value);\n**\t>> float alpha ();\n*/\n\nCanvas.prototype.alpha = function (value)\n{\n\tthis._alpha *= value;\n\n\tif (this.context)\n\t\tthis.context.globalAlpha = this._alpha;\n\n\treturn this;\n};\n\n\n/**\n**\tSets or returns the current global composite operation value (source-atop, source-in, source-out, source-over, destination-atop,\n**\tdestination-in, destination-out, destination-over, lighter, copy, xor).\n**\n**\t>> Canvas globalCompositeOperation (string value);\n**\t>> string globalCompositeOperation ();\n*/\n\nCanvas.prototype.globalCompositeOperation = function (value)\n{\n\treturn this._contextAttribute (\"globalCompositeOperation\", value);\n};\n\n\n/**\n**\tTransforms shape of subsequent drawings based on a matrix. The provided values represent a matrix and it will be multiplied\n**\twith the current transformation matrix. If no parameter is provided the active matrix will be used.\n**\n**\t>> Canvas transform (float a, float b, float c, float d, float e, float f);\n*/\n\nCanvas.prototype.transform = function (a, b, c, d, e, f)\n{\n\tif (this.context == null)\n\t\treturn this;\n\n\tif (!arguments.length)\n\t{\n\t\tthis.context.setTransform (this.matr.data[0], this.matr.data[3], this.matr.data[1], this.matr.data[4], this.matr.data[2], this.matr.data[5]);\n\t\treturn this;\n\t}\n\n\tthis.context.transform (a, b, c, d, e, f);\n\treturn this;\n};\n\n\n/**\n**\tSimilar to transform() but this matrix is not multiplied by the active transformation matrix, instead it just comes the current matrix.\n**\n**\t>> Canvas setTransform (float a, float b, float c, float d, float e, float f);\n*/\n\nCanvas.prototype.setTransform = function (a, b, c, d, e, f)\n{\n\tthis.context.setTransform (a, b, c, d, e, f);\n\treturn this;\n};\n\n\n/**\n**\tDraws a filled rectangle on the canvas.\n**\n**\t>> Canvas fillRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.fillRect = function (x, y, w, h)\n{\n\tthis.context.fillRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tDraws an stroked rectangle on the canvas.\n**\n**\t>> Canvas strokeRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.strokeRect = function (x, y, w, h)\n{\n\tthis.context.strokeRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tClears a rectangle on the canvas. All pixels will be erased.\n**\n**\t>> Canvas clearRect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.clearRect = function (x, y, w, h)\n{\n\tthis.context.clearRect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tStarts a new path. Any previous path points will be cleared.\n**\n**\t>> Canvas beginPath();\n*/\n\nCanvas.prototype.beginPath = function ()\n{\n\tthis.context.beginPath ();\n\treturn this;\n};\n\n\n/**\n**\tCreates a new point in the current path.\n**\n**\t>> Canvas moveTo (float x, float y);\n*/\n\nCanvas.prototype.moveTo = function (x, y)\n{\n\tthis.context.moveTo (x, y);\n\treturn this;\n};\n\n\n/**\n**\tCreates a new point from the first path point to the last, and finishes the path.\n**\n**\t>> Canvas closePath();\n*/\n\nCanvas.prototype.closePath = function ()\n{\n\tthis.context.closePath ();\n\treturn this;\n};\n\n\n/**\n**\tDraws a line from the last point on the path to the given point.\n**\n**\t>> Canvas lineTo (float x, float y);\n*/\n\nCanvas.prototype.lineTo = function (x, y)\n{\n\tthis.context.lineTo (x, y);\n\treturn this;\n};\n\n\n/**\n**\tCreates a hollow rectangle path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas rect (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.rect = function (x, y, w, h)\n{\n\tthis.context.rect (x, y, w, h);\n\treturn this;\n};\n\n\n/**\n**\tFills the active path with the current fill style or with the one given in the value parameter.\n**\n**\t>> Canvas fill (string value);\n**\t>> Canvas fill ();\n*/\n\nCanvas.prototype.fill = function (value)\n{\n\tif (value) this.fillStyle (value);\n\tthis.context.fill ();\n\treturn this;\n};\n\n\n/**\n**\tStrokes the active path with the current stroke style or with the one given in the value parameter.\n**\n**\t>> Canvas stroke (string value);\n**\t>> Canvas stroke ();\n*/\n\nCanvas.prototype.stroke = function (value)\n{\n\tif (value) this.strokeStyle (value);\n\tthis.context.stroke ();\n\treturn this;\n};\n\n\n/**\n**\tCreates a viewport with the active path. Only the viewport will be visible.\n**\n**\t>> Canvas clip();\n*/\n\nCanvas.prototype.clip = function ()\n{\n\tthis.context.clip ();\n\treturn this;\n};\n\n\n/**\n**\tAdds points of a quadratic curve to the active path. A control points and one reference point must be provided.\n**\n**\t>> Canvas quadraticCurveTo (float cpx, float cpy, float x, float y);\n*/\n\nCanvas.prototype.quadraticCurveTo = function (cpx, cpy, x, y)\n{\n\tthis.context.quadraticCurveTo (cpx, cpy, x, y);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of a bezier curve to the active path. Two control points and one reference point must be provided.\n**\n**\t>> Canvas bezierCurveTo (float cx1, float cy1, float cx2, float cy2, float x, float y);\n*/\n\nCanvas.prototype.bezierCurveTo = function (cx1, cy1, cx2, cy2, x, y)\n{\n\tthis.context.bezierCurveTo (cx1, cy1, cx2, cy2, x, y);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of an arc the the active path. Used to draw a circle of part of it.\n**\n**\t>> Canvas arc (float x, float y, float r, float sA, float eA, float cw);\n*/\n\nCanvas.prototype.arc = function (x, y, r, sA, eA, cw)\n{\n\tthis.context.arc (x, y, r, sA, eA, cw);\n\treturn this;\n};\n\n\n/**\n**\tAdds points of an arc to the active path. Used to create an arc between two points.\n**\n**\t>> Canvas arcTo (float x1, float y1, float x2, float y2, float r);\n*/\n\nCanvas.prototype.arcTo = function (x1, y1, x2, y2, r)\n{\n\tthis.context.arcTo (x1, y1, x2, y2, r);\n\treturn this;\n};\n\n\n/**\n**\tDraws filled text on the canvas with the active font, and fillStyle properties.\n**\n**\t>> Canvas fillText (string text, float x, float y, float maxWidth=1000)\n*/\n\nCanvas.prototype.fillText = function (text, x, y, maxWidth)\n{\n\tthis.context.fillText (text, x, y, maxWidth ? maxWidth : 1000);\n\treturn this;\n};\n\n\n/**\n**\tDraws stroked text on the canvas with the active font, and fillStyle properties.\n**\n**\t>> Canvas strokeText (string text, float x, float y, float maxWidth=1000);\n*/\n\nCanvas.prototype.strokeText = function (text, x, y, maxWidth)\n{\n\tthis.context.strokeText (text, x, y, maxWidth ? maxWidth : 1000);\n\treturn this;\n};\n\n\n/**\n**\tMeasures the width of the given text using active font properties.\n**\n**\t>> float measureText (string text);\n*/\n\nCanvas.prototype.measureText = function (text)\n{\n\treturn this.context.measureText (text).width;\n};\n\n\n/**\n**\tReturns a new image data object with the specified size.\n**\n**\t>> ImageData createImageData (float w, float h);\n*/\n\nCanvas.prototype.createImageData = function (w, h)\n{\n\treturn this.context.createImageData (w, h);\n};\n\n\n/**\n**\tReturns an image data object with the pixels of a rectangular area of the canvas.\n**\n**\t>> ImageData getImageData (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.getImageData = function (x, y, w, h)\n{\n\treturn this.context.getImageData (x, y, w, h);\n};\n\n\n/**\n**\tPuts image data on the canvas at the specified location.\n**\n**\t>> Canvas putImageData (ImageData data, float x, float y);\n*/\n\nCanvas.prototype.putImageData = function (data, x, y)\n{\n\tthis.context.putImageData (data, x, y);\n\treturn this;\n};\n\n\n/**\n**\tDraws an image on the canvas.\n**\n**\tCanvas drawImage (Image img, float x, float y);\n**\tCanvas drawImage (Image img, float x, float y, float w, float h);\n**\tCanvas drawImage (Image img, float sx, float sy, float sw, float sh, float dx, float dy, float dw, float dh);\n*/\n\nCanvas.prototype.drawImage = function (...args)\n{\n\tif (args.length == 3)\n\t{\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2]);\n\t}\n\telse if (args.length == 5)\n\t{\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2], ~~args[3], ~~args[4]);\n\t}\n\telse if (args.length == 9)\n\t{\n\t\tvar a3 = ~~args[3];\n\t\tvar a4 = ~~args[4];\n\t\tif (!a3 || !a4) return this;\n\n\t\tvar a7 = ~~args[7];\n\t\tvar a8 = ~~args[8];\n\t\tif (!a7 || !a8) return this;\n\n\t\tthis.context.drawImage (args[0], ~~args[1], ~~args[2], a3, a4, ~~args[5], ~~args[6], a7, a8);\n\t}\n\n\treturn this;\n};\n\n\n/**\n**\tClears the entire canvas. If the backgroundColor parameter is set the canvas will be cleared manually by using\n**\tthe fillRect method.\n**\n**\t>> Canvas clear (string backgroundColor);\n**\t>> Canvas clear ();\n*/\n\nCanvas.prototype.clear = function (backgroundColor)\n{\n\tif (this.gl != null)\n\t{\n\t\tthis.gl.clear(this.gl.DEPTH_BUFFER_BIT | this.gl.COLOR_BUFFER_BIT);\n\t\tthis.gl_active_texture = null;\n\n\t\treturn this;\n\t}\n\n\tif (backgroundColor)\n\t{\n\t\tthis.globalCompositeOperation(\"source-over\").globalAlpha(1.0).fillStyle(backgroundColor !== true ? backgroundColor : this.backgroundColor).fillRect(0, 0, this._width, this._height);\n\t}\n\telse\n\t{\n\t\tthis.elem.width = this.width;\n\t\tthis.applyConfig();\n\t}\n\n\tthis.transform();\n\treturn this;\n};\n\n\n/**\n**\tResets the context drawing properties to their initial values.\n**\n**\t>> Canvas reset (bool clearPath);\n**\t>> Canvas reset ();\n*/\n\nCanvas.prototype.reset = function (clearPath)\n{\n\tthis.fillStyle(\"#000000\").strokeStyle(\"#000000\").lineCap(\"butt\").lineJoin(\"miter\")\n\t.lineWidth(\"1\").miterLimit(\"10\").shadowColor(\"#000000\").shadowOffsetX(\"0\")\n\t.shadowOffsetY(\"0\").shadowBlur(\"0\").globalAlpha(\"1.0\").globalCompositeOperation(\"source-over\");\n\n\tif (clearPath) this.beginPath().closePath();\n\n\treturn this;\n};\n\n\n/**\n**\tPushes the current transformation matrix into the matrix stack.\n**\n**\t>> Canvas pushMatrix();\n*/\n\nCanvas.prototype.pushMatrix = function ()\n{\n\tthis.matrixStack.push (this.matr);\n\tthis.matr = this.matr.clone();\n\n\treturn this;\n};\n\n\n/**\n**\tPops a matrix from the matrix stack into the transformation matrix.\n**\n**\t>> Canvas popMatrix();\n*/\n\nCanvas.prototype.popMatrix = function ()\n{\n\tthis.matr = this.matrixStack.pop ();\n\treturn this.transform ();\n};\n\n\n/**\n**\tPushes the current global alpha into the stack.\n**\n**\t>> Canvas pushAlpha();\n*/\n\nCanvas.prototype.pushAlpha = function ()\n{\n\tthis.alphaStack.push (this.globalAlpha());\n\treturn this;\n};\n\n\n/**\n**\tPops an alpha from the stack into the global alpha.\n**\n**\t>> Canvas popAlpha();\n*/\n\nCanvas.prototype.popAlpha = function ()\n{\n\tthis.globalAlpha(this.alphaStack.pop());\n\treturn this;\n};\n\n\n/**\n**\tSets the transformation matrix to identity.\n**\n**\t>> Canvas loadIdentity();\n*/\n\nCanvas.prototype.loadIdentity = function ()\n{\n\tthis.matr.identity ();\n\treturn this.transform ();\n};\n\n\n/**\n**\tSets the transformation matrix to the specified one.\n**\n**\t>> Canvas loadMatrix (Matrix matr);\n*/\n\nCanvas.prototype.loadMatrix = function (matr)\n{\n\tthis.matr.identity().append(matr);\n\treturn this.transform ();\n};\n\n\n/**\n**\tReturns a copy of the current transformation matrix object.\n**\n**\t>> Matrix getMatrix();\n*/\n\nCanvas.prototype.getMatrix = function ()\n{\n\treturn this.matr.clone();\n};\n\n\n/**\n**\tAppends a matrix to the current transformation matrix.\n**\n**\t>> Canvas appendMatrix (Matrix matr);\n*/\n\nCanvas.prototype.appendMatrix = function (matr)\n{\n\tthis.matr.append (matr);\n\treturn this.transform ();\n};\n\n\n/**\n**\tSets scaling factors for subsequent drawing operations. If the useNative is not set then scale with the current\n**\ttransformation matrix will be performed.\n**\n**\t>> Canvas scale (float sx, float sy, bool useNative=false);\n*/\n\nCanvas.prototype.scale = function (sx, sy, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.scale (sx, sy);\n\t\treturn this;\n\t}\n\n\tthis.matr.scale (sx, sy);\n\treturn this.transform();\n};\n\n\n/**\n**\tSets rotation factor for subsequent drawing operations. The angle is in radians. If useNative is not set\n**\tthen rotation with the transformation matrix will be used.\n**\n**\t>> Canvas rotate (float angle, bool useNative=false);\n*/\n\nCanvas.prototype.rotate = function (angle, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.rotate (angle);\n\t\treturn this;\n\t}\n\n\tthis.matr.rotate (angle);\n\treturn this.transform ();\n};\n\n\n/**\n**\tMoves starting point to an specified location. If the useNative parameter is not set then translation with\n**\tthe transformation matrix will be done.\n**\n**\t>> Canvas translate (float x, float y, bool useNative=false);\n*/\n\nCanvas.prototype.translate = function (x, y, useNative)\n{\n\tif (useNative) {\n\t\tthis.context.translate (x, y);\n\t\treturn this;\n\t}\n\n\tthis.matr.translate (x, y);\n\treturn this.transform ();\n};\n\n\n/**\n**\tCreates a hollow ellipse path on the canvas for subsequent stroke or fill.\n**\n**\t>> Canvas ellipse (float x, float y, float w, float h);\n*/\n\nCanvas.prototype.ellipse = function (x, y, w, h)\n{\n\tvar ox = (w/2)*.5522848, oy = (h/2)*.5522848;\n\tvar xe = x+w-1, ye = y+h-1, xm = x+w/2, ym = y+h/2;\n\n\tthis.beginPath ().moveTo(x, ym);\n\tthis.bezierCurveTo (x, ym - oy, xm - ox, y, xm, y);\n\tthis.bezierCurveTo (xm + ox, y, xe, ym - oy, xe, ym);\n\tthis.bezierCurveTo (xe, ym + oy, xm + ox, ye, xm, ye);\n\tthis.bezierCurveTo (xm - ox, ye, x, ym + oy, x, ym);\n\tthis.closePath ();\n\n\treturn this;\n};\n\n\n/**\n**\tCreates a hollow circle path on the canvas for subsequent stroke or fill. If the stroke param is set the circle\n**\twill be drawn with the specified stroke color.\n**\n**\t>> Canvas circle (float x, float y, float r, string strokeColor);\n**\t>> Canvas circle (float x, float y, float r);\n*/\n\nCanvas.prototype.circle = function (x, y, r, stroke)\n{\n\tthis.beginPath();\n\tthis.arc(x, y, r, 0, 2*Math.PI);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\n\treturn this;\n};\n\n\n/**\n**\tDraws a line for subsequent stroke or fill. If the stroke param is set the line will be drawn with\n**\tthe specified stroke color.\n**\n**\t>> Canvas line (float x1, float y1, float x2, float y2, string strokeColor);\n**\t>> Canvas line (float x1, float y1, float x2, float y2);\n*/\n\nCanvas.prototype.line = function (x1, y1, x2, y2, stroke)\n{\n\tthis.beginPath();\n\tthis.moveTo(x1, y1);\n\tthis.lineTo(x2, y2);\n\tthis.closePath();\n\n\tif (stroke) this.stroke(stroke);\n\treturn this;\n};\n\n\n/**\n**\tAttaches internal listeners for mouse/pointer events on the canvas object, this is called automatically when\n**\tattaching handlers to the canvas. The actual handlers are added or removed using the addPointerHandler and\n**\tremovePointerHandler respectively.\n**\n**\t>> Canvas enablePointerEvents();\n*/\n\nCanvas.prototype.enablePointerEvents = function()\n{\n\tif (this.pointerHandler) return this;\n\n\tthis.pointerScale = { sx: 1, sy: 1 };\n\tthis.pointerOffset = { x: 0, y: 0 };\n\n\tvar _ = this;\n\n\tvar _evt =\n\t{\n\t\taction: '',\n\t\tbuttons: 0, lbuttons: 0,\n\t\tx: 0, y: 0,\n\n\t\tcontainedBy: function (x, y, w, h) {\n\t\t\treturn this.x >= x && this.x <= (x+w-1) && this.y >= y && this.y <= (y+h-1);\n\t\t}\n\t};\n\n\tthis.pointerHandlers = [];\n\n\tthis.pointerHandler = function (code, evt)\n\t{\n\t\tvar rect = this.elem.getBoundingClientRect();\n\n\t\t_evt.action = code;\n\t\t_evt.buttons = evt.buttons;\n\t\t_evt.x = _evt.rx = ~~(evt.clientX - rect.left);\n\t\t_evt.y = _evt.ry = ~~(evt.clientY - rect.top);\n\n\t\t_evt.x = ((_evt.x - _.pointerOffset.x) - 0.0*_.pointerScale.sx) / _.pointerScale.sx;\n\t\t_evt.y = ((_evt.y - _.pointerOffset.y) - 0.0*_.pointerScale.sy) / _.pointerScale.sy;\n\n\t\t_evt.dragging = false;\n\n\t\tif (_evt.buttons && !_evt.lbuttons)\n\t\t{\n\t\t\t_evt.sx = _evt.x;\n\t\t\t_evt.sy = _evt.y;\n\n\t\t\t_evt.ldx = _evt.ldy = 0;\n\t\t}\n\n\t\tif (_evt.buttons && _evt.lbuttons)\n\t\t{\n\t\t\t_evt.dragging = true;\n\n\t\t\t_evt.dx = _evt.x - _evt.sx;\n\t\t\t_evt.dy = _evt.y - _evt.sy;\n\t\t\t\n\t\t\t_evt.ddx = _evt.dx - _evt.ldx;\n\t\t\t_evt.ddy = _evt.dy - _evt.ldy;\n\n\t\t\t_evt.ldx = _evt.dx;\n\t\t\t_evt.ldy = _evt.dy;\n\t\t}\n\n\t\t_evt.lbuttons = _evt.buttons;\n\n\t\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t\t{\n\t\t\tif (this.pointerHandlers[i][1].call(this.pointerHandlers[i][2], _evt) === false)\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.elem.onmousedown = function(evt) {  _.pointerHandler('DOWN', evt); };\n\tthis.elem.onmouseup = function(evt) { _.pointerHandler('UP', evt); };\n\tthis.elem.onmousemove = function(evt) { _.pointerHandler('MOVE', evt); };\n\n\treturn this;\n};\n\n\n/**\n**\tSets the pointer scaling factors.\n**\n**\t>> Canvas setPointerScale (float sx, float sy);\n*/\n\nCanvas.prototype.setPointerScale = function (sx, sy)\n{\n\tthis.pointerScale = { sx: sx, sy: sy };\n\treturn this;\n};\n\n\n/**\n**\tSets the pointer offset that is applied after scaling.\n**\n**\t>> Canvas setPointerOffset (float x, float y);\n*/\n\nCanvas.prototype.setPointerOffset = function (x, y)\n{\n\tthis.pointerOffset = { x: x, y: y };\n\treturn this;\n};\n\n\n/**\n**\tAdds a pointer event handler, returns the handler reference id for later removal.\n**\n**\t>> string addPointerHandler (function callback, object context);\n**\t>> string addPointerHandler (function callback);\n*/\n\nCanvas.prototype.addPointerHandler = function (callback, context)\n{\n\tthis.enablePointerEvents();\n\n\tthis.pointerHandlers.push ([this.pointerHandlers.length+\"_\"+~~(Math.random()*1e6), callback, context]);\n\n\treturn this.pointerHandlers[this.pointerHandlers.length-1][0];\n};\n\n\n/**\n**\tRemoves a previously attached pointer event handler.\n**\n**\t>> void removePointerHandler (string id);\n*/\n\nCanvas.prototype.removePointerHandler = function (id)\n{\n\tif (!this.pointerHandlers) return;\n\n\tfor (var i = 0; i < this.pointerHandlers.length; i++)\n\t{\n\t\tif (this.pointerHandlers[i][0] == id)\n\t\t{\n\t\t\tthis.pointerHandlers.splice(i, 1);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n\n/**\n**\tDraws an image resource on the canvas (as obtained by Resources.load).\n**\n**\t>> Canvas drawImageEx (Resource image, float x, float y, [float width, float height]);\n*/\n\nCanvas.prototype.drawImageResource = function (image, x, y, width, height)\n{\n\tif (width == null)\n\t\treturn this.drawImage (image.data, 0, 0, image.data.width, image.data.height, x, y, image.width, image.height);\n\n\treturn this.drawImage (image.data, 0, 0, image.data.width, image.data.height, x, y, width, height);\n};\n","/*\n**\t@rsthn/cherry/system\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\nconst KeyCodes = require('./keycodes');\nconst List = require('./list');\nconst Linkable = require('./linkable');\nconst Timer = require('./timer');\nconst Canvas = require('./canvas');\n\n/**\n**\tSystem object.\n*/\n\nconst System = module.exports =\n{\n\t/**\n\t**\tSystem flags.\n\t*/\n\tflags:\n\t{\n\t\trenderingEnabled: false,\n\t\trenderingPaused: false\n\t},\n\n\t/**\n\t**\tEvent codes.\n\t*/\n\tEVT_KEY_DOWN:\t\t\t0x001,\n\tEVT_KEY_UP:\t\t\t\t0x002,\n\n\tEVT_POINTER_DOWN: \t\t0x010,\n\tEVT_POINTER_UP: \t\t0x011,\n\tEVT_POINTER_MOVE: \t\t0x012,\n\tEVT_POINTER_DRAG_START:\t0x013,\n\tEVT_POINTER_DRAG_MOVE:\t0x014,\n\tEVT_POINTER_DRAG_STOP:\t0x015,\n\n\t/**\n\t**\tDisplay orientations.\n\t*/\n\tDEFAULT:\t0,\n\tLANDSCAPE:\t1,\n\tPORTRAIT:\t2,\n\tAUTOMATIC:\t3,\n\n\t/**\n\t**\tDefault options of the rendering system.\n\t*/\n\tdefaultOptions:\n\t{\n\t\tbackground: \"#000\",\n\t\tgl: false,\n\n\t\tcanvas: null,\n\t\tcanvas2: null,\n\n\t\tfps: 60,\n\t\tminFps: 15,\n\n\t\tcontext: null,\n\t\tantialias: true,\n\n\t\ttargetScreenWidth: null,\n\t\ttargetScreenHeight: null,\n\n\t\torientation: 0,\n\n\t\textraScaleFactor: 1,\n\t\tfullscreen: true\n\t},\n\n\t/**\n\t**\tScreen resolution, obtained automatically when the system is initialized.\n\t*/\n\tscreenWidth: 0, screenHeight: 0,\n\n\t/**\n\t**\tCoordinates of the screen's offset (for letter-box effect when the screen does not fit tightly).\n\t*/\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t**\tDevice pixel ratio, canvas backing store ratio and resulting canvas ratio (devicePixelRatio / backingStoreRatio).\n\t*/\n\tdevicePixelRatio: 1, backingStoreRatio: 1, canvasPixelRatio: 1, canvasScaleFactor: 1, scaleFactor: 1,\n\n\t/*\n\t**\tInitial transformation matrix. Should be used (if needed) instead of loadIdentity() since the System does some transformations first.\n\t*/\n\tinitialMatrix: null,\n\n\t/**\n\t**\tDisplay buffer for the renderer (either 2d or webgl).\n\t*/\n\tdisplayBuffer: null,\n\n\t/**\n\t**\tSecondry display buffer (always 2d).\n\t*/\n\tdisplayBuffer2: null,\n\n\t/**\n\t**\tSmall (320x240) temporal display buffer.\n\t*/\n\ttempDisplayBuffer: null,\n\n\t/**\n\t**\tMap with the status of all keys (along with other flags).\n\t*/\n\tkeyState: { time: 0, shift: false, ctrl: false, alt: false, keyCode: 0 },\n\n\t/**\n\t**\tCurrent status of all pointers. The related object is known as the Pointer State, and has the following fields:\n\t**\tid, isActive, isDragging, sx, sy, x, y, dx, dy, button\n\t*/\n\tpointerState: { },\n\n\t/**\n\t**\tThe update method of all objects will be executed when the system update() method is called.\n\t*/\n\tupdateQueue: null, /*List*/\n\n\t/**\n\t**\tThe draw method of all objects will be executed when the system draw() method is called.\n\t*/\n\tdrawQueue: null, /*List*/\n\n\t/*\n\t**\tTime scale, the frame delta is multiplied by this value before each system cycle.\n\t*/\n\ttimeScale: 1,\n\n\t/**\n\t**\tFrame interval in milliseconds.\n\t*/\n\tframeInterval: 0,\n\n\t/**\n\t**\tFixed frame interval in milliseconds, when set to non-zero value the frame delta will be set to this value.\n\t*/\n\tfixedFrameInterval: 0,\n\n\t/**\n\t**\tMaximum frame interval in milliseconds, if the frameDelta exceeds this it will be truncated to this value.\n\t*/\n\tmaxFrameInterval: 0,\n\n\t/**\n\t**\tLast frame delta in seconds and milliseconds (float, int).\n\t*/\n\tframeDelta: 0,\n\tframeDeltaMillis: 0,\n\n\t/**\n\t**\tLogical system time (updated on each cycle by the calculated frameDelta).\n\t*/\n\tframeTime: 0,\n\tframeTimeMillis: 0,\n\n\t/**\n\t**\tCurrent frame number.\n\t*/\n\tframeNumber: 0,\n\n\t/**\n\t**\tIndicates if the drawing or update process is taking place.\n\t*/\n\tframeUpdateInProgress: false,\n\tframeDrawInProgress: false,\n\n\t/**\n\t**\tRendering time data.\n\t*/\n\tperf:\n\t{\n\t\t/**\n\t\t**\tTime of the first frame drawn.\n\t\t*/\n\t\tstartTime: 0,\n\n\t\t/**\n\t\t**\tTime of the last frame drawn.\n\t\t*/\n\t\tlastTime: 0,\n\n\t\t/**\n\t\t**\tNumber of frames drawn in total since startTime.\n\t\t*/\n\t\tnumFrames: 0,\n\n\t\t/**\n\t\t**\tTotal time accumulated in each update and draw operation.\n\t\t*/\n\t\tupdateTime: 0,\n\t\tdrawTime: 0\n\t},\n\n\t/**\n\t**\tInitializes the system with the specified configuration.\n\t*/\n\tinit: function (opts)\n\t{\n\t\t// Load options from defaults and from the specified ones.\n\t\tvar o = { };\n\n\t\tObject.assign(o, this.defaultOptions);\n\t\tif (opts) Object.assign(o, opts);\n\n\t\tthis.options = o;\n\n\t\t// Set default orientation if both target sizes were specified.\n\t\tif (o.targetScreenWidth && o.targetScreenHeight && o.orientation == System.DEFAULT)\n\t\t{\n\t\t\to.orientation = o.targetScreenWidth > o.targetScreenHeight ? System.LANDSCAPE : System.PORTRAIT;\n\t\t}\n\n\t\tthis.orientation = o.orientation;\n\n\t\tthis.updateQueue = new List();\n\t\tthis.drawQueue = new List();\n\n\t\t// Attach frame event handlers.\n\t\tthis.frameInterval = int(1000 / o.fps);\n\t\tthis.maxFrameInterval = int(1000 / o.minFps);\n\n\t\tglobal.onresize = this.onWindowResized.bind(this);\n\n\t\tthis.frameTimer = new Timer (this.frameInterval, this.onFrame.bind(this), true);\n\n\t\t// Setup canvas buffer.\n\t\tthis.displayBuffer = new Canvas (null, { gl: o.gl, elem: o.canvas, absolute: true, hidden: false, antialias: o.antialias, background: o.background });\n\t\tthis.displayBuffer2 = new Canvas (null, { gl: false, elem: o.canvas2, absolute: true, hidden: false, antialias: o.antialias, background: 'none' });\n\n\t\tthis.displayBuffer2.elem.style.pointerEvents = 'none';\n\n\t\tthis.tempDisplayBuffer = new Canvas (null, { hidden: true, antialias: o.antialias }).resize(320, 240);\n\n\t\tvar display0 = this.displayBuffer.elem;\n\n\t\t// Obtain device display ratios.\n\t\tthis.devicePixelRatio = global.devicePixelRatio || 1;\n\n\t\tthis.backingStoreRatio = o.gl == true ? 1 : (this.displayBuffer.context.webkitBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.mozBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.msBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.oBackingStorePixelRatio ||\n\t\t\t\t\t\t\t\t\tthis.displayBuffer.context.backingStorePixelRatio || 1);\n\n\t\tthis.canvasPixelRatio = this.devicePixelRatio / this.backingStoreRatio;\n\n\t\tSystem.onWindowResized (true);\n\n\t\t// Attach keyboard event handlers.\n\t\tvar _this = this;\n\n\t\tglobal.onkeydown = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (_this.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\t_this.keyState[evt.keyCode] = true;\n\n\t\t\t_this.keyState.keyCode = evt.keyCode;\n\t\t\t_this.keyState.startTime = System.now(true);\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\t_this.keyState.shift = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\t_this.keyState.ctrl = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\t_this.keyState.alt = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// CTRL+TAB should always be handled by the browser.\n\t\t\tif (_this.keyState.ctrl && evt.keyCode == KeyCodes.TAB)\n\t\t\t{\n\t\t\t\t_this.keyState[evt.keyCode] = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (_this.onKeyboardEvent (_this.EVT_KEY_DOWN, evt.keyCode, _this.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\tglobal.onkeyup = function (evt)\n\t\t{\n\t\t\tif (evt.target !== global.document.body)\n\t\t\t\treturn;\n\n\t\t\tif (!_this.keyState[evt.keyCode])\n\t\t\t\treturn false;\n\n\t\t\t_this.keyState[evt.keyCode] = false;\n\t\t\t_this.keyState.endTime = System.now(true);\n\t\t\t_this.keyState.keyCode = evt.keyCode;\n\n\t\t\tswitch (evt.keyCode)\n\t\t\t{\n\t\t\t\tcase 16: // SHIFT\n\t\t\t\t\t_this.keyState.shift = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 17: // CTRL\n\t\t\t\t\t_this.keyState.ctrl = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 18: // ALT\n\t\t\t\t\t_this.keyState.alt = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (_this.onKeyboardEvent (_this.EVT_KEY_UP, evt.keyCode, _this.keyState) === false)\n\t\t\t\treturn false;\n\t\t};\n\n\t\t// Attach pointer event handlers if pointer-events are available.\n\t\tif (\"ontouchstart\" in global)\n\t\t{\n\t\t\tdisplay0.ontouchstart = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.pointerState[touches[i].identifier] = {\n\t\t\t\t\t\t\t\tid: touches[i].identifier, isActive: false, isDragging: false,\n\t\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0, button: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.isActive = true;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 1;\n\n\t\t\t\t\tp.startTime = System.now(true);\n\n\t\t\t\t\tp.x = p.sx = System.reverseRender ? ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor) : ~~((touches[i].clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\t\tp.y = p.sy = System.reverseRender ? ~~(System.screenHeight - (touches[i].clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DOWN, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchend = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.endTime = System.now(true);\n\t\t\t\t\tp.deltaTime = p.endTime - p.startTime;\n\n\t\t\t\t\tp.x = System.reverseRender ? ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor) : ~~((touches[i].clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\t\tp.y = System.reverseRender ? ~~(System.screenHeight - (touches[i].clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\t\tif (p.isDragging)\n\t\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchcancel = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tp.x = System.reverseRender ? ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor) : ~~((touches[i].clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\t\tp.y = System.reverseRender ? ~~(System.screenHeight - (touches[i].clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_STOP : System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\t\tp.isActive = false;\n\t\t\t\t\tp.isDragging = false;\n\t\t\t\t\tp.button = 0;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.ontouchmove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tvar touches = evt.changedTouches;\n\n\t\t\t\tfor (var i = 0; i < touches.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!System.pointerState[touches[i].identifier])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tvar p = System.pointerState[touches[i].identifier];\n\n\t\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t\t{\n\t\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\t\tp.isDragging = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tp.x = System.reverseRender ? ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor) : ~~((touches[i].clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\t\tp.y = System.reverseRender ? ~~(System.screenHeight - (touches[i].clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((touches[i].clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_MOVE : System.EVT_POINTER_MOVE, p, System.pointerState);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\t// Attach mouse event handlers when pointer-events are not available.\n\t\telse\n\t\t{\n\t\t\tdisplay0.onmousedown = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t{\n\t\t\t\t\tSystem.pointerState[0] = {\n\t\t\t\t\t\t\tid: 0, isActive: false, isDragging: false, button: 0,\n\t\t\t\t\t\t\tsx: 0, sy: 0, x: 0, y: 0, dx: 0, dy: 0,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tp.isActive = true;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = evt.which;\n\n\t\t\t\tp.x = p.sx = System.reverseRender ? ~~((evt.clientY-System.offsY) / System.canvasScaleFactor) : ~~((evt.clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\tp.y = p.sy = System.reverseRender ? ~~(System.screenHeight - (evt.clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((evt.clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DOWN, p, System.pointerState);\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tdisplay0.onmouseup = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tp.x = System.reverseRender ? ~~((evt.clientY-System.offsY) / System.canvasScaleFactor) : ~~((evt.clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\tp.y = System.reverseRender ? ~~(System.screenHeight - (evt.clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((evt.clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\tif (p.isDragging)\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_STOP, p, System.pointerState);\n\n\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_UP, p, System.pointerState);\n\n\t\t\t\tp.isActive = false;\n\t\t\t\tp.isDragging = false;\n\t\t\t\tp.button = 0;\n\t\t\t};\n\n\t\t\tdisplay0.onmousemove = function (evt)\n\t\t\t{\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tif (!System.pointerState[0])\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar p = System.pointerState[0];\n\n\t\t\t\tif (p.isActive && !p.isDragging)\n\t\t\t\t{\n\t\t\t\t\tSystem.onPointerEvent (System.EVT_POINTER_DRAG_START, p, System.pointerState);\n\t\t\t\t\tp.isDragging = true;\n\t\t\t\t}\n\n\t\t\t\tp.x = System.reverseRender ? ~~((evt.clientY-System.offsY) / System.canvasScaleFactor) : ~~((evt.clientX-System.offsX) / System.canvasScaleFactor);\n\t\t\t\tp.y = System.reverseRender ? ~~(System.screenHeight - (evt.clientX-System.offsX) / System.canvasScaleFactor - 1) : ~~((evt.clientY-System.offsY) / System.canvasScaleFactor);\n\n\t\t\t\tp.dx = p.x - p.sx;\n\t\t\t\tp.dy = p.y - p.sy;\n\n\t\t\t\tSystem.onPointerEvent (p.isDragging ? System.EVT_POINTER_DRAG_MOVE : System.EVT_POINTER_MOVE, p, System.pointerState);\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t},\n\n\t/**\n\t**\tReturns the current time in milliseconds or seconds if asSeconds is set to true.\n\t*/\n\tnow: function(asSeconds)\n\t{\n\t\tvar value = hrnow();\n\t\treturn asSeconds ? (value / 1000) : value;\n\t},\n\n\t/**\n\t**\tReturns the current logical time in seconds (same as reading System.frameTime).\n\t*/\n\ttime: function()\n\t{\n\t\treturn this.frameTime;\n\t},\n\n\t/**\n\t**\tStarts the system and enables rendering and updates.\n\t*/\n\tstart: function()\n\t{\n\t\tthis.onWindowResized();\n\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.frameTimer.start();\n\t},\n\n\t/**\n\t**\tStops the system by disabling both rendering and updates.\n\t*/\n\tstop: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t\tthis.frameTimer.stop();\n\t},\n\n\t/**\n\t**\tDisables updates, but continues to render.\n\t*/\n\tpause: function()\n\t{\n\t\tthis.flags.renderingPaused = true;\n\t},\n\n\t/**\n\t**\tResumes updates if previously stopped with `pause()`.\n\t*/\n\tresume: function()\n\t{\n\t\tthis.flags.renderingPaused = false;\n\t\tthis.resetPerf();\n\t},\n\n\t/**\n\t**\tExecuted when a frame needs to be rendered to the display buffer.\n\t*/\n\tonFrame: function(delta, timer)\n\t{\n\t\tvar now = this.now();\n\t\tvar tmp;\n\n\t\tif (delta > this.maxFrameInterval)\n\t\t\tdelta = this.maxFrameInterval;\n\n\t\tif (this.fixedFrameInterval != 0)\n\t\t\tdelta = this.fixedFrameInterval;\n\n\t\tif (!this.flags.renderingEnabled || this.flags.renderingPaused)\n\t\t{\n\t\t\tthis.frameDrawInProgress = true;\n\t\t\ttry {\n\t\t\t\tthis.draw (this.displayBuffer, this.displayBuffer2);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(\"DRAW ERROR: \\n\" + e + \"\\n\" + e.stack);\n\t\t\t}\t\n\t\t\tthis.frameDrawInProgress = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.perf.numFrames == 0)\n\t\t{\n\t\t\tthis.perf.startTime = now - this.frameInterval;\n\t\t\tthis.perf.lastTime = now;\n\t\t}\n\n\t\tdelta *= this.timeScale;\n\n\t\tthis.frameDeltaMillis = delta;\n\t\tthis.frameDelta = delta / 1000.0;\n\t\tthis.frameTimeMillis += this.frameDeltaMillis;\n\t\tthis.frameTime += this.frameDelta;\n\t\tthis.frameNumber++;\n\n\t\t/* ~ */\n\t\tthis.frameUpdateInProgress = true;\n\t\ttmp = hrnow();\n\t\ttry {\n\t\t\tthis.update (this.frameDelta, this.frameDeltaMillis);\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.error(\"UPDATE ERROR: \" + e + \"\\n\" + e.stack);\n\t\t\tSystem.stop();\n\t\t}\n\t\tthis.perf.updateTime += hrnow() - tmp;\n\t\tthis.frameUpdateInProgress = false;\n\n\t\t/* ~ */\n\t\tthis.frameDrawInProgress = true;\n\t\ttmp = hrnow();\n\t\ttry {\n\t\t\tthis.draw (this.displayBuffer, this.displayBuffer2);\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.error(\"DRAW ERROR: \\n\" + e + \"\\n\" + e.stack);\n\t\t\tSystem.stop();\n\t\t}\t\n\t\tthis.perf.drawTime += hrnow() - tmp;\n\t\tthis.frameDrawInProgress = false;\n\n\t\tthis.perf.lastTime = now;\n\t\tthis.perf.numFrames++;\n\t},\n\n\t/**\n\t**\tExecuted when the size of the window has changed. Will cause a full buffer rendering.\n\t*/\n\tonWindowResized: function(notRendering)\n\t{\n\t\tif ('document' in global)\n\t\t{\n\t\t\tif (this.options.fullscreen)\n\t\t\t{\n\t\t\t\tthis._screenWidth = int(global.screen.width);\n\t\t\t\tthis._screenHeight = int(global.screen.height);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._screenWidth = global.innerWidth;\n\t\t\t\tthis._screenHeight = global.innerHeight;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._screenWidth = this.options.targetScreenWidth;\n\t\t\tthis._screenHeight = this.options.targetScreenHeight;\n\t\t}\n\n\t\tthis.canvasScaleFactor = 1;\n\n\t\tif ((this._screenWidth < this._screenHeight && this.orientation == System.LANDSCAPE) || (this._screenWidth > this._screenHeight && this.orientation == System.PORTRAIT))\n\t\t{\n\t\t\tthis.screenWidth = this._screenHeight;\n\t\t\tthis.screenHeight = this._screenWidth;\n\n\t\t\tthis.reverseRender = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.screenWidth = this._screenWidth;\n\t\t\tthis.screenHeight = this._screenHeight;\n\n\t\t\tthis.reverseRender = false;\n\t\t}\n\n\t\tlet targetScreenWidth = this.options.targetScreenWidth;\n\t\tlet targetScreenHeight = this.options.targetScreenHeight;\n\n\t\tif (this.orientation == System.AUTOMATIC && targetScreenWidth && targetScreenHeight)\n\t\t{\n\t\t\tif ((targetScreenWidth > targetScreenHeight && this.screenWidth < this.screenHeight) || (targetScreenWidth < targetScreenHeight && this.screenWidth > this.screenHeight))\n\t\t\t{\n\t\t\t\ttargetScreenWidth = targetScreenHeight;\n\t\t\t\ttargetScreenHeight = this.options.targetScreenWidth;\n\t\t\t}\n\t\t}\n\n\t\tif (targetScreenWidth && targetScreenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = Math.min (this.screenWidth / targetScreenWidth, this.screenHeight / targetScreenHeight);\n\t\t}\n\t\telse if (targetScreenWidth)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenWidth / targetScreenWidth;\n\t\t}\n\t\telse if (targetScreenHeight)\n\t\t{\n\t\t\tthis.canvasScaleFactor = this.screenHeight / targetScreenHeight;\n\t\t}\n\n\t\tvar _screenWidth = this.screenWidth;\n\t\tvar _screenHeight = this.screenHeight;\n\n\t\tif (targetScreenWidth) this.screenWidth = targetScreenWidth;\n\t\tif (targetScreenHeight) this.screenHeight = targetScreenHeight;\n\n\t\tthis.offsX = int((_screenWidth - this.screenWidth*this.canvasScaleFactor)*0.5);\n\t\tthis.offsY = int((_screenHeight - this.screenHeight*this.canvasScaleFactor)*0.5);\n\n\t\tif (this.reverseRender)\n\t\t{\n\t\t\tvar tmp = this.offsX;\n\t\t\tthis.offsX = this.offsY;\n\t\t\tthis.offsY = tmp;\n\t\t}\n\n\t\tthis.scaleFactor = this.canvasScaleFactor * this.canvasPixelRatio;\n\t\tthis.scaleFactor = ~~(0.7 + this.scaleFactor);\n\n\t\tthis.flags.renderingEnabled = false;\n\n\t\tif ('document' in global)\n\t\t\tglobal.document.body.style.backgroundColor = this.displayBuffer.backgroundColor;\n\n\t\t\tif (!this.reverseRender)\n\t\t\t{\n\t\t\t\tthis.displayBuffer.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\t\tthis.displayBuffer.elem.style.width = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t\t\tthis.displayBuffer.elem.style.height = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\n\t\t\t\tthis.displayBuffer2.resize (this.screenWidth*this.scaleFactor, this.screenHeight*this.scaleFactor);\n\t\t\t\tthis.displayBuffer2.elem.style.width = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t\t\tthis.displayBuffer2.elem.style.height = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.displayBuffer.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\t\tthis.displayBuffer.elem.style.width = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t\t\tthis.displayBuffer.elem.style.height = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\n\t\t\t\tthis.displayBuffer2.resize (this.screenHeight*this.scaleFactor, this.screenWidth*this.scaleFactor);\n\t\t\t\tthis.displayBuffer2.elem.style.width = (this.screenHeight*this.canvasScaleFactor) + \"px\";\n\t\t\t\tthis.displayBuffer2.elem.style.height = (this.screenWidth*this.canvasScaleFactor) + \"px\";\n\t\t\t}\n\n\t\t\tthis.displayBuffer.elem.style.marginLeft = this.offsX + \"px\";\n\t\t\tthis.displayBuffer.elem.style.marginTop = this.offsY + \"px\";\n\n\t\t\tthis.displayBuffer2.elem.style.marginLeft = this.offsX + \"px\";\n\t\t\tthis.displayBuffer2.elem.style.marginTop = this.offsY + \"px\";\n\n\t\t\tthis.displayBuffer.loadIdentity();\n\t\t\tthis.displayBuffer2.loadIdentity();\n\n\t\t\tif (this.scaleFactor != 1) {\n\t\t\t\tthis.displayBuffer.globalScale(this.scaleFactor);\n\t\t\t\tthis.displayBuffer2.globalScale(this.scaleFactor);\n\t\t\t}\n\n\t\t\tif (this.reverseRender)\n\t\t\t{\n\t\t\t\tthis.displayBuffer.rotate(-Math.PI / 2);\n\t\t\t\tthis.displayBuffer.translate(0, -this.screenHeight);\n\t\t\t\tthis.displayBuffer.flipped(true);\n\n\t\t\t\tthis.displayBuffer2.rotate(-Math.PI / 2);\n\t\t\t\tthis.displayBuffer2.translate(0, -this.screenHeight);\n\t\t\t\tthis.displayBuffer2.flipped(true);\n\t\t\t}\n\n\t\tthis.scaleFactor *= this.options.extraScaleFactor;\n\n\t\tthis.integerScaleFactor = ~~(this.scaleFactor + 0.9);\n\t\tthis.resetPerf();\n\n\t\tthis.initialMatrix = this.displayBuffer.getMatrix();\n\n\t\tif (notRendering != true)\n\t\t{\n\t\t\tthis.flags.renderingEnabled = true;\n\t\t\tthis.onCanvasResized (this.screenWidth, this.screenHeight);\n\t\t}\n\t},\n\n\t/**\n\t**\tEvent triggered when the canvas was resized by the system.\n\t*/\n\tonCanvasResized: function (screenWidth, screenHeight)\n\t{\n\t},\n\n\t/**\n\t**\tResets the performance data.\n\t*/\n\tresetPerf: function()\n\t{\n\t\tthis.perf.numFrames = 0;\n\t},\n\n\t/**\n\t**\tAdds the specified object to the update queue. Must have method update (deltaTime: int).\n\t*/\n\tupdateQueueAdd: function (/*object*/obj)\n\t{\n\t\tthis.updateQueue.push (obj);\n\t\treturn this.updateQueue.bottom;\n\t},\n\n\t/**\n\t**\tRemoves the specified object from the update queue.\n\t*/\n\tupdateQueueRemove: function (/*object*/obj)\n\t{\n\t\tthis.updateQueue.remove (obj instanceof Linkable ? obj : this.updateQueue.sgetNode(obj));\n\t},\n\n\t/**\n\t**\tAdds the specified object to the draw queue. Must have method draw (canvas: Canvas).\n\t*/\n\tdrawQueueAdd: function (/*object*/obj)\n\t{\n\t\tthis.drawQueue.push (obj);\n\t\treturn this.drawQueue.bottom;\n\t},\n\n\t/**\n\t**\tRemoves the specified object from the draw queue.\n\t*/\n\tdrawQueueRemove: function (/*object*/obj)\n\t{\n\t\tthis.drawQueue.remove (obj instanceof Linkable ? obj : this.drawQueue.sgetNode(obj));\n\t},\n\n\t/**\n\t**\tAdds the specified object to the update and draw queues. Must have both update (deltaTime: int) and draw (canvas: Canvas) methods. Returns `obj`.\n\t*/\n\tqueueAdd: function (/*object*/obj)\n\t{\n\t\tthis.updateQueue.push (obj);\n\t\tthis.drawQueue.push (obj);\n\t\treturn obj;\n\t},\n\n\t/**\n\t**\tRemoves the specified object from the update and draw queues.\n\t*/\n\tqueueRemove: function (/*object*/obj)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(obj));\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(obj));\n\t},\n\n\t/**\n\t**\tRuns an update cycle, all objects in the updateQueue will be updated.\n\t*/\n\tupdate: function (dts, dtm)\n\t{\n\t\tvar next;\n\n\t\tfor (var elem = this.updateQueue.top; elem; elem = next)\n\t\t{\n\t\t\tnext = elem.next;\n\t\t\telem.value.update(dts, dtm);\n\t\t}\n\t},\n\n\t/**\n\t**\tRuns a rendering cycle, all objects in the drawQueue will be drawn.\n\t*/\n\tdraw: function (canvas, canvas2)\n\t{\n\t\tvar next;\n\n\t\tfor (var elem = this.drawQueue.top; elem; elem = next)\n\t\t{\n\t\t\tnext = elem.next;\n\t\t\telem.value.draw(canvas, canvas2);\n\t\t}\n\t},\n\n\t/**\n\t**\tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` and `easing` function.\n\t*/\n\tinterpolate: function (src, dst, duration, easing, callback/* function(data, isFinished) */)\n\t{\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet interpolator =\n\t\t{\n\t\t\tupdate: function(dt)\n\t\t\t{\n\t\t\t\tfor (let x in time)\n\t\t\t\t{\n\t\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\ttime[x] += dt;\n\t\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t\t{\n\t\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\t\tcount--;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t\t}\n\n\t\t\t\tcallback (data, count == 0);\n\n\t\t\t\tif (count == 0)\n\t\t\t\t\tSystem.updateQueueRemove(interpolator);\n\t\t\t}\n\t\t};\n\n\t\tSystem.updateQueueAdd(interpolator);\n\t\tinterpolator.update(0);\n\t},\n\n\t/**\n\t**\tEvent triggered when a keyboard event is detected by the system, `action` is one of the EVT_KEY_* constants,\n\t**\t`keyCode` is one of the `KeyCodes` constants and `keyState` a reference to `System.keyState`.\n\t*/\n\tonKeyboardEvent: function (action, keyCode, keyState)\n\t{\n\t},\n\n\t/**\n\t**\tEvent triggered when a pointer event is detected by the system, `action` is one of the EVT_POINTER_* constants,\n\t**\t`pointer` contains the pointer state, and `pointers` a reference to `System.pointerState`.\n\t*/\n\tonPointerEvent: function (action, pointer, pointers)\n\t{\n\t}\n};\n","/*\n**\t@rsthn/cherry/log\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst System = require('./system');\n\n/**\n**\tLogging module to show logs on the system display buffer.\n*/\n\nconst Log = module.exports =\n{\n\tenabled: false,\n\n\tdata: [ ],\n\tcount: 0,\n\tmaxsize: 30,\n\tdebugEcho: false,\n\n\tcolor: '#fff',\n\tbackground: '#000',\n\n\t/**\n\t**\tWrites a message to the log buffer, ensure logging has been enabled by calling enable() or any messages will be ignored.\n\t*/\n\twrite: function (msg)\n\t{\n\t\tif (!this.enabled) return;\n\n\t\tthis.data.push(msg);\n\t\tthis.count++;\n\n\t\twhile (this.data.length > this.maxsize)\n\t\t\tthis.data.shift();\n\n\t\tif (this.debugEcho)\n\t\t\tconsole.debug(this.count + \": \" + msg);\n\t},\n\n\t/**\n\t**\tClears the current log buffer.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.data = [];\n\t\tthis.count = 0;\n\t},\n\n\t/**\n\t**\tEnables on-screen logging, must be called first before any call to write() or logging messages will be ignored.\n\t*/\n\tenable: function (x, y, fontSize, showFps, showIndex)\n\t{\n\t\tif (this.enabled) return;\n\t\tthis.enabled = true;\n\n\t\tif (!x) x = 0;\n\t\tif (!y) y = 0;\n\n\t\tif (!fontSize) fontSize = 8.5;\n\n\t\tif (showFps === false) y -= 16;\n\n\t\tSystem.drawQueueAdd ({ draw: function (tmp, g)\n\t\t{\n\t\t\tg.clear();\n\n\t\t\tg.font(\"normal \"+fontSize+\"pt 'Bitstream Vera Sans Mono', monospace\");\n\t\t\tg.textBaseline('top');\n\n\t\t\tvar _time = ((System.perf.lastTime - System.perf.startTime) / 1000);\n\t\t\tvar _frames = System.perf.numFrames;\n\t\t\tvar s = '';\n\n\t\t\tif (showFps !== false)\n\t\t\t{\n\t\t\t\ts = 'FPS: '+(_frames/_time).toFixed(2) + ', update: ' + (System.perf.updateTime/_frames).toFixed(2) + ', draw: ' + (System.perf.drawTime/_frames).toFixed(2);\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x+8 - 3, y+10-1, g.measureText(s) + 6, fontSize+4);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x+8, y+10);\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < Log.data.length; i++)\n\t\t\t{\n\t\t\t\ts = (showIndex !== false ? \"#\" + (Log.count-Log.data.length+i+1) + \": \" : \"> \") + Log.data[i];\n\n\t\t\t\tif (Log.background) {\n\t\t\t\t\tg.fillStyle(Log.background);\n\t\t\t\t\tg.fillRect (x+8 - 3, y+16 + (fontSize+4)*(i+1) - 1, g.measureText(s) + 6, fontSize+4);\n\t\t\t\t}\n\n\t\t\t\tg.fillStyle(Log.color);\n\t\t\t\tg.fillText(s, x+8, y+16 + (fontSize+4)*(i+1));\n\t\t\t}\n\t\t}});\n\t}\n};\n","/*\n**\t@rsthn/cherry/wrappers/drawable\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\n\nmodule.exports = Class.extend\n({\n\tclassName: \"Drawable\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"image\")\n\t\t\tthrow new Error (\"Resource is not an image.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.width = this.r.width;\n\t\tthis.height = this.r.height;\n\t},\n\n\tdraw: function (g, x, y, width, height)\n\t{\n\t\tif (width == null)\n\t\t\tg.drawImageResource (this.r, x, y);\n\t\telse\n\t\t\tg.drawImageResource (this.r, x, y, width, height);\n\t},\n\n\tgetDrawable: function ()\n\t{\n\t\treturn this;\n\t}\n});\n","/*\n**\t@rsthn/cherry/wrappers/drawable\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\n\nmodule.exports = Class.extend\n({\n\tclassName: \"DrawableRect\",\n\n\twidth: null,\n\theight: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"object\")\n\t\t\tthrow new Error (\"Resource is not an object.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.width = this.r.width;\n\t\tthis.height = this.r.height;\n\t},\n\n\tdraw: function (g, x, y)\n\t{\n\t\tg.fillStyle (this.r.color);\n\t\tg.fillRect (x, y, this.width, this.height);\n\t},\n\n\tgetDrawable: function ()\n\t{\n\t\treturn this;\n\t}\n});\n","/*\n**\t@rsthn/cherry/wrappers/spritesheet\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Canvas = require('../canvas');\n\n/*\n\tIf source is \"image\":\n\t\tconfig: {\n\t\t\tsheetWidth: int, frameWidth: int, frameHeight: int?, numFrames: int?\n\t\t\t--OR--\n\t\t\tnumFrames: int, frameWidth: int, frameHeight: int?\n\t\t}\n\n\tIf source is \"images\":\n\t\tconfig: {\n\t\t\tframeWidth: int, frameHeight: int\n\t\t}\n\t\t\n\tNOTE: The sheetWidth, frameWidth and frameHeight should reflect the real image size. The system will automatically scale it if the source image is smaller/bigger.\n*/\n\nmodule.exports = Class.extend\n({\n\tclassName: \"SpriteSheet\",\n\n\twidth: 0, height: 0,\n\n\tnumCols: 0, numFrames: 0,\n\n\tdrawableCache: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif ((r.type != \"image\" && r.type != \"images\"))\n\t\t\tthrow new Error (\"Resource is not a sprite sheet.\");\n\n\t\tvar r_scale, v_scale;\n\n\t\tif (r.type == \"image\")\n\t\t{\n\t\t\tif (!r.config.sheetWidth && (!r.config.numFrames || !r.config.frameWidth))\n\t\t\t\tthrow new Error (\"Required sheetWidth or numFrames+frameWidth\");\n\n\t\t\tif (!r.config.sheetWidth)\n\t\t\t\tr.config.sheetWidth = r.config.numFrames * r.config.frameWidth;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data.height;\n\n\t\t\tr_scale = r.data.width / r.config.sheetWidth;\n\t\t\tv_scale = r.width / r.config.sheetWidth;\n\t\t}\n\t\telse // r.type == \"images\"\n\t\t{\n\t\t\tif (!r.config) r.config = { };\n\n\t\t\tif (!r.config.frameWidth)\n\t\t\t\tr.config.frameWidth = r.data[0].width;\n\n\t\t\tif (!r.config.frameHeight)\n\t\t\t\tr.config.frameHeight = r.data[0].height;\n\n\t\t\tr_scale = r.data[0].data.width / r.config.frameWidth;\n\t\t\tv_scale = r.data[0].width / r.config.frameWidth;\n\t\t}\n\n\t\tvar _width = r.config.frameWidth;\n\t\tvar _height = r.config.frameHeight;\n\n\t\tthis.r_frameWidth = (_width * r_scale);\n\t\tthis.r_frameHeight = (_height * r_scale);\n\n\t\tthis.width = (_width * v_scale);\n\t\tthis.height = (_height * v_scale);\n\n\t\tif (r.type == \"image\")\n\t\t{\n\t\t\tthis.numCols = ~~(r.data.width / this.r_frameWidth);\n\t\t\tthis.numRows = Math.ceil(r.data.height / this.r_frameHeight);\n\n\t\t\tthis.numFrames = r.config.numFrames || (this.numCols * this.numRows);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.numCols = this.numRows = 0;\n\t\t\tthis.numFrames = r.data.length;\n\t\t}\n\n\t\tthis.drawableCache = { };\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\t},\n\n\tdrawFrame: function (g, x, y, frame, width, height)\n\t{\n\t\tif (frame < 0 || frame >= this.numFrames)\n\t\t\treturn;\n\n\t\tif (!width) width = this.width;\n\t\tif (!height) height = this.height;\n\n\t\tif (this.numCols != 0)\n\t\t{\n\t\t\tvar j = ~~(frame / this.numCols) * this.r_frameHeight;\n\t\t\tvar i =  (frame % this.numCols) * this.r_frameWidth;\n\n\t\t\tg.drawImage (this.r.data, i, j, this.r_frameWidth, this.r_frameHeight, x, y, width, height);\n\t\t}\n\t\telse\n\t\t\tg.drawImage (this.r.data[frame].data, 0, 0, this.r_frameWidth, this.r_frameHeight, x, y, width, height);\n\t},\n\n\tgetDrawable: function (frameIndex)\n\t// OR getDrawable: function (x, y)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tframeIndex = arguments[1]*this.numCols + arguments[0];\n\n\t\tif (!this.drawableCache[frameIndex])\n\t\t{\n\t\t\tthis.drawableCache[frameIndex] =\n\t\t\t{\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height,\n\n\t\t\t\tframeIndex: frameIndex,\n\t\t\t\tr: this,\n\n\t\t\t\tdraw: function (g, x, y, width, height)\n\t\t\t\t{\n\t\t\t\t\tg.drawFrame (this.r, x, y, this.frameIndex, width, height);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.drawableCache[frameIndex];\n\t}\n});\n\nCanvas.prototype.drawFrame = function (r, x, y, frameIndex, width, height)\n{\n\tr.drawFrame (this, x, y, frameIndex, width, height);\n};\n","/*\n**\t@rsthn/cherry/wrappers/spritesheet-animation\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst SpriteSheet = require('./spritesheet');\nconst System = require('../system');\n\n/*\n\tanim: {\n\t\tdef: string, fps: int?,\n\n\t\tseq: {\n\t\t\tseq1: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: [ [int, int, ...], ... ] },\n\t\t\tseq2: { loop: bool?, group: \"0,12\" },\n\t\t\tseq2: { loop: bool?, group: \"4\" },\n\t\t},\n\n\t\ttrans: {\n\t\t\tseq1: {\n\t\t\t\tseq2: [ seq_name, seq_name, ... ]\n\t\t\t}\n\t\t}\n\t}\n\n\tNOTE: When specifying a group such as \"0,12\" it means to draw tiles 0 and the 12 in that single frame.\n*/\n\nconst Animation = Class.extend\n({\n\tseq: null, seq_i: 0,\n\ttrans: null, trans_i: 0, trans_t: null,\n\n\tqueue: null,\n\n\tfps: 0, frameMillis: 0, time: 0,\n\n\tframeNumber: -1,\n\n\tfinished: false,\n\tpaused: false,\n\n\twidth: null,\n\theight: null,\n\n\tonFinishedCallback: null,\n\tonFinishedArg: null,\n\n\tonFrameCallback: null,\n\tonFrameArg: null,\n\n\t__ctor: function (anim, seq, fps)\n\t{\n\t\tthis.anim = anim;\n\t\tthis.queue = [ ];\n\n\t\tthis.seq = seq;\n\t\tthis.trans = null;\n\n\t\tthis.width = anim.width;\n\t\tthis.height = anim.height;\n\n\t\tthis.fps = fps;\n\n\t\tthis.setFps (this.seq.fps || this.fps);\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tsetFps: function (fps)\n\t{\n\t\tthis.frameMillis = ~~(1000 / fps);\n\t\tthis.time = 0;\n\n\t\treturn this;\n\t},\n\n\tsetPaused: function (value)\n\t{\n\t\tthis.paused = value;\n\t\treturn this;\n\t},\n\n\tsetInitialDelay: function (dt)\n\t{\n\t\tthis.time = -dt*1000.0;\n\t\treturn this;\n\t},\n\n\tonFinished: function (fn, arg)\n\t{\n\t\tthis.onFinishedCallback = fn;\n\t\tthis.onFinishedArg = arg;\n\t\treturn this;\n\t},\n\n\tonFrame: function (fn, arg)\n\t{\n\t\tthis.onFrameCallback = fn;\n\t\tthis.onFrameArg = arg;\n\t\treturn this;\n\t},\n\n\tsetFrame: function (i)\n\t{\n\t\tthis.seq_i = i % this.seq.group.length;\n\t\treturn this;\n\t},\n\n\tgetFrame: function (normalized)\n\t{\n\t\treturn normalized === true ? (this.seq_i / (this.seq.group.length-1)) : this.seq_i;\n\t},\n\n\tgetLength: function ()\n\t{\n\t\treturn this.seq.group.length;\n\t},\n\n\tdraw: function (g, x, y)\n\t{\n\t\tif (this.time < 0)\n\t\t{\n\t\t\tif (!this.paused)\n\t\t\t{\n\t\t\t\tthis.time += this.frameNumber == System.frameNumber ? 0 : System.frameDeltaMillis;\n\t\t\t\tthis.frameNumber = System.frameNumber;\n\t\t\t}\n\n\t\t\tif (this.time > 0) this.time = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.seq_i == this.seq.group.length)\n\t\t{\n\t\t\tvar t = this.seq.group[this.seq_i-1];\n\n\t\t\tif (g != null)\n\t\t\t{\n\t\t\t\tfor (var i = 0; i < t.length; i++)\n\t\t\t\t\tg.drawFrame (this.anim, x, y, t[i]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar t = this.seq.group[this.seq_i];\n\n\t\tif (g != null)\n\t\t{\n\t\t\tfor (var i = 0; i < t.length; i++)\n\t\t\t\tg.drawFrame (this.anim, x, y, t[i]);\n\t\t}\n\n\t\tif (!this.paused)\n\t\t{\n\t\t\tthis.time += this.frameNumber == System.frameNumber ? 0 : System.frameDeltaMillis;\n\t\t\tthis.frameNumber = System.frameNumber;\n\t\t}\n\n\t\tif (this.time >= this.frameMillis)\n\t\t{\n\t\t\tconst frameIndex = this.seq_i;\n\n\t\t\tthis.time -= this.frameMillis;\n\t\t\tthis.seq_i++;\n\n\t\t\tif (this.seq_i == this.seq.group.length)\n\t\t\t{\n\t\t\t\tif (this.trans != null)\n\t\t\t\t{\n\t\t\t\t\tif (++this.trans_i == this.trans.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.trans = null;\n\t\t\t\t\t\tthis.seq = this.trans_t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.seq = this.trans[this.trans_i];\n\n\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\tthis.time = 0;\n\n\t\t\t\t\tthis.finished = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.seq.loop)\n\t\t\t\t\t\tthis.seq_i = 0;\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.finished = true;\n\n\t\t\t\t\t\tif (this.onFinishedCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.onFinishedCallback(this.onFinishedArg);\n\t\t\t\t\t\t\tthis.onFinishedCallback = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t\tthis.use(this.queue.shift(), true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.onFrameCallback)\n\t\t\t{\n\t\t\t\tif (this.onFrameCallback(frameIndex, this.seq.group.length-1, this.onFrameArg) === false)\n\t\t\t\t\tthis.onFrameCallback = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tadvance: function ()\n\t{\n\t\tthis.setPaused (false);\n\t\tthis.draw (null, 0, 0);\n\t},\n\n\tuse: function (seqName, force)\n\t{\n\t\tvar seq = this.trans == null ? this.seq : this.trans_t;\n\n\t\tif (seq.name == seqName && force !== true)\n\t\t\treturn this;\n\n\t\tif (seq.trans && seq.trans[seqName])\n\t\t{\n\t\t\tthis.trans_t = this.anim.a.seq[seqName];\n\n\t\t\tthis.trans = seq.trans[seqName];\n\t\t\tthis.trans_i = 0;\n\n\t\t\tthis.seq = this.trans[this.trans_i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.seq = this.anim.a.seq[seqName];\n\t\t\tthis.setFps (this.seq.fps || this.fps);\n\t\t}\n\n\t\tthis.seq_i = 0;\n\t\tthis.time = 0;\n\n\t\tthis.finished = false;\n\t\treturn this;\n\t},\n\n\tsetQueue: function (list)\n\t{\n\t\tthis.queue = list;\n\t\tthis.use(this.queue.shift(), true);\n\t},\n\n\tenqueue: function (seqName, force)\n\t{\n\t\tvar seq = this.trans == null ? this.seq : this.trans_t;\n\n\t\tif (seq.name == seqName && seq.loop)\n\t\t\treturn this;\n\n\t\tif (force !== true && this.queue.length > 0 && this.queue[this.queue.length-1] == seqName)\n\t\t\treturn this;\n\n\t\tif (seq.loop || this.finished)\n\t\t{\n\t\t\tthis.use(seqName, true);\n\t\t\treturn this;\n\t\t}\n\n\t\tthis.queue.push(seqName);\n\t\treturn this;\n\t}\n});\n\n\n\nconst SpriteSheetAnimation = module.exports = SpriteSheet.extend\n({\n\tclassName: \"SpriteSheetAnimation\",\n\n\t__ctor: function (r)\n\t{\n\t\tif (!r.anim) throw new Error (\"Animation descriptors not found.\");\n\n\t\tthis._super.SpriteSheet.__ctor (r);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tvar t = this.a = this.r.anim;\n\n\t\tif (t.initialized) return;\n\n\t\tif (!t.def) t.def = \"def\";\n\n\t\tif (!t.seq) t.seq = { };\n\n\t\tif (!t.seq[t.def] && (t.def == \"def\" || t.def == \"defloop\"))\n\t\t{\n\t\t\tvar p = { loop: (t.def == \"def\" ? false : true), group: [ ] };\n\n\t\t\tfor (var i = 0; i < this.numFrames; i++)\n\t\t\t{\n\t\t\t\tp.group.push([i]);\n\t\t\t}\n\n\t\t\tt.seq[t.def] = p;\n\t\t}\n\n\t\tif (!t.seq[t.def])\n\t\t\tthrow new Error (\"Undefined default sequence: \" + t.def);\n\n\t\tif (!t.fps) t.fps = 25;\n\n\t\tt.def = t.seq[t.def];\n\n\t\tvar frameIndex = 0;\n\n\t\tfor (var i in t.seq)\n\t\t{\n\t\t\tt.seq[i].name = i;\n\n\t\t\tif (!t.seq[i].loop)\n\t\t\t\tt.seq[i].loop = false;\n\n\t\t\tif (typeof(t.seq[i].group) == \"string\")\n\t\t\t{\n\t\t\t\tvar a, b, c;\n\n\t\t\t\tif (t.seq[i].group.indexOf(\" \") != -1)\n\t\t\t\t{\n\t\t\t\t\ta = t.seq[i].group.split(\" \");\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (var j in a)\n\t\t\t\t\t\tt.seq[i].group.push([int(a[j])]);\n\t\t\t\t}\n\t\t\t\telse if (t.seq[i].group.indexOf(\",\") != -1)\n\t\t\t\t{\n\t\t\t\t\tc = t.seq[i].group.split(\",\");\n\t\t\t\t\t\n\t\t\t\t\ta = int(c[0]);\n\t\t\t\t\tb = int(c[1]);\n\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\tfor (c = a; c <= b; c++)\n\t\t\t\t\t\tt.seq[i].group.push([c]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta = int(t.seq[i].group);\n\t\t\t\t\tt.seq[i].group = [ ];\n\n\t\t\t\t\twhile (a--) t.seq[i].group.push([frameIndex++]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (t.trans)\n\t\t{\n\t\t\tfor (var i in t.trans)\n\t\t\t{\n\t\t\t\tt.seq[i].trans = t.trans[i];\n\n\t\t\t\tfor (var j in t.trans[i])\n\t\t\t\t{\n\t\t\t\t\tfor (var k = 0; k < t.trans[i][j].length; k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar n = t.trans[i][j][k];\n\n\t\t\t\t\t\tif (!t.seq[n]) throw new Error (\"Undefined sequence: \" + n);\n\t\t\t\t\t\tt.trans[i][j][k] = t.seq[n];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tt.initialized = true;\n\t},\n\n\tgetDrawable: function (initialseq, fps)\n\t{\n\t\treturn new Animation (this, initialseq ? this.a.seq[initialseq] : this.a.def, fps || this.a.fps);\n\t},\n\n\tgetSequence: function (initialseq)\n\t{\n\t\treturn initialseq ? this.a.seq[initialseq] : this.a.def;\n\t}\n});\n","/*\n**\t@rsthn/cherry/wrappers/spritefont\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Canvas = require('../canvas');\n\n/*\n\tfont: {\n\t\tsheetWidth: int, sheetHeight: int, charWidth: int, charHeight: int, charset: string, widths: [char, width, ...]\n\t}\n*/\n\nmodule.exports = Class.extend\n({\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"image\" || !r.font)\n\t\t\tthrow new Error (\"Resource is not a sprite font.\");\n\n\t\tvar r_scale = r.data.width / r.font.sheetWidth;\n\t\tvar v_scale = r.width / r.font.sheetWidth;\n\n\t\tthis.r_charWidth = (r.font.charWidth * r_scale);\n\t\tthis.r_charHeight = (r.font.charHeight * r_scale);\n\n\t\tthis.charWidth = (r.font.charWidth * v_scale);\n\t\tthis.charHeight = (r.font.charHeight * v_scale);\n\n\t\tvar cols = ~~(r.font.sheetWidth / r.font.charWidth);\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tvar n = r.font.charset.length;\n\t\tvar k = 0;\n\t\tvar y = 0;\n\n\t\tthis.charTable = { };\n\n\t\tthis.charTable[\" \"] = { charWidth: this.charWidth >> 1, r_charWidth: this.r_charWidth };\n\n\t\twhile (k < n)\n\t\t{\n\t\t\tvar x = 0;\n\n\t\t\tfor (var i = 0; i < cols && k < n; i++)\n\t\t\t{\n\t\t\t\tvar c = r.font.charset[k++];\n\n\t\t\t\tthis.charTable[c] = { x: x, y: y, charWidth: this.charWidth, r_charWidth: this.r_charWidth };\n\n\t\t\t\tx += this.r_charWidth;\n\t\t\t}\n\n\t\t\ty += this.r_charHeight;\n\t\t}\n\n\t\tif (!r.font.widths) return;\n\n\t\tvar n = r.font.widths.length;\n\n\t\tfor (var i = 0; i < n; i += 2)\n\t\t{\n\t\t\tvar w1 = (r.font.widths[i] * v_scale);\n\t\t\tvar w2 = (r.font.widths[i] * r_scale);\n\n\t\t\tvar s = r.font.widths[i+1];\n\n\t\t\tfor (var j = 0; j < s.length; j++)\n\t\t\t{\n\t\t\t\tthis.charTable[s[j]].charWidth = w1;\n\t\t\t\tthis.charTable[s[j]].r_charWidth = w2;\n\t\t\t}\n\t\t}\n\t},\n\n\tdraw: function (g, x, y, text)\n\t{\n\t\tvar n = text.length;\n\n\t\tfor (var i = 0; i < n; i++)\n\t\t{\n\t\t\tif (text[i] == \" \")\n\t\t\t{\n\t\t\t\tx += this.charTable[text[i]].charWidth;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tg.drawImage (this.r.data, c.x, c.y, c.r_charWidth, this.r_charHeight, x, y, c.charWidth, this.charHeight);\n\n\t\t\tx += c.charWidth;\n\t\t}\n\t},\n\n\tmeasureWidth: function (text)\n\t{\n\t\tvar n = text.length;\n\t\tvar x = 0;\n\n\t\tfor (var i = 0; i < n; i++)\n\t\t{\n\t\t\tvar c = this.charTable[text[i]];\n\t\t\tif (!c) continue;\n\n\t\t\tx += c.charWidth;\n\t\t}\n\n\t\treturn x;\n\t},\n\n\tmeasureHeight: function (text)\n\t{\n\t\treturn this.charHeight;\n\t}\n});\n\n\nCanvas.prototype.drawText = function (r, x, y, text)\n{\n\tr.draw (this, x, y, text.toString());\n};\n\nCanvas.prototype.drawTextAligned = function (r, x, y, w, h, ax, ay, text)\n{\n\ttext = text.toString();\n\n\tif (ax == 0) // Align-Center\n\t\tx = x + ((w - r.measureWidth(text)) >> 1);\n\telse if (ax < 0) // Align-Left\n\t\tx = x - ax - 1;\n\telse if (ax > 0) // Align-Right\n\t\tx = x + w - ax + 1 - r.measureWidth(text);\n\n\tif (ay == 0) // Align-Center\n\t\ty = y + ((h - r.measureHeight(text)) >> 1);\n\telse if (ay < 0) // Align-Top\n\t\ty = y - ay - 1;\n\telse if (ay > 0) // Align-Bottom\n\t\ty = y + h - ay + 1 - r.measureHeight(text);\n\n\tr.draw (this, x, y, text);\n};\n\nCanvas.prototype.drawTextAligned2 = function (r, bounds, ax, ay, text)\n{\n\tthis.drawTextAligned (r, bounds.x1, bounds.y1, bounds.width(), bounds.height(), ax, ay, text);\n};\n","/*\n**\t@rsthn/cherry/wrappers/sound\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Rin, Class } = require('@rsthn/rin');\n\n/*\n\ttrack: string (music|sfx)\n*/\n\nconst Sound = module.exports = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audio\")\n\t\t\tthrow new Error (\"Resource is not audio.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this, callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this, callback, volume);\n\t}\n});\n\nSound.ENGINE_HTML5 = 1;\nSound.ENGINE_WEBAUDIO = 2;\nSound.ENGINE_NATIVEAUDIO = 3;\n\nRin.override(Sound,\n{\n\tMASTER: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tSFX: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMUSIC: {\n\t\tenabled: true,\n\t\tvolume: 0.8\n\t},\n\n\tVOICE: {\n\t\tenabled: true,\n\t\tvolume: 1\n\t},\n\n\tMAX_POOL_SIZE: 100,\n\n\tpool: [ ],\n\tactive: [ ],\n\n\tregister: function (node)\n\t{\n\t\tif (node.registered) return;\n\n\t\tnode.registered = true;\n\t\tthis.active.push(node);\n\t},\n\n\tunregister: function (node)\n\t{\n\t\tif (!node.registered) return;\n\n\t\tnode.registered = false;\n\n\t\tvar i = Sound.active.indexOf(node);\n\t\tif (i == -1) return;\n\n\t\tSound.active.splice(i, 1);\n\t},\n\n\tupdateNode: function (node, cmd)\n\t{\n\t\tswitch (node.snd.r.engine)\n\t\t{\n\t\t\tcase Sound.ENGINE_WEBAUDIO:\n\t\t\t\treturn this.updateNode_webaudio(node, cmd);\n\n\t\t\tcase Sound.ENGINE_NATIVEAUDIO:\n\t\t\t\treturn this.updateNode_nativeaudio(node, cmd);\n\t\t}\n\n\t\treturn this.updateNode_audio(node, cmd);\n\t},\n\n\t// Web Audio.\n\talloc_webaudio: function (node)\n\t{\n\t\tnode.gainNode = audioContext.createGain();\n\t\tnode.gainNode.gain.value = 0;\n\t\tnode.gainNode.connect(audioContext.destination);\n\n\t\tnode.res = audioContext.createBufferSource();\n\t\tnode.res.buffer = node.snd.r.data;\n\t\tnode.res.loop = false;\n\t\tnode.res.connect(node.gainNode);\n\t\tnode.res.node = node;\n\t},\n\n\tfree_webaudio: function (node)\n\t{\n\t\tif (!node.res) return;\n\n\t\tnode.gainNode.disconnect();\n\n\t\tnode.res = null;\n\t\tnode.gainNode = null;\n\t},\n\n\t// Native Audio (Cordova plugin).\n\talloc_nativeaudio: function (node)\n\t{\n\t\tnode.res = true;\n\t},\n\n\tfree_nativeaudio: function (node)\n\t{\n\t\tnode.res = false;\n\t},\n\n\t// HTML5 Audio.\n\talloc_audio: function (node)\n\t{\n\t\tif (!this.pool.length)\n\t\t\titem = node.cloneNode();\n\t\telse\n\t\t\titem = this.pool.pop();\n\n\t\titem._src = node.src;\n\t\treturn item;\n\t},\n\n\tfree_audio: function (node)\n\t{\n\t\tif (this.pool.length == this.MAX_POOL_SIZE)\n\t\t\treturn;\n\n\t\t//BUG: This causes a GET request of \"/null\" on Chromium.\n\t\t//node.src = null;\n\n\t\tthis.pool.push(node);\n\t},\n\n\t/* *********************** */\n\tupdateNode_webaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_webaudio(node);\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_webaudio;\n\t\t\t\tnode.gainNode.gain.value = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.start(0, node.startTime/1000.0);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_webaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.gainNode.gain.value = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_webaudio(node);\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\t\t\t\tnode.res.onended = null;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tnode.res.stop();\n\n\t\t\t\tSound.free_webaudio(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.loop = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_webaudio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tSound.free_webaudio(node);\n\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_webaudio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_webaudio (node, 'stop');\n\t},\n\n\t/* *********************** */\n\tupdateNode_nativeaudio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t\tSound.alloc_nativeaudio(node);\n\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\ttry {\n\t\t\t\t\tglobal.plugins.NativeAudio.play (node.snd.r.data, null, null, function() { Sound.onended_nativeaudio(node); } );\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_nativeaudio(node);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister(node);\n\t\t\t\tglobal.plugins.NativeAudio.stop (node.snd.r.data, null);\n\n\t\t\t\tSound.free_nativeaudio(node);\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\t// Unsupported.\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_nativeaudio: function (node)\n\t{\n\t\tSound.updateNode_nativeaudio (node, 'stop');\n\t},\n\n\tupdateNode_audio: function (node, cmd)\n\t{\n\t\tif (!node) return null;\n\n\t\tvar volume = Sound.MASTER.volume * node.snd.track.volume * node.volume;\n\n\t\tswitch (cmd)\n\t\t{\n\t\t\t/* **************** */\n\t\t\tcase 'play':\n\t\t\t\tif (node.playing) break;\n\n\t\t\t\tif (!node.res)\n\t\t\t\t{\n\t\t\t\t\tnode.res = Sound.alloc_audio (node.snd.r.data);\n\t\t\t\t\tnode.res.node = node;\n\t\t\t\t\tnode.res.src = node.res._src;\n\t\t\t\t}\n\n\t\t\t\tnode.playTime = hrnow();\n\t\t\t\tnode.playing = true;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tnode.res.onended = Sound.onended_audio;\n\t\t\t\tnode.res.currentTime = node.startTime/1000.0;\n\t\t\t\tnode.res.volume = volume;\n\n\t\t\t\ttry {\n\t\t\t\t\tnode.res.play();\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tSound.register(node);\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'setvolume':\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.res.volume = volume;\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'stop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\n\t\t\t\t\tSound.free_audio (node.res);\n\t\t\t\t\tnode.res = null;\n\t\n\t\t\t\t\tif (node.callback) node.callback();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.res) break;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\n\t\t\t\tSound.free_audio (node.res);\n\t\t\t\tnode.res = null;\n\n\t\t\t\tif (node.callback) node.callback();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'pause':\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime += hrnow() - node.playTime;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = true;\n\n\t\t\t\tSound.unregister (node);\n\t\t\t\tnode.res.pause();\n\t\t\t\tbreak;\n\n\t\t\t/* **************** */\n\t\t\tcase 'softstop':\n\t\t\t\tif (!node.playing && node.paused)\n\t\t\t\t{\n\t\t\t\t\tnode.startTime = 0;\n\t\t\t\t\tnode.paused = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!node.playing || !node.res)\n\t\t\t\t\tbreak;\n\n\t\t\t\tnode.startTime = 0;\n\t\t\t\tnode.playing = false;\n\t\t\t\tnode.pause = false;\n\t\t\t\tbreak;\t\n\t\t}\n\n\t\treturn node;\n\t},\n\n\tonended_audio: function (e)\n\t{\n\t\tvar node = e.currentTarget.node;\n\n\t\tif (node.playing && node.loop != 0)\n\t\t{\n\t\t\tif (node.loop != -1)\n\t\t\t\tnode.loop--;\n\n\t\t\tnode.startTime = 0;\n\t\t\tnode.playing = false;\n\t\t\tnode.pause = false;\n\n\t\t\tSound.updateNode_audio (node, 'play');\n\t\t\treturn;\n\t\t}\n\n\t\tnode.res.onended = null;\n\t\tnode.res.volume = 0;\n\n\t\tSound.updateNode_audio (node, 'stop');\n\t},\n\n\t/* *************************************** */\n\t/* PUBLIC */\n\n\tenableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = true;\n\t},\n\n\tdisableTrack: function (track)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.enabled = false;\n\t},\n\n\tsetVolume: function (track, value)\n\t{\n\t\tif (!track) return;\n\n\t\ttrack.volume = value;\n\t},\n\n\tcreateNode: function (snd, volume)\n\t{\n\t\tvar node = { };\n\n\t\tnode.startVolume = volume;\n\t\tnode.volume = volume;\n\t\tnode.snd = snd;\n\t\tnode.loop = 0;\n\t\tnode.playing = false;\n\t\tnode.paused = false;\n\t\tnode.startTime = 0;\n\t\tnode.playTime = 0;\n\t\tnode.callback = null;\n\t\tnode.timer = null;\n\t\tnode.res = null;\n\n\t\treturn node;\n\t},\n\n\tplay: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvar volume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tplayLoop: function (snd, completeCallback, volume)\n\t{\n\t\tif (!this.MASTER.enabled || !snd || !snd.track.enabled)\n\t\t\treturn null;\n\n\t\tvolume = (volume !== undefined && volume !== null) ? volume : 1.0;\n\t\n\t\tvar node = this.createNode(snd, volume);\n\t\tnode.callback = completeCallback;\n\t\tnode.loop = -1;\n\n\t\treturn this.updateNode(node, 'play');\n\t},\n\n\tstop: function (node, callback)\n\t{\n\t\tif (!node) return null;\n\n\t\tif (callback && callback !== true) node.callback = callback;\n\t\treturn this.updateNode(node, callback === true ? 'stop' : 'softstop');\n\t},\n\n\tpause: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode(node, 'pause');\n\t},\n\n\tresume: function (node)\n\t{\n\t\tif (!node) return null;\n\n\t\treturn this.updateNode (node, 'play');\n\t},\n\n\tfadeOut: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (!node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\t\tnode.startVolume = node.volume;\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*(1-t);\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback === true)\n\t\t\t\t\tSound.updateNode(node, 'stop');\n\t\t\t\telse\n\t\t\t\t\tSound.updateNode(node, 'pause');\n\n\t\t\t\tif (callback && callback !== true)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t},\n\n\tfadeIn: function (node, millis, callback)\n\t{\n\t\tif (!node) return;\n\n\t\tif (node.playing || node.timer)\n\t\t{\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime = hrnow();\n\n\t\tnode.volume = 0;\n\t\tthis.updateNode(node, 'play');\n\n\t\tnode.timer = setInterval (function()\n\t\t{\n\t\t\tvar t = ((hrnow() - startTime) / millis);\n\t\t\tif (t > 1) t = 1;\n\n\t\t\tnode.volume = node.startVolume*t;\n\t\t\tSound.updateNode(node, 'setvolume');\n\n\t\t\tif (t == 1)\n\t\t\t{\n\t\t\t\tclearInterval (node.timer);\n\t\t\t\tnode.timer = null;\n\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t},\n\t\t50);\n\t}\n});\n","/*\n**\t@rsthn/cherry/wrappers/sound-array\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('../globals');\n\nconst { Rin, Class } = require('@rsthn/rin');\nconst Sound = require('./sound');\n\n/*\n\ttrack: string (music|sfx)\n\tmode: sequential|random\n*/\n\nmodule.exports = Class.extend\n({\n\tr: null,\n\n\t__ctor: function (r)\n\t{\n\t\tif (r.type != \"audios\")\n\t\t\tthrow new Error (\"Resource is not audios.\");\n\n\t\tthis.r = r;\n\t\tthis.r.wrapper = this;\n\n\t\tif (!this.r.track)\n\t\t\tthis.r.track = \"sfx\";\n\n\t\tif (!this.r.mode)\n\t\t\tthis.r.mode = \"random\";\n\n\t\tthis.track = Sound[this.r.track.toUpperCase()];\n\n\t\tthis.sounds = [];\n\t\tthis.lastIndex = -1;\n\n\t\tfor (var i = 0; i < this.r.data.length; i++)\n\t\t{\n\t\t\tthis.sounds.push(new Sound (Rin.override (this.r.data[i], { track: this.r.track })));\n\t\t}\n\t},\n\n\tgetRandomSound: function ()\n\t{\n\t\tif (this.r.mode == \"random\")\n\t\t\treturn this.sounds[randr(0, this.sounds.length-1)];\n\n\t\tthis.lastIndex = ++this.lastIndex % this.sounds.length;\n\t\treturn this.sounds[this.lastIndex];\n\t},\n\n\tplay: function (callback, volume)\n\t{\n\t\treturn Sound.play (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayLoop: function (callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.getRandomSound(), callback, volume);\n\t},\n\n\tplayAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.play (this.sounds[index % this.sounds.length], callback, volume);\n\t},\n\n\tplayLoopAt: function (index, callback, volume)\n\t{\n\t\treturn Sound.playLoop (this.sounds[index % this.sounds.length], callback, volume);\n\t}\n});\n","/*\n**\t@rsthn/cherry/wrappers\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nmodule.exports =\n{\n\tDrawable: require('./wrappers/drawable'),\n\tDrawableRect: require('./wrappers/drawable-rect'),\n\n\tSpriteSheet: require('./wrappers/spritesheet'),\n\tSpriteSheetAnimation: require('./wrappers/spritesheet-animation'),\n\tSpriteFont: require('./wrappers/spritefont'),\n\n\tSound: require('./wrappers/sound'),\n\tSoundArray: require('./wrappers/sound-array')\n};\n","/*\n**\t@rsthn/cherry/resources\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\nconst { Rin } = require('@rsthn/rin');\nconst System = require('./system');\nconst Canvas = require('./canvas');\nconst Wrappers = require('./wrappers');\n\n/**\n**\tProvides functionality to load and manipulate resources (images, audio, etc).\n*/\n\nconst Resources = module.exports =\n{\n\t/**\n\t**\tIndicates if integer scaling is enabled when calling resizeImage(), when enabled, applies only to up-scaling, and images will always be up-scaled\n\t**\tto integer factors only and the drawImageEx will take care of drawing it slighly resized to the target canvas. If disabled the images will be\n\t**\tdown or up-scaled using the half/double method and will eventually end up having the specified target size.\n\t*/\n\tintegerScaling: true,\n\n\t/**\n\t**\tLoads a list of resources. The list parameter is a map with elements as shown in the example below,\n\t**\tthe callback can be optionally specified and it will be called with the index of the element being\n\t**\tloaded and the total number of elements to load.\n\t**\n\t**\t{ type: \"image\", wrapper: \"\", src: \"assets/ui/btn-left.png\", width: 64, [ height: 64 ], pixelated: false }\n\t**\t{ type: \"images\", wrapper: \"\", src: \"assets/ui/##.png\", count: 16, width: 64, [ height: 64 ], pixelated: false }\n\t**\t{ type: \"audio\", wrapper: \"\", src: \"assets/ui/tap.wav\" }\n\t**\t{ type: \"audios\", wrapper: \"\", src: \"assets/ui/snd-##.wav\", count: 4 }\n\t**\t{ type: \"json\", wrapper: \"\", src: \"assets/config.json\" }\n\t**\t{ type: \"object\", wrapper: \"\" }\n\t*/\n\tload: function (list, callback, completeCallback, keyList, index)\n\t{\n\t\tif (!keyList)\n\t\t{\n\t\t\tkeyList = Object.keys(list);\n\t\t\tlist.__original = Rin.clone(list);\n\t\t\tindex = 0;\n\t\t}\n\n\t\tif (callback) callback (index, keyList.length, index / keyList.length);\n\n\t\tif (index == keyList.length)\n\t\t{\n\t\t\tif (completeCallback) completeCallback(list);\n\t\t\treturn;\n\t\t}\n\n\t\tvar r = list[keyList[index]];\n\n\t\tr.resName = keyList[index];\n\n\t\tswitch (r.type)\n\t\t{\n\t\t\t// *********************\n\t\t\tcase \"image\":\n\t\t\t\tr.data = new Image ();\n\n\t\t\t\tr.data.onload = function ()\n\t\t\t\t{\n\t\t\t\t\tvar ratio = r.data.width / r.data.height;\n\n\t\t\t\t\tif (r.scale)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = ~~(r.data.width*r.scale);\n\t\t\t\t\t\tr.height = ~~(r.data.height*r.scale);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = r.data.width;\n\t\t\t\t\t\tr.height = r.data.height;\n\t\t\t\t\t}\n\t\t\t\t\telse if (r.width && !r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.height = int(r.width / ratio);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!r.width && r.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tr.width = int(ratio * r.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.owidth = r.data.width;\n\t\t\t\t\tr.oheight = r.data.height;\n\n\t\t\t\t\tif (r.data.width != r.width || r.data.height != r.height || (r.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (r.original === true)\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width, r.height, r.pixelated, true);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tr.data = Resources.resizeImage (r, r.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tr.rscale = r.data.width / r.width;\n\n\t\t\t\t\t// Used to prevent a delay when rendering an image for the first time on some browsers.\n\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(r.data, 0, 0);\n\n\t\t\t\t\tSystem.displayBuffer.prepareImage(r.data);\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index+1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function () {\n\t\t\t\t\tconsole.error (\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\t// *********************\n\t\t\tcase \"images\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"image\", width: r.width, height: r.height, scale: r.scale };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.data = new Image ();\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\ttmp.data.onload = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar ratio = tmp.data.width / tmp.data.height;\n\n\t\t\t\t\t\tif (tmp.scale)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = ~~(tmp.data.width*tmp.scale);\n\t\t\t\t\t\t\ttmp.height = ~~(tmp.data.height*tmp.scale);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = tmp.data.width;\n\t\t\t\t\t\t\ttmp.height = tmp.data.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (tmp.width && !tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.height = int(tmp.width / ratio);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!tmp.width && tmp.height)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmp.width = int(ratio * tmp.height);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.owidth = tmp.data.width;\n\t\t\t\t\t\t\tr.oheight = tmp.data.height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tmp.data.width != tmp.width || tmp.data.height != tmp.height || (tmp.original !== true && System.scaleFactor != 1))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (tmp.original === true)\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width, tmp.height, r.pixelated, true);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttmp.data = Resources.resizeImage (tmp, tmp.width * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), tmp.height * (r.pixelated ? System.integerScaleFactor : System.scaleFactor), r.pixelated, true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmp.rscale = tmp.data.width / tmp.width;\n\n\t\t\t\t\t\tif (r._i == 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr.width = tmp.width;\n\t\t\t\t\t\t\tr.height = tmp.height;\n\t\t\t\t\t\t\tr.rscale = tmp.rscale;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tSystem.tempDisplayBuffer.drawImage(tmp.data, 0, 0);\n\t\t\t\t\t\tSystem.displayBuffer.prepareImage(tmp.data);\n\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function () {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audio\":\n\n\t\t\t\tif (!r.track) r.track = \"sfx\";\n\n\t\t\t\tif (global.plugins && global.plugins.NativeAudio && r.track == \"sfx\")\n\t\t\t\t{\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\tr.data = \"snd_\" + index;\n\n\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(r.data, r.src,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + r.resName + \"\\n\" + e);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (global.audioContext)\n\t\t\t\t{\n\t\t\t\t\tr.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\tfetchAudioBuffer (r.src + \"?r=\" + Math.random())\n\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\tr.data = audioBuffer;\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\t\t\n\t\t\t\t\t})\n\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tr.data = new Audio ();\n\t\t\t\tr.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\tr.data.oncanplaythrough = function ()\n\t\t\t\t{\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t};\n\n\t\t\t\tr.data.onerror = function ()\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName);\n\t\t\t\t};\n\n\t\t\t\tr.data.src = r.src + \"?r=\" + Math.random();\n\t\t\t\tbreak;\n\n\t\t\tcase \"audios\":\n\n\t\t\t\tvar src = r.src;\n\n\t\t\t\tvar d0 = src.indexOf(\"#\");\n\t\t\t\tvar d1 = src.lastIndexOf(\"#\");\n\t\t\t\tvar dN = d1 - d0 + 1;\n\n\t\t\t\tif (d0 == -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'src' attribute requires one or more '#' marks.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!r.count)\n\t\t\t\t{\n\t\t\t\t\tconsole.error (\"Unable to load: \" + r.resName + \"\\nError: The 'count' attribute was not found.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tr._i = 0;\n\t\t\t\tr.data = [ ];\n\n\t\t\t\tvar cb = function ()\n\t\t\t\t{\n\t\t\t\t\tif (r._i == r.count)\n\t\t\t\t\t{\n\t\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = { type: \"audio\", track: r.track };\n\n\t\t\t\t\ttmp.src = r.src.substr(0, d0) + ((r._i++) / Math.pow(10,dN)).toFixed(dN).substr(2) + r.src.substr(d1+1);\n\t\t\t\t\ttmp.resName = r.resName + \"#\" + (r._i - 1);\n\n\t\t\t\t\tif (!tmp.track) tmp.track = \"sfx\";\n\n\t\t\t\t\tif (global.plugins && global.plugins.NativeAudio && tmp.track == \"sfx\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_NATIVEAUDIO;\n\t\t\t\t\t\ttmp.data = \"snd_\" + index + \"_\" + r._i;\n\t\n\t\t\t\t\t\tglobal.plugins.NativeAudio.preloadSimple(tmp.data, tmp.src,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(e) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load (sfx): \" + tmp.resName + \"\\n\" + e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (global.audioContext)\n\t\t\t\t\t{\n\t\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_WEBAUDIO;\n\n\t\t\t\t\t\tfetchAudioBuffer (tmp.src + \"?r=\" + Math.random())\n\t\t\t\t\t\t.then (audioBuffer => {\n\t\t\t\t\t\t\ttmp.data = audioBuffer;\n\t\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch (err => {\n\t\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttmp.data = new Audio ();\n\t\t\t\t\ttmp.engine = Wrappers.Sound.ENGINE_HTML5;\n\n\t\t\t\t\ttmp.data.oncanplaythrough = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tr.data.push(tmp);\n\t\t\t\t\t\tcb();\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.onerror = function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + tmp.resName);\n\t\t\t\t\t};\n\n\t\t\t\t\ttmp.data.src = tmp.src + \"?r=\" + Math.random();\n\t\t\t\t};\n\n\t\t\t\tcb();\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"json\":\n\n\t\t\t\tfetchd (r.src + \"?r=\" + Math.random(), { responseType: 'json' }).then(function(json)\n\t\t\t\t{\n\t\t\t\t\tr.data = json;\n\n\t\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\t})\n\t\t\t\t.catch(function(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(\"Error: Unable to load: \" + r.resName + \". Error: \" + err);\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"object\":\n\t\t\t\tr.data = { };\n\n\t\t\t\tResources.onLoaded (list, keyList[index]);\n\t\t\t\tResources.load (list, callback, completeCallback, keyList, index + 1);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t/**\n\t**\tUnloads the specified list of resources.\n\t*/\n\tunload: function (list)\n\t{\n\t\tvar __original;\n\n\t\tfor (var i in list)\n\t\t{\n\t\t\tif (i == \"__original\")\n\t\t\t{\n\t\t\t\t__original = list[i];\n\t\t\t\tdelete list[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (list[i].r)\n\t\t\t{\n\t\t\t\tdispose(list[i]);\n\t\t\t\tlist[i] = list[i].r;\n\t\t\t}\n\n\t\t\tswitch (list[i].type)\n\t\t\t{\n\t\t\t\tcase \"audio\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"audios\":\n\t\t\t\t\t// violet: unload audio if using NativeAudio\n\t\t\t\t\t// global.plugins.NativeAudio.unload\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"images\":\n\t\t\t\t\tfor (var j = 0; j < list[i].data.length; j++)\n\t\t\t\t\t\tdispose (list[i].data[j]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdispose (list[i].data);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlist[i].data = null;\n\t\t\tdelete list[i];\n\t\t}\n\n\t\tfor (var i in __original)\n\t\t\tlist[i] = __original[i];\n\t},\n\n\t/**\n\t**\tExecutes post-load actions on a resource.\n\t*/\n\tonLoaded: function (list, index)\n\t{\n\t\tvar r = list[index];\n\t\tif (!r.wrapper || !(r.wrapper in Wrappers)) return;\n\n\t\tlist[index] = new Wrappers[r.wrapper] (r);\n\t},\n\n\t/**\n\t**\tResizes the given image to the specified size.\n\t*/\n\tresizeImage: function (image, dw, dh, pixelated, discardOriginal)\n\t{\n\t\tvar sw = image.data.width;\n\t\tvar sh = image.data.height;\n\n\t\tdw = int(dw);\n\t\tdh = int(dh);\n\n\t\tif (sw == dw && sh == dh)\n\t\t\treturn image.data;\n\n\t\tif (!this.integerScaling && pixelated) pixelated = null;\n\n\t\tif (!pixelated)\n\t\t{\n\t\t\tpixelated = pixelated === null ? false : true;\n\n\t\t\tvar temp = new Canvas (null, { hidden: true, antialias: pixelated }).resize (sw, sh);\n\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tvar tw = sw >> 1;\n\t\t\t\tvar th = sh >> 1;\n\n\t\t\t\tif (tw <= dw || th <= dh)\n\t\t\t\t\tbreak;\n\n\t\t\t\tvar output = new Canvas (null, { hidden: true, antialias: pixelated }).resize (tw, th);\n\t\t\t\toutput.drawImage (temp.elem, 0, 0, tw, th);\n\t\t\t\ttemp.dispose ();\n\n\t\t\t\tsw = tw;\n\t\t\t\tsh = th;\n\n\t\t\t\ttemp = output;\n\t\t\t}\n\n\t\t\tvar output = new Canvas (null, { hidden: true, antialias: pixelated }).resize (dw, dh);\n\t\t\toutput.drawImage (temp.elem, 0, 0, dw, dh);\n\t\t\ttemp.dispose ();\n\n\t\t\tif (discardOriginal)\n\t\t\t\tdispose (image.data);\n\n\t\t\treturn output.elem;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (~~(dw / sw) > 0)\n\t\t\t{\n\t\t\t\tvar ratio = ~~((dw / sw) + 0.9);\n\n\t\t\t\tdw = ratio * sw;\n\t\t\t\tdh = ratio * sh;\n\n\t\t\t\tvar rep_x = dw / sw;\n\t\t\t\tvar rep_y = dh / sh;\n\n\t\t\t\tvar output = new Canvas (null, { hidden: true, antialias: false }).resize (dw, dh);\n\n\t\t\t\tvar temp = new Canvas (null, { hidden: true, antialias: false }).resize (sw, sh);\n\t\t\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\t\t\tfor (var j = 0; j < sh; j++)\n\t\t\t\t{\n\t\t\t\t\tvar s = temp.getImageData(0, j, sw, 1).data;\n\t\t\t\t\tvar sp = 0;\n\n\t\t\t\t\tfor (var i = 0; i < sw && sp < s.length; i++, sp += 4)\n\t\t\t\t\t{\n\t\t\t\t\t\toutput.fillStyle(\"rgba(\"+s[sp]+\",\"+s[sp+1]+\",\"+s[sp+2]+\",\"+(s[sp+3] / 255)+\")\");\n\t\t\t\t\t\toutput.fillRect(i*rep_x, j*rep_y, rep_x, rep_y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemp.dispose();\n\n\t\t\t\treturn output.elem;\n\t\t\t}\n\n\t\t\treturn this.resizeImage (image, dw, dh, null, discardOriginal);\n\t\t}\n\t},\n\n\t/**\n\t**\tFlips an image horizontally.\n\t*/\n\tflipImageHorz: function (image)\n\t{\n\t\tvar temp = new Canvas (null, { hidden: true }).resize (image.data.width, image.data.height);\n\n\t\ttemp.translate(image.data.width, 0);\n\t\ttemp.scale(-1, 1);\n\n\t\ttemp.drawImage (image.data, 0, 0);\n\n\t\treturn temp.elem;\n\t},\n\n\t/**\n\t**\tForces the browser to show a download dialog.\n\t*/\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t**\tForces the browser to show a file selection dialog.\n\t*/\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function ()\n\t\t{\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as a dataURL.\n\t*/\n\tloadAsDataURL: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as text.\n\t*/\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as an array buffer.\n\t*/\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t**\tLoads an array of URLs using FileReader and returns them as data url.\n\t*/\n\tloadAllAsDataURL: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tResources.loadAsDataURL (fileList[i], function(url) {\n\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t}\n};\n","/*\n**\t@rsthn/cherry/quadtree-item\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Rect = require('./rect');\n\n/**\n**\tBase class for items accepted by a QuadTree.\n*/\n\nconst QuadTreeItem = module.exports = Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTreeItem\",\n\n\t/**\n\t**\tBoundaries at which the item was inserted.\n\t*/\n\tinsertionBounds: null, /* Rect */\n\n\t/**\n\t**\tBoundaries of the last known position that was correct.\n\t*/\n\tlastBounds: null, /* Rect */\n\n\t/**\n\t**\tCurrent bounds of the element.\n\t*/\n\tbounds: null, /* Rect */\n\n\t/**\n\t**\tCurrent logical bounds of the element for collision detection.\n\t*/\n\tlbounds: null, /* Rect */\n\n\t/**\n\t**\tType of the item.\n\t*/\n\ttype: 0,\n\n\t/**\n\t**\tZ-index (layer ordering) of the item.\n\t*/\n\tzindex: 0,\n\n\t/**\n\t**\tVisibility of the item.\n\t*/\n\tvisible: true,\n\n\t/**\n\t**\tFlags of the item (see FLAG_* constants).\n\t*/\n\tflags: 0,\n\n\t/**\n\t**\tNumber of nodes referencing this item.\n\t*/\n\tnumRefNodes: 0,\n\n\t/**\n\t**\tTag of the item.\n\t*/\n\ttag: null,\n\n\t/**\n\t**\tExecuted when the item is created.\n\t*/\n\t__ctor: function ()\n\t{\n\t\tthis.insertionBounds = Rect.alloc();\n\t\tthis.lastBounds = Rect.alloc();\n\t\tthis.bounds = Rect.alloc();\n\t\tthis.lbounds = Rect.alloc();\n\n\t\tthis.numRefNodes = 0;\n\t\tthis.zindex = 0;\n\n\t\tthis.flags = QuadTreeItem.FLAG_INITIAL;\n\t\tthis.visible = true;\n\t},\n\n\t/**\n\t**\tResets the object to its initial state.\n\t*/\n\t__reinit: function ()\n\t{\n\t\tthis.insertionBounds.zero();\n\t\tthis.lastBounds.zero();\n\t\tthis.bounds.zero();\n\t\tthis.lbounds.zero();\n\n\t\tthis.numRefNodes = 0;\n\t\tthis.zindex = 0;\n\n\t\tthis.flags = QuadTreeItem.FLAG_INITIAL;\n\t\tthis.visible = true;\n\n\t\tthis.type = 0;\n\t\tthis.tag = null;\n\t},\n\n\t/**\n\t**\tExecuted when the item is removed from the tree.\n\t*/\n\t__dtor: function ()\n\t{\n\t},\n\n\t/**\n\t**\tSets flag bits.\n\t*/\n\tsetFlags: function (value)\n\t{\n\t\tthis.flags |= value;\n\t},\n\n\t/**\n\t**\tClears flag bits.\n\t*/\n\tclearFlags: function (value)\n\t{\n\t\tthis.flags &= ~value;\n\t},\n\n\t/**\n\t**\tReturns the result of masking (bitwise AND) the flags by the specified flag bits.\n\t*/\n\tgetFlags: function (value)\n\t{\n\t\treturn this.flags & value;\n\t},\n\n\t/**\n\t**\tSets the tag of the item.\n\t*/\n\tsetTag: function (tag)\n\t{\n\t\tthis.tag = tag;\n\t},\n\n\t/**\n\t**\tReturns the tag of the item.\n\t*/\n\tgetTag: function()\n\t{\n\t\treturn this.tag;\n\t},\n\n\t/**\n\t**\tSets the z-index of the item.\n\t*/\n\tsetZIndex: function (value)\n\t{\n\t\tthis.zindex = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the Z-index of the item.\n\t*/\n\tgetZIndex: function ()\n\t{\n\t\treturn this.zindex;\n\t},\n\n\t/**\n\t**\tExecuted when the item is inserted on the tree.\n\t*/\n\tnotifyInserted: function (tree)\n\t{\n\t\tthis.flags |= QuadTreeItem.FLAG_ATTACHED;\n\t\tthis.insertionBounds.set (this.getBounds());\n\n\t\tif (this.flags & QuadTreeItem.FLAG_INITIAL)\n\t\t{\n\t\t\tthis.flags &= ~QuadTreeItem.FLAG_INITIAL;\n\t\t\tthis.lastBounds.set (this.getBounds());\n\t\t}\n\t},\n\n\t/**\n\t**\tExecuted when the item is removed from the tree.\n\t*/\n\tnotifyRemoved: function (tree)\n\t{\n\t\tthis.flags &= ~QuadTreeItem.FLAG_ATTACHED;\n\t},\n\n\t/**\n\t**\tExecuted when the item's position has been acnowledged.\n\t*/\n\tnotifyPosition: function ()\n\t{\n\t\tthis.lastBounds.set (this.getBounds());\n\t},\n\n\t/**\n\t**\tReturns the rect with the insertion bounds.\n\t*/\n\tgetInsertionBounds: function () /* Rect */\n\t{\n\t\treturn this.insertionBounds;\n\t},\n\n\t/**\n\t**\tReturns the rect with the last bounds.\n\t*/\n\tgetLastBounds: function () /* Rect */\n\t{\n\t\treturn this.lastBounds;\n\t},\n\n\t/**\n\t**\tReturns the physical bounds of the item.\n\t*/\n\tgetBounds: function () /* Rect */\n\t{\n\t\treturn this.bounds;\n\t},\n\n\t/**\n\t**\tReturns the logical bounds of the item (used for collision detection). The logical bounds must always be a sub-set\n\t**\tof the physical bounds or collision detection might not work.\n\t*/\n\tgetLBounds: function () /* Rect */\n\t{\n\t\treturn this.lbounds;\n\t},\n\n\t/**\n\t**\tSets the type of the item.\n\t*/\n\tsetType: function (type)\n\t{\n\t\tthis.type = type;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the type of the item.\n\t*/\n\tgetType: function ()\n\t{\n\t\treturn this.type;\n\t},\n\n\t/**\n\t**\tSets the visibility of the item.\n\t*/\n\tsetVisible: function (value)\n\t{\n\t\tthis.visible = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the visibility of the item.\n\t*/\n\tgetVisible: function ()\n\t{\n\t\treturn this.visible;\n\t}\n});\n\n/**\n**\tExecuted when the item is removed from the tree.\n*/\nQuadTreeItem.FLAG_QUEUED\t\t=\t0x01;\nQuadTreeItem.FLAG_ATTACHED\t\t=\t0x02;\nQuadTreeItem.FLAG_SELECTED\t\t=\t0x04;\nQuadTreeItem.FLAG_INITIAL\t\t=\t0x08;\nQuadTreeItem.FLAG_ALWAYS_SELECT\t=\t0x10;\nQuadTreeItem.FLAG_CHILD\t\t\t=\t0x20;\nQuadTreeItem.FLAG_USERDEF\t\t=\t0x40;\n","/*\n**\t@rsthn/cherry/quadtree-node\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\nconst { Class } = require('@rsthn/rin');\nconst Rect = require('./rect');\nconst QuadTreeItem = require('./quadtree-item');\n\n/**\n**\tDescribes a node of the quad tree.\n*/\n\nconst QuadTreeNode = module.exports = Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTreeNode\",\n\n\t/**\n\t**\tRegion covered by this node.\n\t*/\n\textents: null, /* Rect */\n\n\t/**\n\t**\tNumber of items stored in the node (and all of its sub-nodes).\n\t*/\n\tnumItems: 0, /* int */\n\n\t/**\n\t**\tLink to the first item of this node.\n\t*/\n\tinsertionPoint: null,\n\n\t/**\n\t**\tSub-nodes of the node. If the node is a branch subNode will not be null.\n\t*/\n\tsubNode: null, /* array[4] of QuadTreeNode */\n\n\t/**\n\t**\tIndicates if the node or a sub-node is dirty.\n\t*/\n\tisDirty: false,\n\n\t/**\n\t**\tTree containing this node.\n\t*/\n\ttree: null,\n\n\t/**\n\t**\tConstructs the tree node with the specified extents.\n\t*/\n\t__ctor: function (tree, x1, y1, x2, y2)\n\t{\n\t\tthis.tree = tree;\n\n\t\tthis.numItems = 0;\n\t\tthis.isDirty = false;\n\n\t\tthis.insertionPoint = null;\n\t\tthis.subNode = null;\n\n\t\tthis.extents = Rect.alloc(x1, y1, x2, y2);\n\t},\n\n\t/**\n\t**\tDestroys the node and all child nodes. Items are not removed, use clear() to properly remove items.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tdispose(this.subNode[i]);\n\n\t\t\tthis.subNode = null;\n\t\t}\n\n\t\tthis.extents.dispose();\n\t},\n\n\t/**\n\t**\tRemoves all items and child nodes.\n\t*/\n\tclear: function ()\n\t{\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t{\n\t\t\t\tthis.subNode[i].clear(this.tree.items);\n\t\t\t\tdispose(this.subNode[i]);\n\t\t\t}\n\n\t\t\tthis.subNode = null;\n\t\t\tthis.numItems = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar j = null;\n\n\t\t\tfor (var i = this.insertionPoint; i && this.numItems--; i = j)\n\t\t\t{\n\t\t\t\tj = i.next;\n\n\t\t\t\tvar k = this.tree.items.remove(i);\n\t\t\t\tk.numRefNodes--;\n\n\t\t\t\tif (k.numRefNodes == 0)\n\t\t\t\t{\n\t\t\t\t\tk.notifyRemoved(this.tree);\n\t\t\t\t\tdispose(k);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.insertionPoint = null;\n\t\t\tthis.numItems = 0;\n\t\t}\n\t},\n\n\t/**\n\t**\tReturns the extents of the node (Rect).\n\t*/\n\tgetExtents: function () /* Rect */\n\t{\n\t\treturn this.extents;\n\t},\n\n\t/**\n\t**\tAdds an item to the node or any of its sub-nodes. If the node exceeds the given capacity the node will be split in four sub-nodes.\n\t**\tReturns false if the item could not added because (a) it is outside the extents of the tree or (b) the node cannot be split.\n\t*/\n\taddItem: function (/*QuadTreeItem*/item, /*int*/capacity) /* bool */\n\t{\n\t\tif (!item.getBounds().intersects(this.extents))\n\t\t\treturn false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tvar result = false;\n\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tresult |= this.subNode[i].addItem (item, capacity);\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.isDirty = true;\n\t\t\t\tthis.numItems++;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tif (this.numItems < capacity)\n\t\t{\n\t\t\tif (this.insertionPoint == null)\n\t\t\t{\n\t\t\t\tthis.tree.items.push (item);\n\t\t\t\tthis.insertionPoint = this.tree.items.bottom;\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.tree.items.insertAfter (this.insertionPoint, item);\n\n\t\t\tthis.isDirty = true;\n\t\t\tthis.numItems++;\n\n\t\t\tif (item.numRefNodes == 0)\n\t\t\t\titem.notifyInserted(this.tree);\n\n\t\t\titem.numRefNodes++;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.extents.width() < 1 && this.extents.height() < 1)\n\t\t{\n\t\t\tconsole.log(\"Error: Unable to split node any further. Current size is \"+this.extents.width()+\" x \"+this.extents.height());\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.subNode = [\n\t\t\tnew QuadTreeNode (this.tree, this.extents.x1, this.extents.y1, this.extents.cx, this.extents.cy),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.cx, this.extents.y1, this.extents.x2, this.extents.cy),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.x1, this.extents.cy, this.extents.cx, this.extents.y2),\n\t\t\tnew QuadTreeNode (this.tree, this.extents.cx, this.extents.cy, this.extents.x2, this.extents.y2)\n\t\t];\n\n\t\tlet n = this.numItems;\n\t\tthis.numItems = 0;\n\n\t\tfor (let i = 0; i < n; i++)\n\t\t{\n\t\t\tlet tmp = this.insertionPoint.next;\n\t\t\tlet cur = this.insertionPoint.value;\n\n\t\t\tcur.numRefNodes--;\n\n\t\t\tif (!this.addItem (cur, capacity))\n\t\t\t{\n\t\t\t\tconsole.log (\"Error: Shouldn't have happened. Unable to insert item on a sub-node of a just-split node.\");\n\t\t\t}\n\n\t\t\tthis.tree.items.remove (this.insertionPoint);\n\t\t\tthis.insertionPoint = tmp;\n\t\t}\n\n\t\tthis.insertionPoint = null;\n\n\t\treturn this.addItem (item, capacity);\n\t},\n\n\t/**\n\t**\tRemoves an item from the node and/or its sub-nodes. Returns false if the node was not found.\n\t*/\n\tremoveItem: function (/*QuadTreeItem*/item)\n\t{\n\t\tif (!item.getInsertionBounds().intersects(this.extents))\n\t\t\treturn false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tvar result = false;\n\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tresult |= this.subNode[i].removeItem (item);\n\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.isDirty = true;\n\t\t\t\tthis.numItems--;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tvar i = this.insertionPoint;\n\t\tvar n = this.numItems;\n\n\t\tfor (; i && n--; i = i.next)\n\t\t{\n\t\t\tif (i.value == item) break;\n\t\t}\n\n\t\tif (i == null) return false;\n\n\t\tthis.isDirty = true;\n\t\tthis.numItems--;\n\n\t\titem.numRefNodes--;\n\n\t\tif (i === this.insertionPoint)\n\t\t\tthis.insertionPoint = this.numItems ? i.next : null;\n\n\t\tthis.tree.items.remove(i);\n\n\t\tif (item.numRefNodes == 0)\n\t\t\titem.notifyRemoved(this.tree);\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tSelects items inside the specified rect from the node and all sub-nodes.\n\t*/\n\tselectItems: function (/*Rect*/rect)\n\t{\n\t\tif (!rect.intersects(this.extents))\n\t\t\treturn;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tthis.subNode[i].selectItems (rect);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar i = this.insertionPoint;\n\t\t\tvar n = this.numItems;\n\n\t\t\tfor (; i && n--; i = i.next)\n\t\t\t{\n\t\t\t\tif ((i.value.visible == true && i.value.getInsertionBounds().intersects(rect)) || (i.value.flags & QuadTreeItem.FLAG_ALWAYS_SELECT))\n\t\t\t\t\ti.value.flags |= QuadTreeItem.FLAG_SELECTED;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t**\tFinds all collisions and executes the specified handler. Before calling the handler the provided filter function will\n\t**\tbe used to determine if the two objects physically colliding actually represent a semantically correct collision.\n\t*/\n\tdetectCollisions: function (/*IQuadTreeHandler*/handler, context)\n\t{\n\t\tif (!this.isDirty)\n\t\t\treturn;\n\n\t\tthis.isDirty = false;\n\n\t\tif (this.subNode != null)\n\t\t{\n\t\t\tfor (var i = 0; i < 4; i++)\n\t\t\t\tthis.subNode[i].detectCollisions (handler, context);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar n = this.numItems;\n\t\tvar i_next;\n\n\t\tfor (var i = this.insertionPoint; i && n > 1; i = i_next)\n\t\t{\n\t\t\tvar i_next = i.next;\n\t\t\tvar m = --n;\n\n\t\t\tif (i.value.visible == false)\n\t\t\t\tcontinue;\n\n\t\t\tif (!handler.onFilterRequest (i.value, context))\n\t\t\t\tcontinue;\n\n\t\t\tvar rect = i.value.getLBounds();\n\t\t\tvar j_next;\n\n\t\t\tfor (var j = i.next; j && m-- > 0; j = j_next)\n\t\t\t{\n\t\t\t\tvar j_next = j.next;\n\n\t\t\t\tif (j.value.visible == false)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (!handler.onFilterRequest (j.value, context))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (!j.value.getLBounds().intersects (rect))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// Following code is non-standard cherry. Required on JS because objects might be recycled.\n\t\t\t\tvar iId = i.objectId;\n\t\t\t\tvar jId = j.objectId;\n\n\t\t\t\thandler.onCollision (i.value, j.value, context);\n\n\t\t\t\tif (i.objectId != iId)\n\t\t\t\t{\n\t\t\t\t\ti_next = this.insertionPoint;\n\t\t\t\t\tn = this.numItems;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (j.objectId != jId)\n\t\t\t\t{\n\t\t\t\t\tj_next = i.next;\n\t\t\t\t\tm = n;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","/*\n**\t@rsthn/cherry/quadtree\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\nconst { Class } = require('@rsthn/rin');\nconst List = require('./list');\nconst QuadTreeNode = require('./quadtree-node');\nconst QuadTreeItem = require('./quadtree-item');\n\n/**\n**\tImplemention of a quad tree for optimized storage of spatial items.\n*/\n\nconst QuadTree = module.exports = Class.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"QuadTree\",\n\n\t/**\n\t**\tRoot node of the tree.\n\t*/\n\troot: null, /*QuadTreeNode*/\n\n\t/**\n\t**\tList of all inserted items, linearly grouped by node.\n\t*/\n\titems: null, /*List<QuadTreeItem>*/\n\n\t/**\n\t**\tList of items ordered by their position from back to front.\n\t*/\n\torderedItems: null, /*List<QuadTreeItem>*/\n\n\t/**\n\t**\tQueue of items to be updated on the next update cycle.\n\t*/\n\tupdateQueue: null, /*List<QuadTreeItem>*/\n\n\t/**\n\t**\tMaximum number of items per each node.\n\t*/\n\tnodeCapacity: 0,\n\n\t/**\n\t**\tNode pointing to the next selected item.\n\t*/\n\tnextItem: null, /*Linkable<QuadTreeItem>*/\n\n\t/**\n\t**\tDirection of traversal of selected items, forward (false) or backward (true).\n\t*/\n\tisReverse: false,\n\n\t/**\n\t**\tIndicates if the quad tree layer is visible.\n\t*/\n\tvisible: true,\n\n\t/**\n\t**\tDirection of the X, Y and Z coordinates (true=inverted). Used to alter ordering of items in the quad tree.\n\t*/\n\txd: false, yd: false, zd: false,\n\n\t/**\n\t**\tConstructs a quad tree for the specified region.\n\t*/\n\t__ctor: function (x1, y1, x2, y2, nodeCapacity)\n\t{\n\t\tthis.items = new List ();\n\t\tthis.orderedItems = new List ();\n\t\tthis.updateQueue = new List ();\n\n\t\tthis.root = new QuadTreeNode (this, x1, y1, x2, y2);\n\t\tthis.nodeCapacity = nodeCapacity;\n\n\t\tthis.isReverse = false;\n\t\tthis.visible = true;\n\n\t\tthis.fnComparator = this.COMPARATOR_DEFAULT_YX;\n\t},\n\n\t/**\n\t**\tDestructs the tree, all nodes and all items.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tthis.root.clear();\n\t\tdispose(this.root);\n\n\t\tdispose(this.items);\n\t\tdispose(this.orderedItems);\n\t\tdispose(this.updateQueue);\n\t},\n\n\t/**\n\t**\tReturns the extents of the quad tree.\n\t*/\n\tgetExtents: function () /*Rect*/\n\t{\n\t\treturn this.root.getExtents();\n\t},\n\n\t/**\n\t**\tSets the visibility of the QuadTree.\n\t*/\n\tsetVisible: function (value)\n\t{\n\t\tthis.visible = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the visibility of the QuadTree.\n\t*/\n\tgetVisible: function ()\n\t{\n\t\treturn this.visible;\n\t},\n\n\t/**\n\t**\tRemoves (and destroys) all items and all nodes from the tree.\n\t*/\n\tclear: function ()\n\t{\n\t\tthis.root.clear();\n\n\t\tthis.orderedItems.reset();\n\t\tthis.updateQueue.reset();\n\t},\n\n\t/**\n\t**\tSets the direction of the x, y or z axis.\n\t*/\n\tsetXd: function (value) { if (this.xd == value) return false; this.xd = value; return true; },\n\tsetYd: function (value) { if (this.yd == value) return false; this.yd = value; return true; },\n\tsetZd: function (value) { if (this.zd == value) return false; this.zd = value; return true; },\n\n\t/**\n\t**\tReturns the sign of the x, y or z axis.\n\t*/\n\tgetXd: function() { return this.xd; },\n\tgetYd: function() { return this.yd; },\n\tgetZd: function() { return this.zd; },\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\".\n\t*/\n\tfnComparator: null,\n\n\t/**\n\t**\tSets the comparator function used to determine the drawing order of items. Returns false if the provided comparator\n\t**\tis the same as the one currently being used.\n\t*/\n\tsetComparator: function (fnComparator)\n\t{\n\t\tif (this.fnComparator == fnComparator)\n\t\t\treturn false;\n\n\t\tthis.fnComparator = fnComparator;\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses 2D-grid comparison. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_DEFAULT_YX: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.y1<b.y1)^this.yd) || (a.y1==b.y1 && ((a.x1<b.x1)^this.xd))));\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses 2D-grid comparison. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_DEFAULT_XY: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.x1<b.x1)^this.xd) || (a.x1==b.x1 && ((a.y1<b.y1)^this.yd))));\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\". Uses Manhattan distance function. Z-Index specifies a virtual layer.\n\t*/\n\tCOMPARATOR_MANHATTAN: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex < q.zindex) ^ this.zd) || (p.zindex == q.zindex && (a.cx + a.cy < b.cx + b.cy));\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y2 component. The Z-Index is arithmetically added to the Y2 value.\n\t*/\n\tCOMPARATOR_Y2: function (a, b, p, q)\n\t{\n\t\treturn ((p.zindex<q.zindex)^this.zd) || (p.zindex==q.zindex && (((a.y2<b.y2)^this.yd) || (a.y2==b.y2 && (a.x1<=b.x1)^this.xd)));\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the Y1 value.\n\t*/\n\tCOMPARATOR_Y1: function (a, b, p, q)\n\t{\n\t\treturn ((a.y1 + p.zindex) < (b.y1 + q.zindex)) ^ this.yd;\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the X2 value.\n\t*/\n\tCOMPARATOR_X2: function (a, b, p, q)\n\t{\n\t\treturn ((a.x2 + p.zindex) < (b.x2 + q.zindex)) ^ this.xd;\n\t},\n\n\t/**\n\t**\tReturns true if \"a\" should be drawn before \"b\" by comparing only the Y-axis. The Z-Index is arithmetically added to the X1 value.\n\t*/\n\tCOMPARATOR_X1: function (a, b, p, q)\n\t{\n\t\treturn ((a.x1 + p.zindex) < (b.x1 + q.zindex)) ^ this.xd;\n\t},\n\n\t/**\n\t**\tUsed for internal ordering. Returns true if item P is before item Q by comparing their position.\n\t*/\n\tisBefore: function (/*QuadTreeItem*/p, /*QuadTreeItem*/q)\n\t{\n\t\treturn this.fnComparator(p.getLBounds(), q.getLBounds(), p, q);\n\t},\n\n\t/**\n\t**\tAdds an item to the ordered list.\n\t*/\n\taddItemOrdered: function (/*QuadTreeItem*/item)\n\t{\n\t\tfor (var i = this.orderedItems.top; i; i = i.next)\n\t\t{\n\t\t\tif (this.isBefore (item, i.value))\n\t\t\t{\n\t\t\t\tthis.orderedItems.insertBefore (i, item);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.orderedItems.push (item);\n\t},\n\n\t/**\n\t**\tReorders the ordered-items-list using the current comparator. Should be called after changing the comparator or the axes sign.\n\t*/\n\treorderItems: function ()\n\t{\n\t\tvar tmp = this.orderedItems;\n\n\t\tthis.orderedItems = new List ();\n\n\t\tfor (var i = tmp.top; i; i = i.next)\n\t\t{\n\t\t\tthis.addItemOrdered(i.value);\n\t\t}\n\n\t\tdispose(tmp);\n\t},\n\n\t/**\n\t**\tAdds an item to the tree, returns false if the operation was unsuccessful.\n\t*/\n\taddItem: function (/*QuadTreeItem*/item) /*bool*/\n\t{\n\t\tif (this.root.addItem (item, this.nodeCapacity))\n\t\t{\n\t\t\tthis.addItemOrdered (item);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRemoves an item from the tree. Returns false if the operation was unsuccessful.\n\t*/\n\tremoveItem: function (/*QuadTreeItem*/item) /*bool*/\n\t{\n\t\tif (!(item.flags & QuadTreeItem.FLAG_ATTACHED))\n\t\t\treturn true;\n\n\t\tif (!this.root.removeItem (item))\n\t\t\treturn false;\n\n\t\tthis.orderedItems.remove (this.orderedItems.sgetNode (item));\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the update queue to be processed on the next update cycle.\n\t*/\n\tupdateItem: function (/*QuadTreeItem*/item)\n\t{\n\t\tthis.removeItem (item);\n\n\t\tif (!this.addItem (item))\n\t\t{\n\t\t\tdispose(item, 'QuadTree::updateItem');\n\t\t\treturn;\n\t\t}\n\n\t\tif (item.flags & QuadTreeItem.FLAG_QUEUED)\n\t\t\treturn;\n\n\t\tthis.updateQueue.push (item);\n\t\titem.flags |= QuadTreeItem.FLAG_QUEUED;\n\t},\n\n\t/**\n\t**\tRuns an update cycle on the tree. Any queued item will be updated.\n\t*/\n\tupdate: function()\n\t{\n\t\tvar i;\n\n\t\twhile (i = this.updateQueue.pop())\n\t\t{\n\t\t\ti.flags &= ~QuadTreeItem.FLAG_QUEUED;\n\t\t\ti.notifyPosition();\n\t\t}\n\t},\n\n\t/**\n\t**\tReturns the list of ordered items.\n\t*/\n\tgetItems: function () /*List<QuadTreeItem>*/\n\t{\n\t\treturn this.orderedItems;\n\t},\n\n\t/**\n\t**\tSets the reverse-flag to report selected items from front-to-back (true) or back-to-front (false).\n\t*/\n\tsetReverse: function (value) /*QuadTree*/\n\t{\n\t\tthis.isReverse = value;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSelects all items that are within the specified region.\n\t*/\n\tselectItems: function (/*Rect*/rect, isReverse=null)\n\t{\n\t\tif (isReverse === null)\n\t\t\tisReverse = this.isReverse;\n\n\t\tthis.root.selectItems (rect);\n\t\tthis.nextItem = isReverse ? this.orderedItems.bottom : this.orderedItems.top;\n\t},\n\n\t/**\n\t**\tReturns the next selected item in the list or null if the end has been reached.\n\t*/\n\tgetNextSelectedItem: function (isReverse=null) /*QuadTreeItem*/\n\t{\n\t\tif (isReverse === null)\n\t\t\tisReverse = this.isReverse;\n\n\t\twhile (this.nextItem != null && !(this.nextItem.value.flags & QuadTreeItem.FLAG_SELECTED))\n\t\t{\n\t\t\tthis.nextItem = isReverse ? this.nextItem.prev : this.nextItem.next;\n\t\t}\n\n\t\tvar ret = this.nextItem;\n\n\t\tif (this.nextItem)\n\t\t{\n\t\t\tthis.nextItem.value.flags &= ~QuadTreeItem.FLAG_SELECTED;\n\t\t\tthis.nextItem = isReverse ? this.nextItem.prev : this.nextItem.next;\n\t\t}\n\n\t\treturn ret ? ret.value : null;\n\t},\n\n\t/**\n\t**\tDetects collisions between items and executes the methods of the specified handler. The context variable is\n\t**\tpassed as-is to the handler routines. The handler should implement methods:\n\t**\n\t**\tbool onFilterRequest (item, context)\n\t**\tbool onCollision (a, b, context)\n\t*/\n\tdetectCollisions: function (/*IQuadTreeHandler*/handler, context)\n\t{\n\t\tvar attempts = 16;\n\n\t\twhile (this.root.isDirty && --attempts != 0)\n\t\t\tthis.root.detectCollisions (handler, context);\n\n\t\tif (attempts == 0)\n\t\t\tconsole.log(\"Error: Collision detection generated an unresolved state.\");\n\t}\n});\n","/*\n**\t@rsthn/cherry/fragment\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst QuadTreeItem = require('./quadtree-item');\nconst DisplayElement = require('./display-element');\n\n/**\n**\tDescribes a rectangular 2D display element.\n*/\n\nconst Fragment = module.exports = QuadTreeItem.extend\n({\n\t/**\n\t**\tParent element of the collision fragment.\n\t*/\n\tparent: null,\n\n\t/**\n\t**\tConstructs a fragment with the specified parameters.\n\t*/\n\t__ctor: function (parent, dx, dy, width, height)\n\t{\n\t\tthis._super.QuadTreeItem.__ctor();\n\n\t\tthis.parent = parent;\n\n\t\tthis.setFlags (DisplayElement.FLAG_FRAGMENT | QuadTreeItem.FLAG_CHILD);\n\t\tthis.setType (parent.getType());\n\n\t\tthis.bounds.set(parent.bounds);\n\t\tthis.lbounds.set(parent.bounds);\n\n\t\tthis.bounds.translate (dx, dy);\n\t\tthis.lbounds.translate (dx, dy);\n\n\t\tthis.bounds.resize (width, height, false, true);\n\t\tthis.lbounds.resize (width, height, false, true);\n\t},\n\n\t/**\n\t**\tTranslates the fragment using the specified deltas (dw is used for the W-value).\n\t*/\n\ttranslate: function (dx, dy)\n\t{\n\t\tthis.bounds.translate (dx, dy);\n\t\tthis.lbounds.translate (dx, dy);\n\t}\n});\n","/*\n**\t@rsthn/cherry/display-element\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst QuadTreeItem = require('./quadtree-item');\nconst Fragment = require('./fragment');\nconst List = require('./list');\n\n/**\n**\tDescribes a rectangular 2D display element.\n*/\n\nconst DisplayElement = module.exports = QuadTreeItem.extend\n({\n\t/**\n\t**\tName of the class (for inheritance purposes).\n\t*/\n\tclassName: \"DisplayElement\",\n\n\t/**\n\t**\tLayer where the element is stored. Set internally when the element is added to a QuadTree.\n\t*/\n\tlayer: null, /*QuadTree*/\n\n\t/**\n\t**\tList of alternative collision areas (fragments) of the element. By default the element's bounds are used for collision\n\t**\tdetection, however when complex elements are needed additional collision areas can be defined using addCollisionFragment().\n\t*/\n\tfragments: null,\n\n\t/**\n\t**\tPosition of the element in world space (top-left corner).\n\t*/\n\tx: 0, y: 0,\n\n\t/**\n\t**\tPosition of the element in screen space.\n\t*/\n\tscrX: 0, scrY: 0,\n\n\t/**\n\t**\tRelated element. That is, the element whose position will be modified by this element.\n\t*/\n\trelated: null,\n\n\t/**\n\t**\tWhen the element is related, this is the parent of the element.\n\t*/\n\tparent: null,\n\n\t/**\n\t**\tConstructs a display element with the specified dimensions.\n\t*/\n\t__ctor: function (width, height)\n\t{\n\t\tthis._super.QuadTreeItem.__ctor();\n\n\t\tthis.layer = null;\n\t\tthis.setPosition (0, 0);\n\t\tthis.resize (width, height);\n\t},\n\n\t/**\n\t**\tInitializes the display element with the specified dimensions.\n\t*/\n\t__reinit: function (width, height)\n\t{\n\t\tthis._super.QuadTreeItem.__reinit();\n\n\t\tthis.layer = null;\n\t\tthis.setPosition (0, 0);\n\t\tthis.resize (width, height);\n\t},\n\n\t/**\n\t**\tDestroys the element and all related resources.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tif (this.fragments != null && this.layer != null)\n\t\t{\n\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t\tthis.layer.removeItem(i.value);\n\t\t}\n\n\t\tif (this.fragments != null)\n\t\t\tdispose(this.fragments);\n\n\t\tif (this.related != null)\n\t\t\tdispose(this.related);\n\n\t\tif (this.layer != null)\n\t\t\tthis.layer.removeItem (this);\n\n\t\tthis._super.QuadTreeItem.__dtor();\n\t},\n\n\t/**\n\t**\tMore user-friendly function to destroy the display element. Same as calling __dtor() directly.\n\t*/\n\tdispose: function ()\n\t{\n\t\tthis.__dtor();\n\t},\n\n\t/**\n\t**\tResizes both bounds and lbounds of the display element.\n\t*/\n\tresize: function (width, height)\n\t{\n\t\tthis.bounds.resize (width, height, false, true);\n\t\tthis.lbounds.resize (width, height, false, true);\n\t},\n\n\t/**\n\t**\tSets the layer of the element.\n\t*/\n\tnotifyInserted: function (layer)\n\t{\n\t\tthis._super.QuadTreeItem.notifyInserted(layer);\n\t\tif (!layer) return;\n\n\t\tif (this.layer != null && this.layer !== layer)\n\t\t{\n\t\t\tthis.layer.removeItem (this);\n\n\t\t\tif (this.fragments != null)\n\t\t\t{\n\t\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t\t\tthis.layer.removeItem (i.value);\n\t\t\t}\n\t\t}\n\n\t\tthis.layer = layer;\n\n\t\tif (this.fragments != null)\n\t\t{\n\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t\tthis.layer.addItem (i.value);\n\t\t}\n\t},\n\n\t/**\n\t**\tClears the layer of the element.\n\t*/\n\tnotifyRemoved: function (layer)\n\t{\n\t\tif (this.fragments != null)\n\t\t{\n\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t\tthis.layer.removeItem (i.value);\n\t\t}\n\n\t\tthis.layer = null;\n\t},\n\n\t/**\n\t**\tSets the layer of the element.\n\t*/\n\tsetLayer: function (layer)\n\t{\n\t\tlayer.addItem(this);\n\t\treturn this;\n\t},\n\n\t/*\n\t**\tRemoves the item from the layer. Returns the item.\n\t*/\n\tremove: function ()\n\t{\n\t\tif (!this.layer) return this;\n\n\t\tthis.layer.removeItem(this);\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the visibility of the display element (and all collision fragments).\n\t*/\n\tsetVisible: function (value)\n\t{\n\t\tthis._super.QuadTreeItem.setVisible (value);\n\n\t\tif (this.fragments != null)\n\t\t{\n\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t\ti.value.setVisible (value);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the related element.\n\t*/\n\tsetRelated: function (elem)\n\t{\n\t\tthis.related = elem;\n\t\tthis.related.parent = this;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tAdds a collision fragment to the element.\n\t*/\n\taddFragment: function (dx, dy, w, h)\n\t{\n\t\tif (this.fragments == null)\n\t\t\tthis.fragments = new List();\n\n\t\tlet fragment = new Fragment (this, dx, dy, w, h);\n\t\tthis.fragments.push (fragment);\n\n\t\tif (this.layer != null)\n\t\t\tthis.layer.addItem (fragment);\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the number of collision fragments.\n\t*/\n\tgetNumFragments: function()\n\t{\n\t\treturn this.fragments != null ? this.fragments.count : 0;\n\t},\n\n\t/**\n\t**\tReturns the list of collision fragments.\n\t*/\n\tgetFragments: function()\n\t{\n\t\treturn this.fragments;\n\t},\n\n\t/**\n\t**\tExecuted when the position changes to update the element bounds.\n\t*/\n\tonPositionChanged: function (x, y, zi)\n\t{\n\t\tvar dx = x - this.bounds.x1;\n\t\tvar dy = y - this.bounds.y1;\n\t\tvar dzi = zi - this.zindex;\n\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t\tthis.zindex += dzi;\n\n\t\tthis.scrX = this.x;\n\t\tthis.scrY = this.y;\n\n\t\tthis.bounds.translate (dx, dy);\n\t\tthis.lbounds.translate (dx, dy);\n\n\t\tif (this.layer != null)\n\t\t\tthis.layer.updateItem (this);\n\n\t\tif (this.fragments != null && this.layer != null)\n\t\t{\n\t\t\tfor (let i = this.fragments.top; i; i = i.next)\n\t\t\t{\n\t\t\t\ti.value.translate (dx, dy);\n\t\t\t\tthis.layer.updateItem (i.value);\n\t\t\t}\n\t\t}\n\n\t\tif (this.related != null)\n\t\t\tthis.related.translate(dx, dy);\n\t},\n\n\t/**\n\t**\tSets the position of the element.\n\t*/\n\tsetBounds: function (bounds)\n\t{\n\t\tthis.onPositionChanged(bounds.x1, bounds.y1, this.zindex);\n\t\tthis.resize(bounds.width(), bounds.height());\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the position of the element.\n\t*/\n\tsetPosition: function (x, y, centerRelative=false)\n\t{\n\t\tif (centerRelative == true)\n\t\t{\n\t\t\tx += this.bounds.x1 - this.bounds.cx;\n\t\t\ty += this.bounds.y1 - this.bounds.cy;\n\t\t}\n\n\t\tthis.onPositionChanged(x, y, this.zindex);\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the X-position of the element in screen-space.\n\t*/\n\tgetScrX: function ()\n\t{\n\t\treturn this.scrX;\n\t},\n\n\t/**\n\t**\tReturns the Y-position of the element in screen-space.\n\t*/\n\tgetScrY: function ()\n\t{\n\t\treturn this.scrY;\n\t},\n\n\t/**\n\t**\tSets the X-position of the element.\n\t*/\n\tsetX: function (x)\n\t{\n\t\tthis.onPositionChanged(x, this.bounds.y1, this.zindex);\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the Y-position of the element.\n\t*/\n\tsetY: function (y)\n\t{\n\t\tthis.onPositionChanged(this.bounds.x1, y, this.zindex);\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the X-position of the element.\n\t*/\n\tgetX: function ()\n\t{\n\t\treturn this.x;\n\t},\n\n\t/**\n\t**\tReturns the Y-position of the element.\n\t*/\n\tgetY: function ()\n\t{\n\t\treturn this.y;\n\t},\n\n\t/**\n\t**\tTranslates the element by the given deltas.\n\t*/\n\ttranslate: function (dx, dy, dzi=0)\n\t{\n\t\tthis.onPositionChanged(this.bounds.x1+dx, this.bounds.y1+dy, this.zindex+dzi);\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tPerforms an update cycle of the element. Parameter dt is in seconds if added to World, or in milliseconds if added to System.\n\t*/\n\tupdate: function (dt)\n\t{\n\t},\n\n\t/**\n\t**\tDraws the element on the specified canvas.\n\t*/\n\tdraw: function (g)\n\t{\n\t}\n});\n\nDisplayElement.FLAG_FRAGMENT\t= 1*QuadTreeItem.FLAG_USERDEF;\nDisplayElement.FLAG_HOLLOW\t\t= 2*QuadTreeItem.FLAG_USERDEF;\n\nObject.assign(exports, module.exports);\n","/*\n**\t@rsthn/cherry/viewport\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tViewport class controls the current visible rectangle of the world.\n*/\n\nconst Rect = require('./rect');\n\n/**\n**\tConstructs the viewport with the specified viewport and world dimensions. A focus factor can\n**\tbe specified as well, if none provided the default value is 0.4.\n*/\n\nconst Viewport = module.exports = function (sx, sy, width, height, worldWidth, worldHeight, focusFactorX/*0.4*/, focusFactorY/*0.4*/)\n{\n\tthis.focusFactorX = focusFactorX == undefined ? 0.4 : focusFactorX;\n\tthis.focusFactorY = focusFactorY == undefined ? 0.4 : focusFactorY;\n\n\tthis.focusTarget = null;\n\n\tthis.sx = sx;\n\tthis.sy = sy;\n\n\tif (width > worldWidth) width = worldWidth;\n\tif (height > worldHeight) height = worldHeight;\n\n\tthis.width = width >> 1;\n\tthis.height = height >> 1;\n\n\tworldWidth >>= 1;\n\tworldHeight >>= 1;\n\n\tthis.worldX1 = -worldWidth;\n\tthis.worldY1 = -worldHeight;\n\tthis.worldX2 = +worldWidth;\n\tthis.worldY2 = +worldHeight;\n\n\tthis.bounds = Rect.alloc();\n\tthis.focusBounds = Rect.alloc();\n\tthis.screenBounds = Rect.alloc();\n\n\tthis.x = 0;\n\tthis.y = 0;\n\n\tthis.enabled = true;\n\n\tthis.updateScreenBounds();\n\tthis.updateBounds();\n};\n\n/**\n**\tDimensions of the viewport.\n*/\nViewport.prototype.width = 0;\nViewport.prototype.height = 0;\n\n/**\n**\tPosition of the viewport in screen space.\n*/\nViewport.prototype.sx = 0;\nViewport.prototype.sy = 0;\n\n/**\n**\tPosition of the viewport in the world.\n*/\nViewport.prototype.x = 0;\nViewport.prototype.y = 0;\n\n/**\n**\tRatio for the viewport's center (value from -1 to 1), used when focusing to use a different focus point instead of the exact center.\n*/\nViewport.prototype.centerRatioX = 0;\nViewport.prototype.centerRatioY = 0;\n\n/**\n**\tPosition delta, used to move the viewport around without affecting the focus point.\n*/\nViewport.prototype.dx = 0;\nViewport.prototype.dy = 0;\n\n/**\n**\tBoundaries of the world (automatically calculated from the world dimensions).\n*/\nViewport.prototype.worldX1 = 0;\nViewport.prototype.worldY1 = 0;\nViewport.prototype.worldX2 = 0;\nViewport.prototype.worldY2 = 0;\n\n/**\n**\tThe focus factor determines the ratio of a smaller viewport on which the current focus point must \n**\tbe contained. If the focus point is not inside the smaller viewport scrolling will be performed.\n*/\nViewport.prototype.focusFactorX = 0;\nViewport.prototype.focusFactorY = 0;\n\n/**\n**\tFocus target of the viewport. When the viewport is updated it will automatically focus on this element.\n*/\nViewport.prototype.focusTarget = null;\n\n/**\n**\tIndicates if the viewport is enabled.\n*/\nViewport.prototype.enabled = false;\n\n/**\n**\tViewport scale.\n*/\nViewport.prototype.scale = 1;\n\n/**\n**\tReturns the enabled flag of the viewport.\n*/\nViewport.prototype.isEnabled = function ()\n{\n\treturn this.enabled;\n};\n\n/**\n**\tSets the enabled flag of the viewport.\n*/\nViewport.prototype.setEnabled = function (enabled)\n{\n\tthis.enabled = enabled;\n\treturn this;\n};\n\n/**\n**\tUpdates the bound rect of the viewport.\n*/\nViewport.prototype.updateBounds = function ()\n{\n\tthis.bounds.set (this.x-(this.width/this.scale)+this.dx, this.y-(this.height/this.scale)+this.dy, this.x+(this.width/this.scale)+this.dx, this.y+(this.height/this.scale)+this.dy);\n\n\tthis.focusBounds.set (\n\t\tthis.x - (this.focusFactorX*this.width + this.centerRatioX*this.width)/this.scale, this.y - (this.focusFactorY*this.height + this.centerRatioY*this.height)/this.scale,\n\t\tthis.x + (this.focusFactorX*this.width + this.centerRatioX*this.width)/this.scale, this.y + (this.focusFactorY*this.height + this.centerRatioY*this.height)/this.scale\n\t);\n};\n\n/**\n**\tUpdates the screen bound rect of the viewport.\n*/\nViewport.prototype.updateScreenBounds = function ()\n{\n\tthis.screenBounds.set (this.sx, this.sy, this.sx + (this.width << 1), this.sy + (this.height << 1));\n};\n\n/**\n**\tSets the dimensions of the viewport.\n*/\nViewport.prototype.resize = function (width, height)\n{\n\tthis.width = width >> 1;\n\tthis.height = height >> 1;\n\n\tthis.updateScreenBounds();\n\tthis.updateBounds();\n\n\treturn this;\n};\n\n/**\n**\tSets the position of the viewport within the world, relative to the current focus point. When `absolute` is true, the focus point will be updated.\n*/\nViewport.prototype.setPosition = function (x, y, absolute=false)\n{\n\tif (absolute === true)\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.dx = this.dy = 0;\n\t}\n\telse\n\t{\n\t\tthis.dx = x;\n\t\tthis.dy = y;\n\t}\n\n\tthis.updateBounds();\n\treturn this;\n};\n\n/**\n**\tSets the scale of the viewport.\n*/\nViewport.prototype.setScale = function (value)\n{\n\tthis.scale = value;\n\n\tthis.updateScreenBounds();\n\tthis.updateBounds();\n\n\treturn this;\n};\n\n/**\n**\tSets the center ratio of the viewport.\n*/\nViewport.prototype.setCenter = function (rx, ry)\n{\n\tthis.centerRatioX = rx;\n\tthis.centerRatioY = ry;\n\n\treturn this;\n};\n\n/**\n**\tMoves the viewport in the world, relative to the current focus point.\n*/\nViewport.prototype.translate = function (dx, dy)\n{\n\tthis.dx += dx;\n\tthis.dy += dy;\n\n\tthis.updateBounds();\n\treturn this;\n};\n\n/**\n**\tSets the screen position of the viewport.\n*/\nViewport.prototype.setScreenPosition = function (sx, sy)\n{\n\tthis.sx = sx;\n\tthis.sy = sy;\n\n\tthis.updateScreenBounds();\n};\n\n/**\n**\tReturns the X position of the viewport inside the world. When `absolute` is true, the focus point X (without offset) will be returned.\n*/\nViewport.prototype.getX = function (absolute=false)\n{\n\treturn this.x + (absolute ? 0 : this.dx);\n};\n\n/**\n**\tReturns the Y position of the viewport inside the world. When `absolute` is true, the focus point Y (without offset) will be returned.\n*/\nViewport.prototype.getY = function (absolute=false)\n{\n\treturn this.y + (absolute ? 0 : this.dy);\n};\n\n/**\n**\tReturns the X position of the viewport inside the world relative to the current focus point.\n*/\nViewport.prototype.getPositionX = function ()\n{\n\treturn this.dx;\n};\n\n/**\n**\tReturns the Y position of the viewport inside the world relative to the current focus point.\n*/\nViewport.prototype.getPositionY = function ()\n{\n\treturn this.dy;\n};\n\n/**\n**\tReturns the width of the viewport.\n*/\nViewport.prototype.getWidth = function ()\n{\n\treturn this.width << 1;\n};\n\n/**\n**\tReturns the height of the viewport.\n*/\nViewport.prototype.getHeight = function ()\n{\n\treturn this.height << 1;\n};\n\n/**\n**\tReturns the bounds of the viewport in world-space.\n*/\nViewport.prototype.getBounds = function ()\n{\n\treturn this.bounds;\n};\n\n/**\n**\tReturns the bounds of the viewport in screens-space.\n*/\nViewport.prototype.getScreenBounds = function ()\n{\n\treturn this.screenBounds;\n};\n\n/**\n**\tReturns the bounds of the focus-area rectangle in world-space.\n*/\nViewport.prototype.getFocusBounds = function ()\n{\n\treturn this.focusBounds;\n};\n\n/**\n**\tMoves the viewport to focus on the specified point. If no focus factor is specified the default will be used.\n*/\nViewport.prototype.focusOn = function (i, j, kx, ky)\n{\n\tif (kx === undefined) kx = this.focusFactorX;\n\tif (ky === undefined) ky = this.focusFactorY;\n\n\tlet x1 = this.x - (kx*this.width + this.centerRatioX*this.width)/this.scale;\n\tlet x2 = this.x + (kx*this.width + this.centerRatioX*this.width)/this.scale;\n\tlet y1 = this.y - (ky*this.height + this.centerRatioY*this.height)/this.scale;\n\tlet y2 = this.y + (ky*this.height + this.centerRatioY*this.height)/this.scale;\n\n\tlet nx = this.x;\n\tlet ny = this.y;\n\n\tif (i < x1) nx += (i - x1);\n\telse if (i > x2) nx += (i - x2);\n\n\tif (j < y1) ny += (j - y1);\n\telse if (j > y2) ny += (j - y2);\n\n\tx1 = nx - this.width;\n\tx2 = nx + this.width;\n\ty1 = ny - this.height;\n\ty2 = ny + this.height;\n\n\tif (x1 < this.worldX1) nx = this.worldX1 + this.width;\n\tif (x2 > this.worldX2) nx = this.worldX2 - this.width;\n\n\tif (y1 < this.worldY1) ny = this.worldY1 + this.height;\n\tif (y2 > this.worldY2) ny = this.worldY2 - this.height;\n\n\tthis.x = nx;\n\tthis.y = ny;\n\n\tthis.updateBounds();\n};\n\n/**\n**\tUpdates the viewport.\n*/\nViewport.prototype.update = function (dt)\n{\n\tif (this.focusTarget != null)\n\t\tthis.focusOn (this.focusTarget.getX(), this.focusTarget.getY());\n};\n\n/**\n**\tTracks a specified object by maintaining focus on it.\n*/\nViewport.prototype.setFocusTarget = function (/*DisplayElement*/elem)\n{\n\tthis.focusTarget = elem;\n\treturn this;\n};\n\n/**\n**\tSets the focus factor of the viewport.\n*/\nViewport.prototype.setFocusFactor = function (/*float*/valueX, /*float*/valueY)\n{\n\tthis.focusFactorX = valueX;\n\tthis.focusFactorY = valueY === undefined ? valueX : valueY;\n\n\treturn this;\n};\n\n/**\n**\tApplies the viewport transform to the specified display buffer.\n*/\nViewport.prototype.applyTransform = function (g)\n{\n\tg.translate (~~this.screenBounds.cx, ~~this.screenBounds.cy);\n\tg.scale (this.scale, this.scale);\n\tg.translate (-(~~this.getX()), -(~~this.getY()));\n};\n\n/**\n**\tConverts a point from screen-space to world-space.\n*/\nViewport.prototype.toWorldSpace = function (x, y)\n{\n\tx = ((x - ~~this.screenBounds.cx) / this.scale) + ~~this.getX();\n\ty = ((y - ~~this.screenBounds.cy) / this.scale) + ~~this.getY();\n\n\treturn { x: x, y: y };\n};\n\n/**\n**\tConverts a point from world-space to screen-space.\n*/\nViewport.prototype.toScreenSpace = function (x, y)\n{\n\tx = (x - ~~this.getX()) * this.scale + ~~this.screenBounds.cx;\n\ty = (y - ~~this.getY()) * this.scale + ~~this.screenBounds.cy;\n\n\treturn { x: x, y: y };\n};\n","/*\n**\t@rsthn/cherry/world\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nrequire('./globals');\n\nconst { Class } = require('@rsthn/rin');\nconst Rect = require('./rect');\nconst List = require('./list');\nconst QuadTree = require('./quadtree');\nconst Viewport = require('./viewport');\nconst System = require('./system');\nconst DisplayElement = require('./display-element');\n\n/**\n**\tDescribes the container where all viewports and layers are stored.\n*/\n\nconst World = module.exports = Class.extend\n({\n\t/**\n\t**\tTemporal object to get the bounds of the viewport.\n\t*/\n\trect: null, /*Rect*/\n\n\t/**\n\t**\tBounds of the world.\n\t*/\n\tbounds: null, /*Rect*/\n\n\t/**\n\t**\tNumber of viewports in the world.\n\t*/\n\tnumViewports: 0,\n\n\t/**\n\t**\tViewports of the world. Set by default to 0.2 of focus factor.\n\t*/\n\tviewports: null, /*Array*/\n\n\t/**\n\t**\tWidth and height of the world.\n\t*/\n\tworldWidth: 0,\n\tworldHeight: 0,\n\n\t/**\n\t**\tNumber of layers in the world.\n\t*/\n\tnumLayers: 0,\n\n\t/**\n\t**\tArray of layers.\n\t*/\n\tlayers: null, /*Array*/\n\n\t/**\n\t**\tArray with booleans indicating if the element lbounds should be drawn on that layer.\n\t*/\n\tdebugLBounds: null, /*Array*/\n\n\t/**\n\t**\tHandler executed after each layer is drawn.\n\t*/\n\tonLayerDrawn: null, /*Array*/\n\n\t/**\n\t**\tThe update method of all objects will be executed when the World's update() method is called.\n\t*/\n\tupdateQueue: null, /*List*/\n\n\t/**\n\t**\tThe draw method of all objects will be executed after the World's draw() method is called.\n\t*/\n\tdrawQueue: null, /*List*/\n\n\t/**\n\t**\tIndicates if a full screen clear should be performed before each frame.\n\t*/\n\tfullClear: true,\n\n\t/*\n\t**\tIndicates if elements marked as FLAG_HOLLOW should be drawn or not.\n\t*/\n\tdrawHollow: false,\n\n\t/**\n\t**\tConstructs a world container with the specified dimensions, number of layers and number of viewports.\n\t*/\n\t__ctor: function (numViewports, numLayers, worldWidth, worldHeight, focusFactor/*0.2*/)\n\t{\n\t\tif (focusFactor === undefined) focusFactor = 0.2;\n\n\t\tthis.numLayers = numLayers;\n\t\tthis.numViewports = numViewports;\n\n\t\tthis.worldWidth = worldWidth;\n\t\tthis.worldHeight = worldHeight;\n\n\t\tvar halfX = (worldWidth + 0) >> 1;\n\t\tvar halfY = (worldHeight + 0) >> 1;\n\n\t\tvar minX = -halfX;\n\t\tvar maxX = halfX;\n\n\t\tvar minY = -halfY;\n\t\tvar maxY = halfY;\n\n\t\tthis.layers = [];\n\t\tthis.viewports = [];\n\t\tthis.debugLBounds = [];\n\n\t\tthis.updateQueue = new List();\n\t\tthis.drawQueue = new List();\n\n\t\tthis.onLayerDrawn = [ ];\n\n\t\tfor (var i = 0; i < numLayers; i++)\n\t\t{\n\t\t\tthis.layers[i] = new QuadTree (minX, minY, maxX, maxY, 16);\n\t\t\tthis.debugLBounds[i] = false;\n\t\t}\n\n\t\tfor (var i = 0; i < numViewports; i++)\n\t\t\tthis.viewports[i] = new Viewport (0, 0, System.screenWidth, System.screenHeight, worldWidth, worldHeight, focusFactor);\n\n\t\tthis.bounds = Rect.alloc(worldWidth, worldHeight);\n\t\tthis.rect = Rect.alloc();\n\t},\n\n\t/**\n\t**\tDestroys the world and all in it.\n\t*/\n\t__dtor: function ()\n\t{\n\t\tfor (var i = 0; i < this.numLayers; i++)\n\t\t\tdispose(this.layers[i]);\n\n\t\tfor (var i = 0; i < this.numViewports; i++)\n\t\t\tdispose(this.viewports[i]);\n\n\t\tdispose(this.updateQueue);\n\t\tdispose(this.drawQueue);\n\t},\n\n\t/**\n\t**\tReturns the width of the world.\n\t*/\n\tgetWidth: function ()\n\t{\n\t\treturn this.worldWidth;\n\t},\n\n\t/**\n\t**\tReturns the height of the world.\n\t*/\n\tgetHeight: function ()\n\t{\n\t\treturn this.worldHeight;\n\t},\n\n\t/**\n\t**\tReturns a viewport of the world.\n\t*/\n\tgetViewport: function (index) /*Viewport*/\n\t{\n\t\tif (index < 0 || index >= this.numViewports)\n\t\t\treturn null;\n\n\t\treturn this.viewports[index];\n\t},\n\n\t/**\n\t**\tReturns the bounds of the world.\n\t*/\n\tgetBounds: function () /*Rect*/\n\t{\n\t\treturn this.bounds;\n\t},\n\n\t/**\n\t**\tReturns a layer given its index. Returns null if the index if out of range.\n\t*/\n\tgetLayer: function (layer) /*QuadTree*/\n\t{\n\t\tif (layer < 0 || layer >= this.numLayers)\n\t\t\treturn null;\n\n\t\treturn this.layers[layer];\n\t},\n\n\t/**\n\t**\tAdds the specified element to the periodic update queue.\n\t*/\n\tupdateQueueAdd: function (/*DisplayElement*/elem)\n\t{\n\t\tthis.updateQueue.push (elem);\n\t},\n\n\t/**\n\t**\tRemoves the specified element from the periodic update queue.\n\t*/\n\tupdateQueueRemove: function (/*DisplayElement*/elem)\n\t{\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(elem));\n\t},\n\n\t/**\n\t**\tAdds the specified object to the extra draw queue.\n\t*/\n\tdrawQueueAdd: function (/*object*/elem)\n\t{\n\t\tthis.drawQueue.push (elem);\n\t},\n\n\t/**\n\t**\tRemoves the specified element from the periodic update queue.\n\t*/\n\tdrawQueueRemove: function (/*object*/elem)\n\t{\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(elem));\n\t},\n\n\t/**\n\t**\tAdds the specified object to the extra draw and update queue.\n\t*/\n\tqueueAdd: function (/*object*/elem)\n\t{\n\t\tthis.drawQueue.push (elem);\n\t\tthis.updateQueue.push (elem);\n\t},\n\n\t/**\n\t**\tRemoves the specified element from the draw and update queue.\n\t*/\n\tqueueRemove: function (/*object*/elem)\n\t{\n\t\tthis.drawQueue.remove (this.drawQueue.sgetNode(elem));\n\t\tthis.updateQueue.remove (this.updateQueue.sgetNode(elem));\n\t},\n\n\t/**\n\t**\tDraws all elements that lie inside the viewports.\n\t*/\n\tdraw: function (g)\n\t{\n\t\tif (this.fullClear) g.clear(true);\n\n\t\tfor (var viewportIndex = 0; viewportIndex < this.numViewports; viewportIndex++)\n\t\t{\n\t\t\tvar viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport.isEnabled()) continue;\n\n\t\t\tg.save();\n\n\t\t\tlet clipArea = viewport.getScreenBounds();\n\t\t\tg.beginPath();\n\t\t\tg.rect(clipArea.x1, clipArea.y1, clipArea.width(), clipArea.height());\n\t\t\tg.clip();\n\n\t\t\tg.pushMatrix();\n\t\t\tviewport.applyTransform(g);\n\n\t\t\tthis.rect.set(viewport.getBounds());\n\n\t\t\tfor (var layerIndex = 0; layerIndex < this.numLayers; layerIndex++)\n\t\t\t{\n\t\t\t\tvar layer = this.layers[layerIndex];\n\t\t\t\tif (!layer.getVisible()) continue;\n\n\t\t\t\tvar elem;\n\n\t\t\t\tlayer.selectItems (this.rect);\n\n\t\t\t\t/*DEBUG*/layer.selectedCount = 0;\n\n\t\t\t\twhile ((elem = layer.getNextSelectedItem()) != null)\n\t\t\t\t{\n\t\t\t\t\tif (elem.getFlags(DisplayElement.FLAG_FRAGMENT))\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tif (elem.getFlags(DisplayElement.FLAG_HOLLOW) && this.drawHollow !== true)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t/*DEBUG*/layer.selectedCount++;\n\t\t\t\t\telem.draw(g);\n\n\t\t\t\t\tif (this.debugLBounds[layerIndex])\n\t\t\t\t\t{\n\t\t\t\t\t\tg.fillStyle('rgba(255,0,255,0.25)');\n\t\t\t\t\t\tg.fillRect(elem.lbounds.x1, elem.lbounds.y1, elem.lbounds.width(), elem.lbounds.height());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.onLayerDrawn[layerIndex])\n\t\t\t\t\tthis.onLayerDrawn[layerIndex] (g);\n\t\t\t}\n\n\t\t\tg.popMatrix();\n\t\t\tg.restore();\n\t\t}\n\n\t\tfor (var elem = this.drawQueue.top; elem; elem = elem.next)\n\t\t\telem.value.draw(g);\n\t},\n\n\t/**\n\t**\tPerforms an update cycle. Note that dt is passed to the sub-update methods in seconds NOT milliseconds.\n\t*/\n\tupdate: function (dt, dtm)\n\t{\n\t\tthis.updateElems(dt, dtm);\n\t\tthis.onUpdated(dt, dtm);\n\t\tthis.updateLayers();\n\t\tthis.updateViewports(dt, dtm);\n\t},\n\n\t/**\n\t**\tExecuted after all elements in the world have been updated. Parameter dt is in seconds, dtm in milliseconds.\n\t*/\n\tonUpdated: function (dt, dtm)\n\t{\n\t},\n\n\t/**\n\t**\tPerforms an update cycle on all elements that have requested a periodic update. Parameter dt is in seconds, dtm in milliseconds.\n\t*/\n\tupdateElems: function (dt, dtm)\n\t{\n\t\tfor (var elem = this.updateQueue.top; elem; elem = elem.next)\n\t\t\telem.value._used = false;\n\n\t\tlet n = this.updateQueue.count;\n\n\t\tfor (var elem = this.updateQueue.top; elem; )\n\t\t{\n\t\t\tif (elem.value._used === true)\n\t\t\t{\n\t\t\t\telem = elem.next;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\telem.value._used = true;\n\t\t\telem.value.update (dt, dtm);\n\n\t\t\tif (this.updateQueue.count != n)\n\t\t\t{\n\t\t\t\tn = this.updateQueue.count;\n\t\t\t\telem = this.updateQueue.top;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\telem = elem.next;\n\t\t}\n\t},\n\n\t/**\n\t**\tExecutes an update cycle on all viewports. Parameter dt is in seconds, dtm in milliseconds.\n\t*/\n\tupdateViewports: function (dt, dtm)\n\t{\n\t\tfor (var viewportIndex = 0; viewportIndex < this.numViewports; viewportIndex++)\n\t\t{\n\t\t\tvar viewport = this.viewports[viewportIndex];\n\t\t\tif (!viewport.isEnabled()) continue;\n\n\t\t\tviewport.update(dt, dtm);\n\t\t}\n\t},\n\n\t/**\n\t**\tExecutes an update cycle on all layers.\n\t*/\n\tupdateLayers: function ()\n\t{\n\t\tfor (var layer = 0; layer < this.numLayers; layer++)\n\t\t\tthis.layers[layer].update();\n\t},\n\n\t/**\n\t**\tTruncates the position of the element to the bounds of the world. Returns D0 set if truncated to the top,\n\t**\tD1 set if truncated to bottom, D2 if truncated to left and D3 if truncated to right.\n\t*/\n\ttruncatePosition: function (/*DisplayElement*/elem)\n\t{\n\t\tvar elemBounds = elem.getBounds();\n\t\tvar value = 0;\n\n\t\tif (elemBounds.x2 > this.bounds.x2)\n\t\t\telem.translate (this.bounds.x2 - elemBounds.x2, 0), value |= (1 << 3);\n\n\t\tif (elemBounds.y2 > this.bounds.y2)\n\t\t\telem.translate (0, this.bounds.y2 - elemBounds.y2), value |= (1 << 1);\n\n\t\tif (elemBounds.x1 < this.bounds.x1)\n\t\t\telem.translate (this.bounds.x1 - elemBounds.x1, 0), value |= (1 << 2);\n\n\t\tif (elemBounds.y1 < this.bounds.y1)\n\t\t\telem.translate (0, this.bounds.y1 - elemBounds.y1), value |= (1 << 0);\n\n\t\treturn value;\n\t},\n\n\tmoveToContact: function (a, b)\n\t{\n\t\tvar ra = a.getLBounds();\n\t\tvar rb = b.getLBounds();\n\n\t\tvar p_ra = a.getLastBounds();\n\t\tvar tmp = a.getBounds();\n\t\tp_ra = this.rect.set(ra).translate(p_ra.x1 - tmp.x1, p_ra.y1 - tmp.y1);\n\n\t\tvar delta = new Vec2();\n\t\tdelta.set(a.getVelocity());\n\n\t\tvar t_bottom = ra.y2 == p_ra.y2 ? -1 : (rb.y1 - p_ra.y2) / (ra.y2 - p_ra.y2);\n\t\tvar t_top = ra.y1 == p_ra.y1 ? -1 : (rb.y2 - p_ra.y1) / (ra.y1 - p_ra.y1);\n\t\tvar t_left = ra.x1 == p_ra.x1 ? -1 : (rb.x2 - p_ra.x1) / (ra.x1 - p_ra.x1);\n\t\tvar t_right = ra.x2 == p_ra.x2 ? -1 : (rb.x1 - p_ra.x2) / (ra.x2 - p_ra.x2);\n\n\t\tvar dir = 0;\n\n\t\tif (t_top < 0 || t_top > 1) t_top = 1048576;\n\t\tif (t_bottom < 0 || t_bottom > 1) t_bottom = 1048576;\n\t\tif (t_left < 0 || t_left > 1) t_left = 1048576;\n\t\tif (t_right < 0 || t_right > 1) t_right = 1048576;\n\n\t\tif (t_top != 1048576 && t_top < t_bottom && t_top < t_left && t_top < t_right)\n\t\t{\n\t\t\tdir = \"D_TOP\";\n\t\t}\n\t\telse if (t_bottom != 1048576 && t_bottom < t_left && t_bottom < t_right)\n\t\t{\n\t\t\tdir = \"D_BOTTOM\";\n\t\t}\n\t\telse if (t_left != 1048576 && t_left < t_right)\n\t\t{\n\t\t\tdir = \"D_LEFT\";\n\t\t}\n\t\telse if (t_right != 1048576)\n\t\t{\n\t\t\tdir = \"D_RIGHT\";\n\t\t}\n\n\t\tswitch (dir)\n\t\t{\n\t\t\tcase \"D_TOP\":\n\t\t\t\ta.translate (0, rb.y2 - ra.y1);\n\t\t\t\ta.getVelocity().y = 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"D_BOTTOM\":\n\t\t\t\ta.translate (0, rb.y1 - ra.y2);\n\t\t\t\ta.getVelocity().y = 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"D_LEFT\":\n\t\t\t\ta.translate (rb.x2 - ra.x1, 0);\n\t\t\t\ta.getVelocity().x = 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"D_RIGHT\":\n\t\t\t\ta.translate (rb.x1 - ra.x2, 0);\n\t\t\t\ta.getVelocity().x = 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n\n/**\n**\tTruncation position bits.\n*/\nWorld.T_TOP\t\t=\t0x01;\nWorld.T_BOTTOM\t=\t0x02;\nWorld.T_LEFT\t=\t0x04;\nWorld.T_RIGHT\t=\t0x08;\n","/*\n**\t@rsthn/cherry/easing\n**\n**\tCopyright (c) 2016-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions.\n*/\n\nconst Easing = module.exports =\n{\n\t/* ******************************************** */\n\tLinear:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\tIN: function (t, k)\n\t\t{\n\t\t\tif (k === undefined) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\tOUT: function (t, k)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\tIN_OUT: function (t, k)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCirc:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCubic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tExpo:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tPower:\n\t{\n\t\tp: 12,\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(t, Easing.Power.p);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuad:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuartic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuintic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tSine:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tStep:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n","/*\n**\t@rsthn/cherry/anim\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Rin, Class } = require('@rsthn/rin');\n\n/**\n**\tClass to animate properties using different\n*/\n\nconst Anim = module.exports = Class.extend\n({\n\tlist: null,\n\n\tinitialData: null,\n\tdata: null,\n\n\tstack: null,\n\tblock: null,\n\n\ttime: 0, blockTime: 0,\n\tindex: 0,\n\n\tpaused: false,\n\tfinished: false,\n\n\tonFinishedCallback: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis.list = [ ];\n\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.stack = [ ];\n\t\tthis.block = this.list;\n\n\t\tthis.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tclone: function ()\n\t{\n\t\tvar a = new Anim();\n\n\t\ta.list = this.list;\n\t\ta.initialData = this.initialData;\n\n\t\treturn a.reset();\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.onFinishedCallback = callback;\n\t\treturn this;\n\t},\n\n\t// Resets the animation to its initial state.\n\treset: function ()\n\t{\n\t\tthis.stack.length = 0;\n\t\tthis.blockTime = 0;\n\n\t\tthis.time = 0;\n\t\tthis.index = 0;\n\n\t\tthis.block = this.list;\n\n\t\tthis.paused = false;\n\t\tthis.finished = false;\n\n\t\tfor (var i in this.initialData)\n\t\t\tthis.data[i] = this.initialData[i];\n\n\t\treturn this;\n\t},\n\n\t// Sets the initial data.\n\tinitial: function (data)\n\t{\n\t\tthis.initialData = data;\n\t\treturn this.reset();\n\t},\n\n\t// Sets the output data object.\n\tsetOutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t// Pauses the animation.\n\tpause: function ()\n\t{\n\t\tthis.paused = true;\n\t},\n\n\t// Resumes the animation.\n\tresume: function ()\n\t{\n\t\tthis.paused = false;\n\t},\n\n\t// Updates the animation by the specified delta time, ensure the time is specified in the same units as the duration of the actions.\n\tupdate: function (dt)\n\t{\n\t\tif (this.paused) return false;\n\n\t\tif (this.index >= this.block.length)\n\t\t\treturn true;\n\n\t\tvar i = 0;\n\n\t\tthis.time += dt;\n\n\t\twhile (this.index < this.block.length)\n\t\t{\n\t\t\tvar cmd = this.block[this.index];\n\t\t\tvar duration;\n\n\t\t\tswitch (cmd.op)\n\t\t\t{\n\t\t\t\tcase \"parallel\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.blocks.length = 0;\n\t\t\t\t\t\tcmd.started = true;\n\n\t\t\t\t\t\tfor (i = 0; i < cmd.block.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmd.blocks.push([cmd.block[i]]);\n\t\t\t\t\t\t\tcmd.indices[i] = 0;\n\t\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _block = this.block;\n\t\t\t\t\tvar _index = this.index;\n\t\t\t\t\tvar _blockTime = this.blockTime;\n\n\t\t\t\t\tvar n = 0;\n\t\t\t\t\tvar blockTime = _blockTime;\n\n\t\t\t\t\tfor (i = 0; i < cmd.blocks.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block = cmd.blocks[i];\n\t\t\t\t\t\tthis.index = cmd.indices[i];\n\t\t\t\t\t\tthis.blockTime = cmd.blockTimes[i];\n\n\t\t\t\t\t\tif (this.update(0) === true)\n\t\t\t\t\t\t\tn++;\n\n\t\t\t\t\t\tif (this.blockTime > blockTime)\n\t\t\t\t\t\t\tblockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\tcmd.blocks[i] = this.block;\n\t\t\t\t\t\tcmd.indices[i] = this.index;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (n != cmd.blocks.length)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"serial\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _block = this.block;\n\t\t\t\t\tvar _index = this.index;\n\t\t\t\t\tvar _blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"repeat\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\t\t\t\t\t\tcmd._count = cmd.count;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar _block = this.block;\n\t\t\t\t\tvar _index = this.index;\n\t\t\t\t\tvar _blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tif (cmd._count <= 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\t\tthis.index++;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._count--;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"set\":\n\t\t\t\t\tthis.data[cmd.field] = cmd.value;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"restart\":\n\t\t\t\t\tthis.index = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"wait\":\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"range\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (cmd.startValue === null)\n\t\t\t\t\t\t\tcmd._startValue = this.data[cmd.field];\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tcmd._startValue = cmd.startValue;\n\n\t\t\t\t\t\tcmd._endValue = cmd.endValue;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1.0)\n\t\t\t\t\t\tthis.data[cmd.field] = cmd.easing(dt)*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.data[cmd.field] = dt*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"rand\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t\tcmd.last = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\tcmd.cur = ~~(cmd.easing(dt)*cmd.count);\n\t\t\t\t\telse\n\t\t\t\t\t\tcmd.cur = ~~(dt*cmd.count);\n\n\t\t\t\t\tif (cmd.cur != cmd.last)\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\ti = ~~(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\t\t\t\tif (i != this.data[cmd.field]) break;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data[cmd.field] = i;\n\t\t\t\t\t\tcmd.last = cmd.cur;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"randt\":\n\t\t\t\t\tduration = Rin.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\ti = cmd.easing(dt)*(cmd.count-1);\n\t\t\t\t\telse\n\t\t\t\t\t\ti = dt*(cmd.count-1);\n\n\t\t\t\t\tthis.data[cmd.field] = cmd.table[~~((i + cmd.count) % cmd.count)];\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"play\":\n\t\t\t\t\t//if (cmd.snd instanceof Sound)\n\t\t\t\t\tcmd.snd.play();\n\t\t\t\t\t//else\n\t\t\t\t\t//cmd.snd.wrapper.play();\n\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"exec\":\n\t\t\t\t\tcmd.fn.call(this);\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.block == this.list)\n\t\t{\n\t\t\tif (!this.finished && this.onFinishedCallback != null)\n\t\t\t\tthis.onFinishedCallback();\n\n\t\t\tthis.finished = true;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t// Runs the subsequent commands in parallel. Should end the parallel block by calling end().\n\tparallel: function ()\n\t{\n\t\tvar block = [ ];\n\n\t\tthis.block.push({ op: \"parallel\", started: false, block: block, blocks: [ ], indices: [ ], blockTimes: [ ] });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Runs the subsequent commands in series. Should end the serial block by calling end().\n\tserial: function ()\n\t{\n\t\tvar block = [ ];\n\n\t\tthis.block.push({ op: \"serial\", started: false, block: block });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Repeats a block the specified number of times.\n\trepeat: function (count)\n\t{\n\t\tvar block = [ ];\n\n\t\tthis.block.push({ op: \"repeat\", started: false, block: block, count: count });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Sets the callback of the current block.\n\tcallback: function (fn)\n\t{\n\t\tvar block = this.stack[this.stack.length-1];\n\t\tblock[block.length-1].fn = fn;\n\n\t\treturn this;\n\t},\n\n\t// Ends a parallel(), serial() or repeat() block.\n\tend: function ()\n\t{\n\t\tthis.block = this.stack.pop();\n\t\treturn this;\n\t},\n\n\t// Sets the value of a variable.\n\tset: function (field, value)\n\t{\n\t\tthis.block.push({ op: \"set\", field: field, value: value });\n\t\treturn this;\n\t},\n\n\t// Restarts the current block.\n\trestart: function (duration)\n\t{\n\t\tthis.block.push({ op: \"restart\" });\n\t\treturn this;\n\t},\n\n\t// Waits for the specified duration.\n\twait: function (duration)\n\t{\n\t\tthis.block.push({ op: \"wait\", duration: duration });\n\t\treturn this;\n\t},\n\n\t// Sets the range of a variable.\n\trange: function (field, duration, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"range\", started: false, field: field, duration: duration, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive).\n\trand: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"rand\", started: false, field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tvar table = [ ];\n\n\t\tfor (var i = 0; i < count; i++)\n\t\t\ttable.push ((i % (endValue - startValue + 1)) + startValue);\n\n\t\tfor (var i = count >> 2; i > 0; i--)\n\t\t{\n\t\t\tvar a = ~~(Math.random() * count);\n\t\t\tvar b = ~~(Math.random() * count);\n\n\t\t\tvar c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tthis.block.push({ op: \"randt\", field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, table: table, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Plays a sound.\n\tplay: function (snd)\n\t{\n\t\tthis.block.push({ op: \"play\", snd: snd });\n\t\treturn this;\n\t},\n\n\t// Executes a function.\n\texec: function (fn)\n\t{\n\t\tthis.block.push({ op: \"exec\", fn: fn });\n\t\treturn this;\n\t}\n});\n","/*\n**\t@rsthn/cherry/controls/button\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Controls = require('../controls');\nconst Rect = require('../rect');\n\n/**\n**\tButton class provides an easy way to add push-button support to the world.\n*/\n\nmodule.exports = Class.extend\n({\n\t/**\n\t**\tBounding box of the button control and hit box bounds.\n\t*/\n\tbounds: null, hbounds: null,\n\n\t/**\n\t**\tIndicates if once focus is obtained it is locked until the user releases it.\n\t*/\n\tfocusLock: false,\n\n\t/**\n\t**\tIndicates if the button is visible (and thus enabled).\n\t*/\n\tvisible: true,\n\n\t/**\n\t**\tBoth refX and refY indicate the screen area where the button should be placed (reference). Possible values can\n\t**\tbe Controls.LEFT, Controls.RIGHT, Controls.TOP and Controls.BOTTOM.\n\t*/\n\trefX: 0, refY: 0,\n\n\t/**\n\t**\tThe offset indicates the number of pixels to separate the button from the reference area (margin).\n\t*/\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t**\tStatus of the button (0 for unpressed, 1 for pressed).\n\t*/\n\tstatus: 0, pstatus: 0,\n\n\t/**\n\t**\tImages for the unpressed and pressed statuses.\n\t*/\n\tunpressedImg: null,\n\tpressedImg: null,\n\n\t/**\n\t**\tCreates the button with the specified parameters.\n\t*/\n\t__ctor: function (refX, refY, offsX, offsY, unpressedImg, pressedImg)\n\t{\n\t\tthis.unpressedImg = unpressedImg;\n\t\tthis.pressedImg = pressedImg;\n\n\t\tvar x = Controls.getXByRef(this.refX = refX);\n\t\tvar y = Controls.getYByRef(this.refY = refY);\n\n\t\toffsX = (refX & 1 ? -1 : 1) * (this.offsX = offsX);\n\t\toffsY = (refY & 1 ? -1 : 1) * (this.offsY = offsY);\n\n\t\tx += Controls.getFByRef(this.refX) * unpressedImg.width + offsX;\n\t\ty += Controls.getFByRef(this.refY) * unpressedImg.height + offsY;\n\n\t\tthis.bounds = Rect.alloc (this.unpressedImg.width, this.unpressedImg.height);\n\t\tthis.bounds.translate (x - this.bounds.x1, y - this.bounds.y1);\n\n\t\tthis.hbounds = Rect.alloc();\n\t\tthis.hbounds.set (this.bounds);\n\t},\n\n\t/**\n\t**\tReturns true if the button contains the specified point.\n\t*/\n\tcontainsPoint: function (x, y)\n\t{\n\t\treturn this.visible == true ? this.hbounds.containsPoint(x, y) : false;\n\t},\n\n\t/**\n\t**\tDraws the stick on the given graphics surface.\n\t*/\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible) return;\n\n\t\tthis.preDraw(g);\n\n\t\tif (this.status)\n\t\t{\n\t\t\tif (!this.pressedImg)\n\t\t\t{\n\t\t\t\tg.pushMatrix();\n\t\t\t\tg.translate(this.bounds.cx, this.bounds.cy);\n\t\t\t\tg.scale(0.8, 0.8);\n\t\t\t\tthis.unpressedImg.draw (g, -this.unpressedImg.width*0.5, -this.unpressedImg.height*0.5);\n\t\t\t\tg.popMatrix();\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.pressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\t\t}\n\t\telse\n\t\t\tthis.unpressedImg.draw (g, this.bounds.x1, this.bounds.y1);\n\n\t\tthis.postDraw(g);\n\t},\n\n\t/**\n\t**\tExecuted before drawing the element.\n\t*/\n\tpreDraw: function (g)\n\t{\n\t},\n\n\t/**\n\t**\tExecuted after drawing the element.\n\t*/\n\tpostDraw: function (g)\n\t{\n\t},\n\n\t/**\n\t**\tShould be called if the EVT_POINTER_DOWN event starts within the bounding box of the button.\n\t*/\n\tactivate: function (pointer)\n\t{\n\t\tpointer._ref = this;\n\n\t\tthis.pstatus = this.status;\n\t\tthis.status = 1;\n\n\t\tthis.onChange (this.status, this.pstatus);\n\t},\n\n\t/**\n\t**\tShould be called if the EVT_POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t*/\n\tdeactivate: function (pointer)\n\t{\n\t\tpointer._ref = null;\n\n\t\tthis.pstatus = this.status;\n\t\tthis.status = 0;\n\n\t\tthis.onChange (this.status, this.pstatus);\n\t},\n\n\t/**\n\t**\tButton pointer update event. Not required for the button control.\n\t*/\n\tupdate: function (pointerX, pointerY)\n\t{\n\t},\n\n\t/**\n\t**\tResets the button to its initial state.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.status = this.pstatus = 0;\n\t\tthis.onChange (this.status, this.pstatus);\n\t},\n\n\t/**\n\t**\tExecuted after any change in the status of the button.\n\t*/\n\tonChange: function (status, pstatus)\n\t{\n\t\tif (status == 0 && pstatus == 1) this.onTap();\n\t},\n\n\t/**\n\t**\tExecuted when the button is tapped (pressed and then released). Works only if the onChange method was not overriden.\n\t*/\n\tonTap: function ()\n\t{\n\t}\n});\n","/*\n**\t@rsthn/cherry/controls/stick\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst { Class } = require('@rsthn/rin');\nconst Controls = require('../controls');\nconst Rect = require('../rect');\n\n/**\n**\tStick class provides an easy way to add directional control sticks to the world.\n*/\n\nmodule.exports = Class.extend\n({\n\t/**\n\t**\tBounding box of the stick control.\n\t*/\n\tbounds: null,\n\n\t/**\n\t**\tIndicates if once focus is obtained it is locked until the user releases it.\n\t*/\n\tfocusLock: true,\n\n\t/**\n\t**\tIndicates if the stick is visible (and thus enabled).\n\t*/\n\tvisible: true,\n\n\t/**\n\t**\tBoth refX and refY indicate the screen area where the stick should be placed (reference). Possible values can\n\t**\tbe Controls.LEFT, Controls.RIGHT, Controls.TOP and Controls.BOTTOM.\n\t*/\n\trefX: 0, refY: 0,\n\n\t/**\n\t**\tThe offset indicates the number of pixels to separate the stick from the reference area (margin).\n\t*/\n\toffsX: 0, offsY: 0,\n\n\t/**\n\t**\tIndicates the displacement in X and Y of the inner stick. This is calculated when the stick update() method is called.\n\t*/\n\tdispX: 0, dispY: 0,\n\n\t/**\n\t**\tCurrent angle and radius of the stick.\n\t*/\n\tangle: 0, radius: 0,\n\n\t/**\n\t**\tNumber of steps for the angle and radius of the stick. Used to snap the stick to discrete steps.\n\t*/\n\tangleSteps: 0, radiusSteps: 0,\n\n\t/**\n\t**\tDirection (X and Y) and magnitude of the stick vector. The dirX and dirY are normalized.\n\t*/\n\trdirX: 0, rdirY: 0, dirX: 0, dirY: 0, magnitude: 0,\n\n\t/**\n\t**\tOuter and inner images of the stick.\n\t*/\n\touterImg: null,\n\tinnerImg: null,\n\n\t/**\n\t**\tMaximum radius that the inner stick can move.\n\t*/\n\tmaxRadius: 0,\n\n\t/**\n\t**\tCreates the stick with the specified parameters. The refX and refY are values from Controls.* enums.\n\t*/\n\t__ctor: function (refX, refY, offsX, offsY, outerImg, innerImg, maxRadiusRatio)\n\t{\n\t\tthis.maxRadius = maxRadiusRatio*outerImg.width*0.5;\n\n\t\tthis.outerImg = outerImg;\n\t\tthis.innerImg = innerImg;\n\n\t\tvar x = Controls.getXByRef(this.refX = refX);\n\t\tvar y = Controls.getYByRef(this.refY = refY);\n\n\t\toffsX = (refX & 1 ? -1 : 1) * (this.offsX = offsX);\n\t\toffsY = (refY & 1 ? -1 : 1) * (this.offsY = offsY);\n\n\t\tx += Controls.getFByRef(this.refX) * outerImg.width + offsX;\n\t\ty += Controls.getFByRef(this.refY) * outerImg.height + offsY;\n\n\t\tthis.bounds = Rect.alloc (this.outerImg.width, this.outerImg.height);\n\t\tthis.bounds.translate (x - this.bounds.x1, y - this.bounds.y1);\n\t},\n\n\t/**\n\t**\tReturns true if the stick contains the specified point.\n\t*/\n\tcontainsPoint: function (x, y)\n\t{\n\t\treturn this.visible == true ? this.bounds.containsPoint(x, y) : false;\n\t},\n\n\t/**\n\t**\tDraws the stick on the given graphics surface.\n\t*/\n\tdraw: function (g)\n\t{\n\t\tif (!this.visible) return;\n\n\t\tvar x = this.bounds.x1;\n\t\tvar y = this.bounds.y1;\n\n\t\tthis.outerImg.draw(g, x, y);\n\t\tthis.innerImg.draw(g, this.bounds.cx - this.innerImg.width*0.5 + this.dispX, this.bounds.cy - this.innerImg.height*0.5 + this.dispY);\n\t},\n\n\t/**\n\t**\tShould be called if the EVT_POINTER_DOWN event starts within the bounding box of the stick.\n\t*/\n\tactivate: function (pointer)\n\t{\n\t\tpointer._ref = this;\n\t},\n\n\t/**\n\t**\tShould be called if the EVT_POINTER_UP event is fired with the \"_ref\" attribute pointing to this object.\n\t*/\n\tdeactivate: function (pointer)\n\t{\n\t\tpointer._ref = null;\n\t\tthis.reset();\n\t},\n\n\t/**\n\t**\tUpdates the stick direction using the specified pointer coordinates. This should be called only if the EVT_POINTER_DOWN event started within\n\t**\tthe bounding box of the stick.\n\t*/\n\tupdate: function (pointerX, pointerY)\n\t{\n\t\tvar dx = pointerX - this.bounds.cx;\n\t\tvar dy = pointerY - this.bounds.cy;\n\n\t\tthis.angle = Math.atan2(-dy, dx);\n\t\tthis.radius = Math.sqrt(dx*dx + dy*dy);\n\n\t\tif (this.radius > this.maxRadius)\n\t\t\tthis.radius = this.maxRadius;\n\n\t\tif (this.angleSteps)\n\t\t{\n\t\t\tvar fs = (2*Math.PI / this.angleSteps);\n\t\t\tthis.angle = int((this.angle + Math.PI + fs/2) / fs) * fs - Math.PI;\n\t\t}\n\n\t\tif (this.radiusSteps)\n\t\t{\n\t\t\tvar fs = (this.maxRadius / this.radiusSteps);\n\t\t\tthis.radius = int((this.radius + fs/2) / fs) * fs;\n\t\t}\n\n\t\tthis.rdirX = Math.min(1, Math.max(dx / this.maxRadius, -1));\n\t\tthis.rdirY = Math.min(1, Math.max(dy / this.maxRadius, -1));\n\n\t\tthis.dispX = this.radius * Math.cos(this.angle);\n\t\tthis.dispY = this.radius * -Math.sin(this.angle);\n\n\t\tif (this.radius > 0)\n\t\t{\n\t\t\tthis.dirX = this.dispX / this.radius;\n\t\t\tthis.dirY = this.dispY / this.radius;\n\n\t\t\tthis.magnitude = this.radius / this.maxRadius;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dirX = 0;\n\t\t\tthis.dirY = 0;\n\n\t\t\tthis.magnitude = 0;\n\t\t}\n\n\t\tthis.onChange(this.dirX, this.dirY, this.magnitude, this.angle);\n\t},\n\n\t/**\n\t**\tResets the stick to its initial position.\n\t*/\n\treset: function ()\n\t{\n\t\tthis.dispX = 0;\n\t\tthis.dispY = 0;\n\n\t\tthis.rdirX = 0;\n\t\tthis.rdirY = 0;\n\n\t\tthis.dirX = 0;\n\t\tthis.dirY = 0;\n\t\tthis.magnitude = 0;\n\n\t\tthis.onChange(this.dirX, this.dirY, this.magnitude, this.angle);\n\t},\n\n\t/**\n\t**\tExecuted after any change in the direction of the stick.\n\t*/\n\tonChange: function (dirX, dirY, magnitude, angle)\n\t{\n\t}\n});\n","/*\n**\t@rsthn/cherry/controls\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst System = require('./system');\n\n/**\n**\tProvides utility functions for controls (buttons, sticks, etc).\n*/\n\nmodule.exports = \n{\n\t/**\n\t**\tPosition reference points.\n\t*/\n\tLEFT:\t0x000,\n\tRIGHT:\t0x001,\n\tTOP:\t0x000,\n\tBOTTOM:\t0x001,\n\tCENTER: 0x002,\n\n\t/**\n\t**\tReturns the X position given a reference value.\n\t*/\n\tgetXByRef: function (refX)\n\t{\n\t\treturn refX == this.CENTER ? (System.screenWidth*0.5) : (refX == this.LEFT ? 0 : System.screenWidth - 1);\n\t},\n\n\t/**\n\t**\tReturns the Y position given a reference value.\n\t*/\n\tgetYByRef: function (refY)\n\t{\n\t\treturn refY == this.CENTER ? (System.screenHeight*0.5) : (refY == this.TOP ? 0 : System.screenHeight - 1);\n\t},\n\n\t/**\n\t**\tReturns the F factor given a reference value.\n\t*/\n\tgetFByRef: function (ref)\n\t{\n\t\treturn ref == this.CENTER ? -0.5 : (ref & 1 ? -1 : 0);\n\t}\n};\n\n/**\n**\tPredefined controls.\n*/\n\nmodule.exports.Button = require('./controls/button');\nmodule.exports.Stick = require('./controls/stick');\n","/*\n**\t@rsthn/cherry\n**\n**\tCopyright (c) 2013-2020, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nmodule.exports =\n{\n\tG: require('./globals'),\n\tC: require('./config'),\n\n\tMatrix: require('./matrix'),\n\tRect: require('./rect'),\n\tVec2: require('./vec2'),\n\tTFunction: require('./tfunction'),\n\n\tPerf: require('./perf'),\n\tLog: require('./log'),\n\tTimer: require('./timer'),\n\n\tRecycler: require('./recycler'),\n\tLinkable: require('./linkable'),\n\tList: require('./list'),\n\n\tCanvas: require('./canvas'),\n\tKeyCodes: require('./keycodes'),\n\tSystem: require('./system'),\n\n\tWrappers: require('./wrappers'),\n\tResources: require('./resources'),\n\n\tQuadTreeItem: require('./quadtree-item'),\n\tQuadTreeNode: require('./quadtree-node'),\n\tQuadTree: require('./quadtree'),\n\n\tDisplayElement: require('./display-element'),\n\tViewport: require('./viewport'),\n\tWorld: require('./world'),\n\n\tEasing: require('./easing'),\n\tAnim: require('./anim'),\n\n\tControls: require('./controls')\n};\n"]}