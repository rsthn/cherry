parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"LZnf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var I={FPS:60,ANTIALIAS:!1,BACKGROUND:"#000",ORIENTATION:0,WIDTH:360,HEIGHT:640,ORIGINAL_TILE_SIZE:32,TILE_SIZE:64,BOARD_WIDTH:10,BOARD_HEIGHT:5,SCALE:1,init:function(){this.SCALE=this.TILE_SIZE/this.ORIGINAL_TILE_SIZE}};exports.default=I;
},{}],"IGXQ":[function(require,module,exports) {

},{}],"tjXp":[function(require,module,exports) {
var global = arguments[3];
var n=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=u(require("./config.js")),e=o(require("./shims.js"));function r(){if("function"!=typeof WeakMap)return null;var n=new WeakMap;return r=function(){return n},n}function o(n){if(n&&n.__esModule)return n;if(null===n||"object"!=typeof n&&"function"!=typeof n)return{default:n};var t=r();if(t&&t.has(n))return t.get(n);var e={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if(Object.prototype.hasOwnProperty.call(n,u)){var i=o?Object.getOwnPropertyDescriptor(n,u):null;i&&(i.get||i.set)?Object.defineProperty(e,u,i):e[u]=n[u]}return e.default=n,t&&t.set(n,e),e}function u(n){return n&&n.__esModule?n:{default:n}}var i={area:null,viewport:null,debugHitbox:!1,debugBounds:!1,debugImage:!1};exports.default=i,n.px=function(n){return n*t.default.SCALE},n.dispose=function(n,t){n&&("dispose"in n?n.dispose(t):"__dtor"in n&&n.__dtor())},n.audioContext="AudioContext"in n?new AudioContext:null,n.fetchd=function(n,t){return new Promise((e,r)=>{t||(t={}),"responseType"in t||(t.responseType="arraybuffer");var o=new XMLHttpRequest;for(var u in o.open("GET",n,!0),t)o[u]=t[u];o.onload=function(){e(o.response)},o.onerror=function(){r("Unable to fetch specified resource.")},o.send()})},n.fetchAudioBuffer=function(t){return new Promise((e,r)=>{n.audioContext?fetchd(t).then(n=>audioContext.decodeAudioData(n)).then(n=>e(n)).catch(n=>r(n)):r("AudioContext is not available.")})},n.int=function(n){return~~n},n.bool=function(n){return!0===n||!1===n?n:"true"==n||"false"!=n&&!!n},n.float=function(n){return parseFloat(n)},n.float2=function(n){return~~(100*n)/100},n.float3=function(n){return~~(1e3*n)/1e3},n.float4=function(n){return~~(1e4*n)/1e4},n.rad=function(n){return n*Math.PI/180},n.rand=function(){return int(65536*Math.random())},n.randf=function(){return Math.random()},n.randrf=function(n,t){let e=Math.random();return e*t+(1-e)*n},n.randr=function(n,t){let e=Math.random();return~~(e*t+(1-e)*n)},n.randtf=function(n,t,e){for(var r=[],o=0;o<e;o++)r.push(randrf(n,t));return r},n.hrnow=function(){return~~performance.now()},n.randvar=function(n,t){return function(){return randr(n,t)}},n.randitem=function(n,t,e){return t||(t=0),e||(e=n.length-1),function(){return n[randr(t,e)]}},n.getLineSegmentIntersection=function(n,t,e,r,o,u,i,a){if(n==o&&t==u&&e==i&&r==a)return 0;var f=r-t,c=e-n,d=a-u,s=i-o;if(0==f&&0==d){if(t!=u)return 2;var l=Math.max(n,o);return l>Math.min(e,i)?2:(l-n)/c}if(0==c&&0==s){if(n!=o)return 2;var p=Math.max(t,u);return p>Math.min(r,a)?2:(p-t)/f}if(0==c)return 0>(M=(d*(n-o)+s*(u-t))/(s*f))||M>1?2:0>(h=(n-o)/s)||h>1?2:M;var h,M,v=d*c-s*f;return 0==v?2:0>(h=(f*(o-n)+c*(t-u))/v)||h>1?2:0>(M=(s*h+o-n)/c)||M>1?2:M},n.lineSegmentIntersects=function(n,t,e,r,o,u,i,a){let f=getLineSegmentIntersection(n,t,e,r,o,u,i,a);return f>=0&&f<=1},n.rotatePoint=function(n,t,e){return"object"==Rin.typeOf(n)?{x:t*n.x+e*n.y,y:e*n.x-t*n.y}:{x:t*Math.cos(n)+e*Math.sin(n),y:e*Math.cos(n)-t*Math.sin(n)}},n.stepValue=function(n,t,e,r){return Math.round(r*(n-t)/(e-t))/r*(e-t)+t},n.alignValue=function(n,t){return Math.round(n/t)*t};
},{"./config.js":"LZnf","./shims.js":"IGXQ"}],"QPdb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var N={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PGUP:33,PGDN:34,END:35,HOME:36,INS:45,DEL:46,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUM_PLUS:107,NUM_MINUS:109,NUM_ASTERISK:106,NUM_SLASH:111,NUM_DOT:110,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};exports.default=N;
},{}],"axtM":[function(require,module,exports) {
let e=module.exports={};e.invokeLater=function(e){e&&setTimeout(function(){e()},10)},e.wait=function(e){return new Promise(function(t,n){setTimeout(t,e)})},e.typeOf=function(e){return e instanceof Array?"array":null===e?"null":(typeof e).toString().toLowerCase()},e.isArrayOrObject=function(t){switch(e.typeOf(t)){case"array":case"object":return!0}return!1},e.clone=function(t){var n;if("array"==e.typeOf(t)){n=[];for(let r=0;r<t.length;r++)n.push(e.clone(t[r]))}else if("object"==e.typeOf(t)){n={};for(let r in t)n[r]=e.clone(t[r])}else n=t;return n},e.merge=function(t,...n){if("array"==e.typeOf(t))for(let r=0;r<n.length;r++){let i=n[r];if("array"!=e.typeOf(i))t.push(i);else for(let n=0;n<i.length;n++)t.push(e.clone(i[n]))}else if("object"==e.typeOf(t))for(let r=0;r<n.length;r++){let i=n[r];if("object"==e.typeOf(i))for(let n in i)e.isArrayOrObject(i[n])?n in t?e.merge(t[n],i[n]):t[n]=e.clone(i[n]):t[n]=i[n]}return t},e.override=function(e,...t){for(let n=0;n<t.length;n++)for(let r in t[n])e[r]=t[n][r];return e},e.partialCompare=function(e,t){if(null==e||null==t)return!1;if(e===t)return!0;for(var n in t)if(e[n]!=t[n])return!1;return!0},e.arrayFind=function(e,t,n){for(var r=0;e&&r<e.length;r++)if(this.partialCompare(e[r],t))return n?e[r]:r;return!!n&&null},e.indexOf=function(e,t,n=!1){if(n){for(let n=0;n<e.length;n++)if(e[n]===t)return n;return-1}for(let r in e)if(e[r]===t)return r;return-1},e.escape=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.ensureTypeOf=function(e,t){return!t||!e||t instanceof e?t:t.isInstanceOf&&e.prototype.className&&t.isInstanceOf(e.prototype.className)?t:new e(t)},e.isTypeOf=function(e,t){return!t||!e||t instanceof e||!!(t.isInstanceOf&&e.prototype.className&&t.isInstanceOf(e.prototype.className))},e.serialize=function(e){return JSON.stringify(e)},e.deserialize=function(e){return JSON.parse(e)},e.hookAppend=function(e,t,n,r=!0){const i=e[t];return e[t]=r?function(...e){if(!1!==i.apply(this,e))return n.apply(this,e)}:function(...e){return i.apply(this,e),n.apply(this,e)},{unhook:function(){e[t]=i}}},e.hookPrepend=function(e,t,n,r=!0){const i=e[t];return e[t]=r?function(...e){if(!1!==n.apply(this,e))return i.apply(this,e)}:function(...e){return n.apply(this,e),i.apply(this,e)},{unhook:function(){e[t]=i}}};
},{}],"xPXT":[function(require,module,exports) {
let t=require("./alpha"),e=module.exports=function(){};e._class=e,e._super={},e.prototype.className="Class",e.prototype.__ctor=function(){},e.prototype.__dtor=function(){},e.prototype.isInstanceOf=function(e){return(e="string"==t.typeOf(e)?e:e.prototype?e.prototype.className:e.constructor.prototype.className)in this._super||this.className==e},e.prototype._initSuperRefs=function(){var e=this.constructor._super,s={};for(let r in e){let o={},p=e[r].prototype;for(let e in p)"function"==t.typeOf(p[e])&&(o[e]=p[e].bind(this));s[r]=o}this._super=s},e.inherit=function(e){var s=this._class,r=s._super,o=s._class;if("function"==t.typeOf(e)){for(let t in e._class)/^[A-Z]/.test(t)||(s[t]=e._class[t]);t.override(s.prototype,e._class.prototype),t.override(r,e._class._super),e._class.prototype.className&&(r[e._class.prototype.className]=e._class)}else t.override(s.prototype,e);return s._super=r,s._class=o,s},e.prototype._extend=function(t,s){var r=function(...t){this._initSuperRefs(),this.__ctor.apply(this,t)};r._class=r,r._super={},e.inherit.call(r,t),delete r.prototype.className;for(let e=0;e<s.length;e++)r.inherit(s[e]);return delete r._super.Class,"classInit"in r.prototype&&r.prototype.classInit(),r},e.extend=function(...t){return this._class.prototype._extend(this,t)},e.create=function(t){return new(this.extend(t))};
},{"./alpha":"axtM"}],"K4NB":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];let i=require("./alpha"),s=require("./class");module.exports=s.extend({className:"Event",source:null,name:null,args:null,_async:!1,list:null,next:null,ret:null,original:null,i:-1,__ctor:function(t,i,s,h,e,n){this.source=t,this.name=s,this.args=h,this.cbHandler=e,this.cbContext=n,this.list=i,this.reset()},reset:function(){return this.next=null,this.ret=[],this._async=!1,this.i=-1,this},setSource:function(t){return this.source=t,this},wait:function(){return this._async=!0,this},resume:function(){for(this._async=!1;!(this._async||++this.i>=this.list.length);)if(!this.list[this.i].silent)if("string"==i.typeOf(this.list[this.i].handler)){if(this.list[this.i].context){if(!this.list[this.i].context[this.list[this.i].handler])continue;if(!1===this.list[this.i].context[this.list[this.i].handler](this,this.args,this.list[this.i].data))break}else if(!1===t[this.list[this.i].handler].call(null,this,this.args,this.list[this.i].data))break}else if(!1===this.list[this.i].handler.call(this.list[this.i].context,this,this.args,this.list[this.i].data))break;return this._async?this:(this.i>=this.list.length&&this.next&&this.next.resume(),this.cbHandler&&this.cbHandler.call(this.cbContext),this)},from:function(t){return this.original=t,this},enqueue:function(t){if(!t)return this;var i;for(i=this;null!=i.next;i=i.next);return i.next=t,t.from(this),this}});
},{"./alpha":"axtM","./class":"xPXT"}],"aK92":[function(require,module,exports) {
let e=require("./class"),t=require("./event");module.exports=e.extend({className:"EventDispatcher",listeners:null,namespace:null,__ctor:function(){this.listeners={}},setNamespace:function(e){return this.namespace=e,this},addEventListener:function(e,t,s,n){var i=(e=e.split(":"))[e.length-1],r=e.length>1?e[0]:null;return this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push({ns:r,handler:t,context:s,data:n,silent:0}),this},removeEventListener:function(e,t,s){var n=(e=e.split(":"))[e.length-1],i=e.length>1?e[0]:null;if("*"==n)for(var r in this.listeners)for(var l=this.listeners[r],h=0;h<l.length;h++){var a=!0;t&&(a=a&&l[h].handler===t),s&&(a=a&&l[h].context===s),i&&(a=a&&l[h].ns==i),a&&l.splice(h--,1)}else{if(!this.listeners[n])return this;for(l=this.listeners[n],h=0;h<l.length;h++){a=!0;t&&(a=a&&l[h].handler===t),s&&(a=a&&l[h].context===s),i&&(a=a&&l[h].ns==i),a&&l.splice(h--,1)}}return this},prepareEvent:function(e,s,n,i){var r=[],l=(e=e.split(":"))[e.length-1],h=e.length>1?e[0]:null;this.listeners[l]&&(r=r.concat(this.listeners[l])),this.listeners["*"]&&(r=r.concat(this.listeners["*"]));for(var a=0;a<r.length;a++)r[a].silent&&r.splice(a--,1);if(h)for(a=0;a<r.length;a++)r[a].ns!=h&&r.splice(a--,1);return new t(this,r,l,s,n,i)},silence:function(e,t){var s=(e=e.split(":"))[e.length-1],n=e.length>1?e[0]:null;if(t=!1===t?-1:1,"*"==s)for(var i in this.listeners)for(var r=this.listeners[i],l=0;l<r.length;l++)n&&r[l].ns!=n||(r[l].silent+=t);else{if(!this.listeners[s])return this;for(r=this.listeners[s],l=0;l<r.length;l++)n&&r[l].ns!=n||(r[l].silent+=t)}return this},dispatchEvent:function(e,t,s,n){return this.prepareEvent(this.namespace?this.namespace+":"+e:e,t,s,n).resume()}});
},{"./class":"xPXT","./event":"K4NB"}],"S8C1":[function(require,module,exports) {
module.exports={email:/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)+$/i,url:/^[\w-]+:\/\/[\w-]+(\.\w+)+.*$/,urlNoProt:/^[\w-]+(\.\w+)+.*$/,name:/^[-A-Za-z0-9_.]+$/,uname:/^['\pL\pN ]+$/,text:/^[^&<>{}]*$/,utext:/^([\r\n\pL\pN\pS &!@#$%*\[\]()_+=;',.\/?:"~-]+)$/};
},{}],"JVzn":[function(require,module,exports) {
let Rin=require("./alpha"),Regex=require("./model-regex");module.exports={_getref:function(value,obj){return"string"==typeof value?("#"==value.substr(0,1)?value=obj.get(value.substr(1)):"@"==value.substr(0,1)&&(value=obj[value.substr(1)]),"string"==typeof value?eval(value):value):value},type:function(r,e,t,n){switch(e){case"int":if(n=parseInt(n),isNaN(n))throw new Error(e);break;case"float":if(n=parseFloat(n),isNaN(n))throw new Error(e);break;case"string":n=null==n?"":n.toString();break;case"bit":if(!0===n||!1===n){n=n?1:0;break}if(n=parseInt(n),isNaN(n))throw new Error(e);n=n?1:0;break;case"array":if("array"==Rin.typeOf(n))break;if(null==n){n=[];break}throw new Error(e);case"bool":if("true"===n||!0===n){n=!0;break}if("false"===n||!1===n){n=!1;break}throw new Error(e)}return n},model:function(r,e,t,n){var o=this._getref(e,r);if(!o)throw new Error(e);return n?o.ensure(n):new o},cls:function(r,e,t,n){var o=this._getref(e,r);return n?Rin.ensureTypeOf(o,n):new o},arrayof:function(r,e,t,n){var o=this._getref(e,r);if(n||(n=[]),!o||"array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)n[i]=Rin.ensureTypeOf(o,n[i]);return n},arraynull:function(r,e,t,n){var o=!1;if("object"==Rin.typeOf(e)&&(e.remove&&(o=e.remove),e=e.value),e)return n;if("array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)if(null==n[i]){if(!o)throw new Error(e);n.splice(i--,1)}return n},arraycompliant:function(r,e,t,n){var o=!1;if("object"==Rin.typeOf(e)&&(e.remove&&(o=e.remove),e=e.value),!e)return n;if("array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)if(null!=n[i]&&!n[i].isCompliant()){if(!o)throw new Error(e);n.splice(i--,1)}return n},required:function(r,e,t,n){if(null==n)throw new Error(e?"":"null");switch(Rin.typeOf(n)){case"array":if(0==n.length)throw new Error(e?"":"null");break;default:if(0==n.toString().length)throw new Error(e?"":"null")}return n},minlen:function(r,e,t,n){if(n.toString().length<e)throw new Error(e);return n},maxlen:function(r,e,t,n){if(n.toString().length>e)throw new Error(e);return n},minval:function(r,e,t,n){if(parseFloat(n)<e)throw new Error(e);return n},maxval:function(r,e,t,n){if(parseFloat(n)>e)throw new Error(e);return n},mincount:function(r,e,t,n){if("array"!=Rin.typeOf(n)||n.length<e)throw new Error(e);return n},maxcount:function(r,e,t,n){if("array"!=Rin.typeOf(n)||n.length>e)throw new Error(e);return n},pattern:function(r,e,t,n){if(!Regex[e].test(n.toString()))throw new Error(e);return n},inset:function(r,e,t,n){if("array"!=Rin.typeOf(e)){if(!new RegExp("^("+e.toString()+")$").test(n.toString()))throw new Error(e);return n}if(-1==e.indexOf(n.toString()))throw new Error(e.join("|"));return n},upper:function(r,e,t,n){return e?n.toString().toUpperCase():n},lower:function(r,e,t,n){return e?n.toString().toLowerCase():n}};
},{"./alpha":"axtM","./model-regex":"S8C1"}],"rbeK":[function(require,module,exports) {
let t=require("./alpha"),i=require("./event-dispatcher"),s=module.exports=i.extend({className:"Model",defaults:null,constraints:null,data:null,changedList:null,_silent:0,_level:0,__ctor:function(t,i){if(this._super.EventDispatcher.__ctor(),this.data={},null!=i)this.reset(i);else{var s=null;if(!this.defaults&&this.constraints){s={};for(var e in this.constraints){var n=this.constraints[e];null!==n.def&&void 0!==n.def?"function"==typeof n.def?s[e]=n.def():s[e]=n.def:s[e]=null}}this.reset(s)}this.init(),null!=t&&this.set(arguments[0],!0),this.constraints&&this.update(),this.ready()},reset:function(i,s){if(!this.defaults){if(!i||"object"!=t.typeOf(i)&&"function"!=t.typeOf(i))return this;this.defaults=i}return"function"==t.typeOf(this.defaults)?this.data=this.defaults():this.data=t.clone(this.defaults),!1===s||!1===i?this:this.update(null,!0)},init:function(){},ready:function(){},silent:function(t){return this._silent+=t?1:-1,this},_validate:function(t,i){if(!this.constraints||!this.constraints[t])return i;var e=this.constraints[t],n=i;for(var a in e)if(s.Constraints[a])try{n=s.Constraints[a](this,e[a],t,n)}catch(r){if("null"==r.message)break;throw new Error(`Constraint [${a}:${e[a]}] failed on property '${t}'.`)}return n},_set:function(t,i){if(!this.constraints||!this.constraints[t])return this.data[t]=i,i;var e=this.constraints[t],n=(this.data[t],i);for(var a in e)if(s.Constraints[a])try{n=s.Constraints[a](this,e[a],t,n)}catch(r){if("null"==r.message)break;this._silent||this.dispatchEvent("constraintError",{constraint:a,message:r.message,name:t,value:i});break}return this.data[t]=n},_propertyEvent:function(t,i,s,e){var n={name:t,old:i,value:s,level:this._level},a=this.dispatchEvent("propertyChanging",n);e?this.data[t]=n.value:n.value=this._set(t,n.value),null!=a&&a.ret.length&&!1===a.ret[0]||(this.dispatchEvent("propertyChanged."+t,n),this.dispatchEvent("propertyChanged",n),this.changedList.push(t))},set:function(){var i=arguments.length,s=!1,e=!1;if((i>2||2==i&&"object"==t.typeOf(arguments[0]))&&"boolean"==t.typeOf(arguments[i-1])&&!1===(s=arguments[--i])&&(e=!0),0==this._level&&(this.changedList=[]),this._level++,2==i)(this.data[arguments[0]]!=arguments[1]||s)&&(this._silent||e?this._set(arguments[0],arguments[1]):this._propertyEvent(arguments[0],this.data[arguments[0]],this._validate(arguments[0],arguments[1])));else for(var n in arguments[0])(this.data[n]!=arguments[0][n]||s)&&(this._silent||e?this._set(n,arguments[0][n]):this._propertyEvent(n,this.data[n],this._validate(n,arguments[0][n])));return--this._level||!this.changedList.length||e||this._silent||this.dispatchEvent("modelChanged",{fields:this.changedList}),this},has:function(t){return t in this.data},get:function(t,i){return 0==arguments.length||!1===t?this.data:1==arguments.length&&!0===t?this.flatten():2==arguments.length&&void 0===this.data[t]?i:this.data[t]},getInt:function(t,i){return 2==arguments.length&&void 0===this.data[t]?i:parseInt(this.data[t])},getFloat:function(t,i){return 2==arguments.length&&void 0===this.data[t]?i:parseFloat(this.data[t])},getBool:function(t,i){return"true"===(t=2==arguments.length&&void 0===this.data[t]?i:this.data[t])||!0===t||"false"!==t&&!1!==t&&!!parseInt(t)},getReference:function(t){var i=this;return{get:function(){return i.get(t)},set:function(s){i.set(t,s)}}},constraint:function(i,s,e){if(3==arguments.length||2==arguments.length||1==arguments.length&&"object"==t.typeOf(i)){switch(this.constraints===this.constructor.prototype.constraints&&(this.constraints=t.clone(this.constraints)),arguments.length){case 1:t.override(this.constraints,i);break;case 2:t.override(this.constraints[i],s);break;case 3:this.constraints[i][s]=e}return this}return i?this.constraints[i]:this},flatten:function(i,s){if(i)return null==(a=this.flatten(!1,!0))?null:(a.class=this.classPath,a);if(!this.constraints&&!this.defaults)return this.data;if(!this.isCompliant())return{};var e=this.constraints,n=this.defaults?"function"==t.typeOf(this.defaults)?this.defaults():this.defaults:this.constraints,a={};for(var r in this.data)if(r in n){if(e&&e[r]){var h=e[r];if(h.model){a[r]=this.data[r]?this.data[r].flatten(s):null;continue}if(h.arrayof){a[r]=[];for(var l=0;l<this.data[r].length;l++)a[r][l]=this.data[r][l]?this.data[r][l].flatten(s):null;continue}if(h.cls){a[r]=this.data[r]?this.data[r].flatten():null;continue}}a[r]=this.data[r]}return a},remove:function(i,s){if("array"==t.typeOf(i)){for(var e=0;e<i.length;e++)delete this.data[i[e]];!1===s||this._silent||this.dispatchEvent("propertyRemoved",{fields:i})}else delete this.data[i],!1===s||this._silent||this.dispatchEvent("propertyRemoved",{fields:[i]})},update:function(i,s){if(this._silent)return this;if(0==this._level&&(this.changedList=[]),this._level++,i&&"string"==t.typeOf(i))this._propertyEvent(i,this.data[i],this.data[i],s);else if(i&&"array"==t.typeOf(i))for(var e of i)this._propertyEvent(e,this.data[e],this.data[e],s);else for(var e in this.data)this._propertyEvent(e,this.data[e],this.data[e],s);return--this._level||this._silent||0==this.changedList.length&&!0!==i||this.dispatchEvent("modelChanged",{fields:this.changedList}),this},validate:function(i){if(!this.constraints)return this;if(i&&"string"==t.typeOf(i))this._set(i,this.data[i]);else for(var s in this.data)i&&-1==t.indexOf(i,s)||this._set(s,this.data[s]);return this},isCompliant:function(){if(!this.constraints)return!0;try{for(var t in this.data)this._validate(t,this.data[t]);return!0}catch(i){}return!1},observe:function(t,i,s){this.addEventListener("propertyChanged."+t,i,s)},unobserve:function(t,i,s){this.removeEventListener("propertyChanged."+t,i,s)},toString:function(){return t.serialize(this.get(!0))}});s.Constraints=require("./model-constraints");
},{"./alpha":"axtM","./event-dispatcher":"aK92","./model-constraints":"JVzn"}],"J25A":[function(require,module,exports) {
let t=require("./alpha"),e=require("./model");module.exports=e.extend({className:"ModelList",itemt:e,contents:null,itemId:null,nextId:null,defaults:{contents:null},constraints:{contents:{type:"array",arrayof:"@itemt"}},__ctor:function(...t){this.itemId=[],this.nextId=0,this._super.Model.__ctor(...t)},ready:function(){this._eventGroup="ModelList_"+Date.now()+":modelChanged",this.contents=this.data.contents},_bind:function(t,e){return e&&e.addEventListener&&e.addEventListener(this._eventGroup,this._onItemEvent,this,t),e},_unbind:function(t){return t&&t.removeEventListener&&t.removeEventListener(this._eventGroup),t},_onItemEvent:function(t,e,n){this.prepareEvent("itemChanged",{id:n,item:t.source}).from(t).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},length:function(){return this.data.contents.length},clear:function(){for(var t=0;t<this.data.contents;t++)this._unbind(this.data.contents[t]);this.itemId=[],this.nextId=0,this.data.contents=[],this.prepareEvent("itemsCleared").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},setData:function(e){if(this.clear(),e){for(var n=0;n<e.length;n++){var i=t.ensureTypeOf(this.itemt,e[n]);this.itemId.push(this.nextId++),this.data.contents.push(i),this._bind(this.nextId-1,i)}this.prepareEvent("itemsChanged").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()}},getData:function(){return this.data.contents},getAt:function(t){return t<0||t>=this.data.contents.length?null:this.data.contents[t]},removeAt:function(t){if(t<0||t>=this.data.contents.length)return null;let e=this.data.contents.splice(t,1)[0],n=this.itemId.splice(t,1)[0];return this._unbind(e),this.prepareEvent("itemRemoved",{id:n,item:e}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),e},setAt:function(e,n){return!(e<0||e>=this.data.contents.length)&&(n=t.ensureTypeOf(this.itemt,n),this._unbind(this.data.contents[e]),this.data.contents[e]=n,this._bind(this.itemId[e],n),this.prepareEvent("itemChanged",{id:this.itemId[e],item:n}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),!0)},updateAt:function(t){return!(t<0||t>=this.data.contents.length)&&(this.prepareEvent("itemChanged",{id:this.itemId[t],item:this.data.contents[t]}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),!0)},push:function(e){return e&&"object"!=t.typeOf(e)?null:(e=t.ensureTypeOf(this.itemt,e),this.itemId.push(this.nextId++),this.data.contents.push(e),this._bind(this.nextId-1,e),this.prepareEvent("itemAdded",{id:this.itemId[this.itemId.length-1],item:e,position:"tail"}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),e)},pop:function(){return this._unbind(this.data.contents.pop())},unshift:function(e){return e&&"object"!=t.typeOf(e)?null:(e=t.ensureTypeOf(this.itemt,e),this.itemId.unshift(this.nextId++),this.data.contents.unshift(e),this._bind(this.nextId-1,e),this.prepareEvent("itemAdded",{id:this.itemId[0],item:e,position:"head"}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),e)},shift:function(){return this._unbind(this.data.contents.shift())},find:function(e,n){for(var i=this.data.contents,s=0;s<i.length;s++)if(t.partialCompare(i[s].data,e))return n?i[s]:s;return n?null:-1}});
},{"./alpha":"axtM","./model":"rbeK"}],"xgn1":[function(require,module,exports) {
let t=require("./alpha"),n=module.exports={Type:function(n){let e={flatten:function(t,n){return t},unflatten:function(t,n){return t}};return n?t.override(e,n):e},String:function(){return n.Type({flatten:function(t,n){return null!=t?t.toString():null},unflatten:function(t,n){return null!=t?t.toString():null}})},Integer:function(){return n.Type({flatten:function(t,n){return~~t},unflatten:function(t,n){return~~t}})},Number:function(t){return n.Type({_precision:t,_round:!1,precision:function(t){return this._precision=~~t,this},flatten:function(t,n){return t=parseFloat(t),this._precision>0&&(t=~~(t*Math.pow(10,this._precision))/Math.pow(10,this._precision)),t},unflatten:function(t,n){return parseFloat(t)}})},Bool:function(t){return n.Type({_compact:t,compact:function(t){return this._compact=t,this},flatten:function(t,n){return t=~~t,this._compact?t>0?1:0:t>0},unflatten:function(t,n){return!!~~t}})},SharedString:function(){return n.Type({flatten:function(t,n){return null==t?0:(t=t.toString(),"strings"in n||(n.strings_map={},n.strings=[]),t in n.strings_map||(n.strings.push(t),n.strings_map[t]=n.strings.length),n.strings_map[t])},unflatten:function(t,n){return null==t||0==t?null:n.strings[~~t-1]}})},Array:function(t){return n.Type({itemType:t,_debug:!1,debug:function(t){return this._debug=t,this},of:function(t){return this.itemType=t,this},flatten:function(t,n){if(null==t)return null;let e=[];for(let r=0;r<t.length;r++)e.push(this.itemType.flatten(t[r],n));return e},unflatten:async function(t,n){if(null==t)return null;let e=[];for(let r=0;r<t.length;r++)e.push(await this.itemType.unflatten(t[r],n));return e}})},Object:function(){return n.Type({properties:[],property:function(t,n,e=null){return this.properties.push({name:t,type:n,defvalue:e}),this},flatten:function(t,n){if(null==t)return null;let e;if(!0===n.symbolic){e={};for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=this.properties[r].type.flatten(t[this.properties[r].name],n)}else{e=[];for(let r=0;r<this.properties.length;r++)e.push(this.properties[r].type.flatten(t[this.properties[r].name],n))}return e},unflatten:async function(t,n){if(null==t)return null;let e={};if(!0===n.symbolic)for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=await this.properties[r].type.unflatten(this.properties[r].name in t?t[this.properties[r].name]:this.properties[r].defvalue,n);else for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=await this.properties[r].type.unflatten(r in t?t[r]:this.properties[r].defvalue,n);return e}})},Class:function(t){return n.Type({_constructor:t,constructor:function(t){return this._constructor=t,this},flatten:function(t,n){return null==t?null:t.flatten(n)},unflatten:async function(t,n){return null==t?null:await(new this._constructor).unflatten(t,n)}})},Property:function(t,e){return n.Type({property:t,type:e,name:function(t){return this.property=t,this},is:function(t){return this.type=t,this},flatten:function(t,n){if(null==t)return null;let e;return!0===n.symbolic?(e={})[this.property]=this.type.flatten(t[this.property],n):e=this.type.flatten(t[this.property],n),e},unflatten:async function(t,n){if(null==t)return null;let e={};return!0===n.symbolic?e[this.property]=await this.type.unflatten(t[this.property],n):e[this.property]=await this.type.unflatten(t,n),e}})},Map:function(){return n.Type({flatten:function(t,n){if(null==t)return null;if(!0===n.symbolic)return t;let e=[];for(let r in t)e.push(r),e.push(t[r]);return e},unflatten:function(t,n){if(null==t)return null;if(!0===n.symbolic)return t;let e={};for(let r=0;r<t.length;r+=2)e[t[r]]=t[r+1];return e}})}};
},{"./alpha":"axtM"}],"RExd":[function(require,module,exports) {
let t=require("./class");module.exports=t.extend({className:"Flattenable",typeSchema:null,flatten:function(t){return this.typeSchema.flatten(this,t)},unflatten:async function(t,e){return Object.assign(this,await this.typeSchema.unflatten(t,e)),await this.onUnflattened(),this},onUnflattened:async function(){}});
},{"./class":"xPXT"}],"tkuZ":[function(require,module,exports) {
let t=require("./flattenable"),i=require("./schema"),e=require("./alpha");module.exports=t.extend({className:"Collection",itemTypeSchema:null,items:null,__ctor:function(t){t||(t=this.itemTypeSchema),t&&(this.typeSchema=i.Property("items").is(i.Array().of(t))),this.reset()},onUnflattened:function(){let t=this.items;this.reset();for(let i of t)this.add(i)},reset:function(){return this.items=[],this},clear:function(){var t=this.items;this.reset();for(var i=0;i<t.length;i++)this.onItemRemoved(t[i],0);return this},sort:function(t,i){return"function"!=typeof t?this.items.sort(function(e,s){return(e[t]<=s[t]?-1:1)*(!0===i?-1:1)}):this.items.sort(t),this},findItem:function(t,i){if(!this.items)return null;for(var s=0;s<this.items.length;s++)if((!i||!e.partialCompare(this.items[s],i))&&e.partialCompare(this.items[s],t))return this.items[s];return null},getItems:function(){return this.items},length:function(){return this.items.length},isEmpty:function(){return!this.items.length},indexOf:function(t){return this.items.indexOf(t)},getAt:function(t,i=!1){return t<0&&1==i&&(t+=this.items.length),t>=0&&t<this.items.length?this.items[t]:null},first:function(){return this.getAt(0)},last:function(){return this.getAt(-1,!0)},addAt:function(t,i){if(!i||!this.onBeforeItemAdded(i))return this;if(t<0&&(t=0),t>this.items.length&&(t=this.items.length),0==t)this.items.unshift(i);else if(t==this.items.length)this.items.push(i);else{var e=this.items.splice(0,t);e.push(i),this.items=e.concat(this.items)}return this.onItemAdded(i),this},unshift:function(t){return this.addAt(0,t)},push:function(t){return this.addAt(this.items.length,t)},add:function(t){return this.push(t)},removeAt:function(t,i=!1){if(t<0&&1==i&&(t+=this.items.length),t<0||t>=this.items.length)return null;var e=this.items[t];return this.items.splice(t,1),this.onItemRemoved(e,t),e},pop:function(t){return this.removeAt(-1,!0)},shift:function(t){return this.removeAt(0)},remove:function(t){return this.removeAt(this.indexOf(t))},forEach:function(t){if(this.isEmpty())return this;for(var i=0;i<this.items.length&&!1!==t(this.items[i],i,this);i++);return this},forEachCall:function(t,...i){if(this.isEmpty())return this;for(var e=0;e<this.items.length&&!1!==this.items[e][t](...i);e++);return this},forEachRev:function(t){if(this.isEmpty())return this;for(var i=this.items.length-1;i>=0&&!1!==t(this.items[i],i,this);i--);return this},forEachRevCall:function(t,...i){if(this.isEmpty())return this;for(var e=this.items.length-1;e>=0&&!1!==this.items[e][t](...i);e--);return this},onBeforeItemAdded:function(t){return!0},onItemAdded:function(t){},onItemRemoved:function(t){}});
},{"./flattenable":"RExd","./schema":"xgn1","./alpha":"axtM"}],"p9x3":[function(require,module,exports) {
let e=require("./alpha"),t=module.exports={strict:!1,parseTemplate:function(r,n,a,l=!1,i=1){let u="string",o=null,f=0,s=0,c="",p=[],g=p,h=!1;function d(r,l){if("template"==r?l=t.parseTemplate(l,n,a,!0,0):"parse"==r?(l=t.parseTemplate(l,n,a,!1,0),r="base-string","array"==e.typeOf(l)&&(r=l[0].type,l=l[0].data)):"parse-trim-merge"==r?l=t.parseTemplate(l.trim().split("\n").map(e=>e.trim()).join("\n"),n,a,!1,0):"parse-merge"==r?l=t.parseTemplate(l,n,a,!1,0):"parse-merge-alt"==r&&(l=t.parseTemplate(l,"{","}",!1,0)),"parse-merge"==r||"parse-merge-alt"==r||"parse-trim-merge"==r)for(let e=0;e<l.length;e++)p.push(l[e]);else p.push({type:r,data:l});h&&(g.push(p=[]),h=!1)}!0===l&&(r=r.trim(),u="identifier",f=10,g.push(p=[])),r+="\0";for(let e=0;e<r.length;e++)if("\\"!=r[e]){switch(f){case 0:"\0"==r[e]?o="string":r[e]==n&&"<"==r[e+1]?(f=1,s=1,o="string",u="parse-merge"):r[e]==n&&"@"==r[e+1]?(f=1,s=1,o="string",u="parse-trim-merge",e++):r[e]==n&&":"==r[e+1]?(f=12,s=1,o="string",u="string",e++):r[e]==n?(f=1,s=1,o="string",u="template"):c+=r[e];break;case 1:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){f=0,o=u;break}}else r[e]==n&&s++;c+=r[e];break;case 10:if("\0"==r[e]){o=u;break}if("."==r[e]){d(u,c),d("access","."),u="identifier",c="";break}if(null!=r[e].match(/[\t\n\r\f\v ]/)){for(o=u,u="identifier",h=!0;null!=r[e].match(/[\t\n\r\f\v ]/);)e++;e--;break}if(r[e]==n&&"<"==r[e+1]){c&&(o=u),f=11,s=1,u="parse-merge";break}if(r[e]==n&&"@"==r[e+1]){c&&(o=u),f=11,s=1,u="parse-trim-merge",e++;break}if('"'==r[e]){c&&(o=u),f=14,s=1,u="parse-merge";break}if("'"==r[e]){c&&(o=u),f=15,s=1,u="parse-merge";break}if("`"==r[e]){c&&(o=u),f=16,s=1,u="parse-merge-alt";break}if(r[e]==n&&":"==r[e+1]){c&&(o=u),f=13,s=1,u="string",e++;break}if(r[e]==n){c&&d(u,c),f=11,s=1,c="",u="parse",c+=r[e];break}"identifier"!=u&&(d(u,c),c="",u="identifier"),c+=r[e];break;case 11:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}else r[e]==n&&s++;c+=r[e];break;case 12:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){0!=c.length&&"<"!=c[0]&&"["!=c[0]&&" "!=c[0]&&(c=n+c+a),f=0,o=u;break}}else r[e]==n&&s++;c+=r[e];break;case 13:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){"<"!=c[0]&&"["!=c[0]&&" "!=c[0]&&(c=n+c+a),f=10;break}}else r[e]==n&&s++;c+=r[e];break;case 14:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if('"'==r[e]){if(--s<0)throw new Error('Parse error: Unmatched "');if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e];break;case 15:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if("'"==r[e]){if(--s<0)throw new Error("Parse error: Unmatched '");if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e];break;case 16:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if("`"==r[e]){if(--s<0)throw new Error("Parse error: Unmatched `");if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e]}o&&(d(o,c),o=c="")}else c+="\\",c+=r[++e];if(!l){let e=0;for(;e<g.length&&"string"==g[e].type&&""==g[e].data;)g.splice(e,1);for(e=g.length-1;e>0&&"string"==g[e].type&&""==g[e].data;)g.splice(e--,1);0==g.length&&g.push({type:"string",data:""})}return i&&function e(t){if("object"==typeof t){if(t instanceof Array)for(let r=0;r<t.length;r++)e(t[r]);else t.data=e(t.data);return t}for(let r=0;r<t.length;r++)if("\\"==t[r]){let e=t[r+1];switch(e){case"n":e="\n";break;case"r":e="\r";break;case"f":e="\f";break;case"v":e="\v";break;case"t":e="\t";break;case"s":e="s";break;case'"':e='"';break;case"'":e="'"}t=t.substr(0,r)+e+t.substr(r+2)}return t}(g),g},parse:function(e){return this.parseTemplate(e.trim(),"[","]",!1)},clean:function(e){for(let t=0;t<e.length;t++)"template"!=e[t].type&&(e.splice(t,1),t--);return e},expand:function(r,n,a="text",l="base-string"){let i=[];if("var"==l){let e=!0,a=!1,l=n,u=null,o=!0,f="";for(let i=0;i<r.length&&null!=n;i++)switch(r[i].type){case"identifier":case"string":f+=r[i].data,u=null;break;case"template":f+="object"!=typeof(u=this.expand(r[i].data,l,"arg","template"))?u:"";break;case"base-string":f+=this.expand(r[i].data,l,"arg","base-string"),u=null;break;case"access":if(u&&"object"==typeof u)n=u;else{for(""==f&&(f="this");;)if("!"==f[0])f=f.substr(1),e=!1;else{if("$"!=f[0])break;f=f.substr(1),a=!0}if("this"!=f&&null!=n){let e=n;null===(n=f in n?n[f]:null)&&o&&f in t.functions&&(n=t.functions[f](null,null,e)),o=!1}}f=""}for(;""!=f;)if("!"==f[0])f=f.substr(1),e=!1;else{if("$"!=f[0])break;f=f.substr(1),a=!0}if("this"!=f){let e=!1;if(null!=n?f in n?n=n[f]:(e=!0,n=null):e=!0,e&&1==r.length&&1==t.strict)throw new Error("Expression function `"+f+"` not found.")}"string"==typeof n&&(e&&(n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a&&(n='"'+n+'"')),i.push(n)}if("varref"==a){let e=n,a=null,l=!0,i="";for(let u=0;u<r.length&&null!=n;u++)switch(r[u].type){case"identifier":case"string":i+=r[u].data,a=null;break;case"template":i+="object"!=typeof(a=this.expand(r[u].data,e,"arg","template"))?a:"";break;case"base-string":i+=this.expand(r[u].data,e,"arg","base-string"),a=null;break;case"access":if(a&&"object"==typeof a)n=a;else{for(""==i&&(i="this");;)if("!"==i[0])i=i.substr(1);else{if("$"!=i[0])break;i=i.substr(1)}if("this"!=i&&null!=n){let e=n;null===(n=i in n?n[i]:null)&&l&&i in t.functions&&(n=t.functions[i](null,null,e)),l=!1}}i=""}for(;""!=i;)if("!"==i[0])i=i.substr(1);else{if("$"!=i[0])break;i=i.substr(1)}return"this"!=i?[n,i]:null}if("fn"==l){var u=[];if(u.push(t.expand(r[0],n,"text","base-string")),"_"+u[0]in t.functions&&(u[0]="_"+u[0]),!(u[0]in t.functions)){if(1==t.strict)throw new Error("Expression function `"+u[0]+"` not found.");return`(Unknown: ${u[0]})`}if("_"==u[0][0])return t.functions[u[0]](r,n);for(let e=1;e<r.length;e++)u.push(t.expand(r[e],n,"arg","base-string"));i.push(t.functions[u[0]](u,r,n))}if("template"==l){if(1==r.length){if(1==r[0].length&&"string"==r[0][0].type)return r[0][0].data;if(1==r[0].length&&"identifier"==r[0][0].type){let e=r[0][0].data;if(e in t.functions||"_"+e in t.functions)return t.expand(r,n,a,"fn")}return t.expand(r[0],n,a,"var")}return t.expand(r,n,a,"fn")}if("base-string"==l){let e=-1;for(let l of r){let u=null;switch(e++,l.type){case"template":u=t.expand(l.data,n,a,"template");break;case"string":case"identifier":u=l.data;break;case"base-string":u=t.expand(l.data,n,a,"base-string")}"void"!=a&&("last"==a&&e!=r.length-1||i.push(u))}}if("obj"==a)return i;if("last"==a)return"Rose\\Arry"==typeOf(i)&&(i=i[0]),i;if("void"==a)return null;if("arg"==a)return"array"==e.typeOf(i)?1!=i.length?i.join(""):i[0]:i;if("text"==a&&"array"==e.typeOf(i)){let e=t=>null!=t&&"object"==typeof t?"map"in t?t.map(e).join(""):"join"in t?t.join(""):t.toString():t;i=i.map(e).join("")}return i},compile:function(e){return e=t.parse(e),function(r=null,n="text"){return t.expand(e,r||{},n)}},eval:function(e,r=null,n="text"){return e=t.parse(e),t.expand(e,r||{},n)},value:function(r,n=null){return"array"!=e.typeOf(r)?r:t.expand(r,n||{},"arg")},register:function(e,r){t.functions[e]=r},call:function(e,r,n=null){return e in t.functions?t.functions[e](r,null,n):null},getNamedValues:function(e,r,n=1,a=!0){let l={},i=0;for(;n<e.length;n+=2){let u=t.expand(e[n],r,"arg");i||(i=u.startsWith(":")?1:u.endsWith(":")?2:3),1==i?u=u.substr(1):2==i&&(u=u.substr(0,u.length-1)),l[u]=a?t.expand(e[n+1],r,"arg"):e[n+1]}return l}};t.functions={null:function(e){return null},true:function(e){return!0},false:function(e){return!1},len:function(e){return e[1].toString().length},int:function(e){return~~e[1]},str:function(e){return e[1].toString()},float:function(e){return parseFloat(e[1])},chr:function(e){return String.fromCharCode(e[1])},ord:function(e){return e[1].toString().charCodeAt(0)},not:function(e){return!e[1]},neg:function(e){return-e[1]},abs:function(e){return Math.abs(e[1])},and:function(e){for(let t=1;t<e.length;t++)if(!e[t])return!1;return!0},or:function(e){for(let t=1;t<e.length;t++)if(~~e[t])return!0;return!1},eq:function(e){return e[1]==e[2]},ne:function(e){return e[1]!=e[2]},lt:function(e){return e[1]<e[2]},le:function(e){return e[1]<=e[2]},gt:function(e){return e[1]>e[2]},ge:function(e){return e[1]>=e[2]},isnotnull:function(e){return!!e[1]},isnull:function(e){return!e[1]},iszero:function(e){return 0==parseInt(e[1])},"eq?":function(e){return e[1]==e[2]},"ne?":function(e){return e[1]!=e[2]},"lt?":function(e){return e[1]<e[2]},"le?":function(e){return e[1]<=e[2]},"gt?":function(e){return e[1]>e[2]},"ge?":function(e){return e[1]>=e[2]},"notnull?":function(e){return!!e[1]},"null?":function(e){return!e[1]},"zero?":function(e){return 0==parseInt(e[1])},typeof:function(t){return e.typeOf(t[1])},"*":function(e){let t=e[1];for(let r=2;r<e.length;r++)t*=e[r];return t},"/":function(e){let t=e[1];for(let r=2;r<e.length;r++)t/=e[r];return t},"+":function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=-e[r];return t},"-":function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=e[r];return t},mul:function(e){let t=e[1];for(let r=2;r<e.length;r++)t*=e[r];return t},div:function(e){let t=e[1];for(let r=2;r<e.length;r++)t/=e[r];return t},sum:function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=-e[r];return t},sub:function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=e[r];return t},mod:function(e){let t=e[1];for(let r=2;r<e.length;r++)t%=e[r];return t},pow:function(e){let t=e[1];for(let r=2;r<e.length;r++)t=Math.pow(t,e[r]);return t},json:function(e){return JSON.stringify(e[1])},_set:function(e,r){for(let n=1;n+1<e.length;n+=2){let a=t.value(e[n+1],r);if(e[n].length>1){let l=t.expand(e[n],r,"varref");null!=l&&(l[0][l[1]]=a)}else r[t.value(e[n],r)]=a}return""},_unset:function(e,r){for(let n=1;n<e.length;n++)if(e[n].length>1){let a=t.expand(e[n],r,"varref");null!=a&&delete a[0][a[1]]}else delete r[t.value(e[n],r)];return null},trim:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.trim()):e[1].trim():""},upper:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.toUpperCase()):e[1].toUpperCase():""},lower:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.toLowerCase()):e[1].toLowerCase():""},substr:function(e){let t=e[e.length-1].toString(),r=0,n=null;return 4==e.length?(r=~~e[1],n=~~e[2]):(r=~~e[1],n=null),r<0&&(r+=t.length),n<0&&(n+=t.length),null===n&&(n=t.length-r),t.substr(r,n)},replace:function(e){return e[3].split(e[1]).join(e[2])},nl2br:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.replace(/\n/g,"<br/>")):e[1].replace(/\n/g,"<br/>"):""},"%":function(t){t.shift();var r=t.shift();let n="";for(let a=0;a<t.length;a++)if("array"==e.typeOf(t[a])){n+=`<${r}>`;for(let e=0;e<t[a].length;e++)n+=t[a][e];n+=`</${r}>`}else n+=`<${r}>${t[a]}</${r}>`;return n},"%%":function(e){e.shift();var t=e.shift();let r="",n="";for(let a=0;a<e.length;a+=2)a+1<e.length?r+=` ${e[a]}="${e[a+1]}"`:n=e[a];return n?`<${t}${r}>${n}</${t}>`:`<${t}${r}/>`},join:function(t){return t[2]&&"array"==e.typeOf(t[2])?t[2].join(t[1]):""},split:function(e){return e[2]&&"string"==typeof e[2]?e[2].split(e[1]):[]},keys:function(e){return e[1]&&"object"==typeof e[1]?Object.keys(e[1]):[]},values:function(e){return e[1]&&"object"==typeof e[1]?Object.values(e[1]):[]},_each:function(e,r){let n=t.expand(e[1],r,"arg"),a=t.expand(e[2],r,"arg"),l=[],i=0;if(!a)return l;for(let u in a)r[n]=a[u],r[n+"##"]=i++,r[n+"#"]=u,l.push(t.expand(e[3],r,"text"));return delete r[n],delete r[n+"##"],delete r[n+"#"],l},_foreach:function(e,r){let n=t.expand(e[1],r,"arg"),a=t.expand(e[2],r,"arg"),l=0;if(!a)return null;for(let i in a)r[n]=a[i],r[n+"##"]=l++,r[n+"#"]=i,t.expand(e[3],r,"text");return delete r[n],delete r[n+"##"],delete r[n+"#"],null},"_?":function(e,r){return t.expand(e[1],r,"arg")?t.expand(e[2],r,"arg"):e.length>3?t.expand(e[3],r,"arg"):""},"_??":function(e,r){let n=t.expand(e[1],r,"arg");return n||t.expand(e[2],r,"arg")},_if:function(e,r){for(let n=0;n<e.length;n+=3){if("else"==t.expand(e[n],r,"arg"))return t.expand(e[n+1],r,"text");if(t.expand(e[n+1],r,"arg"))return t.expand(e[n+2],r,"text")}return""},_switch:function(e,r){let n=t.expand(e[1],r,"arg");for(let a=2;a<e.length;a+=2){let l=t.expand(e[a],r,"arg");if(l==n||"default"==l)return t.expand(e[a+1],r,"text")}return""},_break:function(e,t){throw new Error("EXC_BREAK")},_continue:function(e,t){throw new Error("EXC_CONTINUE")},_repeat:function(e,r){if(e.length<3||1!=(1&e.length))return"(`repeat`: Wrong number of parameters)";let n=t.value(e[1],r),a=null,l=0,i=null,u=null;for(let c=2;c<e.length-1;c+=2){switch(t.value(e[c],r).toLowerCase()){case"from":l=parseFloat(t.value(e[c+1],r));break;case"to":i=parseFloat(t.value(e[c+1],r));break;case"count":a=parseFloat(t.value(e[c+1],r));break;case"step":u=parseFloat(t.value(e[c+1],r))}}let o=e[e.length-1],f=[];if(null!==i)if(null===u&&(u=l>i?-1:1),u<0)for(let c=l;c>=i;c+=u)try{r[n]=c,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}else for(let c=l;c<=i;c+=u)try{r[n]=c,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}else if(null!==a){null===u&&(u=1);for(let e=l;a>0;a--,e+=u)try{r[n]=e,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}}else{null===u&&(u=1);for(let e=l;;e+=u)try{r[n]=e,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}}return delete r[n],f},_for:function(e,r){if(e.length<3||1!=(1&e.length))return"(`for`: Wrong number of parameters)";let n=t.value(e[1],r),a=null,l=0;to=null;let i=null;for(let f=2;f<e.length-1;f+=2)switch(value=t.value(e[f],r),value.toLowerCase()){case"from":l=parseFloat(t.value(e[f+1],r));break;case"to":to=parseFloat(t.value(e[f+1],r));break;case"count":a=parseFloat(t.value(e[f+1],r));break;case"step":i=parseFloat(t.value(e[f+1],r))}let u=e[e.length-1];if(null!==to)if(null===i&&(i=l>to?-1:1),i<0)for(let f=l;f>=to;f+=i)try{r[n]=f,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}else for(let f=l;f<=to;f+=i)try{r[n]=f,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}else if(null!==a){null===i&&(i=1);for(let e=l;a>0;a--,e+=i)try{r[n]=e,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}}else{null===i&&(i=1);for(let e=l;;e+=i)try{r[n]=e,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}}return delete r[n],null},_loop:function(e,r){if(e.length<2)return"(`loop`: Wrong number of parameters)";let n=e[1];for(;;)try{t.value(n,r)}catch(a){let e=a.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw a}return null},_echo:function(e,r){let n="";for(let a=1;a<e.length;a++)n+=t.expand(e[a],r,"arg");return console.log(n),""},"_#":function(e,r){let n=[];for(let a=1;a<e.length;a++)n.push(t.expand(e[a],r,"arg"));return n},"_##":function(e,t){let r=[];for(let n=1;n<e.length;n++)r.push(e[n]);return r},"_&":function(e,r){return t.getNamedValues(e,r,1,!0)},"_&&":function(e,r){return t.getNamedValues(e,r,1,!1)},contains:function(e,t,r){let n=e[1];if("object"!=typeof n)return r.err="Argument is not a Map",!1;let a="";for(let l=2;l<e.length;l++)e[l]in n||(a+=", "+e[l]);return""==a||(r.err=a.substr(1),!1)},has:function(t,r,n){let a=t[2];return"object"==e.typeOf(a)&&t[1]in a},_map:function(r,n){let a=t.expand(r[1],n,"arg"),l=t.expand(r[2],n,"arg");if(!l)return l;let i="array"==e.typeOf(l),u=i?[]:{},o=0;for(let e in l)n[a]=l[e],n[a+"##"]=o++,n[a+"#"]=e,i?u.push(t.expand(r[3],n,"arg")):u[e]=t.expand(r[3],n,"arg");return delete n[a],delete n[a+"##"],delete n[a+"#"],u},_filter:function(r,n){let a=t.expand(r[1],n,"arg"),l=t.expand(r[2],n,"arg");if(!l)return l;let i="array"==e.typeOf(l),u=i?[]:{},o=0;for(let e in l)n[a]=l[e],n[a+"##"]=o++,n[a+"#"]=e,~~t.expand(r[3],n,"arg")&&(i?u.push(l[e]):u[e]=l[e]);return delete n[a],delete n[a+"##"],delete n[a+"#"],u},expand:function(e,r,n){return t.expand(t.parseTemplate(e[1],"{","}"),3==e.length?e[2]:n)},_call:function(e,r){let n=t.expand(e[1],r,"varref");if(!n||"function"!=typeof n[0][n[1]])throw new Error("Expression is not a function: "+t.expand(e[1],r,"obj").map(e=>null==e?".":e).join(""));let a=[];for(let l=2;l<e.length;l++)a.push(t.value(e[l],r));return n[0][n[1]](...a)}};
},{"./alpha":"axtM"}],"OHwo":[function(require,module,exports) {
let e=require("./alpha");e.Rin=e,e.Class=require("./class"),e.Event=require("./event"),e.EventDispatcher=require("./event-dispatcher"),e.Model=require("./model"),e.ModelList=require("./model-list"),e.Schema=require("./schema"),e.Flattenable=require("./flattenable"),e.Collection=require("./collection"),e.Template=require("./template"),Object.assign(module.exports,e);
},{"./alpha":"axtM","./class":"xPXT","./event":"K4NB","./event-dispatcher":"aK92","./model":"rbeK","./model-list":"J25A","./schema":"xgn1","./flattenable":"RExd","./collection":"tkuZ","./template":"p9x3"}],"X2Ny":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={},t={};var o=t;exports.default=o,t.attachTo=function(t,o){if(o||(o=1024),!t.prototype.className)throw new Error("Unable to attach recycler functions to unnamed class.");e[t.prototype.className]=t,t.recyclerPool=[],t.prototype.objectId=0,t.nextObjectId=0,t.createdItems=0,t.restoredItems=0,t.recycledItems=0,t.alloc=function(){var e;return this.recyclerPool.length?(e=this.recyclerPool.pop(),t.restoredItems++):(e=new t,t.createdItems++),"__reinit"in e&&e.__reinit.apply(e,arguments),e.objectId=++this.nextObjectId,this.nextObjectId=1073741823&this.nextObjectId,e},t.prototype.dispose=function(e){0!=this.objectId?("__dtor"in this&&this.__dtor(),t.recycledItems++,this.objectId=0,this.disposeReason=e,t.recyclerPool.length<o&&t.recyclerPool.push(this)):console.error("Already disposed ("+t.prototype.className+"): "+e+" / "+this.disposeReason)}},t.showStats=function(){for(var t in console.group("Recycling Facilities"),e){var o=e[t];console.debug(t+": created="+o.createdItems+", restored="+o.restoredItems+", recycled="+o.recycledItems+", available="+o.recyclerPool.length)}console.groupEnd()};
},{}],"KbP4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@rsthn/rin"),t=n(require("./recycler.js"));function n(e){return e&&e.__esModule?e:{default:e}}const r=e.Class.extend({className:"Linkable",prev:null,next:null,value:null,__ctor:function(e){this.value=e,this.clear()},__reinit:function(e){return this.value=e,this.clear(),this},__dtor:function(){},clear:function(){return this.next=this.prev=null,this},linkAfter:function(e){this.prev=e,this.next=e?e.next:null,e&&(e.next&&(e.next.prev=this),e.next=this)},linkBefore:function(e){this.prev=e?e.prev:null,this.next=e,e&&(e.prev&&(e.prev.next=this),e.prev=this)},unlink:function(){return this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.clear()}});t.default.attachTo(r);var i=r;exports.default=i;
},{"@rsthn/rin":"OHwo","./recycler.js":"X2Ny"}],"j8vy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin"),n=o(require("./linkable.js"));function o(t){return t&&t.__esModule?t:{default:t}}var e=t.Class.extend({className:"List",top:null,bottom:null,count:0,__ctor:function(){this.top=null,this.bottom=null,this.count=0},__dtor:function(){this.reset()},clear:function(){var t,n;for(t=this.top;null!=t;t=n)n=t.next,dispose(t.value),dispose(t);return this.top=this.bottom=null,this.count=0,this},reset:function(){var t,n;for(t=this.top;null!=t;t=n)n=t.next,dispose(t);return this.top=this.bottom=null,this.count=0,this},getAt:function(t){var n=null;for(n=this.top;n&&t--;n=n.next);return null!=n?n.value:null},getNodeAt:function(t){var n=null;for(n=this.top;n&&t--;n=n.next);return n},sgetNode:function(t){for(var n=this.top;n;n=n.next)if(n.value==t)return n;return null},remove:function(t){if(null==t||"isInstanceOf"in t&&t.isInstanceOf(n.default)||(t=this.sgetNode(t)),!t)return null;t.prev||(this.top=t.next),t.next||(this.bottom=t.prev),this.count--;var o=t.unlink().value;return dispose(t),o},insertBefore:function(t,o){if(!t)return this;var e=n.default.alloc(o);return e.linkBefore(t),t==this.top&&(this.top=e),this.count++,o},insertAfter:function(t,o){if(!t)return this;var e=n.default.alloc(o);return e.linkAfter(t),t==this.bottom&&(this.bottom=e),this.count++,o},unshift:function(t){var o=n.default.alloc(t);return o.linkBefore(this.top),this.bottom||(this.bottom=o),this.top=o,this.count++,t},shift:function(){var t=this.top;if(!t)return null;(this.top=t.next)||(this.bottom=null),this.count--;var n=t.unlink().value;return dispose(t),n},push:function(t){var o=n.default.alloc(t);return o.linkAfter(this.bottom),this.top||(this.top=o),this.bottom=o,this.count++,t},pop:function(){var t=this.bottom;if(!t)return null;(this.bottom=t.prev)||(this.top=null),this.count--;var n=t.unlink().value;return dispose(t),n},append:function(t){for(var n=t.top;n;n=n.next)this.push(n.value);return this},forEach:function(t){let n;for(let o=this.top;o;o=n)if(n=o.next,!1===t(o.value,o,this))return!1;return!0},forEachRev:function(t){let n;for(let o=this.bottom;o;o=n)if(n=o.prev,!1===t(o.value,o,this))return!1;return!0},find:function(t){let n=null;return this.forEach(function(o){if(t(o))return n=o,!1}),n},filter:function(t){let n=[];return this.forEach(function(o){t(o)&&n.push(o)}),n}});exports.default=e;
},{"@rsthn/rin":"OHwo","./linkable.js":"KbP4"}],"D2RU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=function(t,i){this.callback=i,this.interval=t};t.prototype.onTimeout=function(){if(this.isRunning){this.rTime=hrnow()-this.startTime;var t=this.rTime-(this.sTime+this.interval);t<0?this.runAfter(-t):(this.sTime+=this.interval*(1+int(t/this.interval)),this.tDelta=t<0?this.interval:this.rTime-this.lTime,this.lTime=this.rTime,this.callback(this.tDelta,this),this.runAfter(this.sTime+this.interval-(hrnow()-this.startTime)))}},t.prototype.onStart=function(){},t.prototype.start=function(t=!1,i=1){this.startTime=hrnow(),this.sTime=0,this.lTime=0,this.lastTime=hrnow(),this.isRunning=!0,this.onStart(),t&&this.callback(0,this),this.runAfter(this.interval*i)},t.prototype.runAfter=function(t){requestAnimationFrame(()=>this.onTimeout())},t.prototype.stop=function(){this.isRunning=!1};var i=t;exports.default=i;
},{}],"YOKs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=function(){this.data=[1,0,0,0,1,0,0,0,1]};var a=t;exports.default=a,t.prototype.toString=function(){return"[".concat(this.data[0],", ").concat(this.data[3],", ").concat(this.data[6],"]\n[").concat(this.data[1],", ").concat(this.data[4],", ").concat(this.data[7],"]\n[").concat(this.data[2],", ").concat(this.data[5],", ").concat(this.data[8],"]\n")},t.prototype.zero=function(){return this.data.fill(0),this},t.prototype.fill=function(t){return this.data.fill(t),this},t.prototype.set=function(a){if(a instanceof t)for(let t=0;t<9;t++)this.data[t]=a.data[t];else if(a instanceof Array)for(let t=0;t<9;t++)this.data[t]=a[t];else abort();return this},t.prototype.identity=function(){return this.data.fill(0),this.data[0]=this.data[4]=this.data[8]=1,this},t.prototype.scalef=function(t){for(let a=0;a<9;a++)this.data[a]*=t;return this},t.prototype.clone=function(){for(var a=new t,d=0;d<9;d++)a.data[d]=this.data[d];return a},t.prototype.append=function(a){var d,i,o,s,n=[1,0,0,0,1,0,0,0,1];for(a instanceof t&&(a=a.data),i=0;i<3;i++)for(d=0;d<3;d++){for(s=0,o=0;o<3;o++)s+=a[3*i+o]*this.data[3*o+d];n[3*i+d]=s}for(d=0;d<9;d++)this.data[d]=n[d];return this},t.prototype.translate=function(t,a){return 0==t&&0==a?this:this.append([1,0,0,0,1,0,t,a,1])},t.prototype.rotate=function(t){return 0==t?this:this.append([Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1])},t.prototype.scale=function(t,a){return 1==t&&1==a?this:this.append([t,0,0,0,a,0,0,0,1])},t.prototype.applyTo=function(t,a){return{x:this.data[0]*t+this.data[3]*a+this.data[6],y:this.data[1]*t+this.data[4]*a+this.data[7]}},t.prototype.transpose=function(){for(var t=[0,0,0,0,0,0,0,0,0],a=0;a<3;a++)for(var d=0;d<3;d++)t[3*a+d]=this.data[3*d+a];for(let i=0;i<9;i++)this.data[i]=t[i];return this},t.prototype.det=function(){return this.data[0]*(this.data[4]*this.data[8]-this.data[5]*this.data[7])-this.data[1]*(this.data[3]*this.data[8]-this.data[5]*this.data[6])+this.data[2]*(this.data[3]*this.data[7]-this.data[4]*this.data[6])},t.prototype.adj=function(){var t=this.transpose(),a=[];return a[0]=t.data[4]*t.data[8]-t.data[5]*t.data[7],a[1]=-(t.data[3]*t.data[8]-t.data[5]*t.data[6]),a[2]=t.data[3]*t.data[7]-t.data[4]*t.data[6],a[3]=-(t.data[1]*t.data[8]-t.data[2]*t.data[7]),a[4]=t.data[0]*t.data[8]-t.data[2]*t.data[6],a[5]=-(t.data[0]*t.data[7]-t.data[1]*t.data[6]),a[6]=t.data[1]*t.data[5]-t.data[2]*t.data[4],a[7]=-(t.data[0]*t.data[5]-t.data[2]*t.data[3]),a[8]=t.data[0]*t.data[4]-t.data[1]*t.data[3],t.data=a,t},t.prototype.inverse=function(){var t=this.det();return t?this.adj().scalef(1/t):null};
},{}],"wkWf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./system.js"));function t(e){return e&&e.__esModule?e:{default:e}}const a={enabled:!1,data:[],count:0,maxsize:30,debugEcho:!1,color:"#fff",background:"#000",vars:{},write:function(e){for(this.data.push(e),this.count++;this.data.length>this.maxsize;)this.data.shift();this.debugEcho&&console.debug(this.count+": "+e)},clear:function(){this.data=[],this.count=0},enable:function(t,l,r,o,i){if(this.enabled)return;this.enabled=!0,t||(t=0),l||(l=0),r||(r=8.5),!1===o&&(l-=16);let d=l;e.default.drawQueueAdd({draw:function(u,s){s.clear(),s.font("normal "+r+"pt 'Bitstream Vera Sans Mono', monospace"),s.textBaseline("top");var f=(e.default.perf.lastTime-e.default.perf.startTime)/1e3,n=e.default.perf.numFrames,c="";l=d,!1!==o&&(c="fps: "+(n/f).toFixed(2)+", dt: "+(1e3/(n/f)).toFixed(2)+" ms, update: "+(e.default.perf.updateTime/n).toFixed(2)+" ms, draw: "+(e.default.perf.drawTime/n).toFixed(2)+" ms",a.background&&(s.fillStyle(a.background),s.fillRect(t+8-3,l+10-1,s.measureText(c)+6,r+4)),s.fillStyle(a.color),s.fillText(c,t+8,l+10)),c="";for(let e in a.vars)c+=e+"="+a.vars[e]+"  ";c&&(l+=24,a.background&&(s.fillStyle(a.background),s.fillRect(t+8-3,l+10-1,s.measureText(c)+6,r+4)),s.fillStyle(a.color),s.fillText(c,t+8,l+10));for(var h=0;h<a.data.length;h++)c=(!1!==i?"#"+(a.count-a.data.length+h+1)+": ":"> ")+a.data[h],a.background&&(s.fillStyle(a.background),s.fillRect(t+8-3,l+16+(r+4)*(h+1)-1,s.measureText(c)+6,r+4)),s.fillStyle(a.color),s.fillText(c,t+8,l+16+(r+4)*(h+1))}})}};var l=a;exports.default=l;
},{"./system.js":"tYB4"}],"sUEe":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@rsthn/rin"),i=n(require("../math/matrix.js")),r=n(require("./log.js"));function n(t){return t&&t.__esModule?t:{default:t}}const o=function(n=null){let s={elem:null,gl:!1,background:"#000",width:0,height:0,hidden:!0,absolute:!1,antialias:!1,...n};null==s.elem?(this.elem=t.document?t.document.createElement("canvas"):e.Rin.clone(o.passThruCanvas),t.document&&1!=s.hidden&&(t.document.body.appendChild(this.elem),!0===s.absolute&&(this.elem.style.position="absolute",this.elem.style.left="0",this.elem.style.top="0"))):this.elem=elem,this.elem.getContext&&(!0===s.gl?(this.gl=this.elem.getContext("webgl2"),this.context=null,r.default.write(this.gl.getParameter(this.gl.VERSION)),r.default.write(this.gl.getParameter(this.gl.SHADING_LANGUAGE_VERSION)),this.initGl()):(this.context=this.elem.getContext("2d"),this.gl=null),this.antialias=s.antialias,this.setBackground(s.background),this.matrixStack=[],this.alphaStack=[],this.matr=new i.default,this._alpha=1,this._globalScale=1,this.matr.identity(),null!=this.context&&(this.updateTransform(),this.strokeStyle("#fff"),this.fillStyle("#fff")),this.resize(s.width,s.height))};o.passThruCanvas={parentNode:null,imageSmoothingEnabled:!0,style:{},width:950,height:540,getContext:function(t){return this},save:function(){},restore:function(){},scale:function(t,e){},rotate:function(t){},translate:function(t,e){},setTransform:function(t,e,i,r,n,o){},updateTransform:function(){},toDataURL:function(t,e){return""},beginPath:function(){},moveTo:function(t,e){},closePath:function(){},lineTo:function(){},rect:function(t,e,i,r){},fill:function(){},stroke:function(){},fillRect:function(t,e,i,r){},strokeRect:function(t,e,i,r){},clip:function(){},quadraticCurveTo:function(t,e,i,r){},bezierCurveTo:function(t,e,i,r,n,o){},arc:function(t,e,i,r,n,o){},arcTo:function(t,e,i,r,n){},fillText:function(t,e,i,r){},strokeText:function(t,e,i,r){},measureText:function(t){return{width:0}},createImageData:function(t,e){return{width:t,height:e}},getImageData:function(t,e,i,r){return{width:i,height:r,data:[]}},putImageData:function(t,e,i){},drawImage:function(...t){},getBoundingClientRect:function(){return{left:0,top:0}}},o.prototype.buildShader=function(t,e,i){const r=this.gl,n=r.createShader(e);if(r.shaderSource(n,i),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("compilerShader: "+r.getShaderInfoLog(n));r.attachShader(t,n)},o.prototype.initGl=function(){let t=this.gl;if(this.gl_array_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.gl_array_buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.gl_program=t.createProgram(),this.buildShader(this.gl_program,t.VERTEX_SHADER,"#version 300 es\n\n\t\tin vec2 location;\n\n\t\tuniform vec2 screen_size;\n\t\tuniform vec2 texture_size;\n\t\tuniform mat3 location_matrix;\n\t\tuniform mat3 texture_matrix;\n\t\tuniform mat3 current_matrix;\n\t\tuniform sampler2D texture;\n\n\t\tout vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(((vec2(current_matrix*location_matrix*vec3(location, 1.0))/screen_size)*2.0-vec2(1.0, 1.0))*vec2(1.0, -1.0), 0.0, 1.0);\n\t\t\tf_texcoords = vec2(texture_matrix*vec3(location, 1.0))/texture_size;\n\t\t}\n\t"),this.buildShader(this.gl_program,t.FRAGMENT_SHADER,"#version 300 es\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tex;\n\t\tin vec2 f_texcoords;\n\n\t\tout vec4 color;\n\n\t\tvoid main() {\n\t\t\tcolor = texture(tex, f_texcoords);\n\t\t}\n\t"),t.linkProgram(this.gl_program),!t.getProgramParameter(this.gl_program,t.LINK_STATUS))throw new Error("linkProgram: "+t.getProgramInfoLog(program));t.useProgram(this.gl_program),t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.clearDepth(0),t.depthFunc(t.GEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.gl_attrib_location=t.getAttribLocation(this.gl_program,"location"),this.gl_uniform_screen_size=t.getUniformLocation(this.gl_program,"screen_size"),this.gl_uniform_texture_size=t.getUniformLocation(this.gl_program,"texture_size"),this.gl_uniform_texture=t.getUniformLocation(this.gl_program,"texture"),this.gl_uniform_matrix=t.getUniformLocation(this.gl_program,"location_matrix"),this.gl_uniform_current_matrix=t.getUniformLocation(this.gl_program,"current_matrix"),this.gl_uniform_texture_matrix=t.getUniformLocation(this.gl_program,"texture_matrix"),t.enableVertexAttribArray(this.gl_attrib_location),t.vertexAttribPointer(this.gl_attrib_location,2,t.FLOAT,t.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0*Float32Array.BYTES_PER_ELEMENT),this.location_matrix=new i.default,this.texture_matrix=new i.default,this.drawImage=function(...e){const i=e[0],r=e[1],n=e[2];if(!i.gl_ready)return;if(this.gl_active_texture!=i.gl_texture&&(this.gl.activeTexture(t.TEXTURE0),this.gl.bindTexture(t.TEXTURE_2D,i.gl_texture),this.gl.uniform1i(this.gl_uniform_texture,0),this.gl.uniform2fv(this.gl_uniform_texture_size,[i.width,i.height]),this.gl_active_texture=i.gl_texture),3==e.length)return 0==r&&0==n?(this.location_matrix.identity(),this.location_matrix.scale(i.width,i.height),this.gl.uniformMatrix3fv(this.gl_uniform_current_matrix,!1,this.matr.data),this.gl.uniformMatrix3fv(this.gl_uniform_matrix,!1,this.location_matrix.data),this.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix,!1,this.location_matrix.data),void this.gl.drawArrays(t.TRIANGLE_STRIP,0,4)):(this.location_matrix.identity(),this.location_matrix.translate(r,n),this.location_matrix.scale(i.width,i.height),this.texture_matrix.identity(),this.texture_matrix.scale(i.width,i.height),this.gl.uniformMatrix3fv(this.gl_uniform_current_matrix,!1,this.matr.data),this.gl.uniformMatrix3fv(this.gl_uniform_matrix,!1,this.location_matrix.data),this.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix,!1,this.texture_matrix.data),void this.gl.drawArrays(t.TRIANGLE_STRIP,0,4));const o=e[3],s=e[4];if(5==e.length)return;const a=e[5],h=e[6],l=e[7],u=e[8];this.location_matrix.identity(),this.location_matrix.translate(a,h),this.location_matrix.scale(l,u),this.texture_matrix.identity(),this.texture_matrix.translate(r,n),this.texture_matrix.scale(o,s),this.gl.uniformMatrix3fv(this.gl_uniform_current_matrix,!1,this.matr.data),this.gl.uniformMatrix3fv(this.gl_uniform_matrix,!1,this.location_matrix.data),this.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix,!1,this.texture_matrix.data),this.gl.drawArrays(t.TRIANGLE_STRIP,0,4)}},o.prototype.prepareImage=function(t){let e=this.gl;if(null==e)return!1;let i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.gl_texture=i,t.gl_ready=!0,!0},o.prototype.applyConfig=function(){0==this.antialias?(null!=this.context&&(this.context.imageSmoothingEnabled=!1),this.elem.style.imageRendering="crisp-edges"):(null!=this.context&&(this.context.imageSmoothingEnabled=!0),this.elem.style.imageRendering="auto")},o.prototype.dispose=function(){this.elem.parentNode&&this.elem.parentNode.removeChild(this.elem),this.matrixStack=null,this.alphaStack=null,this.matr=null,this.context=null,this.elem=null},o.prototype.setBackground=function(t,e){this.elem.style.background=t,this.backgroundColor=e||t},o.prototype.resize=function(t,e){let i=this.elem.getBoundingClientRect();return t||(t=i.width),e||(e=i.height),this.elem.width=t,this.elem.height=e,this.width=this.elem.width,this.height=this.elem.height,this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale),null!=this.gl&&(this.gl.viewport(0,0,t,e),this.gl_uniform_screen_size&&this.gl.uniform2fv(this.gl_uniform_screen_size,[t,e]),this.gl.enable(this.gl.SCISSOR_TEST),this.gl.scissor(0,0,t,e)),this.applyConfig(),this},o.prototype.globalScale=function(t){return this._globalScale=t,this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale),this.loadIdentity(),this.scale(t,t),this},o.prototype.flipped=function(t){return t?(this._width=~~(this.height/this._globalScale),this._height=~~(this.width/this._globalScale)):(this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale)),this},o.prototype.save=function(){return this.context.save(),this},o.prototype.restore=function(){return this.context.restore(),this},o.prototype.toDataUrl=function(t="image/png",e=null){return this.elem.toDataURL(t,e)},o.prototype.toPng64=function(){return this.elem.toDataURL("image/png").substr(22)},o.prototype._contextAttribute=function(t,e){if(void 0!==e){if(!this.context)throw new Error("Unable to set attribute: "+t);return this.context[t]=e,this}return this.context[t]},o.prototype.fillStyle=function(t){return this._contextAttribute("fillStyle",t)},o.prototype.strokeStyle=function(t){return this._contextAttribute("strokeStyle",t)},o.prototype.lineCap=function(t){return this._contextAttribute("lineCap",t)},o.prototype.lineJoin=function(t){return this._contextAttribute("lineJoin",t)},o.prototype.lineWidth=function(t){return this._contextAttribute("lineWidth",t)},o.prototype.miterLimit=function(t){return this._contextAttribute("miterLimit",t)},o.prototype.shadowColor=function(t){return this._contextAttribute("shadowColor",t)},o.prototype.shadowOffsetX=function(t){return this._contextAttribute("shadowOffsetX",t)},o.prototype.shadowOffsetY=function(t){return this._contextAttribute("shadowOffsetY",t)},o.prototype.shadowBlur=function(t){return this._contextAttribute("shadowBlur",t)},o.prototype.font=function(t){return this._contextAttribute("font",t)},o.prototype.textAlign=function(t){return this._contextAttribute("textAlign",t)},o.prototype.textBaseline=function(t){return this._contextAttribute("textBaseline",t)},o.prototype.globalAlpha=function(t){return void 0===t?this._alpha:(this._alpha=t,this.alpha(1))},o.prototype.alpha=function(t){return this._alpha*=t,this.context&&(this.context.globalAlpha=this._alpha),this},o.prototype.globalCompositeOperation=function(t){return this._contextAttribute("globalCompositeOperation",t)},o.prototype.updateTransform=function(){return null==this.context?this:(this.context.setTransform(this.matr.data[0],this.matr.data[1],this.matr.data[3],this.matr.data[4],this.matr.data[6],this.matr.data[7]),this)},o.prototype.setTransform=function(t,e,i,r,n,o){return this.context.setTransform(t,e,i,r,n,o),this},o.prototype.fillRect=function(t,e,i,r){return this.context.fillRect(t,e,i,r),this},o.prototype.strokeRect=function(t,e,i,r){return this.context.strokeRect(t,e,i,r),this},o.prototype.clearRect=function(t,e,i,r){return this.context.clearRect(t,e,i,r),this},o.prototype.beginPath=function(){return this.context.beginPath(),this},o.prototype.moveTo=function(t,e){return this.context.moveTo(t,e),this},o.prototype.closePath=function(){return this.context.closePath(),this},o.prototype.lineTo=function(t,e){return this.context.lineTo(t,e),this},o.prototype.rect=function(t,e,i,r){return this.context.rect(t,e,i,r),this},o.prototype.fill=function(t){return t&&this.fillStyle(t),this.context.fill(),this},o.prototype.stroke=function(t){return t&&this.strokeStyle(t),this.context.stroke(),this},o.prototype.clip=function(t,e,i,r){return null!=this.gl?this.gl.scissor(t,e,i,r):(this.beginPath(),this.rect(t,e,i,r),this.context.clip()),this},o.prototype.quadraticCurveTo=function(t,e,i,r){return this.context.quadraticCurveTo(t,e,i,r),this},o.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this.context.bezierCurveTo(t,e,i,r,n,o),this},o.prototype.arc=function(t,e,i,r,n,o){return this.context.arc(t,e,i,r,n,o),this},o.prototype.arcTo=function(t,e,i,r,n){return this.context.arcTo(t,e,i,r,n),this},o.prototype.fillText=function(t,e,i,r){return this.context.fillText(t,e,i,r||1e3),this},o.prototype.strokeText=function(t,e,i,r){return this.context.strokeText(t,e,i,r||1e3),this},o.prototype.measureText=function(t){return this.context.measureText(t).width},o.prototype.createImageData=function(t,e){return this.context.createImageData(t,e)},o.prototype.getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},o.prototype.putImageData=function(t,e,i){return this.context.putImageData(t,e,i),this},o.prototype.drawImage=function(...t){if(3==t.length)this.context.drawImage(t[0],~~t[1],~~t[2]);else if(5==t.length)this.context.drawImage(t[0],~~t[1],~~t[2],~~t[3],~~t[4]);else if(9==t.length){var e=~~t[3],i=~~t[4];if(!e||!i)return this;var r=~~t[7],n=~~t[8];if(!r||!n)return this;this.context.drawImage(t[0],~~t[1],~~t[2],e,i,~~t[5],~~t[6],r,n)}return this},o.prototype.clear=function(t){return null!=this.gl?(this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.gl_active_texture=null,this):(t?this.globalCompositeOperation("source-over").globalAlpha(1).fillStyle(!0!==t?t:this.backgroundColor).fillRect(0,0,this._width,this._height):(this.elem.width=this.width,this.applyConfig()),this.updateTransform(),this)},o.prototype.reset=function(t){return this.fillStyle("#000000").strokeStyle("#000000").lineCap("butt").lineJoin("miter").lineWidth("1").miterLimit("10").shadowColor("#000000").shadowOffsetX("0").shadowOffsetY("0").shadowBlur("0").globalAlpha("1.0").globalCompositeOperation("source-over"),t&&this.beginPath().closePath(),this},o.prototype.pushMatrix=function(){return this.matrixStack.push(this.matr),this.matr=this.matr.clone(),this},o.prototype.popMatrix=function(){return this.matr=this.matrixStack.pop(),this.updateTransform()},o.prototype.pushAlpha=function(){return this.alphaStack.push(this.globalAlpha()),this},o.prototype.popAlpha=function(){return this.globalAlpha(this.alphaStack.pop()),this},o.prototype.loadIdentity=function(){return this.matr.identity(),this.updateTransform()},o.prototype.loadMatrix=function(t){return this.matr.set(t),this.updateTransform()},o.prototype.getMatrix=function(){return this.matr.clone()},o.prototype.appendMatrix=function(t){return this.matr.append(t),this.updateTransform()},o.prototype.scale=function(t,e,i){return i?(this.context.scale(t,e),this):(this.matr.scale(t,e),this.updateTransform())},o.prototype.rotate=function(t,e){return e?(this.context.rotate(t),this):(this.matr.rotate(t),this.updateTransform())},o.prototype.translate=function(t,e,i){return i?(this.context.translate(t,e),this):(this.matr.translate(t,e),this.updateTransform())},o.prototype.ellipse=function(t,e,i,r){var n=i/2*.5522848,o=r/2*.5522848,s=t+i-1,a=e+r-1,h=t+i/2,l=e+r/2;return this.beginPath().moveTo(t,l),this.bezierCurveTo(t,l-o,h-n,e,h,e),this.bezierCurveTo(h+n,e,s,l-o,s,l),this.bezierCurveTo(s,l+o,h+n,a,h,a),this.bezierCurveTo(h-n,a,t,l+o,t,l),this.closePath(),this},o.prototype.circle=function(t,e,i,r){return this.beginPath(),this.arc(t,e,i,0,2*Math.PI),this.closePath(),r&&this.stroke(r),this},o.prototype.line=function(t,e,i,r,n){return this.beginPath(),this.moveTo(t,e),this.lineTo(i,r),this.closePath(),n&&this.stroke(n),this},o.prototype.enablePointerEvents=function(){if(this.pointerHandler)return this;this.pointerScale={sx:1,sy:1},this.pointerOffset={x:0,y:0};var t=this,e={action:"",buttons:0,lbuttons:0,x:0,y:0,containedBy:function(t,e,i,r){return this.x>=t&&this.x<=t+i-1&&this.y>=e&&this.y<=e+r-1}};return this.pointerHandlers=[],this.pointerHandler=function(i,r){var n=this.elem.getBoundingClientRect();e.action=i,e.buttons=r.buttons,e.x=e.rx=~~(r.clientX-n.left),e.y=e.ry=~~(r.clientY-n.top),e.x=(e.x-t.pointerOffset.x-0*t.pointerScale.sx)/t.pointerScale.sx,e.y=(e.y-t.pointerOffset.y-0*t.pointerScale.sy)/t.pointerScale.sy,e.dragging=!1,e.buttons&&!e.lbuttons&&(e.sx=e.x,e.sy=e.y,e.ldx=e.ldy=0),e.buttons&&e.lbuttons&&(e.dragging=!0,e.dx=e.x-e.sx,e.dy=e.y-e.sy,e.ddx=e.dx-e.ldx,e.ddy=e.dy-e.ldy,e.ldx=e.dx,e.ldy=e.dy),e.lbuttons=e.buttons;for(var o=0;o<this.pointerHandlers.length&&!1!==this.pointerHandlers[o][1].call(this.pointerHandlers[o][2],e);o++);},this.elem.onmousedown=function(e){t.pointerHandler("DOWN",e)},this.elem.onmouseup=function(e){t.pointerHandler("UP",e)},this.elem.onmousemove=function(e){t.pointerHandler("MOVE",e)},this},o.prototype.setPointerScale=function(t,e){return this.pointerScale={sx:t,sy:e},this},o.prototype.setPointerOffset=function(t,e){return this.pointerOffset={x:t,y:e},this},o.prototype.addPointerHandler=function(t,e){return this.enablePointerEvents(),this.pointerHandlers.push([this.pointerHandlers.length+"_"+~~(1e6*Math.random()),t,e]),this.pointerHandlers[this.pointerHandlers.length-1][0]},o.prototype.removePointerHandler=function(t){if(this.pointerHandlers)for(var e=0;e<this.pointerHandlers.length;e++)if(this.pointerHandlers[e][0]==t){this.pointerHandlers.splice(e,1);break}},o.prototype.drawImageResource=function(t,e,i,r,n){return null==r?this.drawImage(t.data,0,0,t.data.width,t.data.height,e,i,t.width,t.height):this.drawImage(t.data,0,0,t.data.width,t.data.height,e,i,r,n)};var s=o;exports.default=s;
},{"@rsthn/rin":"OHwo","../math/matrix.js":"YOKs","./log.js":"wkWf"}],"tYB4":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=n(require("./keycodes.js")),i=n(require("../utils/list.js")),s=n(require("../utils/linkable.js")),a=n(require("./timer.js")),r=n(require("./canvas.js"));function n(e){return e&&e.__esModule?e:{default:e}}const o={flags:{renderingEnabled:!1,renderingPaused:!1},EVT_KEY_DOWN:1,EVT_KEY_UP:2,EVT_POINTER_DOWN:16,EVT_POINTER_UP:17,EVT_POINTER_MOVE:18,EVT_POINTER_DRAG_START:19,EVT_POINTER_DRAG_MOVE:20,EVT_POINTER_DRAG_STOP:21,DEFAULT:0,LANDSCAPE:1,PORTRAIT:2,AUTOMATIC:3,defaultOptions:{background:"#000",gl:!1,canvas:null,canvas2:null,fps:144,minFps:15,context:null,antialias:!0,screenWidth:null,screenHeight:null,orientation:0,extraScaleFactor:1,fullscreen:!0},screenWidth:0,screenHeight:0,orientation:0,offsX:0,offsY:0,devicePixelRatio:1,backingStoreRatio:1,canvasPixelRatio:1,canvasScaleFactor:1,scaleFactor:1,initialMatrix:null,displayBuffer:null,displayBuffer2:null,tempDisplayBuffer:null,keyState:{time:0,shift:!1,ctrl:!1,alt:!1,keyCode:0},pointerState:{},updateQueue:null,drawQueue:null,timeScale:1,frameInterval:0,fixedFrameInterval:0,maxFrameInterval:0,frameDelta:0,frameDeltaMillis:0,frameTime:0,frameTimeMillis:0,frameNumber:0,frameUpdateInProgress:!1,frameDrawInProgress:!1,perf:{startTime:0,lastTime:0,numFrames:0,updateTime:0,drawTime:0,numSamples:0,windowSize:500,snapStartTime:0,snapNumFrames:0,snapUpdateTime:0,snapDrawTime:0},init:function(s){var n={};Object.assign(n,this.defaultOptions),s&&Object.assign(n,s),this.options=n,n.screenWidth&&n.screenHeight&&n.orientation==o.DEFAULT&&(n.orientation=n.screenWidth>n.screenHeight?o.LANDSCAPE:o.PORTRAIT),this.orientation=n.orientation,this.updateQueue=new i.default,this.drawQueue=new i.default,this.frameInterval=int(1e3/n.fps),this.maxFrameInterval=int(1e3/n.minFps),e.onresize=this.onWindowResized.bind(this),this.frameTimer=new a.default(this.frameInterval,this.onFrame.bind(this),!0),this.displayBuffer=new r.default({gl:n.gl,elem:n.canvas,absolute:!0,hidden:!1,antialias:n.antialias,background:n.background}),this.displayBuffer2=new r.default({gl:!1,elem:n.canvas2,absolute:!0,hidden:!1,antialias:n.antialias,background:"none"}),this.displayBuffer2.elem.style.pointerEvents="none",this.tempDisplayBuffer=new r.default({hidden:!0,antialias:n.antialias}).resize(320,240);var c=this.displayBuffer.elem;this.devicePixelRatio=e.devicePixelRatio||1,this.backingStoreRatio=1==n.gl?1:this.displayBuffer.context.webkitBackingStorePixelRatio||this.displayBuffer.context.mozBackingStorePixelRatio||this.displayBuffer.context.msBackingStorePixelRatio||this.displayBuffer.context.oBackingStorePixelRatio||this.displayBuffer.context.backingStorePixelRatio||1,this.canvasPixelRatio=this.devicePixelRatio/this.backingStoreRatio,o.onWindowResized(!0);var h=this;e.onkeydown=function(i){if(i.target===e.document.body){if(h.keyState[i.keyCode])return!1;switch(h.keyState[i.keyCode]=!0,h.keyState.keyCode=i.keyCode,h.keyState.startTime=o.now(!0),i.keyCode){case 16:h.keyState.shift=!0;break;case 17:h.keyState.ctrl=!0;break;case 18:h.keyState.alt=!0}return h.keyState.ctrl&&i.keyCode==t.default.TAB?(h.keyState[i.keyCode]=!1,!0):!1!==h.onKeyboardEvent(h.EVT_KEY_DOWN,i.keyCode,h.keyState)&&void 0}},e.onkeyup=function(t){if(t.target===e.document.body){if(!h.keyState[t.keyCode])return!1;switch(h.keyState[t.keyCode]=!1,h.keyState.endTime=o.now(!0),h.keyState.keyCode=t.keyCode,t.keyCode){case 16:h.keyState.shift=!1;break;case 17:h.keyState.ctrl=!1;break;case 18:h.keyState.alt=!1}return!1!==h.onKeyboardEvent(h.EVT_KEY_UP,t.keyCode,h.keyState)&&void 0}},"ontouchstart"in e?(c.ontouchstart=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++){o.pointerState[t[i].identifier]||(o.pointerState[t[i].identifier]={id:t[i].identifier,isActive:!1,isDragging:!1,sx:0,sy:0,x:0,y:0,dx:0,dy:0,button:0});var s=o.pointerState[t[i].identifier];s.isActive=!0,s.isDragging=!1,s.button=1,s.startTime=o.now(!0),s.x=s.sx=o.reverseRender?~~((t[i].clientY-o.offsY)/o.canvasScaleFactor):~~((t[i].clientX-o.offsX)/o.canvasScaleFactor),s.y=s.sy=o.reverseRender?~~(o.screenHeight-(t[i].clientX-o.offsX)/o.canvasScaleFactor-1):~~((t[i].clientY-o.offsY)/o.canvasScaleFactor),o.onPointerEvent(o.EVT_POINTER_DOWN,s,o.pointerState)}return!1},c.ontouchend=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(o.pointerState[t[i].identifier]){var s=o.pointerState[t[i].identifier];s.endTime=o.now(!0),s.deltaTime=s.endTime-s.startTime,s.x=o.reverseRender?~~((t[i].clientY-o.offsY)/o.canvasScaleFactor):~~((t[i].clientX-o.offsX)/o.canvasScaleFactor),s.y=o.reverseRender?~~(o.screenHeight-(t[i].clientX-o.offsX)/o.canvasScaleFactor-1):~~((t[i].clientY-o.offsY)/o.canvasScaleFactor),s.isDragging&&o.onPointerEvent(o.EVT_POINTER_DRAG_STOP,s,o.pointerState),o.onPointerEvent(o.EVT_POINTER_UP,s,o.pointerState),s.isActive=!1,s.isDragging=!1,s.button=0}return!1},c.ontouchcancel=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(o.pointerState[t[i].identifier]){var s=o.pointerState[t[i].identifier];s.x=o.reverseRender?~~((t[i].clientY-o.offsY)/o.canvasScaleFactor):~~((t[i].clientX-o.offsX)/o.canvasScaleFactor),s.y=o.reverseRender?~~(o.screenHeight-(t[i].clientX-o.offsX)/o.canvasScaleFactor-1):~~((t[i].clientY-o.offsY)/o.canvasScaleFactor),o.onPointerEvent(s.isDragging?o.EVT_POINTER_DRAG_STOP:o.EVT_POINTER_UP,s,o.pointerState),s.isActive=!1,s.isDragging=!1,s.button=0}return!1},c.ontouchmove=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(o.pointerState[t[i].identifier]){var s=o.pointerState[t[i].identifier];s.isActive&&!s.isDragging&&(o.onPointerEvent(o.EVT_POINTER_DRAG_START,s,o.pointerState),s.isDragging=!0),s.x=o.reverseRender?~~((t[i].clientY-o.offsY)/o.canvasScaleFactor):~~((t[i].clientX-o.offsX)/o.canvasScaleFactor),s.y=o.reverseRender?~~(o.screenHeight-(t[i].clientX-o.offsX)/o.canvasScaleFactor-1):~~((t[i].clientY-o.offsY)/o.canvasScaleFactor),s.dx=s.x-s.sx,s.dy=s.y-s.sy,o.onPointerEvent(s.isDragging?o.EVT_POINTER_DRAG_MOVE:o.EVT_POINTER_MOVE,s,o.pointerState)}return!1}):(c.onmousedown=function(e){e.preventDefault(),o.pointerState[0]||(o.pointerState[0]={id:0,isActive:!1,isDragging:!1,button:0,sx:0,sy:0,x:0,y:0,dx:0,dy:0});var t=o.pointerState[0];return t.isActive=!0,t.isDragging=!1,t.button=e.which,t.x=t.sx=o.reverseRender?~~((e.clientY-o.offsY)/o.canvasScaleFactor):~~((e.clientX-o.offsX)/o.canvasScaleFactor),t.y=t.sy=o.reverseRender?~~(o.screenHeight-(e.clientX-o.offsX)/o.canvasScaleFactor-1):~~((e.clientY-o.offsY)/o.canvasScaleFactor),o.onPointerEvent(o.EVT_POINTER_DOWN,t,o.pointerState),!1},c.onmouseup=function(e){if(e.preventDefault(),!o.pointerState[0])return!1;var t=o.pointerState[0];t.x=o.reverseRender?~~((e.clientY-o.offsY)/o.canvasScaleFactor):~~((e.clientX-o.offsX)/o.canvasScaleFactor),t.y=o.reverseRender?~~(o.screenHeight-(e.clientX-o.offsX)/o.canvasScaleFactor-1):~~((e.clientY-o.offsY)/o.canvasScaleFactor),t.isDragging&&o.onPointerEvent(o.EVT_POINTER_DRAG_STOP,t,o.pointerState),o.onPointerEvent(o.EVT_POINTER_UP,t,o.pointerState),t.isActive=!1,t.isDragging=!1,t.button=0},c.onmousemove=function(e){if(e.preventDefault(),!o.pointerState[0])return!1;var t=o.pointerState[0];return t.isActive&&!t.isDragging&&(o.onPointerEvent(o.EVT_POINTER_DRAG_START,t,o.pointerState),t.isDragging=!0),t.x=o.reverseRender?~~((e.clientY-o.offsY)/o.canvasScaleFactor):~~((e.clientX-o.offsX)/o.canvasScaleFactor),t.y=o.reverseRender?~~(o.screenHeight-(e.clientX-o.offsX)/o.canvasScaleFactor-1):~~((e.clientY-o.offsY)/o.canvasScaleFactor),t.dx=t.x-t.sx,t.dy=t.y-t.sy,o.onPointerEvent(t.isDragging?o.EVT_POINTER_DRAG_MOVE:o.EVT_POINTER_MOVE,t,o.pointerState),!1})},now:function(e){var t=hrnow();return e?t/1e3:t},time:function(){return this.frameTime},start:function(){this.onWindowResized(),this.flags.renderingPaused=!1,this.frameTimer.start()},stop:function(){this.flags.renderingPaused=!0,this.frameTimer.stop()},pause:function(){this.flags.renderingPaused=!0},resume:function(){this.flags.renderingPaused=!1,this.resetPerf()},onFrame:function(e,t){var i,s=this.now();if(e>this.maxFrameInterval&&(e=this.maxFrameInterval),0!=this.fixedFrameInterval&&(e=this.fixedFrameInterval),this.flags.renderingEnabled&&!this.flags.renderingPaused){0==this.perf.numFrames&&(this.perf.startTime=s-this.frameInterval,this.perf.lastTime=s),e*=this.timeScale,this.frameDeltaMillis=e,this.frameDelta=e/1e3,this.frameTimeMillis+=this.frameDeltaMillis,this.frameTime+=this.frameDelta,this.frameNumber++,this.frameUpdateInProgress=!0,i=hrnow();try{this.update(this.frameDelta,this.frameDeltaMillis)}catch(a){throw o.stop(),a}this.perf.updateTime+=hrnow()-i,this.frameUpdateInProgress=!1,this.frameDrawInProgress=!0,i=hrnow();try{this.displayBuffer.clear(),this.draw(this.displayBuffer,this.displayBuffer2)}catch(a){throw o.stop(),a}this.perf.drawTime+=hrnow()-i,this.frameDrawInProgress=!1,this.perf.lastTime=s,this.perf.numFrames++}else{this.frameDrawInProgress=!0;try{this.displayBuffer.clear(),this.draw(this.displayBuffer,this.displayBuffer2)}catch(a){console.error("DRAW ERROR: \n"+a+"\n"+a.stack)}this.frameDrawInProgress=!1}},onWindowResized:function(t){"document"in e?this.options.fullscreen?(this._screenWidth=int(e.screen.width),this._screenHeight=int(e.screen.height)):(this._screenWidth=e.innerWidth,this._screenHeight=e.innerHeight):(this._screenWidth=this.options.screenWidth,this._screenHeight=this.options.screenHeight),this.canvasScaleFactor=1,this._screenWidth<this._screenHeight&&this.orientation==o.LANDSCAPE||this._screenWidth>this._screenHeight&&this.orientation==o.PORTRAIT?(this.screenWidth=this._screenHeight,this.screenHeight=this._screenWidth,this.reverseRender=!0):(this.screenWidth=this._screenWidth,this.screenHeight=this._screenHeight,this.reverseRender=!1);let i=this.options.screenWidth,s=this.options.screenHeight;this.orientation==o.AUTOMATIC&&i&&s&&(i>s&&this.screenWidth<this.screenHeight||i<s&&this.screenWidth>this.screenHeight)&&(i=s,s=this.options.screenWidth),i&&s?this.canvasScaleFactor=Math.min(this.screenWidth/i,this.screenHeight/s):i?this.canvasScaleFactor=this.screenWidth/i:s&&(this.canvasScaleFactor=this.screenHeight/s);var a=this.screenWidth,r=this.screenHeight;if(i&&(this.screenWidth=i),s&&(this.screenHeight=s),this.offsX=int(.5*(a-this.screenWidth*this.canvasScaleFactor)),this.offsY=int(.5*(r-this.screenHeight*this.canvasScaleFactor)),this.reverseRender){var n=this.offsX;this.offsX=this.offsY,this.offsY=n}this.scaleFactor=this.canvasScaleFactor*this.canvasPixelRatio,this.scaleFactor=~~(.7+this.scaleFactor),this.flags.renderingEnabled=!1,"document"in e&&(e.document.body.style.backgroundColor=this.displayBuffer.backgroundColor),this.reverseRender?(this.displayBuffer.resize(this.screenHeight*this.scaleFactor,this.screenWidth*this.scaleFactor),this.displayBuffer.elem.style.width=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer.elem.style.height=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer2.resize(this.screenHeight*this.scaleFactor,this.screenWidth*this.scaleFactor),this.displayBuffer2.elem.style.width=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer2.elem.style.height=this.screenWidth*this.canvasScaleFactor+"px"):(this.displayBuffer.resize(this.screenWidth*this.scaleFactor,this.screenHeight*this.scaleFactor),this.displayBuffer.elem.style.width=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer.elem.style.height=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer2.resize(this.screenWidth*this.scaleFactor,this.screenHeight*this.scaleFactor),this.displayBuffer2.elem.style.width=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer2.elem.style.height=this.screenHeight*this.canvasScaleFactor+"px"),this.displayBuffer.elem.style.marginLeft=this.offsX+"px",this.displayBuffer.elem.style.marginTop=this.offsY+"px",this.displayBuffer2.elem.style.marginLeft=this.offsX+"px",this.displayBuffer2.elem.style.marginTop=this.offsY+"px",this.displayBuffer.loadIdentity(),this.displayBuffer2.loadIdentity(),1!=this.scaleFactor&&(this.displayBuffer.globalScale(this.scaleFactor),this.displayBuffer2.globalScale(this.scaleFactor)),this.reverseRender&&(this.displayBuffer.rotate(-Math.PI/2),this.displayBuffer.translate(0,-this.screenHeight),this.displayBuffer.flipped(!0),this.displayBuffer2.rotate(-Math.PI/2),this.displayBuffer2.translate(0,-this.screenHeight),this.displayBuffer2.flipped(!0)),this.scaleFactor*=this.options.extraScaleFactor,this.integerScaleFactor=~~(this.scaleFactor+.9),this.resetPerf(),this.initialMatrix=this.displayBuffer.getMatrix(),1!=t&&(this.flags.renderingEnabled=!0,this.onCanvasResized(this.screenWidth,this.screenHeight))},onCanvasResized:function(e,t){},resetPerf:function(){this.perf.numFrames=0},updateQueueAdd:function(e){return this.updateQueue.push(e),this.updateQueue.bottom},updateQueueRemove:function(e){this.updateQueue.remove(e instanceof s.default?e:this.updateQueue.sgetNode(e))},drawQueueAdd:function(e){return this.drawQueue.push(e),this.drawQueue.bottom},drawQueueRemove:function(e){this.drawQueue.remove(e instanceof s.default?e:this.drawQueue.sgetNode(e))},queueAdd:function(e){return this.updateQueue.push(e),this.drawQueue.push(e),e},queueRemove:function(e){this.updateQueue.remove(this.updateQueue.sgetNode(e)),this.drawQueue.remove(this.drawQueue.sgetNode(e))},update:function(e,t){for(var i,s=this.updateQueue.top;s;s=i)i=s.next,s.value.update(e,t)},draw:function(e,t){for(var i,s=this.drawQueue.top;s;s=i)i=s.next,s.value.draw(e,t)},interpolate:function(e,t,i,s,a){let r={},n={},c=0;for(let o in e)r[o]=0,n[o]=e[o],c++;let h={update:function(l){for(let a in r){if(r[a]==i[a])continue;r[a]+=l,r[a]>=i[a]&&(r[a]=i[a],c--);let o=s[a](r[a]/i[a]);n[a]=(1-o)*e[a]+o*t[a]}a(n,0==c),0==c&&o.updateQueueRemove(h)}};o.updateQueueAdd(h),h.update(0)},onKeyboardEvent:function(e,t,i){},onPointerEvent:function(e,t,i){}};var c=o;exports.default=c;
},{"./keycodes.js":"QPdb","../utils/list.js":"j8vy","../utils/linkable.js":"KbP4","./timer.js":"D2RU","./canvas.js":"sUEe"}],"WRLr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=function(t,e){this.data=[],this.accumSize=t,this.expectedValue=e,this.stdSum=0,this.stdCount=0};var e=t;exports.default=e,t.prototype.begin=function(){this.startTime=performance.now()},t.prototype.end=function(){this.feed(performance.now()-this.startTime)},t.prototype.feed=function(t){this.data.push(t),this.data.length==this.accumSize&&(this.report(),this.data=[])},t.prototype.report=function(t){for(var e=null,i=null,s=0,a=0,h=0;h<this.data.length;h++)e=null===e?this.data[h]:Math.min(e,this.data[h]),i=null===i?this.data[h]:Math.max(i,this.data[h]),s+=this.data[h];s/=this.data.length;var o=void 0!==this.expectedValue?this.expectedValue:s;for(h=0;h<this.data.length;h++)a+=Math.pow(this.data[h]-o,2);a=Math.sqrt(a/this.data.length),this.stdSum+=a,this.stdCount++;var d="N: "+this.stdCount+", MIN: "+e+", MAX: "+i+", AVG: "+s.toFixed(2)+(void 0!==this.expectedValue?", E: "+this.expectedValue:"")+", STDDEV: "+a.toFixed(2)+", AVG_STDDEV: "+(this.stdSum/this.stdCount).toFixed(2);if(this.min=e,this.max=i,this.avg=s,this.std=a,!0===t)return d;console.log(d)};
},{}],"Ic9U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@rsthn/rin"),t=e.Class.extend({className:"IDrawable",width:null,height:null,__ctor:function(e,t){this.width=e,this.height=t},draw:function(e,t=0,r=0,l=null,i=null){},getDrawable:function(){return this}});exports.default=t;
},{"@rsthn/rin":"OHwo"}],"B6u2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@rsthn/rin"),t=e.Class.extend({className:"IUpdateable",__ctor:function(){},update:function(e){}});exports.default=t;
},{"@rsthn/rin":"OHwo"}],"L4kQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("../system/idrawable.js"));function r(e){return e&&e.__esModule?e:{default:e}}var t=e.default.extend({className:"Drawable",__ctor:function(e){if("image"!=e.type)throw new Error("Resource is not an image.");this._super.IDrawable.__ctor(e.width,e.height),this.r=e,this.r.wrapper=this},draw:function(e,r=0,t=0,a=null,s=null){null==a?e.drawImageResource(this.r,r,t):e.drawImageResource(this.r,r,t,a,s)}});exports.default=t;
},{"../system/idrawable.js":"Ic9U"}],"rVh6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("../system/idrawable.js"));function t(e){return e&&e.__esModule?e:{default:e}}var r=e.default.extend({className:"DrawableRect",width:null,height:null,__ctor:function(e){if("object"!=e.type)throw new Error("Resource is not an object.");this._super.IDrawable.__ctor(e.width,e.height),this.r=e,this.r.wrapper=this},draw:function(e,t=0,r=0){e.fillStyle(this.r.color),e.fillRect(t,r,this.width,this.height)}});exports.default=r;
},{"../system/idrawable.js":"Ic9U"}],"cl9J":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin"),e=i(require("../system/canvas.js"));function i(t){return t&&t.__esModule?t:{default:t}}var h=t.Class.extend({className:"SpriteSheet",width:0,height:0,numCols:0,numFrames:0,drawableCache:null,__ctor:function(t){if("image"!=t.type&&"images"!=t.type)throw new Error("Resource is not a sprite sheet.");var e,i;if("image"==t.type){if(!(t.config.sheetWidth||t.config.numFrames&&t.config.frameWidth))throw new Error("Required sheetWidth or numFrames+frameWidth");t.config.sheetWidth||(t.config.sheetWidth=t.config.numFrames*t.config.frameWidth),t.config.frameHeight||(t.config.frameHeight=t.data.height),e=t.data.width/t.config.sheetWidth,i=t.width/t.config.sheetWidth}else t.config||(t.config={}),t.config.frameWidth||(t.config.frameWidth=t.data[0].width),t.config.frameHeight||(t.config.frameHeight=t.data[0].height),e=t.data[0].data.width/t.config.frameWidth,i=t.data[0].width/t.config.frameWidth;var h=t.config.frameWidth,a=t.config.frameHeight;this.r_frameWidth=h*e,this.r_frameHeight=a*e,this.width=h*i,this.height=a*i,"image"==t.type?(this.numCols=~~(t.data.width/this.r_frameWidth),this.numRows=Math.ceil(t.data.height/this.r_frameHeight),this.numFrames=t.config.numFrames||this.numCols*this.numRows):(this.numCols=this.numRows=0,this.numFrames=t.data.length),this.drawableCache={},this.r=t,this.r.wrapper=this},drawFrame:function(t,e,i,h,a=0,r=0){if(!(h<0||h>=this.numFrames))if(a||(a=this.width),r||(r=this.height),0!=this.numCols){var s=~~(h/this.numCols)*this.r_frameHeight,n=h%this.numCols*this.r_frameWidth;t.drawImage(this.r.data,n,s,this.r_frameWidth,this.r_frameHeight,e,i,a,r)}else t.drawImage(this.r.data[h].data,0,0,this.r_frameWidth,this.r_frameHeight,e,i,a,r)},getDrawable:function(t){return 2==arguments.length&&(t=arguments[1]*this.numCols+arguments[0]),this.drawableCache[t]||(this.drawableCache[t]={width:this.width,height:this.height,frameIndex:t,r:this,draw:function(t,e=0,i=0,h=0,a=0){t.drawFrame(this.r,e,i,this.frameIndex,h,a)}}),this.drawableCache[t]}});exports.default=h,e.default.prototype.drawFrame=function(t,e,i,h,a,r){t.drawFrame(this,e,i,h,a,r)};
},{"@rsthn/rin":"OHwo","../system/canvas.js":"sUEe"}],"S36i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Animation=void 0;var s=require("@rsthn/rin"),e=i(require("./spritesheet.js")),t=i(require("../system/system.js"));function i(s){return s&&s.__esModule?s:{default:s}}const n=s.Class.extend({seq:null,seq_i:0,trans:null,trans_i:0,trans_t:null,queue:null,fps:0,frameMillis:0,time:0,frameNumber:-1,finished:!1,paused:!1,width:null,height:null,onFinishedCallback:null,onFinishedArg:null,onFrameCallback:null,onFrameArg:null,__ctor:function(s,e,t){this.anim=s,this.queue=[],this.seq=e,this.trans=null,this.width=s.width,this.height=s.height,this.fps=t,this.setFps(this.seq.fps||this.fps)},__dtor:function(){},setFps:function(s){return this.frameMillis=~~(1e3/s),this.time=0,this},setPaused:function(s){return this.paused=s,this},setInitialDelay:function(s){return this.time=1e3*-s,this},onFinished:function(s,e){return this.onFinishedCallback=s,this.onFinishedArg=e,this},onFrame:function(s,e){return this.onFrameCallback=s,this.onFrameArg=e,this},setFrame:function(s){return this.seq_i=s%this.seq.group.length,this},getFrame:function(s){return!0===s?this.seq_i/(this.seq.group.length-1):this.seq_i},getLength:function(){return this.seq.group.length},draw:function(s,e,i){if(this.time<0)return this.paused||(this.time+=this.frameNumber==t.default.frameNumber?0:t.default.frameDeltaMillis,this.frameNumber=t.default.frameNumber),void(this.time>0&&(this.time=0));if(this.seq_i!=this.seq.group.length){n=this.seq.group[this.seq_i];if(null!=s)for(r=0;r<n.length;r++)s.drawFrame(this.anim,e,i,n[r]);if(this.paused||(this.time+=this.frameNumber==t.default.frameNumber?0:t.default.frameDeltaMillis,this.frameNumber=t.default.frameNumber),this.time>=this.frameMillis){const s=this.seq_i;this.time-=this.frameMillis,this.seq_i++,this.seq_i==this.seq.group.length&&(null!=this.trans?(++this.trans_i==this.trans.length?(this.trans=null,this.seq=this.trans_t):this.seq=this.trans[this.trans_i],this.seq_i=0,this.time=0,this.finished=!1):(this.seq.loop?this.seq_i=0:(this.finished=!0,this.onFinishedCallback&&(this.onFinishedCallback(this.onFinishedArg),this.onFinishedCallback=null)),this.queue.length&&this.use(this.queue.shift(),!0))),this.onFrameCallback&&!1===this.onFrameCallback(s,this.seq.group.length-1,this.onFrameArg)&&(this.onFrameCallback=null)}}else{var n=this.seq.group[this.seq_i-1];if(null!=s)for(var r=0;r<n.length;r++)s.drawFrame(this.anim,e,i,n[r])}},advance:function(){this.setPaused(!1),this.draw(null,0,0)},use:function(s,e){var t=null==this.trans?this.seq:this.trans_t;return t.name==s&&!0!==e?this:(t.trans&&t.trans[s]?(this.trans_t=this.anim.a.seq[s],this.trans=t.trans[s],this.trans_i=0,this.seq=this.trans[this.trans_i]):(this.seq=this.anim.a.seq[s],this.setFps(this.seq.fps||this.fps)),this.seq_i=0,this.time=0,this.finished=!1,this)},setQueue:function(s){this.queue=s,this.use(this.queue.shift(),!0)},enqueue:function(s,e){var t=null==this.trans?this.seq:this.trans_t;return t.name==s&&t.loop?this:!0!==e&&this.queue.length>0&&this.queue[this.queue.length-1]==s?this:t.loop||this.finished?(this.use(s,!0),this):(this.queue.push(s),this)}});exports.Animation=n;var r=e.default.extend({className:"SpriteSheetAnimation",__ctor:function(s){if(!s.anim)throw new Error("Animation descriptors not found.");this._super.SpriteSheet.__ctor(s),this.r=s,this.r.wrapper=this;var e=this.a=this.r.anim;if(!e.initialized){if(e.def||(e.def="def"),e.seq||(e.seq={}),!e.seq[e.def]&&("def"==e.def||"defloop"==e.def)){for(var t={loop:"def"!=e.def,group:[]},i=0;i<this.numFrames;i++)t.group.push([i]);e.seq[e.def]=t}if(!e.seq[e.def])throw new Error("Undefined default sequence: "+e.def);e.fps||(e.fps=25),e.def=e.seq[e.def];var n=0;for(var i in e.seq){var r,h,a;if(e.seq[i].name=i,e.seq[i].loop||(e.seq[i].loop=!1),"string"==typeof e.seq[i].group)if(-1!=e.seq[i].group.indexOf(" "))for(var u in r=e.seq[i].group.split(" "),e.seq[i].group=[],r)e.seq[i].group.push([int(r[u])]);else if(-1!=e.seq[i].group.indexOf(","))for(a=e.seq[i].group.split(","),r=int(a[0]),h=int(a[1]),e.seq[i].group=[],a=r;a<=h;a++)e.seq[i].group.push([a]);else for(r=int(e.seq[i].group),e.seq[i].group=[];r--;)e.seq[i].group.push([n++])}if(e.trans)for(var i in e.trans)for(var u in e.seq[i].trans=e.trans[i],e.trans[i])for(var l=0;l<e.trans[i][u].length;l++){var o=e.trans[i][u][l];if(!e.seq[o])throw new Error("Undefined sequence: "+o);e.trans[i][u][l]=e.seq[o]}e.initialized=!0}},getDrawable:function(s,e){return new n(this,s?this.a.seq[s]:this.a.def,e||this.a.fps)},getSequence:function(s){return s?this.a.seq[s]:this.a.def}});exports.default=r;
},{"@rsthn/rin":"OHwo","./spritesheet.js":"cl9J","../system/system.js":"tYB4"}],"Rskg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin"),h=r(require("../system/canvas.js"));function r(t){return t&&t.__esModule?t:{default:t}}var i=t.Class.extend({__ctor:function(t){if("image"!=t.type||!t.font)throw new Error("Resource is not a sprite font.");var h=t.data.width/t.font.sheetWidth,r=t.width/t.font.sheetWidth;this.r_charWidth=t.font.charWidth*h,this.r_charHeight=t.font.charHeight*h,this.charWidth=t.font.charWidth*r,this.charHeight=t.font.charHeight*r;var i=~~(t.font.sheetWidth/t.font.charWidth);this.r=t,this.r.wrapper=this;var e=t.font.charset.length,a=0,s=0;for(this.charTable={},this.charTable[" "]={charWidth:this.charWidth>>1,r_charWidth:this.r_charWidth};a<e;){for(var d=0,n=0;n<i&&a<e;n++){var c=t.font.charset[a++];this.charTable[c]={x:d,y:s,charWidth:this.charWidth,r_charWidth:this.r_charWidth},d+=this.r_charWidth}s+=this.r_charHeight}if(t.font.widths)for(e=t.font.widths.length,n=0;n<e;n+=2)for(var o=t.font.widths[n]*r,f=t.font.widths[n]*h,u=t.font.widths[n+1],l=0;l<u.length;l++)this.charTable[u[l]].charWidth=o,this.charTable[u[l]].r_charWidth=f},draw:function(t,h,r,i){for(var e=i.length,a=0;a<e;a++)if(" "!=i[a]){var s=this.charTable[i[a]];s&&(t.drawImage(this.r.data,s.x,s.y,s.r_charWidth,this.r_charHeight,h,r,s.charWidth,this.charHeight),h+=s.charWidth)}else h+=this.charTable[i[a]].charWidth},measureWidth:function(t){for(var h=t.length,r=0,i=0;i<h;i++){var e=this.charTable[t[i]];e&&(r+=e.charWidth)}return r},measureHeight:function(t){return this.charHeight}});exports.default=i,h.default.prototype.drawText=function(t,h,r,i){t.draw(this,h,r,i.toString())},h.default.prototype.drawTextAligned=function(t,h,r,i,e,a,s,d){d=d.toString(),0==a?h+=i-t.measureWidth(d)>>1:a<0?h=h-a-1:a>0&&(h=h+i-a+1-t.measureWidth(d)),0==s?r+=e-t.measureHeight(d)>>1:s<0?r=r-s-1:s>0&&(r=r+e-s+1-t.measureHeight(d)),t.draw(this,h,r,d)},h.default.prototype.drawTextAligned2=function(t,h,r,i,e){this.drawTextAligned(t,h.x1,h.y1,h.width(),h.height(),r,i,e)};
},{"@rsthn/rin":"OHwo","../system/canvas.js":"sUEe"}],"BmPQ":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=require("@rsthn/rin");const r=a.Class.extend({r:null,__ctor:function(e){if("audio"!=e.type)throw new Error("Resource is not audio.");this.r=e,this.r.wrapper=this,this.track=r[this.r.track.toUpperCase()]},play:function(e,a){return r.play(this,e,a)},playLoop:function(e,a){return r.playLoop(this,e,a)}});r.ENGINE_HTML5=1,r.ENGINE_WEBAUDIO=2,r.ENGINE_NATIVEAUDIO=3,Object.assign(r,{MASTER:{enabled:!0,volume:1},SFX:{enabled:!0,volume:1},MUSIC:{enabled:!0,volume:.8},VOICE:{enabled:!0,volume:1},MAX_POOL_SIZE:100,pool:[],active:[],register:function(e){e.registered||(e.registered=!0,this.active.push(e))},unregister:function(e){if(e.registered){e.registered=!1;var a=r.active.indexOf(e);-1!=a&&r.active.splice(a,1)}},updateNode:function(e,a){switch(e.snd.r.engine){case r.ENGINE_WEBAUDIO:return this.updateNode_webaudio(e,a);case r.ENGINE_NATIVEAUDIO:return this.updateNode_nativeaudio(e,a)}return this.updateNode_audio(e,a)},alloc_webaudio:function(e){e.gainNode=audioContext.createGain(),e.gainNode.gain.value=0,e.gainNode.connect(audioContext.destination),e.res=audioContext.createBufferSource(),e.res.buffer=e.snd.r.data,e.res.loop=!1,e.res.connect(e.gainNode),e.res.node=e},free_webaudio:function(e){e.res&&(e.gainNode.disconnect(),e.res=null,e.gainNode=null)},alloc_nativeaudio:function(e){e.res=!0},free_nativeaudio:function(e){e.res=!1},alloc_audio:function(e){return this.pool.length?item=this.pool.pop():item=e.cloneNode(),item._src=e.src,item},free_audio:function(e){this.pool.length!=this.MAX_POOL_SIZE&&this.pool.push(e)},updateNode_webaudio:function(e,a){if(!e)return null;var t=r.MASTER.volume*e.snd.track.volume*e.volume;switch(a){case"play":if(e.playing)break;e.res||r.alloc_webaudio(e),e.playTime=hrnow(),e.playing=!0,e.pause=!1,e.res.onended=r.onended_webaudio,e.gainNode.gain.value=t;try{e.res.start(0,e.startTime/1e3)}catch(n){return r.free_webaudio(e),null}r.register(e);break;case"setvolume":if(!e.res)break;e.gainNode.gain.value=t;break;case"stop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1,r.free_webaudio(e),e.callback&&e.callback();break}if(!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,e.res.onended=null,r.unregister(e),e.res.stop(),r.free_webaudio(e),e.callback&&e.callback();break;case"pause":if(!e.playing||!e.res)break;e.startTime+=hrnow()-e.playTime,e.playing=!1,e.pause=!0,e.res.onended=null,r.unregister(e),e.res.stop(),r.free_webaudio(e);break;case"softstop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1;break}if(!e.playing||!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,e.res.loop=!1}return e},onended_webaudio:function(e){var a=e.currentTarget.node;if(a.playing&&0!=a.loop)return r.free_webaudio(a),-1!=a.loop&&a.loop--,a.startTime=0,a.playing=!1,a.pause=!1,void r.updateNode_webaudio(a,"play");a.res.onended=null,a.res.volume=0,r.updateNode_webaudio(a,"stop")},updateNode_nativeaudio:function(a,t){if(!a)return null;switch(t){case"play":if(a.playing)break;a.res||r.alloc_nativeaudio(a),a.playing=!0,a.pause=!1;try{e.plugins.NativeAudio.play(a.snd.r.data,null,null,function(){r.onended_nativeaudio(a)})}catch(n){return r.free_nativeaudio(a),null}r.register(a);break;case"setvolume":break;case"stop":if(!a.res)break;a.playing=!1,a.pause=!1,r.unregister(a),e.plugins.NativeAudio.stop(a.snd.r.data,null),r.free_nativeaudio(a),a.callback&&a.callback()}return a},onended_nativeaudio:function(e){r.updateNode_nativeaudio(e,"stop")},updateNode_audio:function(e,a){if(!e)return null;var t=r.MASTER.volume*e.snd.track.volume*e.volume;switch(a){case"play":if(e.playing)break;e.res||(e.res=r.alloc_audio(e.snd.r.data),e.res.node=e,e.res.src=e.res._src),e.playTime=hrnow(),e.playing=!0,e.pause=!1,e.res.onended=r.onended_audio,e.res.currentTime=e.startTime/1e3,e.res.volume=t;try{e.res.play()}catch(n){return r.free_audio(e.res),e.res=null,null}r.register(e);break;case"setvolume":if(!e.res)break;e.res.volume=t;break;case"stop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1,r.free_audio(e.res),e.res=null,e.callback&&e.callback();break}if(!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,r.unregister(e),e.res.pause(),r.free_audio(e.res),e.res=null,e.callback&&e.callback();break;case"pause":if(!e.playing||!e.res)break;e.startTime+=hrnow()-e.playTime,e.playing=!1,e.pause=!0,r.unregister(e),e.res.pause();break;case"softstop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1;break}if(!e.playing||!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1}return e},onended_audio:function(e){var a=e.currentTarget.node;if(a.playing&&0!=a.loop)return-1!=a.loop&&a.loop--,a.startTime=0,a.playing=!1,a.pause=!1,void r.updateNode_audio(a,"play");a.res.onended=null,a.res.volume=0,r.updateNode_audio(a,"stop")},enableTrack:function(e){e&&(e.enabled=!0)},disableTrack:function(e){e&&(e.enabled=!1)},setVolume:function(e,a){e&&(e.volume=a)},createNode:function(e,a){var r={};return r.startVolume=a,r.volume=a,r.snd=e,r.loop=0,r.playing=!1,r.paused=!1,r.startTime=0,r.playTime=0,r.callback=null,r.timer=null,r.res=null,r},play:function(e,a,r){if(!this.MASTER.enabled||!e||!e.track.enabled)return null;r=null!=r?r:1;var t=this.createNode(e,r);return t.callback=a,this.updateNode(t,"play")},playLoop:function(e,a,r){if(!this.MASTER.enabled||!e||!e.track.enabled)return null;r=null!=r?r:1;var t=this.createNode(e,r);return t.callback=a,t.loop=-1,this.updateNode(t,"play")},stop:function(e,a){return e?(a&&!0!==a&&(e.callback=a),this.updateNode(e,!0===a?"stop":"softstop")):null},pause:function(e){return e?this.updateNode(e,"pause"):null},resume:function(e){return e?this.updateNode(e,"play"):null},fadeOut:function(e,a,t){if(e)if(e.playing&&!e.timer){var n=hrnow();e.startVolume=e.volume,e.timer=setInterval(function(){var i=(hrnow()-n)/a;i>1&&(i=1),e.volume=e.startVolume*(1-i),r.updateNode(e,"setvolume"),1==i&&(clearInterval(e.timer),e.timer=null,!0===t?r.updateNode(e,"stop"):r.updateNode(e,"pause"),t&&!0!==t&&t())},50)}else t&&t()},fadeIn:function(e,a,t){if(e)if(e.playing||e.timer)t&&t();else{var n=hrnow();e.volume=0,this.updateNode(e,"play"),e.timer=setInterval(function(){var i=(hrnow()-n)/a;i>1&&(i=1),e.volume=e.startVolume*i,r.updateNode(e,"setvolume"),1==i&&(clearInterval(e.timer),e.timer=null,t&&t())},50)}}});var t=r;exports.default=t;
},{"@rsthn/rin":"OHwo"}],"iPTX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin"),s=r(require("./sound.js"));function r(t){return t&&t.__esModule?t:{default:t}}var e=t.Class.extend({r:null,__ctor:function(t){if("audios"!=t.type)throw new Error("Resource is not audios.");this.r=t,this.r.wrapper=this,this.r.track||(this.r.track="sfx"),this.r.mode||(this.r.mode="random"),this.track=s.default[this.r.track.toUpperCase()],this.sounds=[],this.lastIndex=-1;for(var r=0;r<this.r.data.length;r++)this.sounds.push(new s.default(Object.assign(this.r.data[r],{track:this.r.track})))},getRandomSound:function(){return"random"==this.r.mode?this.sounds[randr(0,this.sounds.length-1)]:(this.lastIndex=++this.lastIndex%this.sounds.length,this.sounds[this.lastIndex])},play:function(t,r){return s.default.play(this.getRandomSound(),t,r)},playLoop:function(t,r){return s.default.playLoop(this.getRandomSound(),t,r)},playAt:function(t,r,e){return s.default.play(this.sounds[t%this.sounds.length],r,e)},playLoopAt:function(t,r,e){return s.default.playLoop(this.sounds[t%this.sounds.length],r,e)}});exports.default=e;
},{"@rsthn/rin":"OHwo","./sound.js":"BmPQ"}],"cYhf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SoundArray=exports.Sound=exports.SpriteFont=exports.SpriteSheetAnimation=exports.SpriteSheet=exports.DrawableRect=exports.Drawable=void 0;var e=i(require("./drawable.js")),t=i(require("./drawable-rect.js")),r=i(require("./spritesheet.js")),s=i(require("./spritesheet-animation.js")),o=i(require("./spritefont.js")),a=i(require("./sound.js")),u=i(require("./sound-array.js"));function i(e){return e&&e.__esModule?e:{default:e}}const n=e.default;exports.Drawable=n;const p=t.default;exports.DrawableRect=p;const d=r.default;exports.SpriteSheet=d;const l=s.default;exports.SpriteSheetAnimation=l;const x=o.default;exports.SpriteFont=x;const S=a.default;exports.Sound=S;const c=u.default;exports.SoundArray=c;
},{"./drawable.js":"L4kQ","./drawable-rect.js":"rVh6","./spritesheet.js":"cl9J","./spritesheet-animation.js":"S36i","./spritefont.js":"Rskg","./sound.js":"BmPQ","./sound-array.js":"iPTX"}],"LdWd":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=require("@rsthn/rin"),t=d(require("../system/system.js")),r=d(require("../system/canvas.js")),i=n(require("./wrappers.js"));function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o();if(a&&a.has(e))return a.get(e);var t={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(t,i,n):t[i]=e[i]}return t.default=e,a&&a.set(e,t),t}function d(e){return e&&e.__esModule?e:{default:e}}const l={integerScaling:!0,pixelated:!1,init:function(e=null){e&&Object.assign(this,e)},Image:function(e,a=null){return{type:"image",wrapper:"Drawable",src:e,pixelated:this.pixelated,...a}},Audio:function(e,a=null){return{type:"audio",wrapper:"Sound",src:e,...a}},load:function(r,o,n,d,s){if(d||(d=Object.keys(r),r.__original=a.Rin.clone(r),s=0),o&&o(s,d.length,s/d.length),s!=d.length){var u=r[d[s]];switch(u.resName=d[s],u.type){case"image":u.data=new Image,u.data.onload=function(){var e=u.data.width/u.data.height;u.scale&&(u.width=~~(u.data.width*u.scale),u.height=~~(u.data.height*u.scale)),u.width||u.height?u.width&&!u.height?u.height=int(u.width/e):!u.width&&u.height&&(u.width=int(e*u.height)):(u.width=u.data.width,u.height=u.data.height),u.owidth=u.data.width,u.oheight=u.data.height,(u.data.width!=u.width||u.data.height!=u.height||!0!==u.original&&1!=t.default.scaleFactor)&&(!0===u.original?u.data=l.resizeImage(u,u.width,u.height,u.pixelated,!0):u.data=l.resizeImage(u,u.width*(u.pixelated?t.default.integerScaleFactor:t.default.scaleFactor),u.height*(u.pixelated?t.default.integerScaleFactor:t.default.scaleFactor),u.pixelated,!0)),u.rscale=u.data.width/u.width,t.default.tempDisplayBuffer.drawImage(u.data,0,0),t.default.displayBuffer.prepareImage(u.data),l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)},u.data.onerror=function(){console.error("Error: Unable to load: "+u.resName)},u.data.src=u.src+"?r="+Math.random();break;case"images":var c=(f=u.src).indexOf("#"),h=(g=f.lastIndexOf("#"))-c+1;if(-1==c)return void console.error("Unable to load: "+u.resName+"\nError: The 'src' attribute requires one or more '#' marks.");if(!u.count)return void console.error("Unable to load: "+u.resName+"\nError: The 'count' attribute was not found.");u._i=0,u.data=[],(p=function(){if(u._i==u.count)return l.onLoaded(r,d[s]),void l.load(r,o,n,d,s+1);var e={type:"image",width:u.width,height:u.height,scale:u.scale};e.src=u.src.substr(0,c)+(u._i++/Math.pow(10,h)).toFixed(h).substr(2)+u.src.substr(g+1),e.data=new Image,e.resName=u.resName+"#"+(u._i-1),e.data.onload=function(){var a=e.data.width/e.data.height;e.scale&&(e.width=~~(e.data.width*e.scale),e.height=~~(e.data.height*e.scale)),e.width||e.height?e.width&&!e.height?e.height=int(e.width/a):!e.width&&e.height&&(e.width=int(a*e.height)):(e.width=e.data.width,e.height=e.data.height),1==u._i&&(u.owidth=e.data.width,u.oheight=e.data.height),(e.data.width!=e.width||e.data.height!=e.height||!0!==e.original&&1!=t.default.scaleFactor)&&(!0===e.original?e.data=l.resizeImage(e,e.width,e.height,u.pixelated,!0):e.data=l.resizeImage(e,e.width*(u.pixelated?t.default.integerScaleFactor:t.default.scaleFactor),e.height*(u.pixelated?t.default.integerScaleFactor:t.default.scaleFactor),u.pixelated,!0)),e.rscale=e.data.width/e.width,1==u._i&&(u.width=e.width,u.height=e.height,u.rscale=e.rscale),t.default.tempDisplayBuffer.drawImage(e.data,0,0),t.default.displayBuffer.prepareImage(e.data),u.data.push(e),p()},e.data.onerror=function(){console.error("Error: Unable to load: "+e.resName)},e.data.src=e.src+"?r="+Math.random()})();break;case"audio":if(u.track||(u.track="sfx"),e.plugins&&e.plugins.NativeAudio&&"sfx"==u.track){u.engine=i.Sound.ENGINE_NATIVEAUDIO,u.data="snd_"+s,e.plugins.NativeAudio.preloadSimple(u.data,u.src,function(){l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)},function(e){console.error("Error: Unable to load (sfx): "+u.resName+"\n"+e)});break}if(e.audioContext){u.engine=i.Sound.ENGINE_WEBAUDIO,fetchAudioBuffer(u.src+"?r="+Math.random()).then(e=>{u.data=e,l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)}).catch(e=>{console.error("Error: Unable to load: "+u.resName)});break}u.data=new Audio,u.engine=i.Sound.ENGINE_HTML5,u.data.oncanplaythrough=function(){l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)},u.data.onerror=function(){console.error("Error: Unable to load: "+u.resName)},u.data.src=u.src+"?r="+Math.random();break;case"audios":var f,g,p;c=(f=u.src).indexOf("#"),h=(g=f.lastIndexOf("#"))-c+1;if(-1==c)return void console.error("Unable to load: "+u.resName+"\nError: The 'src' attribute requires one or more '#' marks.");if(!u.count)return void console.error("Unable to load: "+u.resName+"\nError: The 'count' attribute was not found.");u._i=0,u.data=[],(p=function(){if(u._i==u.count)return l.onLoaded(r,d[s]),void l.load(r,o,n,d,s+1);var a={type:"audio",track:u.track};return a.src=u.src.substr(0,c)+(u._i++/Math.pow(10,h)).toFixed(h).substr(2)+u.src.substr(g+1),a.resName=u.resName+"#"+(u._i-1),a.track||(a.track="sfx"),e.plugins&&e.plugins.NativeAudio&&"sfx"==a.track?(a.engine=i.Sound.ENGINE_NATIVEAUDIO,a.data="snd_"+s+"_"+u._i,void e.plugins.NativeAudio.preloadSimple(a.data,a.src,function(){u.data.push(a),p()},function(e){console.error("Error: Unable to load (sfx): "+a.resName+"\n"+e)})):e.audioContext?(a.engine=i.Sound.ENGINE_WEBAUDIO,void fetchAudioBuffer(a.src+"?r="+Math.random()).then(e=>{a.data=e,u.data.push(a),p()}).catch(e=>{console.error("Error: Unable to load: "+a.resName)})):(a.data=new Audio,a.engine=i.Sound.ENGINE_HTML5,a.data.oncanplaythrough=function(){u.data.push(a),p()},a.data.onerror=function(){console.error("Error: Unable to load: "+a.resName)},void(a.data.src=a.src+"?r="+Math.random()))})();break;case"json":fetchd(u.src+"?r="+Math.random(),{responseType:"json"}).then(function(e){u.data=e,l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)}).catch(function(e){console.error("Error: Unable to load: "+u.resName+". Error: "+e)});break;case"object":u.data={},l.onLoaded(r,d[s]),l.load(r,o,n,d,s+1)}}else n&&n(r)},unload:function(e){var a;for(var t in e)if("__original"!=t){switch(e[t].r&&(dispose(e[t]),e[t]=e[t].r),e[t].type){case"audio":case"audios":break;case"images":for(var r=0;r<e[t].data.length;r++)dispose(e[t].data[r]);break;default:dispose(e[t].data)}e[t].data=null,delete e[t]}else a=e[t],delete e[t];for(var t in a)e[t]=a[t]},onLoaded:function(e,a){var t=e[a];t.wrapper&&t.wrapper in i&&(e[a]=new i[t.wrapper](t))},resizeImage:function(e,a,t,i,o){var n=e.data.width,d=e.data.height;if(a=int(a),t=int(t),n==a&&d==t)return e.data;if(!this.integerScaling&&i&&(i=null),i){if(~~(a/n)>0){var l,s=~~(a/n+.9),u=(a=s*n)/n,c=(t=s*d)/d;w=new r.default({hidden:!0,antialias:!1}).resize(a,t);(l=new r.default({hidden:!0,antialias:!1}).resize(n,d)).drawImage(e.data,0,0);for(var h=0;h<d;h++)for(var f=l.getImageData(0,h,n,1).data,g=0,p=0;p<n&&g<f.length;p++,g+=4)w.fillStyle("rgba("+f[g]+","+f[g+1]+","+f[g+2]+","+f[g+3]/255+")"),w.fillRect(p*u,h*c,u,c);return l.dispose(),w.elem}return this.resizeImage(e,a,t,null,o)}for(i=null!==i,(l=new r.default({hidden:!0,antialias:i}).resize(n,d)).drawImage(e.data,0,0);;){var w,m=n>>1,b=d>>1;if(m<=a||b<=t)break;(w=new r.default({hidden:!0,antialias:i}).resize(m,b)).drawImage(l.elem,0,0,m,b),l.dispose(),n=m,d=b,l=w}return(w=new r.default({hidden:!0,antialias:i}).resize(a,t)).drawImage(l.elem,0,0,a,t),l.dispose(),o&&dispose(e.data),w.elem},flipImageHorz:function(e){var a=new r.default({hidden:!0}).resize(e.data.width,e.data.height);return a.translate(e.data.width,0),a.scale(-1,1),a.drawImage(e.data,0,0),a.elem},showDownload:function(e,a){var t=document.createElement("a");t.href=a,t.style.display="none",t.download=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},showFilePicker:function(e,a,t){var r=document.createElement("input");r.type="file",r.accept=a,r.style.display="none",r.multiple=e,document.body.appendChild(r),r.onchange=function(){t(r.files)},document.body.onfocus=function(){document.body.onfocus=null,document.body.removeChild(r)},r.click()},loadAsDataURL:function(e,a){var t=new FileReader;t.onload=function(e){a(e.target.result)},t.readAsDataURL(e)},loadAsText:function(e,a){var t=new FileReader;t.onload=function(e){a(e.target.result)},t.readAsText(e)},loadAsArrayBuffer:function(e,a){var t=new FileReader;t.onload=function(e){a(e.target.result)},t.readAsArrayBuffer(e)},loadAllAsDataURL:function(e,a){var t=[];if(e&&e.length){var r=function(i){i!=e.length?l.loadAsDataURL(e[i],function(a){t.push({name:e[i].name,size:e[i].size,url:a}),r(i+1)}):a(t)};r(0)}else a(t)}};var s=l;exports.default=s;
},{"@rsthn/rin":"OHwo","../system/system.js":"tYB4","../system/canvas.js":"sUEe","./wrappers.js":"cYhf"}],"r7Cy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=require("@rsthn/rin"),i=r.Class.extend({className:"PriorityQueue",queue:null,order:null,__ctor:function(){this.queue={}},add:function(r){if(null==r)return null;if(!("priority"in r))throw new Error("PriorityQueue (add): Object has no `priority` property.");return r.priority in this.queue||(this.queue[r.priority]={is_dirty:!1,list:[]},this.order=Object.keys(this.queue).sort((r,i)=>r-i)),-1===this.queue[r.priority].list.indexOf(r)&&this.queue[r.priority].list.push(r),r},remove:function(r){if(null==r)return null;if(!("priority"in r))throw new Error("PriorityQueue (remove): Object has no `priority` property.");if(!(r.priority in this.queue))return r;var i=this.queue[r.priority].list.indexOf(r);return-1===i?r:(this.queue[r.priority].is_dirty=!0,this.queue[r.priority].list[i]=null,r)},cleanup:function(){for(var r in this.queue){var i=this.queue[r];if(0!=i.is_dirty){for(var e=0;e<i.list.length;e++)null==i.list[e]&&i.list[e--].splice(1,0);i.is_dirty=!1}}},forEach:function(r){for(var i=!1,e=!1,t=0;!e&&t<this.order.length;t++)for(var u=this.queue[this.order[t]].list,n=0;!e&&n<u.length;n++)null!=u[n]&&!1===r(u[n])&&(e=!0),null==u[n]&&(i=!0);i&&this.cleanup()},forEachRev:function(r){for(var i=!1,e=!1,t=this.order.length-1;!e&&t>=0;t--)for(var u=this.queue[this.order[t]].list,n=u.length-1;!e&&n>=0;n--)null!=u[n]&&!1===r(u[n])&&(e=!0),null==u[n]&&(i=!0);i&&this.cleanup()},forEachAsync:function(r){var i=this,e=!1,t=!1,u=-1,n=-1,o=null,l=function(){n++,!t&&n<o.length?(null!=o[n]&&!1===r(o[n],l)&&(t=!0),null==o[n]&&(e=!0),t&&l()):s()},s=function(){u++,!t&&u<i.order.length?(o=i.queue[i.order[u]].list,n=-1,l()):e&&i.cleanup()};s()},forEachRevAsync:function(r){}});exports.default=i;
},{"@rsthn/rin":"OHwo"}],"fFA5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("../utils/recycler.js"));function i(t){return t&&t.__esModule?t:{default:t}}const s=function(){};var h=s;exports.default=h,s.prototype.className="Rect",s.prototype.cx=0,s.prototype.cy=0,s.prototype.x1=0,s.prototype.y1=0,s.prototype.x2=0,s.prototype.y2=0,s.prototype.__reinit=function(){switch(arguments.length){case 0:this.Rect0.apply(this,arguments);break;case 2:this.Rect2.apply(this,arguments);break;case 4:this.Rect4.apply(this,arguments)}return this},s.prototype.Rect0=function(){this.x1=this.y1=this.x2=this.y2=this.cx=this.cy=0},s.prototype.Rect4=function(t,i,s,h){this.set(t,i,s,h)},s.prototype.Rect2=function(t,i){this.set(0,0,0,0),this.resize(t,i)},s.prototype.clone=function(){return s.alloc(this.x1,this.y1,this.x2,this.y2)},s.prototype.zero=function(){return this.cx=0,this.cy=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this},s.prototype.reset=function(){return this.cx=null,this.cy=null,this.x1=null,this.y1=null,this.x2=null,this.y2=null,this},s.prototype.extendWithPoint2=function(t,i){return(null===this.x1||t<this.x1)&&(this.x1=t),(null===this.y1||i<this.y1)&&(this.y1=i),(null===this.x2||t>this.x2)&&(this.x2=t),(null===this.y2||i>this.y2)&&(this.y2=i),this.cx=(this.x1+this.x2)/2,this.cy=(this.y1+this.y2)/2,this},s.prototype.extendWithPoint1=function(t){return this.extendWithPoint2(t.x,t.y)},s.prototype.extendWithPoint=function(...t){return 2==t.length?this.extendWithPoint2(t[0],t[1]):this.extendWithPoint1(t[0])},s.prototype.translate=function(t,i){return this.x1+=t,this.y1+=i,this.x2+=t,this.y2+=i,this.cx+=t,this.cy+=i,this},s.prototype.centerAt=function(t,i,s=!1){return 1==s&&(t=this.x1+t*(this.x2-this.x1),i=this.y1+i*(this.y2-this.y1)),this.translate(t-this.cx,i-this.cy)},s.prototype.set=function(...t){switch(t.length){case 1:return this.set1(...t);case 4:return this.set4(...t)}},s.prototype.set4=function(t,i,s,h){return this.cx=(t+s)/2,this.cy=(i+h)/2,this.x1=t,this.y1=i,this.x2=s,this.y2=h,this},s.prototype.set1=function(t){return this.set4(t.x1,t.y1,t.x2,t.y2)},s.prototype.equals=function(){switch(arguments.length){case 1:return this.equals1.apply(this,arguments);case 4:return this.equals4.apply(this,arguments)}},s.prototype.equals1=function(t){return this.x1==t.x1&&this.x2==t.x2&&this.y1==t.y1&&this.y2==t.y2},s.prototype.equals4=function(t,i,s,h){return t==this.x1&&s==this.x2&&i==this.y1&&h==this.y2},s.prototype.contains=function(){switch(arguments.length){case 1:return this.contains1.apply(this,arguments);case 4:return this.contains4.apply(this,arguments)}},s.prototype.contains1=function(t){return t.equals(Math.max(this.x1,t.x1),Math.max(this.y1,t.y1),Math.min(this.x2,t.x2),Math.min(this.y2,t.y2))},s.prototype.contains4=function(t,i,s,h){return t==Math.max(this.x1,t)&&i==Math.max(this.y1,i)&&s==Math.min(this.x2,s)&&h==Math.min(this.y2,h)},s.prototype.setAsUnion=function(){switch(arguments.length){case 1:return this.setAsUnion1.apply(this,arguments);case 4:return this.setAsUnion4.apply(this,arguments)}},s.prototype.setAsUnion1=function(t){return this.setAsUnion4(t.x1,t.y1,t.x2,t.y2)},s.prototype.setAsUnion4=function(t,i,s,h){return this.x1=Math.min(this.x1,t),this.y1=Math.min(this.y1,i),this.x2=Math.max(this.x2,s),this.y2=Math.max(this.y2,h),this},s.prototype.intersects=function(){switch(arguments.length){case 1:return this.intersects1.apply(this,arguments);case 4:return this.intersects4.apply(this,arguments)}},s.prototype.intersects1=function(t){return this.intersects4(t.x1,t.y1,t.x2,t.y2)},s.prototype.intersects4=function(t,i,s,h){var e=Math.max(this.x1,t),n=Math.max(this.y1,i),o=Math.min(this.x2,s),r=Math.min(this.y2,h);return Math.max(0,r-n)*Math.max(0,o-e)>0},s.prototype.setAsIntersection=function(){switch(arguments.length){case 1:return this.setAsIntersection1.apply(this,arguments);case 4:return this.setAsIntersection4.apply(this,arguments)}},s.prototype.setAsIntersection1=function(t){return this.setAsIntersection4(t.x1,t.y1,t.x2,t.y2)},s.prototype.setAsIntersection4=function(t,i,s,h){return this.x1=Math.max(this.x1,t),this.y1=Math.max(this.y1,i),this.x2=Math.min(this.x2,s),this.y2=Math.min(this.y2,h),Math.max(0,this.y2-this.y1)*Math.max(0,this.x2-this.x1)>0},s.prototype.resize=function(t,i,s=!1,h=!1){return 1==s&&(t*=this.x2-this.x1,i*=this.y2-this.y1),1==h?(this.x2=this.x1+t,this.y2=this.y1+i):(t/=2,i/=2,this.x1=this.cx-t,this.y1=this.cy-i,this.x2=this.cx+t,this.y2=this.cy+i),this},s.prototype.resizeBy=function(t,i,s=!1){return 1==s?(this.x2+=t,this.y2+=i):(t/=2,i/=2,this.x1-=t,this.y1-=i,this.x2+=t,this.y2+=i),this},s.prototype.width=function(){return this.x2-this.x1},s.prototype.height=function(){return this.y2-this.y1},s.prototype.ncx=function(){return(this.cx-this.x1)/(this.x2-this.x1)},s.prototype.ncy=function(){return(this.cy-this.y1)/(this.y2-this.y1)},s.prototype.isRight=function(){return this.x1<=this.x2&&this.y1<=this.y2},s.prototype.containsPoint=function(t,i,s){return s||(s=0),this.x1-s<=t&&t<=this.x2+s&&this.y1-s<=i&&i<=this.y2+s},s.prototype.area=function(t){return t?this.isRight()?(this.y2-this.y1)*(this.x2-this.x1):0:(this.y2-this.y1)*(this.x2-this.x1)},s.prototype.floor=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.floor(this.x2),this.y2=Math.floor(this.y2),this.cx=Math.floor(this.cx),this.cy=Math.floor(this.cy),this},s.prototype.ceil=function(){return this.x1=Math.ceil(this.x1),this.y1=Math.ceil(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this.cx=Math.ceil(this.cx),this.cy=Math.ceil(this.cy),this},s.prototype.toString=function(){return"(Rect: "+this.x1.toFixed(2)+", "+this.y1.toFixed(2)+", "+this.x2.toFixed(2)+", "+this.y2.toFixed(2)+")"},s.prototype.flatten=function(){return[this.x1,this.y1,this.x2,this.y2]},s.prototype.unflatten=function(t){return this.set(t[0],t[1],t[2],t[3]),this},t.default.attachTo(s);
},{"../utils/recycler.js":"X2Ny"}],"lN7n":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=function(){switch(arguments.length){case 0:return this.Vec2_0.apply(this,arguments);case 1:return this.Vec2_1.apply(this,arguments);case 2:return this.Vec2_2.apply(this,arguments)}};var i=t;exports.default=i,t.prototype.x=0,t.prototype.y=0,t.prototype.Vec2_0=function(){this.x=this.y=0},t.prototype.Vec2_2=function(t,i){this.x=t,this.y=i},t.prototype.Vec2_1=function(t){this.x=t.x,this.y=t.y},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(t,i){return 1==arguments.length?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),this},t.prototype.zero=function(){return this.set(0,0)},t.prototype.isZero=function(){return 0==this.x&&0==this.y},t.prototype.equals=function(t,i){return 1==arguments.length?this.x==t.x&&this.y==t.y:this.x==t&&this.y==i},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.inv=function(){return this.x=1/this.x,this.y=1/this.y,this},t.prototype.abs=function(){return this.x=this.x<0?-this.x:this.x,this.y=this.y<0?-this.y:this.y,this},t.prototype.translate=function(t,i){return 1==arguments.length?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=i),this},t.prototype.add=function(t,i){return 1==arguments.length?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=i),this},t.prototype.sub=function(t,i){return 1==arguments.length?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=i),this},t.prototype.scale=function(t,i){return 1==arguments.length?(this.x*=t,this.y*=t):(this.x*=t,this.y*=i),this},t.prototype.floor=function(){return this.x=~~this.x,this.y=~~this.y,this},t.prototype.fract=function(){return this.x=this.x-~~this.x,this.y=this.y-~~this.y,this},t.prototype.dot=function(t,i){return 2==arguments.length?this.x*t+this.y*i:this.x*t.x+this.y*t.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalize=function(){return this.isZero()?this:this.scale(1/this.magnitude())},t.prototype.majorAxis=function(){return Math.abs(this.x)>Math.abs(this.y)?this.y=0:this.x=0,this},t.prototype.minorAxis=function(){return Math.abs(this.x)<Math.abs(this.y)?this.y=0:this.x=0,this},t.prototype.sign=function(){return this.x=this.x?this.x<0?-1:1:0,this.y=this.y?this.y<0?-1:1:0,this},t.prototype.toString=function(){return"(".concat(this.x,", ").concat(this.y,")")};
},{}],"jNL3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin");const i=t.Class.extend({className:"TFunction",t:null,y:null,f:null,__ctor:function(t){this.reset(t)},reset:function(t=0){return this.t=[0],this.y=[t],this.f=[null],this},copyFrom:function(t,i,n){if(this.t=[],this.y=[],this.f=[],null==i&&null==n){for(let i=0;i<t.t.length;i++)this.t.push(t.t[i]),this.y.push(t.y[i]),this.f.push(t.f[i]);return this}null==i&&(i=t.t[0]),null==n&&(n=t.t[t.t.length-1]),i<t.t[0]&&(i=t.t[0]);let e=t.find(i),s=t.find(n);if(null==e)return null;if(null==s)return null;t.t[e]!=i&&(this.set(i,t.getAt(i),t.f[e]),e++);for(let h=e;h<=s;h++)this.set(t.t[h],t.y[h],t.f[h]);if(t.t[s]!=n){let i=(n-t.t[s])/Math.ceil(Math.log(n-t.t[s])),e=this.t[this.t.length-1];for(i<=0&&(i=1),i=n-e;e!=n;)e+i>n&&(i=n-e),e+=i,this.set(float4(e),t.getAt(e),t.f[s])}return this},clone:function(t,n){return(new i).copyFrom(this,t,n)},endTime:function(t=0){return this.t[this.t.length-1]+t},startTime:function(t=0){return this.t[0]+t},find:function(t){if(t<this.t[0])return null;const i=this.t.length;for(let n=1;n<i;n++)if(t<this.t[n])return n-1;return i-1},set:function(t,i,n=null){let e=this.find(t);return null!=e&&(this.t[e]==t?(this.y[e]=i,null!=n&&(this.f[e]=n)):(e++,this.t.splice(e,0,t),this.y.splice(e,0,i),this.f.splice(e,0,n)),!0)},get:function(){return this.y[this.y.length-1]},getAt:function(t){let i=this.find(t);if(null==i)return 0;let n=i+1;if(this.t[i]==t||n>=this.t.length||this.y[i]==this.y[n]||null==this.f[i])return this.y[i];if(null==this.f[i])return this.y[i];let e=t,s=this.t[i],h=this.t[n],l=this.y[i],r=this.y[n];return t=(e-s)/(h-s),(t=this.f[i](t))*r+(1-t)*l},integral:function(t=null,i=null,n=0){null==t&&(t=this.t[0]),null==i&&(i=this.t[this.t.length-1]),t<this.t[0]&&(t=this.t[0]);let e=1;if(t>i){let n;n=t,t=i,i=n,e=-1}let s=n;for(let h=t;h<i;){let t=this.find(h);if(null==t)return 0;let n=t+1,e=Math.max(this.t[t],h),l=Math.min(n<this.t.length?this.t[n]:i,i),r=this.getAt(e),u=l-e,f=this.getAt(l)-r;null==this.f[t]?s+=r*u:s+=.5*f*(l+e)-e*f+r*u,h+=u}return e*s},second_integral:function(t=null,n=null,e=0){null==t&&(t=this.t[0]),null==n&&(n=this.t[this.t.length-1]);let s=i.Temp1.copyFrom(this,this.t[0],t).integrate(e).integral();return i.Temp2.copyFrom(this,this.t[0],n).integrate(e).integral()-s},integrate:function(t=0){let i=[];i.push(t);for(let n=1;n<this.t.length;n++)i.push(i[n-1]+this.integral(this.t[n-1],this.t[n]));return this.y=i,this},accumulate:function(t=0){this.y[0]+=t;for(let i=1;i<this.t.length;i++)this.y[i]+=this.y[i-1];return this},chopLeft:function(t){return this.t.splice(0,t),this.f.splice(0,t),this.y.splice(0,t),this},chopRight:function(t){return this.t.splice(t+1,this.t.length-t-1),this.f.splice(t+1,this.f.length-t-1),this.y.splice(t+1,this.y.length-t-1),this},map:function(t){for(let i=0;i<this.y.length;i++)this.y[i]=t(this.y[i],this.t[i],i);return this},toString:function(t=0){let i="",n=10;const e=function(t,i,n){for(t=t.toString(),null==n&&(n=" "),n=n[0];t.length<i;)t+=n;return t};i+="\n",i+=e(" Time",n)+" "+e(" Value",n)+" "+e(" Integral",n)+"\n",i+=e("",n,"-")+" "+e("",n,"-")+" "+e("",n,"-")+"\n";for(let s=0;s<this.t.length;s++)i+=e(" "+float4(this.t[s]),n)+" "+e(" "+float4(this.y[s]),n)+" "+e(" "+float4(this.integral(this.t[0],this.t[s],t)),n)+"\n";return i}});i.Temp1=new i,i.Temp2=new i;var n=i;exports.default=n;
},{"@rsthn/rin":"OHwo"}],"EVe8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const n={Linear:{IN:function(n){return n},OUT:function(n){return n},IN_OUT:function(n){return n}},Back:{k:1.70158,IN:function(t,u){return void 0===u&&(u=n.Back.k),t*t*((u+1)*t-u)},OUT:function(t,u){return 1-n.Back.IN(1-t,u)},IN_OUT:function(t,u){return t<.5?n.Back.IN(2*t,u)/2:n.Back.OUT(2*(t-.5),u)/2+.5}},Bounce:{getConst:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},IN:function(t){return 1-n.Bounce.getConst(1-t)},OUT:function(t){return n.Bounce.getConst(t)},IN_OUT:function(t){return t<.5?(1-n.Bounce.getConst(1-2*t))/2:n.Bounce.getConst(2*(t-.5))/2+.5}},Circ:{IN:function(n){return 1-Math.sqrt(1-n*n)},OUT:function(t){return 1-n.Circ.IN(1-t)},IN_OUT:function(t){return t<.5?n.Circ.IN(2*t)/2:n.Circ.OUT(2*(t-.5))/2+.5}},Cubic:{IN:function(n){return n*n*n},OUT:function(t){return 1-n.Cubic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Cubic.IN(2*t)/2:n.Cubic.OUT(2*(t-.5))/2+.5}},Expo:{IN:function(n){return Math.pow(2,12*(n-1))},OUT:function(n){return 1-Math.pow(2,-12*n)},IN_OUT:function(n){return(n*=2)<1?Math.pow(2,12*(n-1))/2:(2-Math.pow(2,-12*(n-1)))/2}},Power:{p:12,IN:function(t){return Math.pow(t,n.Power.p)},OUT:function(t){return 1-n.Power.IN(1-t)},IN_OUT:function(t){return t<.5?n.Power.IN(2*t)/2:n.Power.OUT(2*(t-.5))/2+.5}},Quad:{IN:function(n){return n*n},OUT:function(t){return 1-n.Quad.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quad.IN(2*t)/2:n.Quad.OUT(2*(t-.5))/2+.5}},Quartic:{IN:function(n){return n*n*n*n},OUT:function(t){return 1-n.Quartic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quartic.IN(2*t)/2:n.Quartic.OUT(2*(t-.5))/2+.5}},Quintic:{IN:function(n){return n*n*n*n*n},OUT:function(t){return 1-n.Quintic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quintic.IN(2*t)/2:n.Quintic.OUT(2*(t-.5))/2+.5}},Sine:{IN:function(n){return 1-Math.sin(1.5708*(1-n))},OUT:function(n){return Math.sin(1.5708*n)},IN_OUT:function(n){return(Math.cos(3.1416*n)-1)/-2}},Step:{IN:function(n){return 1!=n?0:1},OUT:function(n){return 1!=n?0:1},IN_OUT:function(n){return 1!=n?0:1}}};var t=n;exports.default=t;
},{}],"ZonQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@rsthn/rin");const i=t.Class.extend({list:null,initialData:null,data:null,stack:null,block:null,timeScale:1,time:0,blockTime:0,index:0,paused:!1,finished:!1,finishedCallback:null,finishedCallbackChain:null,__ctor:function(){this.list=[],this.stack=[],this.initialData={},this.data={},this.reset()},__dtor:function(){},clone:function(e=null){return e||(e=new i),e.list=t.Rin.clone(this.list),e.initialData=this.initialData,e.reset()},onFinished:function(t){return this.finishedCallback=t,this},then:function(t){return this.finishedCallback!==this.thenCallback&&(this.finishedCallback=this.thenCallback,this.finishedCallbackChain=[]),this.finishedCallbackChain.push(t),this},thenCallback:function(){if(!this.finishedCallbackChain.length)return!1;this.finishedCallbackChain.shift().call(this)},clear:function(){return this.list=[],this.stack.length=0,this.blockTime=0,this.time=0,this.index=0,this.block=this.list,this.paused=!1,this.finished=!1,this},reset:function(){this.clear();for(let t in this.initialData)this.data[t]=this.initialData[t];return this},initial:function(t){return this.initialData=t,this.reset()},speed:function(t){return this.timeScale=t>0?t:1,this},output:function(t){return this.data=t,this},pause:function(){return this.paused=!0,this},resume:function(){return this.finished=!1,this.paused=!1,this},getValue:function(t,i){let e=this.data[i];if(null===t&&(t=e),"string"==typeof t)switch(t[0]){case"+":t=e+Number(t.substr(1));break;case"-":t=e-Number(t.substr(1));break;default:t=Number(t)}return"function"==typeof t&&(t=t.call(this,this.data[i],this.data,this)),t},update:function(e){if(this.paused)return!1;if(this.index>=this.block.length)return!0;let s,n,l,a=0;for(this.time+=e*this.timeScale*i.timeScale;this.index<this.block.length;){let i,h=this.block[this.index];switch(h.op){case"parallel":if(0==h.started)for(h.blocks.length=0,h.started=!0,a=0;a<h.block.length;a++)h.blocks.push([h.block[a]]),h.indices[a]=0,h.blockTimes[a]=this.blockTime;s=this.block,n=this.index;let r=0,c=l=this.blockTime;for(a=0;a<h.blocks.length;a++)this.block=h.blocks[a],this.index=h.indices[a],this.blockTime=h.blockTimes[a],!0===this.update(0)&&r++,this.blockTime>c&&(c=this.blockTime),h.blockTimes[a]=this.blockTime,h.blocks[a]=this.block,h.indices[a]=this.index;if(this.block=s,this.index=n,this.blockTime=l,h.fn&&h.fn.call(this),r!=h.blocks.length)return!1;h.started=!1,this.blockTime=c,this.index++;break;case"serial":if(0==h.started&&(h._block=h.block,h._index=0,h._blockTime=this.blockTime,h.started=!0),s=this.block,n=this.index,l=this.blockTime,this.block=h._block,this.index=h._index,this.blockTime=h._blockTime,a=this.update(0),h._block=this.block,h._index=this.index,h._blockTime=this.blockTime,this.block=s,this.index=n,this.blockTime=l,h.fn&&h.fn.call(this),!0!==a)return!1;h.started=!1,this.blockTime=h._blockTime,this.index++;break;case"repeat":return 0==h.started&&(h._block=h.block,h._index=0,h._blockTime=this.blockTime,h._count=h.count,h.started=!0),s=this.block,n=this.index,l=this.blockTime,this.block=h._block,this.index=h._index,this.blockTime=h._blockTime,a=this.update(0),h._block=this.block,h._index=this.index,h._blockTime=this.blockTime,this.block=s,this.index=n,this.blockTime=l,h.fn&&h.fn.call(this),!0===a&&(h._count<=1?(h.started=!1,this.blockTime=h._blockTime,this.index++,!1):(h._index=0,h._count--,!1));case"set":this.data[h.field]=this.getValue(h.value,h.field),this.index++;break;case"restart":this.index=0;break;case"wait":if(i="string"==t.Rin.typeOf(h.duration)?this.data[h.duration]:h.duration,this.time<this.blockTime+i)return!1;this.blockTime+=i,this.index++;break;case"range":if(0==h.started&&(h._startValue=this.getValue(h.startValue,h.field),h._endValue=this.getValue(h.endValue,h.field),h.started=!0),i="string"==t.Rin.typeOf(h.duration)?this.data[h.duration]:h.duration,e=this.time<this.blockTime+i?(this.time-this.blockTime)/i:1,h.easing&&1!=e?this.data[h.field]=h.easing(e)*(h._endValue-h._startValue)+h._startValue:this.data[h.field]=e*(h._endValue-h._startValue)+h._startValue,1!=e)return!1;h.started=!1,this.blockTime+=i,this.index++;break;case"rand":if(0==h.started&&(h.started=!0,h.last=null),i="string"==t.Rin.typeOf(h.duration)?this.data[h.duration]:h.duration,e=this.time<this.blockTime+i?(this.time-this.blockTime)/i:1,h.easing&&1!=e?h.cur=~~(h.easing(e)*h.count):h.cur=~~(e*h.count),h.cur!=h.last){for(;(a=~~(Math.random()*(h.endValue-h.startValue+1))+h.startValue)==this.data[h.field];);this.data[h.field]=a,h.last=h.cur}if(1!=e)return!1;h.started=!1,this.blockTime+=i,this.index++;break;case"randt":if(i="string"==t.Rin.typeOf(h.duration)?this.data[h.duration]:h.duration,e=this.time<this.blockTime+i?(this.time-this.blockTime)/i:1,a=h.easing&&1!=e?h.easing(e)*(h.count-1):e*(h.count-1),this.data[h.field]=h.table[~~((a+h.count)%h.count)],1!=e)return!1;this.blockTime+=i,this.index++;break;case"play":h.snd.play(),this.index++;break;case"exec":if(0==h.started&&(h.started=!0,h.lastTime=this.time),e=this.time-h.lastTime,h.lastTime=this.time,!0!==h.fn.call(this,e,this.data,this))return!1;h.started=!1,this.index++}}if(this.block==this.list){let t=this.finished,i=this.block.length,e=this.list;if(this.finished=!0,!t&&null!=this.finishedCallback){if(!1===this.finishedCallback(this.data,this)&&(this.finishedCallback=!1),e!==this.list||this.block.length!=i)return this.resume(),!1}}return!0},parallel:function(){let t=[];return this.block.push({op:"parallel",started:!1,block:t,blocks:[],indices:[],blockTimes:[]}),this.stack.push(this.block),this.block=t,this},serial:function(){let t=[];return this.block.push({op:"serial",started:!1,block:t}),this.stack.push(this.block),this.block=t,this},repeat:function(t){let i=[];return this.block.push({op:"repeat",started:!1,block:i,count:t}),this.stack.push(this.block),this.block=i,this},callback:function(t){let i=this.stack[this.stack.length-1];return i[i.length-1].fn=t,this},end:function(){return this.block=this.stack.pop(),this},set:function(t,i){return this.block.push({op:"set",field:t,value:i}),this},restart:function(t){return this.block.push({op:"restart"}),this},wait:function(t){return this.block.push({op:"wait",duration:t}),this},range:function(t,i,e,s,n){return this.block.push({op:"range",started:!1,field:t,duration:i,startValue:e,endValue:s,easing:n||null}),this},rand:function(t,i,e,s,n,l){return this.block.push({op:"rand",started:!1,field:t,duration:i,count:e,startValue:s,endValue:n,easing:l||null}),this},randt:function(t,i,e,s,n,l){let a=[];for(let h=0;h<e;h++)a.push(h%(n-s+1)+s);for(let h=e>>2;h>0;h--){let t=~~(Math.random()*e),i=~~(Math.random()*e),s=a[i];a[i]=a[t],a[t]=s}return this.block.push({op:"randt",field:t,duration:i,count:e,startValue:s,endValue:n,table:a,easing:l||null}),this},play:function(t){return this.block.push({op:"play",snd:t}),this},exec:function(t){return this.block.push({op:"exec",fn:t,started:!1}),this},setX:function(t){return this.set("x",t)},setY:function(t){return this.set("y",t)},position:function(t,i){return this.set("x",t).set("y",i)},translateX:function(t,i,e){return this.range("x",t,null,(i<0?"-":"+")+Math.abs(i),e)},translateY:function(t,i,e){return this.range("y",t,null,(i<0?"-":"+")+Math.abs(i),e)},translate:function(t,i,e,s){return this.parallel().range("x",t,null,(i<0?"-":"+")+Math.abs(i),s).range("y",t,null,(e<0?"-":"+")+Math.abs(e),s).end()},scaleX:function(t,i,e){return this.range("sx",t,null,i,e)},scaleY:function(t,i,e){return this.range("sy",t,null,i,e)},scale:function(t,i,e,s){return this.parallel().range("sx",t,null,i,s).range("sy",t,null,e,s).end()},rotate:function(t,i,e){return this.range("angle",t,null,(i<0?"-":"+")+Math.abs(i),e)}});i.timeScale=1,i.speed=function(t){i.timeScale=t>0?t:1};var e=i;exports.default=e;
},{"@rsthn/rin":"OHwo"}],"epB2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Anim=exports.Easing=exports.TFunction=exports.Vec2=exports.Rect=exports.Matrix=exports.PriorityQueue=exports.List=exports.Linkable=exports.Recycler=exports.Resources=exports.Wrappers=exports.IUpdateable=exports.IDrawable=exports.Log=exports.Perf=exports.Canvas=exports.KeyCodes=exports.Timer=exports.System=exports.C=exports.G=void 0;var e=w(require("./system/globals.js")),t=w(require("./system/config.js")),r=w(require("./system/system.js")),s=w(require("./system/timer.js")),o=w(require("./system/keycodes.js")),u=w(require("./system/canvas.js")),i=w(require("./system/perf.js")),a=w(require("./system/log.js")),n=w(require("./system/idrawable.js")),p=w(require("./system/iupdateable.js")),c=O(require("./resources/wrappers.js")),l=w(require("./resources/resources.js")),x=w(require("./utils/recycler.js")),f=w(require("./utils/linkable.js")),d=w(require("./utils/list.js")),y=w(require("./utils/priority-queue.js")),j=w(require("./math/matrix.js")),m=w(require("./math/rect.js")),q=w(require("./math/vec2.js")),b=w(require("./math/tfunction.js")),g=w(require("./anim/easing.js")),v=w(require("./anim/anim.js"));function P(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return P=function(){return e},e}function O(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=P();if(t&&t.has(e))return t.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var u=s?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}function w(e){return e&&e.__esModule?e:{default:e}}const M=e.default;exports.G=M;const h=t.default;exports.C=h;const k=r.default;exports.System=k;const C=s.default;exports.Timer=C;const L=o.default;exports.KeyCodes=L;const R=u.default;exports.Canvas=R;const _=i.default;exports.Perf=_;const D=a.default;exports.Log=D;const I=n.default;exports.IDrawable=I;const T=p.default;exports.IUpdateable=T;const W=c;exports.Wrappers=W;const A=l.default;exports.Resources=A;const E=x.default;exports.Recycler=E;const F=f.default;exports.Linkable=F;const G=d.default;exports.List=G;const K=y.default;exports.PriorityQueue=K;const Q=j.default;exports.Matrix=Q;const S=m.default;exports.Rect=S;const U=q.default;exports.Vec2=U;const V=b.default;exports.TFunction=V;const z=g.default;exports.Easing=z;const B=v.default;exports.Anim=B;
},{"./system/globals.js":"tjXp","./system/config.js":"LZnf","./system/system.js":"tYB4","./system/timer.js":"D2RU","./system/keycodes.js":"QPdb","./system/canvas.js":"sUEe","./system/perf.js":"WRLr","./system/log.js":"wkWf","./system/idrawable.js":"Ic9U","./system/iupdateable.js":"B6u2","./resources/wrappers.js":"cYhf","./resources/resources.js":"LdWd","./utils/recycler.js":"X2Ny","./utils/linkable.js":"KbP4","./utils/list.js":"j8vy","./utils/priority-queue.js":"r7Cy","./math/matrix.js":"YOKs","./math/rect.js":"fFA5","./math/vec2.js":"lN7n","./math/tfunction.js":"jNL3","./anim/easing.js":"EVe8","./anim/anim.js":"ZonQ"}]},{},["epB2"], "cherry")